(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}})();const p={LOG_PATH:"/data/adb/gpu_governor/log",CONFIG_PATH:"/data/adb/gpu_governor/config/gpu_freq_table.toml",CURRENT_MODE_PATH:"/data/adb/gpu_governor/config/current_mode",GAMES_FILE:"/data/adb/gpu_governor/game/games.toml",LOG_LEVEL_PATH:"/data/adb/gpu_governor/log/log_level",CUSTOM_CONFIG_PATH:"/data/adb/gpu_governor/config/config.toml"},M=[65e3,64375,63750,63125,62500,61875,61250,60625,6e4,59375,58750,58125,57500,56875,56250,55625,55e3,54375,53750,53125,52500,51875,51250,50625,5e4,49375,48750,48125,47500,46875,46250,45625,45e3,44375,43750,43125,42500,41875],_={VOLT_STEP:625,MAX_VOLT:65e3,MIN_VOLT:41875},f={zh:{title:"天玑GPU调速器",loading:"加载中",header_title:"天玑GPU调速器",nav_status:"状态",nav_config:"配置",nav_log:"日志",nav_settings:"设置",status_title:"模块状态",status_running:"运行状态:",status_running_active:"运行中",status_running_inactive:"未运行",status_checking:"检查中...",status_current_mode:"当前模式:",status_mode_powersave:"省电",status_mode_balance:"均衡",status_mode_performance:"性能",status_mode_fast:"极速",status_mode_unknown:"未知",status_module_version:"模块版本:",status_unknown:"未知",config_gpu_title:"GPU频率表",config_freq:"频率 (MHz)",config_volt:"电压 (uV)",config_ddr:"内存档位",config_edit:"编辑",config_loading:"加载中...",config_not_found:"未找到配置",config_add:"添加配置",config_save:"保存配置",config_games_title:"游戏列表",config_games_add:"添加游戏",config_games_save:"保存列表",config_games_search_placeholder:"搜索游戏...",config_custom_settings:"自定义设置",config_global_settings:"全局设置",config_global_mode:"全局模式:",config_mode_powersave:"省电模式",config_mode_balance:"均衡模式",config_mode_performance:"性能模式",config_mode_fast:"极速模式",config_idle_threshold:"空闲阈值 (%):",config_powersave_mode:"省电模式设置",config_balance_mode:"均衡模式设置",config_performance_mode:"性能模式设置",config_fast_mode:"极速模式设置",config_margin:"余量 (%):",config_sampling_interval:"采样间隔 (ms):",config_min_adaptive_interval:"最小自适应间隔 (ms):",config_max_adaptive_interval:"最大自适应间隔 (ms):",config_up_rate_delay:"升频延迟 (ms):",config_down_rate_delay:"降频延迟 (ms):",config_aggressive_down:"激进降频策略",config_gaming_mode:"游戏优化",config_adaptive_sampling:"自适应采样",config_load_custom:"加载配置",config_save_custom:"保存配置",log_title:"运行日志",log_refresh:"刷新",log_main:"主日志",log_init:"初始化日志",log_loading:"加载中...",log_empty:"日志为空",log_not_found:"未找到日志",log_size_warning:"警告: 日志文件较大",settings_title:"设置",settings_theme_follow:"深色模式跟随系统",settings_theme_follow_summary:"自动根据系统设置切换主题",settings_language:"语言设置:",settings_language_follow:"跟随系统",settings_language_zh:"中文",settings_language_en:"English",settings_language_desc1:"修改语言设置后实时生效",settings_language_desc2:"跟随系统将自动检测系统语言设置",settings_log_level:"主日志等级:",settings_log_level_debug:"Debug (详细)",settings_log_level_info:"Info (信息)",settings_log_level_warn:"Warn (警告)",settings_log_level_error:"Error (错误)",settings_log_level_desc1:"修改日志等级后实时生效",settings_log_level_desc2:"设置为Debug级别将启用详细日志记录",edit_config_title:"编辑GPU频率表",edit_config_freq:"频率 (MHz):",edit_config_freq_example:"例如: 350000 (KHz)",edit_config_freq_hint:"请输入KHz值，表格中显示为MHz",edit_config_volt:"电压 (uV):",edit_config_ddr:"内存档位:",edit_config_ddr_default:"999 (不调整)",edit_config_ddr_highest:"0 (最高)",edit_config_ddr_high:"1",edit_config_ddr_medium:"2",edit_config_ddr_low:"3",edit_config_save:"保存",edit_config_cancel:"取消",edit_config_delete:"删除",edit_game_title:"编辑游戏列表",edit_game_package:"应用包名:",edit_game_package_example:"例如: com.tencent.tmgp.sgame",edit_game_mode:"对应模式:",edit_game_save:"保存",edit_game_cancel:"取消",toast_webui_loaded:"WebUI加载完成",toast_theme_follow_disabled:"已关闭跟随系统主题，现在可以手动切换主题",toast_theme_follow_enabled:"已开启跟随系统主题",toast_theme_follow_keep:"已关闭跟随系统主题，将保持当前主题",toast_theme_switched_dark:"已切换到深色模式",toast_theme_switched_light:"已切换到浅色模式",toast_config_updated:'配置已更新，请点击"保存配置"按钮保存到文件',toast_config_deleted:'配置已删除，请点击"保存配置"按钮保存到文件',toast_config_saved:"配置已成功保存",toast_config_save_fail:"保存配置失败，请检查权限",toast_config_empty:"没有配置可保存",toast_freq_invalid:"请输入有效的频率值",toast_index_invalid:"无效的配置索引",toast_custom_config_loaded:"自定义配置加载完成",toast_game_added:'游戏已添加，请点击"保存列表"按钮保存到文件',toast_game_deleted:'游戏已删除，请点击"保存列表"按钮保存到文件',toast_game_exists:"该应用包名已存在于列表中",toast_game_invalid:"请输入有效的应用包名",toast_games_saved:"游戏列表已成功保存",toast_games_save_fail:"保存游戏列表失败，请检查权限",toast_games_empty:"没有游戏可保存",toast_log_level_debug:"日志等级已设置为: debug，详细日志记录已启用",toast_log_level_set:"日志等级已设置为: {level}，已实时生效",toast_log_level_fail:"保存日志等级失败，请检查权限",toast_language_changed:"语言已切换为{language}",toast_language_follow_system:"语言已设置为跟随系统",copyright_text:"天玑GPU调速器 © 2025 酷安@瓦力喀 = Github@Seyud",config_games_not_found:"未找到游戏",config_games_list_not_found:"未找到游戏列表"},en:{title:"Mediatek Mali GPU Governor",loading:"Loading",header_title:"Mediatek Mali GPU Governor",nav_status:"Status",nav_config:"Config",nav_log:"Log",nav_settings:"Settings",status_title:"Module Status",status_running:"Running Status:",status_running_active:"Running",status_running_inactive:"Not Running",status_checking:"Checking...",status_current_mode:"Current Mode:",status_mode_powersave:"Powersave",status_mode_balance:"Balance",status_mode_performance:"Performance",status_mode_fast:"Fast",status_mode_unknown:"Unknown",status_module_version:"Module Version:",status_unknown:"Unknown",config_gpu_title:"GPU Frequency Table",config_freq:"Frequency (MHz)",config_volt:"Voltage (uV)",config_ddr:"Memory Level",config_edit:"Edit",config_loading:"Loading...",config_not_found:"No configuration found",config_add:"Add Config",config_save:"Save Config",config_games_title:"Games List",config_games_add:"Add Game",config_games_save:"Save List",config_games_search_placeholder:"Search games...",config_custom_settings:"Custom Settings",config_global_settings:"Global Settings",config_global_mode:"Global Mode:",config_mode_powersave:"Powersave Mode",config_mode_balance:"Balance Mode",config_mode_performance:"Performance Mode",config_mode_fast:"Fast Mode",config_idle_threshold:"Idle Threshold (%):",config_powersave_mode:"Powersave Mode Settings",config_balance_mode:"Balance Mode Settings",config_performance_mode:"Performance Mode Settings",config_fast_mode:"Fast Mode Settings",config_margin:"Margin (%):",config_sampling_interval:"Sampling Interval (ms):",config_min_adaptive_interval:"Min Adaptive Interval (ms):",config_max_adaptive_interval:"Max Adaptive Interval (ms):",config_up_rate_delay:"Up Rate Delay (ms):",config_down_rate_delay:"Down Rate Delay (ms):",config_aggressive_down:"Aggressive Down Strategy",config_gaming_mode:"Gaming Mode",config_adaptive_sampling:"Adaptive Sampling",config_load_custom:"Load Config",config_save_custom:"Save Config",log_title:"Runtime Log",log_refresh:"Refresh",log_main:"Main Log",log_init:"Init Log",log_loading:"Loading...",log_empty:"Log is empty",log_not_found:"Log not found",log_size_warning:"Warning: Log file size exceeds limit, it will be rotated automatically.",settings_title:"Settings",settings_theme_follow:"Follow System Dark Mode",settings_theme_follow_summary:"Automatically switch theme based on system settings",settings_language:"Language:",settings_language_follow:"Follow System",settings_language_zh:"中文",settings_language_en:"English",settings_language_desc1:"Language changes take effect immediately",settings_language_desc2:"Follow System will detect system language settings",settings_log_level:"Main Log Level:",settings_log_level_debug:"Debug (Detailed)",settings_log_level_info:"Info",settings_log_level_warn:"Warn",settings_log_level_error:"Error",settings_log_level_desc1:"Log level changes take effect immediately",settings_log_level_desc2:"Debug level enables detailed logging",edit_config_title:"Edit GPU Frequency Table",edit_config_freq:"Frequency (MHz):",edit_config_freq_example:"e.g.: 350000 (KHz)",edit_config_freq_hint:"Please enter KHz value, displayed as MHz in table",edit_config_volt:"Voltage (uV):",edit_config_ddr:"Memory Level:",edit_config_ddr_default:"999 (No Change)",edit_config_ddr_highest:"0 (Highest)",edit_config_ddr_high:"1",edit_config_ddr_medium:"2",edit_config_ddr_low:"3",edit_config_save:"Save",edit_config_cancel:"Cancel",edit_config_delete:"Delete",edit_game_title:"Edit Games List",edit_game_package:"Package Name:",edit_game_package_example:"e.g.: com.tencent.tmgp.sgame",edit_game_mode:"Corresponding Mode:",edit_game_save:"Save",edit_game_cancel:"Cancel",toast_webui_loaded:"WebUI loaded successfully",toast_theme_follow_disabled:"System theme following disabled, you can now switch themes manually",toast_theme_follow_enabled:"System theme following enabled",toast_theme_follow_keep:"System theme following disabled, current theme will be kept",toast_theme_switched_dark:"Switched to dark mode",toast_theme_switched_light:"Switched to light mode",toast_config_updated:'Configuration updated, please click "Save Config" to save to file',toast_config_deleted:'Configuration deleted, please click "Save Config" to save to file',toast_config_saved:"Configuration saved successfully",toast_config_save_fail:"Failed to save configuration, please check permissions",toast_config_empty:"No configuration to save",toast_freq_invalid:"Please enter a valid frequency value",toast_index_invalid:"Invalid configuration index",toast_custom_config_loaded:"Custom configuration loaded",toast_game_added:'Game added, please click "Save List" button to save to file',toast_game_deleted:'Game deleted, please click "Save List" button to save to file',toast_game_exists:"This package name already exists in the list",toast_game_invalid:"Please enter a valid package name",toast_games_saved:"Games list saved successfully",toast_games_save_fail:"Failed to save games list, please check permissions",toast_games_empty:"No games to save",toast_log_level_debug:"Log level set to: debug, detailed logging has been enabled",toast_log_level_set:"Log level set to: {level}, changes applied immediately",toast_log_level_fail:"Failed to save log level, please check permissions",toast_language_changed:"Language changed to {language}",toast_language_follow_system:"Language set to follow system",copyright_text:"Mediatek Mali GPU Governor © 2025 Coolapk@Walika = Github@Seyud",config_games_not_found:"No games found",config_games_list_not_found:"No games list found"}};function i(g,e={},t="zh"){let n=(f[t]||f.zh)[g]||g;for(const[s,o]of Object.entries(e))n=n.replace(`{${s}}`,String(o));return n}let b=0;function w(g){return`${g}_callback_${Date.now()}_${b++}`}function S(g,e){return typeof e>"u"&&(e={}),new Promise((t,a)=>{const n=w("exec");window[n]=(o,r,l)=>{t({errno:o,stdout:r,stderr:l}),s(n)};function s(o){delete window[o]}try{ksu.exec(g,JSON.stringify(e),n)}catch(o){a(o),s(n)}})}function E(g){ksu.toast(g)}function u(g,e={}){return S(g,e)}function c(g){E(g)}class I{currentLanguage="zh";async loadGpuConfig(){const{errno:e,stdout:t}=await u(`cat ${p.CONFIG_PATH}`);if(e===0&&t.trim()){const a=t.trim(),n=[];let s=!1;const r=/freq_table\s*=\s*\[([\s\S]*?)\]/.exec(a);if(r){const l=r[1],d=/\{\s*freq\s*=\s*(\d+),\s*volt\s*=\s*(\d+),\s*ddr_opp\s*=\s*(\d+)\s*\}/g;let h;for(h=d.exec(l);h!==null;){const v=parseInt(h[1],10),C=parseInt(h[2],10),L=parseInt(h[3],10);!Number.isNaN(v)&&!Number.isNaN(C)&&!Number.isNaN(L)&&(n.push({freq:v,volt:C,ddr:L}),s=!0),h=d.exec(l)}}if(!s){const l=/\[\[freq_table\]\][\s\S]*?freq\s*=\s*(\d+)[\s\S]*?volt\s*=\s*(\d+)[\s\S]*?ddr_opp\s*=\s*(\d+)/g;let d;for(d=l.exec(a);d!==null;){const h=parseInt(d[1],10),v=parseInt(d[2],10),C=parseInt(d[3],10);!Number.isNaN(h)&&!Number.isNaN(v)&&!Number.isNaN(C)&&(n.push({freq:h,volt:v,ddr:C}),s=!0),d=l.exec(a)}}if(s)return n.sort((l,d)=>l.freq-d.freq),{success:!0,data:n}}return{success:!1,error:"config_not_found"}}async saveGpuConfig(e){if(!e||e.length===0)return c(i("toast_config_empty",{},this.currentLanguage)),{success:!1,error:"empty_config"};const t=[...e].sort((s,o)=>s.freq-o.freq);let a=`# GPU 频率表
# freq 单位: kHz
# volt 单位: uV
# ddr_opp: DDR OPP 档位

`;return a+=`freq_table = [
`,t.forEach((s,o)=>{a+=`    { freq = ${s.freq}, volt = ${s.volt}, ddr_opp = ${s.ddr} }${o<t.length-1?",":""}
`}),a+=`]
`,(await this.writeFileAtomically(p.CONFIG_PATH,a)).errno===0?(c(i("toast_config_saved",{},this.currentLanguage)),{success:!0}):(c(i("toast_config_save_fail",{},this.currentLanguage)),{success:!1,error:"save_failed"})}async loadCustomConfig(){const{errno:e,stdout:t}=await u(`cat ${p.CUSTOM_CONFIG_PATH}`);if(e===0&&t.trim()){const a=t.trim();return{success:!0,data:this.parseCustomConfig(a)}}return{success:!1,error:"config_not_found"}}async saveCustomConfig(e){const t=this.generateCustomConfigContent(e);return(await this.writeFileAtomically(p.CUSTOM_CONFIG_PATH,t)).errno===0?(c(i("toast_config_saved",{},this.currentLanguage)),{success:!0}):(c(i("toast_config_save_fail",{},this.currentLanguage)),{success:!1,error:"save_failed"})}parseCustomConfig(e){const t={},a=/\[global\]([\s\S]*?)(?=\n\[|$)/.exec(e);return a&&(t.global=this.parseSection(a[1])),["powersave","balance","performance","fast"].forEach(s=>{const o=new RegExp(`\\[${s}\\]([\\s\\S]*?)(?=\\n\\[|$)`).exec(e);o&&(t[s]=this.parseSection(o[1]))}),t}parseSection(e){const t={};return e.split(`
`).forEach(n=>{const s=n.trim();if(s&&!s.startsWith("#")){const[o,r]=s.split("=");if(o&&r){const l=o.trim(),d=r.trim().replace(/["']/g,"");d==="true"?t[l]=!0:d==="false"?t[l]=!1:Number.isNaN(Number(d))?t[l]=d:t[l]=Number(d)}}}),t}generateCustomConfigContent(e){let t=`# GPU调速器配置文件

`;t+=`[global]
`,t+=`# 全局模式设置: powersave, balance, performance, fast
`,t+=`mode = "${e.global?.mode||"balance"}"
`,t+=`# 空闲阈值（百分比）
`,t+=`idle_threshold = ${e.global?.idle_threshold??5}

`;const a=["powersave","balance","performance","fast"],n={powersave:"省电模式 - 更高的升频阈值，更激进的降频",balance:"平衡模式 - 默认设置",performance:"性能模式 - 更低的升频阈值，更保守的降频",fast:"极速模式 - 最低的升频阈值，最保守的降频"};return a.forEach(s=>{t+=`# ${n[s]}
`,t+=`[${s}]
`,t+=this.generateModeConfigContent(e[s]||{})}),t}generateModeConfigContent(e){let t="";return t+=`# 余量
`,t+=`margin = ${e.margin??10}
`,t+=`# 是否使用激进降频策略
`,t+=`aggressive_down = ${e.aggressive_down?"true":"false"}
`,t+=`# 采样间隔（毫秒）
`,t+=`sampling_interval = ${e.sampling_interval??16}
`,t+=`# 游戏优化 - 启用游戏特殊内存优化
`,t+=`gaming_mode = ${e.gaming_mode?"true":"false"}
`,t+=`# 自适应采样
`,t+=`adaptive_sampling = ${e.adaptive_sampling?"true":"false"}
`,t+=`# 自适应采样最小间隔（毫秒）
`,t+=`min_adaptive_interval = ${e.min_adaptive_interval??4}
`,t+=`# 自适应采样最大间隔（毫秒）
`,t+=`max_adaptive_interval = ${e.max_adaptive_interval??20}
`,t+=`# 升频延迟（毫秒）
`,t+=`up_rate_delay = ${e.up_rate_delay??1e3}
`,t+=`# 降频延迟（毫秒）
`,t+=`down_rate_delay = ${e.down_rate_delay??5e3}

`,t}async writeFileAtomically(e,t){const a=`${e}.tmp`,s=`echo '${btoa(unescape(encodeURIComponent(t)))}' | base64 -d > '${a}' && mv '${a}' '${e}'`,o=await u(s);return o.errno!==0&&await u(`rm -f '${a}'`),o}setLanguage(e){this.currentLanguage=e}}class T{gpuConfigs=[];currentLanguage="zh";gpuFreqTable;addConfigBtn;saveConfigBtn;onEditCallback=null;saveConfigToFile=null;constructor(){this.gpuFreqTable=document.getElementById("gpuFreqTable")?.querySelector("tbody"),this.addConfigBtn=document.getElementById("addConfigBtn"),this.saveConfigBtn=document.getElementById("saveConfigBtn")}init(){this.setupEventListeners()}setupEventListeners(){this.addConfigBtn&&this.addConfigBtn.addEventListener("click",()=>this.openEditModal()),this.saveConfigBtn&&this.saveConfigBtn.addEventListener("click",()=>{this.saveConfigToFile&&this.saveConfigToFile()})}loadConfigs(e){this.gpuConfigs=e||[],this.gpuConfigs.length>0?(this.gpuConfigs.sort((t,a)=>t.freq-a.freq),this.refreshTable()):this.showEmptyState()}refreshTable(){if(this.gpuFreqTable){if(this.gpuFreqTable.innerHTML="",this.gpuConfigs.length===0){this.showEmptyState();return}this.gpuConfigs=[...this.gpuConfigs].sort((e,t)=>e.freq-t.freq),this.gpuConfigs.forEach((e,t)=>{const a=this.createTableRow(e,t);this.gpuFreqTable?.appendChild(a)})}}createTableRow(e,t){const a=document.createElement("tr");a.dataset.index=String(t),a.dataset.freq=String(e.freq);const n=document.createElement("td");n.textContent=(e.freq/1e3).toFixed(0);const s=document.createElement("td");s.textContent=String(e.volt);const o=document.createElement("td");o.textContent=String(e.ddr);const r=document.createElement("td"),l=this.createEditButton(t);return r.appendChild(l),a.appendChild(n),a.appendChild(s),a.appendChild(o),a.appendChild(r),a}createEditButton(e){const t=document.createElement("button");return t.className="edit-btn",t.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>',t.title="编辑/删除",t.onclick=()=>(this.openEditModal(e),!1),t}showEmptyState(){this.gpuFreqTable&&(this.gpuFreqTable.innerHTML=`<tr><td colspan="4" class="loading-text">${i("config_not_found",{},this.currentLanguage)}</td></tr>`)}openEditModal(e=-1){if(this.onEditCallback){const t=e>=0?this.gpuConfigs[e]:null;this.onEditCallback(t,e)}}addConfig(e){this.gpuConfigs.push(e),this.refreshTable()}updateConfig(e,t){t>=0&&t<this.gpuConfigs.length?this.gpuConfigs[t]=e:this.gpuConfigs.push(e),this.refreshTable()}deleteConfig(e){return e>=0&&e<this.gpuConfigs.length?(this.gpuConfigs.splice(e,1),this.refreshTable(),!0):!1}getConfigs(){return[...this.gpuConfigs]}setEditCallback(e){this.onEditCallback=e}setSaveFileCallback(e){this.saveConfigToFile=e}isFrequencyDuplicate(e,t=-1){return this.gpuConfigs.some((a,n)=>a.freq===e&&n!==t)}getFrequencyRange(){if(this.gpuConfigs.length===0)return{min:0,max:0};const e=this.gpuConfigs.map(t=>t.freq);return{min:Math.min(...e),max:Math.max(...e)}}sortByFrequency(){this.gpuConfigs.sort((e,t)=>e.freq-t.freq),this.refreshTable()}validateConfig(e){const t=[];return(!e.freq||Number.isNaN(e.freq)||e.freq<=0)&&t.push("无效的频率值"),(!e.volt||Number.isNaN(e.volt)||e.volt<=0)&&t.push("无效的电压值"),(e.ddr===void 0||Number.isNaN(e.ddr))&&t.push("无效的DDR档位值"),{isValid:t.length===0,errors:t}}getStatistics(){if(this.gpuConfigs.length===0)return{count:0,avgFreq:0,avgVolt:0,freqRange:{min:0,max:0},voltRange:{min:0,max:0}};const e=this.gpuConfigs.map(a=>a.freq),t=this.gpuConfigs.map(a=>a.volt);return{count:this.gpuConfigs.length,avgFreq:e.reduce((a,n)=>a+n,0)/e.length,avgVolt:t.reduce((a,n)=>a+n,0)/t.length,freqRange:{min:Math.min(...e),max:Math.max(...e)},voltRange:{min:Math.min(...t),max:Math.max(...t)}}}setLanguage(e){this.currentLanguage=e,this.refreshTable()}clearConfigs(){this.gpuConfigs=[],this.refreshTable()}}class k{voltageController;editingIndex=-1;currentLanguage="zh";onSaveCallback=null;onDeleteCallback=null;editConfigModal;closeModalBtn;freqInput;saveItemBtn;cancelEditBtn;deleteItemBtn;ddrContainer;selectedDdr;constructor(e){this.voltageController=e,this.editConfigModal=document.getElementById("editConfigModal"),this.closeModalBtn=document.querySelector(".close-modal"),this.freqInput=document.getElementById("freqInput"),this.saveItemBtn=document.getElementById("saveItemBtn"),this.cancelEditBtn=document.getElementById("cancelEditBtn"),this.deleteItemBtn=document.getElementById("deleteItemBtn"),this.ddrContainer=document.getElementById("ddrContainer"),this.selectedDdr=document.getElementById("selectedDdr")}init(){this.setupEventListeners(),this.setupDdrSelector()}setupEventListeners(){this.closeModalBtn&&this.closeModalBtn.addEventListener("click",()=>this.closeModal()),this.cancelEditBtn&&this.cancelEditBtn.addEventListener("click",()=>this.closeModal()),this.saveItemBtn&&this.saveItemBtn.addEventListener("click",()=>this.saveConfigItem()),this.deleteItemBtn&&this.deleteItemBtn.addEventListener("click",()=>this.deleteConfigItem()),window.addEventListener("click",e=>{e.target===this.editConfigModal&&this.closeModal()}),window.addEventListener("keydown",e=>{e.key==="Escape"&&this.editConfigModal&&this.editConfigModal.style.display==="block"&&this.closeModal()})}setupDdrSelector(){if(!this.ddrContainer)return;this.ddrContainer.addEventListener("click",()=>{this.ddrContainer?.classList.toggle("open"),this.ddrContainer?.classList.contains("open")?setTimeout(()=>{(this.ddrContainer?.querySelectorAll(".option")).forEach((a,n)=>{setTimeout(()=>{a.style.opacity="1",a.style.transform="translateY(0)"},n*50)})},10):((this.ddrContainer?.querySelectorAll(".option")).forEach(a=>{a.style.opacity="0",a.style.transform="translateY(-10px)"}),setTimeout(()=>{this.ddrContainer?.classList.remove("open")},150))});const e=document.querySelectorAll("#ddrOptions .option");e.forEach(t=>{t.addEventListener("click",a=>{a.stopPropagation(),e.forEach(s=>{s.classList.remove("selected")}),t.classList.add("selected"),this.selectedDdr&&(this.selectedDdr.textContent=t.textContent);const n=this.ddrContainer?.querySelectorAll(".option");n.forEach(s=>{s.style.opacity="0",s.style.transform="translateY(-10px)"}),setTimeout(()=>{this.ddrContainer?.classList.remove("open")},150),setTimeout(()=>{n.forEach(s=>{s.style.opacity="",s.style.transform=""})},300)})})}openModal(e=null,t=-1){if(!this.editConfigModal){console.error("模态框元素不存在");return}this.editingIndex=t,e?(this.freqInput&&(this.freqInput.value=String(e.freq)),this.voltageController&&this.voltageController.setVoltage(e.volt),this.setDdrValue(e.ddr),this.deleteItemBtn&&(this.deleteItemBtn.style.display="block")):(this.freqInput&&(this.freqInput.value=""),this.voltageController&&this.voltageController.reset(),this.setDdrValue(999),this.deleteItemBtn&&(this.deleteItemBtn.style.display="none")),this.editConfigModal.style.display="block"}closeModal(){this.editConfigModal&&(this.editConfigModal.style.display="none")}setDdrValue(e){this.selectedDdr&&document.querySelectorAll("#ddrOptions .option").forEach(a=>{parseInt(a.getAttribute("data-value")||"0",10)===e?(this.selectedDdr&&(this.selectedDdr.textContent=a.textContent),a.classList.add("selected")):a.classList.remove("selected")})}getDdrValue(){if(this.selectedDdr){const e=this.selectedDdr.textContent||"999";return parseInt(e.split(" ")[0],10)}return 999}saveConfigItem(){if(!this.freqInput)return;const e=parseInt(this.freqInput.value,10),t=this.voltageController?this.voltageController.getCurrentVoltage():0,a=this.getDdrValue();if(!e||Number.isNaN(e)){c(i("toast_freq_invalid",{},this.currentLanguage));return}const n={freq:e,volt:t,ddr:a};this.onSaveCallback&&this.onSaveCallback(n,this.editingIndex),this.closeModal(),c(i("toast_config_updated",{},this.currentLanguage))}deleteConfigItem(){this.editingIndex>=0?(this.onDeleteCallback&&this.onDeleteCallback(this.editingIndex),this.closeModal(),c(i("toast_config_deleted",{},this.currentLanguage))):c(i("toast_index_invalid",{},this.currentLanguage))}setSaveCallback(e){this.onSaveCallback=e}setDeleteCallback(e){this.onDeleteCallback=e}setLanguage(e){this.currentLanguage=e}}class B{currentLanguage="zh";customConfig={};globalModeSelect;globalModeContainer;selectedGlobalMode;globalModeOptions;idleThresholdInput;powersaveInputs=null;balanceInputs=null;performanceInputs=null;fastInputs=null;constructor(){this.globalModeSelect=document.getElementById("globalMode"),this.globalModeContainer=document.getElementById("globalModeContainer"),this.selectedGlobalMode=document.getElementById("selectedGlobalMode"),this.globalModeOptions=document.getElementById("globalModeOptions"),this.idleThresholdInput=document.getElementById("idleThreshold"),this.powersaveInputs=this.getModeInputs("powersave"),this.balanceInputs=this.getModeInputs("balance"),this.performanceInputs=this.getModeInputs("performance"),this.fastInputs=this.getModeInputs("fast")}getModeInputs(e){return{margin:document.getElementById(`${e}Margin`),sampling_interval:document.getElementById(`${e}SamplingInterval`),min_adaptive_interval:document.getElementById(`${e}MinAdaptiveInterval`),max_adaptive_interval:document.getElementById(`${e}MaxAdaptiveInterval`),up_rate_delay:document.getElementById(`${e}UpRateDelay`),down_rate_delay:document.getElementById(`${e}DownRateDelay`),aggressive_down:document.getElementById(`${e}AggressiveDown`),gaming_mode:document.getElementById(`${e}GamingMode`),adaptive_sampling:document.getElementById(`${e}AdaptiveSampling`)}}init(){this.initGlobalModeSelect(),this.initModeSwitchEvents()}initGlobalModeSelect(){if(!this.selectedGlobalMode||!this.globalModeOptions)return;this.selectedGlobalMode.addEventListener("click",t=>{t.stopPropagation(),this.globalModeContainer?.classList.toggle("open")}),this.globalModeOptions.querySelectorAll(".option").forEach(t=>{t.addEventListener("click",a=>{a.stopPropagation();const n=t.getAttribute("data-value"),s=t.textContent,o=this.selectedGlobalMode?.querySelector("span");o&&(o.textContent=s||"",o.setAttribute("data-i18n",t.getAttribute("data-i18n")||"")),this.globalModeSelect&&n&&(this.globalModeSelect.value=n,this.globalModeSelect.dispatchEvent(new Event("change"))),this.globalModeContainer?.classList.remove("open")})}),document.addEventListener("click",t=>{this.globalModeContainer?.contains(t.target)||this.globalModeContainer?.classList.remove("open")})}initModeSwitchEvents(){const e=document.querySelectorAll(".mode-tabs-grid .settings-tab-btn"),t=document.querySelectorAll(".mode-config-section");this.globalModeSelect&&this.syncModeTabsWithGlobalMode(this.globalModeSelect.value),e.forEach(a=>{a.addEventListener("click",()=>{const n=a.getAttribute("data-mode");e.forEach(o=>{o.classList.remove("active")}),a.classList.add("active"),t.forEach(o=>{o.classList.remove("active")});const s=document.getElementById(`${n}-config`);s&&s.classList.add("active")})}),this.globalModeSelect&&this.globalModeSelect.addEventListener("change",()=>{const a=this.globalModeSelect?.value;a&&this.syncModeTabsWithGlobalMode(a)})}syncModeTabsWithGlobalMode(e){const t=document.querySelectorAll(".mode-tabs-grid .settings-tab-btn"),a=document.querySelectorAll(".mode-config-section");t.forEach(n=>{n.classList.remove("active"),n.getAttribute("data-mode")===e&&n.classList.add("active")}),a.forEach(n=>{n.classList.remove("active"),n.id===`${e}-config`&&n.classList.add("active")})}populateCustomConfigForm(e){this.customConfig=e||{},this.customConfig.global&&(this.globalModeSelect&&this.customConfig.global.mode&&(this.globalModeSelect.value=String(this.customConfig.global.mode)),this.selectedGlobalMode&&this.customConfig.global.mode&&this.updateGlobalModeDisplay(String(this.customConfig.global.mode)),this.idleThresholdInput&&this.customConfig.global.idle_threshold!==void 0&&(this.idleThresholdInput.value=String(this.customConfig.global.idle_threshold))),this.populateModeConfig(this.powersaveInputs,this.customConfig.powersave),this.populateModeConfig(this.balanceInputs,this.customConfig.balance),this.populateModeConfig(this.performanceInputs,this.customConfig.performance),this.populateModeConfig(this.fastInputs,this.customConfig.fast),this.customConfig.global?.mode&&this.syncModeTabsWithGlobalMode(String(this.customConfig.global.mode))}updateGlobalModeDisplay(e){let t="",a="";switch(e){case"powersave":t=i("config_powersave_mode",{},this.currentLanguage),a="config_powersave_mode";break;case"performance":t=i("config_performance_mode",{},this.currentLanguage),a="config_performance_mode";break;case"fast":t=i("config_fast_mode",{},this.currentLanguage),a="config_fast_mode";break;default:t=i("config_balance_mode",{},this.currentLanguage),a="config_balance_mode";break}if(this.selectedGlobalMode){const n=this.selectedGlobalMode.querySelector("span");n&&(n.textContent=t,n.setAttribute("data-i18n",a))}}populateModeConfig(e,t){!t||!e||Object.keys(e).forEach(a=>{const n=e[a];if(n&&t[a]!==void 0){const s=n;s.type==="checkbox"?s.checked=!!t[a]:s.value=String(t[a])}})}getCurrentConfig(){return{global:{mode:this.getGlobalMode(),idle_threshold:this.getIdleThreshold()},powersave:this.getModeConfig(this.powersaveInputs),balance:this.getModeConfig(this.balanceInputs),performance:this.getModeConfig(this.performanceInputs),fast:this.getModeConfig(this.fastInputs)}}getGlobalMode(){if(this.globalModeSelect?.value)return this.globalModeSelect.value;if(this.selectedGlobalMode){const e=this.selectedGlobalMode.querySelector("span");if(e){const t=e.textContent||"";return t.includes("省电")||t.includes("Power Save")?"powersave":t.includes("性能")||t.includes("Performance")?"performance":t.includes("极速")||t.includes("Fast")?"fast":"balance"}}return"balance"}getIdleThreshold(){return this.idleThresholdInput&&this.idleThresholdInput.value||5}getModeConfig(e){if(!e)return{};const t={};return Object.keys(e).forEach(a=>{const n=e[a];n&&(n.type==="checkbox"?t[a]=n.checked:t[a]=n.value?Number(n.value):0)}),t}setLanguage(e){this.currentLanguage=e,this.customConfig.global?.mode&&this.updateGlobalModeDisplay(String(this.customConfig.global.mode))}}class G{currentVoltValue=_.MAX_VOLT;isLongPress=!1;decreaseTimer=null;increaseTimer=null;voltageEventsInitialized=!1;voltSelect;selectedVolt;voltDecreaseBtn;voltIncreaseBtn;constructor(){this.voltSelect=document.getElementById("voltSelect"),this.selectedVolt=document.getElementById("selectedVolt"),this.voltDecreaseBtn=document.getElementById("voltDecreaseBtn"),this.voltIncreaseBtn=document.getElementById("voltIncreaseBtn")}init(){this.initVoltSelect(),this.setupVoltageEvents()}decreaseVolt(){const e=this.currentVoltValue-_.VOLT_STEP;return e>=_.MIN_VOLT?(this.currentVoltValue=e,this.updateVoltDisplay(),!0):!1}increaseVolt(){const e=this.currentVoltValue+_.VOLT_STEP;return e<=_.MAX_VOLT?(this.currentVoltValue=e,this.updateVoltDisplay(),!0):!1}updateVoltDisplay(){if(this.selectedVolt&&(this.selectedVolt.textContent=String(this.currentVoltValue)),this.voltSelect){const e=Array.from(this.voltSelect.options).find(t=>parseInt(t.value,10)===this.currentVoltValue);if(e)this.voltSelect.value=e.value;else{const t=document.createElement("option");t.value=String(this.currentVoltValue),t.textContent=String(this.currentVoltValue),this.voltSelect.appendChild(t),this.voltSelect.value=String(this.currentVoltValue)}this.voltDecreaseBtn&&(this.voltDecreaseBtn.disabled=this.currentVoltValue<=_.MIN_VOLT),this.voltIncreaseBtn&&(this.voltIncreaseBtn.disabled=this.currentVoltValue>=_.MAX_VOLT)}}initVoltSelect(){!this.voltSelect||!this.selectedVolt||(this.voltSelect.innerHTML="",M.forEach(e=>{const t=document.createElement("option");t.value=String(e),t.textContent=String(e),this.voltSelect?.appendChild(t)}),this.currentVoltValue=_.MAX_VOLT,this.selectedVolt.textContent=String(this.currentVoltValue),this.voltSelect.value=String(this.currentVoltValue),this.updateVoltDisplay())}setupVoltageEvents(){this.voltageEventsInitialized||(this.voltDecreaseBtn&&(this.voltDecreaseBtn.addEventListener("click",()=>{if(this.isLongPress){this.isLongPress=!1;return}this.decreaseVolt()}),this.voltDecreaseBtn.addEventListener("mousedown",()=>{this.isLongPress=!1,this.decreaseTimer=setTimeout(()=>{this.isLongPress=!0,this.decreaseVolt()&&this.decreaseTimer&&(this.decreaseTimer=setInterval(()=>{this.decreaseVolt()||this.decreaseTimer&&(clearInterval(this.decreaseTimer),this.decreaseTimer=null)},150))},500)})),this.voltIncreaseBtn&&(this.voltIncreaseBtn.addEventListener("click",()=>{if(this.isLongPress){this.isLongPress=!1;return}this.increaseVolt()}),this.voltIncreaseBtn.addEventListener("mousedown",()=>{this.isLongPress=!1,this.increaseTimer=setTimeout(()=>{this.isLongPress=!0,this.increaseVolt()&&this.increaseTimer&&(this.increaseTimer=setInterval(()=>{this.increaseVolt()||this.increaseTimer&&(clearInterval(this.increaseTimer),this.increaseTimer=null)},150))},500)})),document.addEventListener("mouseup",()=>this.clearTimers()),document.addEventListener("mouseleave",()=>this.clearTimers()),this.setupTouchEvents(),this.voltageEventsInitialized=!0)}setupTouchEvents(){this.voltDecreaseBtn&&this.voltDecreaseBtn.addEventListener("touchstart",e=>{e.preventDefault(),this.isLongPress=!1,this.decreaseVolt(),this.decreaseTimer=setTimeout(()=>{this.isLongPress=!0,this.decreaseTimer=setInterval(()=>{this.decreaseVolt()||this.decreaseTimer&&(clearInterval(this.decreaseTimer),this.decreaseTimer=null)},150)},500)},{passive:!1}),this.voltIncreaseBtn&&this.voltIncreaseBtn.addEventListener("touchstart",e=>{e.preventDefault(),this.isLongPress=!1,this.increaseVolt(),this.increaseTimer=setTimeout(()=>{this.isLongPress=!0,this.increaseTimer=setInterval(()=>{this.increaseVolt()||this.increaseTimer&&(clearInterval(this.increaseTimer),this.increaseTimer=null)},150)},500)},{passive:!1}),document.addEventListener("touchend",()=>this.clearTimers())}clearTimers(){this.decreaseTimer!==null&&(clearTimeout(this.decreaseTimer),clearInterval(this.decreaseTimer),this.decreaseTimer=null),this.increaseTimer!==null&&(clearTimeout(this.increaseTimer),clearInterval(this.increaseTimer),this.increaseTimer=null)}getCurrentVoltage(){return this.currentVoltValue}setVoltage(e){this.currentVoltValue=e,this.updateVoltDisplay()}reset(){this.currentVoltValue=_.MAX_VOLT,this.updateVoltDisplay()}}class x{currentLanguage="zh";voltageController;configFileManager;modalManager;modeConfigManager;gpuConfigManager;loadCustomConfigBtn;saveCustomConfigBtn;constructor(){this.voltageController=new G,this.configFileManager=new I,this.modalManager=new k(this.voltageController),this.modeConfigManager=new B,this.gpuConfigManager=new T,this.loadCustomConfigBtn=document.getElementById("loadCustomConfigBtn"),this.saveCustomConfigBtn=document.getElementById("saveCustomConfigBtn")}init(){this.setupEventListeners(),this.setupModuleCallbacks(),this.initializeModules(),this.loadInitialData()}initializeModules(){this.voltageController.init(),this.modalManager.init(),this.modeConfigManager.init(),this.gpuConfigManager.init()}setupModuleCallbacks(){this.gpuConfigManager.setEditCallback((e,t)=>{this.modalManager.openModal(e,t)}),this.gpuConfigManager.setSaveFileCallback(()=>{this.saveGpuConfigToFile()}),this.modalManager.setSaveCallback((e,t)=>{this.gpuConfigManager.updateConfig(e,t)}),this.modalManager.setDeleteCallback(e=>{this.gpuConfigManager.deleteConfig(e)})}async loadInitialData(){await this.loadGpuConfig(),await this.loadCustomConfigFromFile()}setupEventListeners(){this.loadCustomConfigBtn&&this.loadCustomConfigBtn.addEventListener("click",()=>this.loadCustomConfigFromFile()),this.saveCustomConfigBtn&&this.saveCustomConfigBtn.addEventListener("click",()=>this.saveCustomConfigToFile())}async loadGpuConfig(){const e=await this.configFileManager.loadGpuConfig();e.success&&e.data?this.gpuConfigManager.loadConfigs(e.data):(console.error("加载GPU配置失败:",e.error),this.gpuConfigManager.loadConfigs([]))}async saveGpuConfigToFile(){const e=this.gpuConfigManager.getConfigs();await this.configFileManager.saveGpuConfig(e)}async loadCustomConfigFromFile(){const e=await this.configFileManager.loadCustomConfig();e.success&&e.data?(this.modeConfigManager.populateCustomConfigForm(e.data),c(i("toast_custom_config_loaded",{},this.currentLanguage))):c(i("toast_config_load_fail",{},this.currentLanguage))}async saveCustomConfigToFile(){const e=this.modeConfigManager.getCurrentConfig();await this.configFileManager.saveCustomConfig(e)}setLanguage(e){this.currentLanguage=e,this.configFileManager.setLanguage(e),this.modalManager.setLanguage(e),this.modeConfigManager.setLanguage(e),this.gpuConfigManager.setLanguage(e)}}class m{static async fetchAppName(e){try{if(typeof window.$packageManager<"u"){const o=window.$packageManager.getApplicationInfo(e,0,0);if(o?.getLabel?.())return o.getLabel()}const{errno:t,stdout:a}=await u(`pm dump ${e} 2>/dev/null | grep "label=" | head -1 | sed 's/.*label=//' | cut -d' ' -f1`);if(t===0&&a.trim()&&a.trim()!=="null")return a.trim();const{errno:n,stdout:s}=await u(`pm path ${e} 2>/dev/null | head -1 | cut -d':' -f2`);if(n===0&&s.trim()){const o=s.trim(),{errno:r,stdout:l}=await u(`aapt dump badging "${o}" 2>/dev/null | grep "application-label:" | head -1 | sed "s/.*application-label:'\\([^']*\\)'.*/\\1/"`);if(r===0&&l.trim())return l.trim()}return m.getAppNameFromPackage(e)}catch(t){return console.error(`Failed to fetch app name for ${e}:`,t),m.getAppNameFromPackage(e)}}static getAppNameFromPackage(e){const t=e.split("."),a=t[t.length-1];return a.replace(/app$/i,"").replace(/client$/i,"").replace(/mobile$/i,"").replace(/([A-Z])/g," $1").trim().split(" ").map(s=>s.charAt(0).toUpperCase()+s.slice(1).toLowerCase()).join(" ")||a.charAt(0).toUpperCase()+a.slice(1)}static async loadAppIcon(e,t,a){try{if(typeof window.$packageManager<"u")try{const s=window.$packageManager.getApplicationIcon(e,0,0);if(s){await m.loadWrapInputStream();const o=window.wrapInputStream;if(o){const l=await(await o(s)).arrayBuffer(),d=m.arrayBufferToBase64(l),h=m.createIconImage(e,d);m.applyIconTransition(h,t,a);return}}}catch(s){console.log(`WebUI-X API failed for ${e}:`,s)}const n=await m.extractIconFromApk(e);if(n){const s=m.createIconImage(e,n);m.applyIconTransition(s,t,a)}}catch(n){console.error(`Error loading icon for ${e}:`,n)}}static async extractIconFromApk(e){const{errno:t,stdout:a}=await u(`pm path ${e} 2>/dev/null | head -1 | cut -d':' -f2`);if(t!==0||!a.trim())return console.log(`Failed to get APK path for ${e}`),null;const n=a.trim(),{errno:s,stdout:o}=await u(`aapt dump badging "${n}" 2>/dev/null | grep "application-icon-" | tail -1 | sed "s/.*'\\([^']*\\)'.*/\\1/"`);if(s!==0||!o.trim())return console.log(`Failed to get icon path for ${e}`),null;const r=o.trim(),l=`/data/local/tmp/icon_${Date.now()}_${Math.random().toString(36).substring(7)}.png`,{errno:d}=await u(`unzip -p "${n}" "${r}" > "${l}" 2>/dev/null`);if(d!==0)return console.log(`Failed to extract icon for ${e}`),await u(`rm -f "${l}" 2>/dev/null`),null;const{errno:h,stdout:v}=await u(`base64 "${l}" 2>/dev/null`);return await u(`rm -f "${l}" 2>/dev/null`),h===0&&v.trim()?v.trim():(console.log(`Failed to convert icon to base64 for ${e}`),null)}static createIconImage(e,t){const a=document.createElement("img");return a.className="game-icon-loaded",a.src=`data:image/png;base64,${t}`,a.alt=e,a}static applyIconTransition(e,t,a){e.onload=()=>{a.style.opacity="0",a.style.transition="opacity 0.3s ease",setTimeout(()=>{t.innerHTML="",e.style.opacity="0",t.appendChild(e),requestAnimationFrame(()=>{e.style.transition="opacity 0.3s ease",e.style.opacity="1"})},300)},e.onerror=()=>{console.warn(`Failed to load icon image for ${e.alt}`)}}static async loadWrapInputStream(){if(typeof window.wrapInputStream>"u")try{const a=await new Function("url","return import(url)")("https://mui.kernelsu.org/internal/assets/ext/wrapInputStream.mjs");window.wrapInputStream=a.wrapInputStream}catch(e){console.error("Failed to load wrapInputStream:",e)}}static arrayBufferToBase64(e){const t=new Uint8Array(e);let a="";for(const n of t)a+=String.fromCharCode(n);return btoa(a)}}class V{editGameModal;closeGameModalBtn;packageNameInput;gameModeSelect;saveGameBtn;cancelGameBtn;gameModeContainer;selectedGameMode;gameModeOptions;currentLanguage;constructor(e){this.currentLanguage=e,this.editGameModal=document.getElementById("editGameModal"),this.closeGameModalBtn=document.querySelector(".close-game-modal"),this.packageNameInput=document.getElementById("packageNameInput"),this.gameModeSelect=document.getElementById("gameModeSelect"),this.saveGameBtn=document.getElementById("saveGameBtn"),this.cancelGameBtn=document.getElementById("cancelGameBtn"),this.gameModeContainer=document.getElementById("gameModeContainer"),this.selectedGameMode=document.getElementById("selectedGameMode"),this.gameModeOptions=document.getElementById("gameModeOptions")}init(e,t){this.closeGameModalBtn&&this.closeGameModalBtn.addEventListener("click",t),this.cancelGameBtn&&this.cancelGameBtn.addEventListener("click",t),this.saveGameBtn&&this.saveGameBtn.addEventListener("click",e),window.addEventListener("click",a=>{a.target===this.editGameModal&&t()}),window.addEventListener("keydown",a=>{a.key==="Escape"&&this.editGameModal&&this.editGameModal.style.display==="block"&&t()}),this.initGameModeSelect()}initGameModeSelect(){if(!this.gameModeContainer||!this.selectedGameMode||!this.gameModeOptions)return;this.selectedGameMode.addEventListener("click",t=>{t.stopPropagation(),this.gameModeContainer?.classList.toggle("open")});const e=this.gameModeOptions.querySelectorAll(".option");e.forEach(t=>{t.addEventListener("click",a=>{a.stopPropagation();const n=t.getAttribute("data-value"),s=t.textContent;this.selectedGameMode&&(this.selectedGameMode.textContent=s),this.gameModeSelect&&n&&(this.gameModeSelect.value=n,this.gameModeSelect.dispatchEvent(new Event("change"))),e.forEach(o=>{o.classList.remove("selected")}),t.classList.add("selected"),this.gameModeContainer?.classList.remove("open")})}),document.addEventListener("click",t=>{this.gameModeContainer?.contains(t.target)||this.gameModeContainer?.classList.remove("open")})}openForAdd(){this.packageNameInput&&(this.packageNameInput.value=""),this.gameModeSelect&&(this.gameModeSelect.value="balance"),this.updateGameModeSelectDisplay("balance"),this.editGameModal&&(this.editGameModal.style.display="block")}openForEdit(e,t){this.packageNameInput&&(this.packageNameInput.value=e),this.gameModeSelect&&(this.gameModeSelect.value=t),this.updateGameModeSelectDisplay(t),this.editGameModal&&(this.editGameModal.style.display="block")}close(){this.editGameModal&&(this.editGameModal.style.display="none")}getPackageName(){return this.packageNameInput?.value.trim()||""}getGameMode(){return this.gameModeSelect?.value||"balance"}updateGameModeSelectDisplay(e){if(!this.selectedGameMode||!this.gameModeOptions)return;const t=this.gameModeOptions.querySelector(`.option[data-value="${e}"]`);t&&(this.selectedGameMode.textContent=t.textContent,this.gameModeOptions.querySelectorAll(".option").forEach(n=>{n.classList.remove("selected")}),t.classList.add("selected"))}setLanguage(e){if(this.currentLanguage=e,this.gameModeSelect){const t=this.gameModeSelect.options;for(let a=0;a<t.length;a++){const n=t[a],o=`status_mode_${n.value}`;f[e]?.[o]&&(n.textContent=f[e][o])}}if(this.gameModeOptions&&this.gameModeOptions.querySelectorAll(".option").forEach(a=>{const s=`status_mode_${a.getAttribute("data-value")}`;f[e]?.[s]&&(a.textContent=f[e][s])}),this.selectedGameMode&&this.gameModeSelect){const a=`status_mode_${this.gameModeSelect.value}`;f[e]?.[a]&&(this.selectedGameMode.textContent=f[e][a])}}}class y{static parseTomlGames(e){const t=[],a=e.split(`
`);let n=null;for(const s of a){const o=s.trim();if(!(!o||o.startsWith("#"))){if(o.startsWith("[[games]]")){n&&t.push(n),n={};continue}if(n&&o.includes("=")){const[r,l]=o.split("="),d=r.trim(),h=l.trim().replace(/"/g,"");d==="package"?n.package=h:d==="mode"&&(n.mode=h)}}}return n&&t.push(n),t}static serializeTomlGames(e){let t=`# GPU调速器游戏列表配置文件

`;return e.forEach(a=>{t+=`[[games]]
`,t+=`package = "${a.package}"
`,t+=`mode = "${a.mode||"balance"}"

`}),t}}class q{currentLanguage;onEdit;onDelete;constructor(e,t,a){this.currentLanguage=e,this.onEdit=t,this.onDelete=a}setLanguage(e){this.currentLanguage=e}renderGamesList(e,t){if(e.innerHTML="",t.length===0){e.innerHTML=`<div class="loading-text">${i("config_games_not_found",{},this.currentLanguage)}</div>`;return}t.forEach((a,n)=>{const s=this.createGameCard(a,n);e.appendChild(s)})}createGameCard(e,t){const a=document.createElement("div");a.className="game-card",a.style.animationDelay=`${Math.min(t*.05,.5)}s`;const n=this.createGameHeader(e),s=this.createGameDetails(e,t);return a.appendChild(n),a.appendChild(s),a}createGameHeader(e){const t=document.createElement("div");t.className="game-header";const a=this.createIconContainer(e),n=this.createGameNameContainer(e);return t.appendChild(a),t.appendChild(n),t}createIconContainer(e){const t=document.createElement("div");t.className="game-icon-container";const n=(e.name||m.getAppNameFromPackage(e.package||"")).charAt(0).toUpperCase(),s=(e.package||"").split("").reduce((l,d)=>d.charCodeAt(0)+((l<<5)-l),0),o=Math.abs(s)%360,r=document.createElement("div");return r.className="game-icon-placeholder",r.textContent=n,r.style.background=`linear-gradient(135deg, hsl(${o}, 65%, 55%), hsl(${o+20}, 65%, 45%))`,t.appendChild(r),e.package&&m.loadAppIcon(e.package,t,r),t}createGameNameContainer(e){const t=document.createElement("div");t.className="game-name-container";const a=e.name||m.getAppNameFromPackage(e.package||""),n=document.createElement("h4");n.className="game-name",n.textContent=a,n.title=a;const s=document.createElement("span");return s.className="game-package",s.textContent=e.package||"",s.title=e.package||"",t.appendChild(n),t.appendChild(s),t}createGameDetails(e,t){const a=document.createElement("div");a.className="game-details";const n=this.getModeText(e.mode||"balance"),s=document.createElement("span");s.className=`game-mode-badge mode-${e.mode||"balance"}`,s.textContent=n,a.appendChild(s);const o=this.createActionButtons(t);return a.appendChild(o),a}createActionButtons(e){const t=document.createElement("div");t.className="game-actions";const a=document.createElement("button");a.className="game-edit-btn",a.innerHTML='<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>',a.title="编辑",a.onclick=s=>{s.stopPropagation(),this.onEdit(e)};const n=document.createElement("button");return n.className="game-delete-btn",n.innerHTML='<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"></path><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>',n.title="删除",n.onclick=s=>{s.stopPropagation(),this.onDelete(e)},t.appendChild(a),t.appendChild(n),t}getModeText(e){const t={zh:{powersave:"省电",balance:"均衡",performance:"性能",fast:"极速"},en:{powersave:"Powersave",balance:"Balance",performance:"Performance",fast:"Fast"}};return t[this.currentLanguage][e]||t[this.currentLanguage].balance}}class A{gamesListData=[];currentLanguage="zh";gamesList;addGameBtn;saveGamesBtn;gamesSearchInput;editingIndex=-1;renderer;modal;constructor(){this.gamesList=document.getElementById("gamesList"),this.addGameBtn=document.getElementById("addGameBtn"),this.saveGamesBtn=document.getElementById("saveGamesBtn"),this.gamesSearchInput=document.getElementById("gamesSearchInput"),this.renderer=new q(this.currentLanguage,e=>this.editGameItem(e),e=>this.deleteGameItem(e)),this.modal=new V(this.currentLanguage)}init(){this.setupEventListeners(),this.modal.init(()=>this.saveGameItem(),()=>this.closeGameModal()),this.gamesSearchInput&&(this.gamesSearchInput.placeholder=i("config_games_search_placeholder",{},this.currentLanguage))}setupEventListeners(){this.addGameBtn&&this.addGameBtn.addEventListener("click",()=>this.openGameModal()),this.saveGamesBtn&&this.saveGamesBtn.addEventListener("click",()=>this.saveGamesToFile()),this.gamesSearchInput&&this.gamesSearchInput.addEventListener("input",e=>{const t=e.target.value.toLowerCase();this.filterGamesList(t)})}filterGamesList(e){document.querySelectorAll(".game-card").forEach(a=>{const n=a.querySelector(".game-name")?.textContent?.toLowerCase()||"",s=a.querySelector(".game-package")?.textContent?.toLowerCase()||"";n.includes(e)||s.includes(e)?a.style.display="flex":a.style.display="none"})}async loadGamesList(){const{errno:e,stdout:t}=await u(`cat ${p.GAMES_FILE}`);if(e===0&&t.trim()){const a=y.parseTomlGames(t.trim());this.gamesListData=a,a.length>0?(await this.loadAppNames(),this.refreshGamesList()):this.gamesList&&(this.gamesList.innerHTML=`<div class="loading-text">${i("config_games_not_found",{},this.currentLanguage)}</div>`)}else this.gamesList&&(this.gamesList.innerHTML=`<div class="loading-text">${i("config_games_list_not_found",{},this.currentLanguage)}</div>`)}async loadAppNames(){for(const e of this.gamesListData)if(e.package&&!e.name){const t=await m.fetchAppName(e.package);e.name=t}}refreshGamesList(){this.gamesList&&this.renderer.renderGamesList(this.gamesList,this.gamesListData)}openGameModal(){this.modal.openForAdd(),this.editingIndex=-1}editGameItem(e){if(e<0||e>=this.gamesListData.length)return;const t=this.gamesListData[e];this.modal.openForEdit(t.package||"",t.mode||"balance"),this.editingIndex=e}closeGameModal(){this.modal.close(),this.editingIndex=-1}saveGameItem(){const e=this.modal.getPackageName(),t=this.modal.getGameMode();if(!e){c(i("toast_game_invalid",{},this.currentLanguage));return}if(this.editingIndex===-1){if(this.gamesListData.some(a=>a.package===e)){c(i("toast_game_exists",{},this.currentLanguage));return}this.gamesListData.push({package:e,mode:t})}else this.gamesListData[this.editingIndex].package=e,this.gamesListData[this.editingIndex].mode=t;this.closeGameModal(),this.refreshGamesList(),this.editingIndex===-1&&c(i("toast_game_added",{},this.currentLanguage))}deleteGameItem(e){e>=0&&e<this.gamesListData.length?(this.gamesListData.splice(e,1),this.refreshGamesList(),c(i("toast_game_deleted",{},this.currentLanguage))):c(i("toast_index_invalid",{},this.currentLanguage))}async saveGamesToFile(){if(this.gamesListData.length===0){c(i("toast_games_empty",{},this.currentLanguage));return}const e=y.serializeTomlGames(this.gamesListData),t=btoa(unescape(encodeURIComponent(e)));(await u(`echo '${t}' | base64 -d > ${p.GAMES_FILE}`)).errno===0?c(i("toast_games_saved",{},this.currentLanguage)):c(i("toast_games_save_fail",{},this.currentLanguage))}setLanguage(e){this.currentLanguage=e,this.gamesSearchInput&&(this.gamesSearchInput.placeholder=i("config_games_search_placeholder",{},this.currentLanguage)),this.renderer.setLanguage(e),this.modal.setLanguage(e),this.refreshGamesList()}}class N{currentLanguage="zh";logContent;refreshLogBtn;constructor(){this.logContent=document.getElementById("logContent"),this.refreshLogBtn=document.getElementById("refreshLogBtn")}init(){this.setupEventListeners(),this.initLogFileSelect()}setupEventListeners(){this.refreshLogBtn&&this.refreshLogBtn.addEventListener("click",()=>this.loadLog());const e=document.querySelectorAll(".log-tab-btn");e.forEach(t=>{t.addEventListener("click",()=>{t.classList.contains("active")||(e.forEach(a=>{a.classList.remove("active")}),t.classList.add("active"),this.logContent&&(this.logContent.style.opacity="0.5",this.logContent.textContent=i("log_loading",{},this.currentLanguage)),setTimeout(()=>{this.loadLog().then(()=>{this.logContent&&(this.logContent.style.opacity="1")})},100))})})}initLogFileSelect(){const e=document.querySelector(".log-tab-btn.active"),t=e?e.getAttribute("data-log"):"gpu_gov.log";document.querySelectorAll(".log-tab-btn").forEach(n=>{n.getAttribute("data-log")===t?n.classList.add("active"):n.classList.remove("active")})}async loadLog(){const e=document.querySelector(".log-tab-btn.active"),t=e?e.getAttribute("data-log"):"gpu_gov.log";this.logContent&&(this.logContent.textContent=i("log_loading",{},this.currentLanguage));const{errno:a,stdout:n}=await u(`cat ${p.LOG_PATH}/${t} 2>/dev/null || echo "日志文件不存在"`);if(n.trim()==="日志文件不存在"){this.logContent&&(this.logContent.textContent=i("log_not_found",{},this.currentLanguage));return}if(a===0){const o=n.trim().split(`
`).slice(-100).join(`
`);this.logContent&&(this.logContent.textContent=o||i("log_empty",{},this.currentLanguage)),this.logContent&&(this.logContent.scrollTop=this.logContent.scrollHeight)}else this.logContent&&(this.logContent.textContent=i("log_not_found",{},this.currentLanguage))}setLanguage(e){this.currentLanguage=e}}class D{currentLanguage="zh";logLevelContainer;languageContainer;constructor(){this.logLevelContainer=document.getElementById("logLevelContainer"),this.languageContainer=document.getElementById("languageContainer")}init(){this.setupEventListeners(),this.loadLogLevel()}setupEventListeners(){if(this.logLevelContainer){const e=this.logLevelContainer.querySelectorAll(".settings-tab-btn");e.forEach(t=>{t.addEventListener("click",a=>{a.preventDefault(),e.forEach(n=>{n.classList.remove("active")}),t.classList.add("active"),this.saveLogLevel()})})}if(this.languageContainer){const e=this.languageContainer.querySelectorAll(".settings-tab-btn");e.forEach(t=>{t.addEventListener("click",async a=>{a.preventDefault(),e.forEach(r=>{r.classList.remove("active")}),t.classList.add("active");const n=t.getAttribute("data-value");localStorage.setItem("languageSetting",n);let s="zh";if(n==="system"){const{errno:r,stdout:l}=await u('getprop persist.sys.locale || getprop ro.product.locale || echo "zh-CN"');r===0&&l.trim()&&(s=l.trim().toLowerCase().startsWith("en")?"en":"zh"),localStorage.setItem("language",s),c(i("toast_language_follow_system",{},s))}else s=n,localStorage.setItem("language",n),c(i("toast_language_changed",{language:n==="zh"?"中文":"English"},s));this.currentLanguage=s;const o=new CustomEvent("languageChange",{detail:{language:s}});document.dispatchEvent(o)})})}}async loadLogLevel(){const{errno:e,stdout:t}=await u(`cat ${p.LOG_LEVEL_PATH} 2>/dev/null || echo "info"`);let a="info";if(e===0){const n=t.trim().toLowerCase();["debug","info","warn","error"].includes(n)&&(a=n)}this.logLevelContainer&&this.logLevelContainer.querySelectorAll(".settings-tab-btn").forEach(s=>{s.getAttribute("data-value")===a?s.classList.add("active"):s.classList.remove("active")})}async saveLogLevel(){if(!this.logLevelContainer)return;const e=this.logLevelContainer.querySelector(".settings-tab-btn.active");if(!e)return;const t=e.getAttribute("data-value"),{errno:a}=await u(`echo "${t}" > ${p.LOG_LEVEL_PATH}`);c(a===0?t==="debug"?i("toast_log_level_debug",{},this.currentLanguage):i("toast_log_level_set",{level:t||""},this.currentLanguage):i("toast_log_level_fail",{},this.currentLanguage))}setLanguage(e){this.currentLanguage=e}}class F{themeToggle;followSystemThemeToggle;followSystemThemeSuperSwitch;currentLanguage="zh";constructor(){this.themeToggle=document.getElementById("themeToggle"),this.followSystemThemeToggle=document.querySelector("#followSystemThemeToggle .miuix-switch-input"),this.followSystemThemeSuperSwitch=document.getElementById("followSystemThemeSuperSwitch")}init(){this.initTheme(),this.setupEventListeners()}initTheme(){const e=localStorage.getItem("theme"),t=window.matchMedia?.("(prefers-color-scheme: dark)").matches,a=localStorage.getItem("followSystemTheme"),n=a===null?!0:a==="true";this.followSystemThemeToggle&&(this.followSystemThemeToggle.checked=n),a===null&&localStorage.setItem("followSystemTheme","true");let s;if(n?s=t?"dark":"light":e?s=e:s=t?"dark":"light",document.documentElement.setAttribute("data-theme",s),localStorage.setItem("theme",s),window.matchMedia){const o=window.matchMedia("(prefers-color-scheme: dark)");o.addEventListener&&o.addEventListener("change",r=>{if(localStorage.getItem("followSystemTheme")==="true"){const l=r.matches?"dark":"light";document.documentElement.setAttribute("data-theme",l),localStorage.setItem("theme",l)}})}}setupEventListeners(){this.themeToggle&&this.themeToggle.addEventListener("click",()=>this.toggleTheme()),this.followSystemThemeSuperSwitch&&(this.followSystemThemeSuperSwitch.addEventListener("click",e=>this.handleFollowSystemToggleClick(e)),this.followSystemThemeSuperSwitch.addEventListener("keydown",e=>{(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),e.currentTarget.click())}),this.followSystemThemeSuperSwitch.setAttribute("tabindex","0"),this.followSystemThemeSuperSwitch.setAttribute("role","switch"),this.followSystemThemeSuperSwitch.setAttribute("aria-checked",this.followSystemThemeToggle?.checked?"true":"false")),this.followSystemThemeToggle&&this.followSystemThemeToggle.addEventListener("change",()=>this.handleFollowSystemChange())}toggleTheme(){this.themeToggle&&this.themeToggle.classList.add("switching"),localStorage.getItem("followSystemTheme")==="true"&&(localStorage.setItem("followSystemTheme","false"),this.followSystemThemeToggle&&(this.followSystemThemeToggle.checked=!1),c(i("toast_theme_follow_disabled",{},this.currentLanguage)));const t=document.documentElement.getAttribute("data-theme")==="light"?"dark":"light";document.documentElement.style.transition="background-color 0.3s ease, color 0.3s ease",document.documentElement.setAttribute("data-theme",t),localStorage.setItem("theme",t),setTimeout(()=>{this.themeToggle&&this.themeToggle.classList.remove("switching"),document.documentElement.style.transition=""},600),c(i(t==="dark"?"toast_theme_switched_dark":"toast_theme_switched_light",{},this.currentLanguage))}handleFollowSystemToggleClick(e){e.target!==this.followSystemThemeToggle&&(e.preventDefault(),navigator.vibrate&&navigator.vibrate(50),this.followSystemThemeToggle&&(this.followSystemThemeToggle.checked=!this.followSystemThemeToggle.checked,this.followSystemThemeToggle.dispatchEvent(new Event("change",{bubbles:!0}))))}handleFollowSystemChange(){const e=!!this.followSystemThemeToggle?.checked;if(localStorage.setItem("followSystemTheme",e.toString()),this.followSystemThemeSuperSwitch&&this.followSystemThemeSuperSwitch.setAttribute("aria-checked",e?"true":"false"),this.followSystemThemeSuperSwitch&&(this.followSystemThemeSuperSwitch.style.transform="scale(0.98)",setTimeout(()=>{this.followSystemThemeSuperSwitch&&(this.followSystemThemeSuperSwitch.style.transform="")},150)),e){const t=window.matchMedia?.("(prefers-color-scheme: dark)").matches?"dark":"light";document.documentElement.setAttribute("data-theme",t),localStorage.setItem("theme",t),c(i("toast_theme_follow_enabled",{},this.currentLanguage))}else c(i("toast_theme_follow_keep",{},this.currentLanguage))}setLanguage(e){this.currentLanguage=e}}class ${currentLanguage="zh";currentPage="page-status";app;loading;htmlRoot;moduleVersion;currentMode;runningStatus;pages;navItems;languageContainer;themeManager;configManager;gamesManager;logManager;settingsManager;constructor(){this.app=document.getElementById("app"),this.loading=document.getElementById("loading"),this.htmlRoot=document.getElementById("htmlRoot"),this.moduleVersion=document.getElementById("moduleVersion"),this.currentMode=document.getElementById("currentMode"),this.runningStatus=document.getElementById("runningStatus"),this.pages=document.querySelectorAll(".page"),this.navItems=document.querySelectorAll(".nav-item"),this.languageContainer=document.getElementById("languageContainer"),this.themeManager=new F,this.configManager=new x,this.gamesManager=new A,this.logManager=new N,this.settingsManager=new D}async init(){this.loading&&(this.loading.style.display="none"),this.app&&(this.app.style.display="block"),this.themeManager.init(),this.configManager.init(),this.gamesManager.init(),this.logManager.init(),this.settingsManager.init(),await this.initLanguage(),this.setupLanguageEvents(),this.setupNavigationEvents(),await this.loadData(),setInterval(()=>{this.loadCurrentMode(),this.checkModuleStatus()},2e3),c(i("toast_webui_loaded",{},this.currentLanguage))}setupNavigationEvents(){this.navItems.forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-page");t&&this.switchPage(t)})})}setupLanguageEvents(){document.addEventListener("languageChange",e=>{const t=e,{language:a}=t.detail;this.currentLanguage=a,this.themeManager.setLanguage(this.currentLanguage),this.configManager.setLanguage(this.currentLanguage),this.gamesManager.setLanguage(this.currentLanguage),this.logManager.setLanguage(this.currentLanguage),this.settingsManager.setLanguage(this.currentLanguage),this.applyTranslations(),this.loadModuleVersion(),this.loadCurrentMode(),this.checkModuleStatus()})}async initLanguage(){const e=localStorage.getItem("languageSetting"),t=localStorage.getItem("language");e===null&&localStorage.setItem("languageSetting","system"),e==="system"||e===null?(this.currentLanguage=await this.detectSystemLanguage(),localStorage.setItem("language",this.currentLanguage)):t&&(this.currentLanguage=t),this.themeManager.setLanguage(this.currentLanguage),this.configManager.setLanguage(this.currentLanguage),this.gamesManager.setLanguage(this.currentLanguage),this.logManager.setLanguage(this.currentLanguage),this.settingsManager.setLanguage(this.currentLanguage),this.applyTranslations(),this.updateSelectedLanguageText(e||"system"),this.setupLanguageEvents()}async detectSystemLanguage(){const e=navigator,t=navigator.language||e.userLanguage||"zh-CN",{errno:a,stdout:n}=await u('getprop persist.sys.locale || getprop ro.product.locale || echo "zh-CN"');return a===0&&n.trim()?n.trim().toLowerCase().startsWith("en")?"en":"zh":t.startsWith("en")?"en":"zh"}applyTranslations(){document.title=i("title",{},this.currentLanguage),this.htmlRoot&&this.htmlRoot.setAttribute("lang",this.currentLanguage==="en"?"en":"zh-CN"),this.loading&&(this.loading.textContent=i("loading",{},this.currentLanguage));const e=document.querySelector(".header-content h1");e&&(e.textContent=i("header_title",{},this.currentLanguage)),document.querySelectorAll(".nav-item").forEach(t=>{const a=t.getAttribute("data-page"),n=t.querySelector(".nav-text");n&&(a==="page-status"?n.textContent=i("nav_status",{},this.currentLanguage):a==="page-config"?n.textContent=i("nav_config",{},this.currentLanguage):a==="page-log"?n.textContent=i("nav_log",{},this.currentLanguage):a==="page-settings"&&(n.textContent=i("nav_settings",{},this.currentLanguage)))}),document.querySelectorAll("[data-i18n]").forEach(t=>{const a=t.getAttribute("data-i18n");a&&f[this.currentLanguage]&&f[this.currentLanguage][a]&&(t.textContent=i(a,{},this.currentLanguage))}),document.querySelectorAll("[data-i18n-placeholder]").forEach(t=>{const a=t.getAttribute("data-i18n-placeholder");a&&f[this.currentLanguage]&&f[this.currentLanguage][a]&&(t.placeholder=i(a,{},this.currentLanguage))})}updateSelectedLanguageText(e){if(!this.languageContainer)return;this.languageContainer.querySelectorAll(".settings-tab-btn").forEach(n=>{n.classList.remove("active")});const a=this.languageContainer.querySelector(`.settings-tab-btn[data-value="${e}"]`);if(a)a.classList.add("active");else{const n=this.languageContainer.querySelector('.settings-tab-btn[data-value="system"]');n&&n.classList.add("active")}}async loadData(){const e=[()=>this.checkModuleStatus(),()=>this.loadModuleVersion(),()=>this.loadCurrentMode(),()=>this.configManager.loadGpuConfig(),()=>this.gamesManager.loadGamesList(),()=>this.logManager.loadLog(),()=>this.settingsManager.loadLogLevel()];for(const t of e)await t();this.switchPage("page-status")}switchPage(e){this.pages.forEach(a=>{a.classList.remove("active")});const t=document.getElementById(e);t&&t.classList.add("active"),this.navItems.forEach(a=>{a.getAttribute("data-page")===e?a.classList.add("active"):a.classList.remove("active")}),this.currentPage=e}async checkModuleStatus(){const{errno:e,stdout:t}=await u('pgrep -f gpugovernor || echo ""'),a=e===0&&t.trim(),n=this.runningStatus?.classList.contains("status-running");a!==n&&this.runningStatus&&(this.runningStatus.classList.add("status-changing"),this.runningStatus.removeAttribute("data-i18n"),setTimeout(()=>{a&&this.runningStatus?(this.runningStatus.textContent=i("status_running_active",{},this.currentLanguage),this.runningStatus.className="status-badge status-running"):this.runningStatus&&(this.runningStatus.textContent=i("status_running_inactive",{},this.currentLanguage),this.runningStatus.className="status-badge status-stopped"),setTimeout(()=>{this.runningStatus?.classList.remove("status-changing")},600)},100))}async loadModuleVersion(){const{errno:e,stdout:t}=await u('grep -i "^version=" /data/adb/modules/Mediatek_Mali_GPU_Governor/module.prop | cut -d= -f2');if(e===0&&t.trim()){this.moduleVersion&&(this.moduleVersion.textContent=t.trim(),this.moduleVersion.removeAttribute("data-i18n"));return}const{errno:a,stdout:n}=await u('grep -i "^version=" /data/adb/ksu/modules/Mediatek_Mali_GPU_Governor/module.prop | cut -d= -f2');if(a===0&&n.trim()){this.moduleVersion&&(this.moduleVersion.textContent=n.trim(),this.moduleVersion.removeAttribute("data-i18n"));return}this.moduleVersion&&(this.moduleVersion.textContent=this.currentLanguage==="en"?"Unknown":"未知",this.moduleVersion.removeAttribute("data-i18n"))}async loadCurrentMode(){const{errno:e,stdout:t}=await u(`cat ${p.CURRENT_MODE_PATH} 2>/dev/null || echo "unknown"`);let a="unknown";if(e===0&&(a=t.trim().toLowerCase()),["powersave","balance","performance","fast"].includes(a)||(a="unknown"),this.currentMode){const s={powersave:i("status_mode_powersave",{},this.currentLanguage),balance:i("status_mode_balance",{},this.currentLanguage),performance:i("status_mode_performance",{},this.currentLanguage),fast:i("status_mode_fast",{},this.currentLanguage),unknown:i("status_mode_unknown",{},this.currentLanguage)};this.currentMode.textContent=s[a]||s.unknown,this.currentMode.className=`mode-badge ${a}`,this.currentMode.removeAttribute("data-i18n")}}}document.addEventListener("DOMContentLoaded",async()=>{console.debug("[main] 生产模式：跳过组件动态加载（已内联）"),await new $().init()});
