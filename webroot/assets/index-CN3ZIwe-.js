(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function K(a,e){let t=a.slice(0,e).split(/\r\n|\n|\r/g);return[t.length,t.pop().length+1]}function X(a,e,t){let n=a.split(/\r\n|\n|\r/g),s="",i=(Math.log10(e+1)|0)+1;for(let o=e-1;o<=e+1;o++){let l=n[o-1];l&&(s+=o.toString().padEnd(i," "),s+=":  ",s+=l,s+=`
`,o===e&&(s+=" ".repeat(i+t+2),s+=`^
`))}return s}class d extends Error{line;column;codeblock;constructor(e,t){const[n,s]=K(t.toml,t.ptr),i=X(t.toml,n,s);super(`Invalid TOML document: ${e}

${i}`,t),this.line=n,this.column=s,this.codeblock=i}}function Z(a,e){let t=0;for(;a[e-++t]==="\\";);return--t&&t%2}function S(a,e=0,t=a.length){let n=a.indexOf(`
`,e);return a[n-1]==="\r"&&n--,n<=t?n:-1}function G(a,e){for(let t=e;t<a.length;t++){let n=a[t];if(n===`
`)return t;if(n==="\r"&&a[t+1]===`
`)return t+1;if(n<" "&&n!=="	"||n==="")throw new d("control characters are not allowed in comments",{toml:a,ptr:e})}return a.length}function y(a,e,t,n){let s;for(;(s=a[e])===" "||s==="	"||!t&&(s===`
`||s==="\r"&&a[e+1]===`
`);)e++;return n||s!=="#"?e:y(a,G(a,e),t)}function N(a,e,t,n,s=!1){if(!n)return e=S(a,e),e<0?a.length:e;for(let i=e;i<a.length;i++){let o=a[i];if(o==="#")i=S(a,i);else{if(o===t)return i+1;if(o===n||s&&(o===`
`||o==="\r"&&a[i+1]===`
`))return i}}throw new d("cannot find end of structure",{toml:a,ptr:e})}function z(a,e){let t=a[e],n=t===a[e+1]&&a[e+1]===a[e+2]?a.slice(e,e+3):t;e+=n.length-1;do e=a.indexOf(n,++e);while(e>-1&&t!=="'"&&Z(a,e));return e>-1&&(e+=n.length,n.length>1&&(a[e]===t&&e++,a[e]===t&&e++)),e}let J=/^(\d{4}-\d{2}-\d{2})?[T ]?(?:(\d{2}):\d{2}:\d{2}(?:\.\d+)?)?(Z|[-+]\d{2}:\d{2})?$/i;class L extends Date{#t=!1;#n=!1;#e=null;constructor(e){let t=!0,n=!0,s="Z";if(typeof e=="string"){let i=e.match(J);i?(i[1]||(t=!1,e=`0000-01-01T${e}`),n=!!i[2],n&&e[10]===" "&&(e=e.replace(" ","T")),i[2]&&+i[2]>23?e="":(s=i[3]||null,e=e.toUpperCase(),!s&&n&&(e+="Z"))):e=""}super(e),isNaN(this.getTime())||(this.#t=t,this.#n=n,this.#e=s)}isDateTime(){return this.#t&&this.#n}isLocal(){return!this.#t||!this.#n||!this.#e}isDate(){return this.#t&&!this.#n}isTime(){return this.#n&&!this.#t}isValid(){return this.#t||this.#n}toISOString(){let e=super.toISOString();if(this.isDate())return e.slice(0,10);if(this.isTime())return e.slice(11,23);if(this.#e===null)return e.slice(0,-1);if(this.#e==="Z")return e;let t=+this.#e.slice(1,3)*60+ +this.#e.slice(4,6);return t=this.#e[0]==="-"?t:-t,new Date(this.getTime()-t*6e4).toISOString().slice(0,-1)+this.#e}static wrapAsOffsetDateTime(e,t="Z"){let n=new L(e);return n.#e=t,n}static wrapAsLocalDateTime(e){let t=new L(e);return t.#e=null,t}static wrapAsLocalDate(e){let t=new L(e);return t.#n=!1,t.#e=null,t}static wrapAsLocalTime(e){let t=new L(e);return t.#t=!1,t.#e=null,t}}let Y=/^((0x[0-9a-fA-F](_?[0-9a-fA-F])*)|(([+-]|0[ob])?\d(_?\d)*))$/,Q=/^[+-]?\d(_?\d)*(\.\d(_?\d)*)?([eE][+-]?\d(_?\d)*)?$/,ee=/^[+-]?0[0-9_]/,te=/^[0-9a-f]{4,8}$/i,F={b:"\b",t:"	",n:`
`,f:"\f",r:"\r",'"':'"',"\\":"\\"};function H(a,e=0,t=a.length){let n=a[e]==="'",s=a[e++]===a[e]&&a[e]===a[e+1];s&&(t-=2,a[e+=2]==="\r"&&e++,a[e]===`
`&&e++);let i=0,o,l="",c=e;for(;e<t-1;){let g=a[e++];if(g===`
`||g==="\r"&&a[e]===`
`){if(!s)throw new d("newlines are not allowed in strings",{toml:a,ptr:e-1})}else if(g<" "&&g!=="	"||g==="")throw new d("control characters are not allowed in strings",{toml:a,ptr:e-1});if(o){if(o=!1,g==="u"||g==="U"){let u=a.slice(e,e+=g==="u"?4:8);if(!te.test(u))throw new d("invalid unicode escape",{toml:a,ptr:i});try{l+=String.fromCodePoint(parseInt(u,16))}catch{throw new d("invalid unicode escape",{toml:a,ptr:i})}}else if(s&&(g===`
`||g===" "||g==="	"||g==="\r")){if(e=y(a,e-1,!0),a[e]!==`
`&&a[e]!=="\r")throw new d("invalid escape: only line-ending whitespace may be escaped",{toml:a,ptr:i});e=y(a,e)}else if(g in F)l+=F[g];else throw new d("unrecognized escape sequence",{toml:a,ptr:i});c=e}else!n&&g==="\\"&&(i=e-1,o=!0,l+=a.slice(c,i))}return l+a.slice(c,t-1)}function ne(a,e,t,n){if(a==="true")return!0;if(a==="false")return!1;if(a==="-inf")return-1/0;if(a==="inf"||a==="+inf")return 1/0;if(a==="nan"||a==="+nan"||a==="-nan")return NaN;if(a==="-0")return n?0n:0;let s=Y.test(a);if(s||Q.test(a)){if(ee.test(a))throw new d("leading zeroes are not allowed",{toml:e,ptr:t});a=a.replace(/_/g,"");let o=+a;if(isNaN(o))throw new d("invalid number",{toml:e,ptr:t});if(s){if((s=!Number.isSafeInteger(o))&&!n)throw new d("integer value cannot be represented losslessly",{toml:e,ptr:t});(s||n===!0)&&(o=BigInt(a))}return o}const i=new L(a);if(!i.isValid())throw new d("invalid value",{toml:e,ptr:t});return i}function ae(a,e,t,n){let s=a.slice(e,t),i=s.indexOf("#");i>-1&&(G(a,i),s=s.slice(0,i));let o=s.trimEnd();if(!n){let l=s.indexOf(`
`,o.length);if(l>-1)throw new d("newlines are not allowed in inline tables",{toml:a,ptr:e+l})}return[o,i]}function A(a,e,t,n,s){if(n===0)throw new d("document contains excessively nested structures. aborting.",{toml:a,ptr:e});let i=a[e];if(i==="["||i==="{"){let[c,g]=i==="["?oe(a,e,n,s):ie(a,e,n,s),u=t?N(a,g,",",t):g;if(g-u&&t==="}"){let p=S(a,g,u);if(p>-1)throw new d("newlines are not allowed in inline tables",{toml:a,ptr:p})}return[c,u]}let o;if(i==='"'||i==="'"){o=z(a,e);let c=H(a,e,o);if(t){if(o=y(a,o,t!=="]"),a[o]&&a[o]!==","&&a[o]!==t&&a[o]!==`
`&&a[o]!=="\r")throw new d("unexpected character encountered",{toml:a,ptr:o});o+=+(a[o]===",")}return[c,o]}o=N(a,e,",",t);let l=ae(a,e,o-+(a[o-1]===","),t==="]");if(!l[0])throw new d("incomplete key-value declaration: no value specified",{toml:a,ptr:e});return t&&l[1]>-1&&(o=y(a,e+l[1]),o+=+(a[o]===",")),[ne(l[0],a,e,s),o]}let se=/^[a-zA-Z0-9-_]+[ \t]*$/;function T(a,e,t="="){let n=e-1,s=[],i=a.indexOf(t,e);if(i<0)throw new d("incomplete key-value: cannot find end of key",{toml:a,ptr:e});do{let o=a[e=++n];if(o!==" "&&o!=="	")if(o==='"'||o==="'"){if(o===a[e+1]&&o===a[e+2])throw new d("multiline strings are not allowed in keys",{toml:a,ptr:e});let l=z(a,e);if(l<0)throw new d("unfinished string encountered",{toml:a,ptr:e});n=a.indexOf(".",l);let c=a.slice(l,n<0||n>i?i:n),g=S(c);if(g>-1)throw new d("newlines are not allowed in keys",{toml:a,ptr:e+n+g});if(c.trimStart())throw new d("found extra tokens after the string part",{toml:a,ptr:l});if(i<l&&(i=a.indexOf(t,l),i<0))throw new d("incomplete key-value: cannot find end of key",{toml:a,ptr:e});s.push(H(a,e,l))}else{n=a.indexOf(".",e);let l=a.slice(e,n<0||n>i?i:n);if(!se.test(l))throw new d("only letter, numbers, dashes and underscores are allowed in keys",{toml:a,ptr:e});s.push(l.trimEnd())}}while(n+1&&n<i);return[s,y(a,i+1,!0,!0)]}function ie(a,e,t,n){let s={},i=new Set,o,l=0;for(e++;(o=a[e++])!=="}"&&o;){let c={toml:a,ptr:e-1};if(o===`
`)throw new d("newlines are not allowed in inline tables",c);if(o==="#")throw new d("inline tables cannot contain comments",c);if(o===",")throw new d("expected key-value, found comma",c);if(o!==" "&&o!=="	"){let g,u=s,p=!1,[P,W]=T(a,e-1);for(let b=0;b<P.length;b++){if(b&&(u=p?u[g]:u[g]={}),g=P[b],(p=Object.hasOwn(u,g))&&(typeof u[g]!="object"||i.has(u[g])))throw new d("trying to redefine an already defined value",{toml:a,ptr:e});!p&&g==="__proto__"&&Object.defineProperty(u,g,{enumerable:!0,configurable:!0,writable:!0})}if(p)throw new d("trying to redefine an already defined value",{toml:a,ptr:e});let[D,j]=A(a,W,"}",t-1,n);i.add(D),u[g]=D,e=j,l=a[e-1]===","?e-1:0}}if(l)throw new d("trailing commas are not allowed in inline tables",{toml:a,ptr:l});if(!o)throw new d("unfinished table encountered",{toml:a,ptr:e});return[s,e]}function oe(a,e,t,n){let s=[],i;for(e++;(i=a[e++])!=="]"&&i;){if(i===",")throw new d("expected value, found comma",{toml:a,ptr:e-1});if(i==="#")e=G(a,e);else if(i!==" "&&i!=="	"&&i!==`
`&&i!=="\r"){let o=A(a,e-1,"]",t-1,n);s.push(o[0]),e=o[1]}}if(!i)throw new d("unfinished array encountered",{toml:a,ptr:e});return[s,e]}function O(a,e,t,n){let s=e,i=t,o,l=!1,c;for(let g=0;g<a.length;g++){if(g){if(s=l?s[o]:s[o]={},i=(c=i[o]).c,n===0&&(c.t===1||c.t===2))return null;if(c.t===2){let u=s.length-1;s=s[u],i=i[u].c}}if(o=a[g],(l=Object.hasOwn(s,o))&&i[o]?.t===0&&i[o]?.d)return null;l||(o==="__proto__"&&(Object.defineProperty(s,o,{enumerable:!0,configurable:!0,writable:!0}),Object.defineProperty(i,o,{enumerable:!0,configurable:!0,writable:!0})),i[o]={t:g<a.length-1&&n===2?3:n,d:!1,i:0,c:{}})}if(c=i[o],c.t!==n&&!(n===1&&c.t===3)||(n===2&&(c.d||(c.d=!0,s[o]=[]),s[o].push(s={}),c.c[c.i++]=c={t:1,d:!1,i:0,c:{}}),c.d))return null;if(c.d=!0,n===1)s=l?s[o]:s[o]={};else if(n===0&&l)return null;return[o,s,c.c]}function I(a,{maxDepth:e=1e3,integersAsBigInt:t}={}){let n={},s={},i=n,o=s;for(let l=y(a,0);l<a.length;){if(a[l]==="["){let c=a[++l]==="[",g=T(a,l+=+c,"]");if(c){if(a[g[1]-1]!=="]")throw new d("expected end of table declaration",{toml:a,ptr:g[1]-1});g[1]++}let u=O(g[0],n,s,c?2:1);if(!u)throw new d("trying to redefine an already defined table or value",{toml:a,ptr:l});o=u[2],i=u[1],l=g[1]}else{let c=T(a,l),g=O(c[0],i,o,0);if(!g)throw new d("trying to redefine an already defined table or value",{toml:a,ptr:l});let u=A(a,c[1],void 0,e,t);g[1][g[0]]=u[0],l=u[1]}if(l=y(a,l,!0),a[l]&&a[l]!==`
`&&a[l]!=="\r")throw new d("each key-value declaration must be followed by an end-of-line",{toml:a,ptr:l});l=y(a,l)}return n}let R=/^[a-z0-9-_]+$/i;function C(a){let e=typeof a;if(e==="object"){if(Array.isArray(a))return"array";if(a instanceof Date)return"date"}return e}function le(a){for(let e=0;e<a.length;e++)if(C(a[e])!=="object")return!1;return a.length!=0}function x(a){return JSON.stringify(a).replace(/\x7f/g,"\\u007f")}function V(a,e,t,n){if(t===0)throw new Error("Could not stringify the object: maximum object depth exceeded");if(e==="number")return isNaN(a)?"nan":a===1/0?"inf":a===-1/0?"-inf":n&&Number.isInteger(a)?a.toFixed(1):a.toString();if(e==="bigint"||e==="boolean")return a.toString();if(e==="string")return x(a);if(e==="date"){if(isNaN(a.getTime()))throw new TypeError("cannot serialize invalid date");return a.toISOString()}if(e==="object")return re(a,t,n);if(e==="array")return ce(a,t,n)}function re(a,e,t){let n=Object.keys(a);if(n.length===0)return"{}";let s="{ ";for(let i=0;i<n.length;i++){let o=n[i];i&&(s+=", "),s+=R.test(o)?o:x(o),s+=" = ",s+=V(a[o],C(a[o]),e-1,t)}return s+" }"}function ce(a,e,t){if(a.length===0)return"[]";let n="[ ";for(let s=0;s<a.length;s++){if(s&&(n+=", "),a[s]===null||a[s]===void 0)throw new TypeError("arrays cannot contain null or undefined values");n+=V(a[s],C(a[s]),e-1,t)}return n+" ]"}function ge(a,e,t,n){if(t===0)throw new Error("Could not stringify the object: maximum object depth exceeded");let s="";for(let i=0;i<a.length;i++)s+=`[[${e}]]
`,s+=q(a[i],e,t,n),s+=`

`;return s}function q(a,e,t,n){if(t===0)throw new Error("Could not stringify the object: maximum object depth exceeded");let s="",i="",o=Object.keys(a);for(let l=0;l<o.length;l++){let c=o[l];if(a[c]!==null&&a[c]!==void 0){let g=C(a[c]);if(g==="symbol"||g==="function")throw new TypeError(`cannot serialize values of type '${g}'`);let u=R.test(c)?c:x(c);if(g==="array"&&le(a[c]))i+=ge(a[c],e?`${e}.${u}`:u,t-1,n);else if(g==="object"){let p=e?`${e}.${u}`:u;i+=`[${p}]
`,i+=q(a[c],p,t-1,n),i+=`

`}else s+=u,s+=" = ",s+=V(a[c],g,t,n),s+=`
`}}return`${s}
${i}`.trim()}function k(a,{maxDepth:e=1e3,numbersAsFloat:t=!1}={}){if(C(a)!=="object")throw new TypeError("stringify can only be called with an object");return q(a,"",e,t)}const _={LOG_PATH:"/data/adb/gpu_governor/log",CONFIG_PATH:"/data/adb/gpu_governor/config/gpu_freq_table.toml",CURRENT_MODE_PATH:"/data/adb/gpu_governor/config/current_mode",GAMES_FILE:"/data/adb/gpu_governor/game/games.toml",LOG_LEVEL_PATH:"/data/adb/gpu_governor/log/log_level",CUSTOM_CONFIG_PATH:"/data/adb/gpu_governor/config/config.toml"},de=[65e3,64375,63750,63125,62500,61875,61250,60625,6e4,59375,58750,58125,57500,56875,56250,55625,55e3,54375,53750,53125,52500,51875,51250,50625,5e4,49375,48750,48125,47500,46875,46250,45625,45e3,44375,43750,43125,42500,41875],v={VOLT_STEP:625,MAX_VOLT:65e3,MIN_VOLT:41875},f={zh:{title:"天玑GPU调速器",loading:"加载中",header_title:"天玑GPU调速器",nav_status:"状态",nav_config:"配置",nav_log:"日志",nav_settings:"设置",status_title:"模块状态",status_running:"运行状态:",status_running_active:"运行中",status_running_inactive:"未运行",status_checking:"检查中...",status_current_mode:"当前模式:",status_mode_powersave:"省电",status_mode_balance:"均衡",status_mode_performance:"性能",status_mode_fast:"极速",status_mode_unknown:"未知",status_module_version:"模块版本:",status_unknown:"未知",config_gpu_title:"GPU频率表",config_freq:"频率 (MHz)",config_volt:"电压 (uV)",config_ddr:"内存档位",config_edit:"编辑",config_loading:"加载中...",config_not_found:"未找到配置",config_add:"添加配置",config_save:"保存配置",config_save_freq_table:"保存频率表",config_games_title:"游戏列表",config_games_add:"添加游戏",config_games_save:"保存列表",config_games_search_placeholder:"搜索游戏...",config_custom_settings:"自定义设置",config_global_settings:"全局设置",config_global_mode:"全局模式:",config_mode_powersave:"省电模式",config_mode_balance:"均衡模式",config_mode_performance:"性能模式",config_mode_fast:"极速模式",config_idle_threshold:"空闲阈值 (%):",config_powersave_mode:"省电模式设置",config_balance_mode:"均衡模式设置",config_performance_mode:"性能模式设置",config_fast_mode:"极速模式设置",config_margin:"余量 (%):",config_sampling_interval:"采样间隔 (ms):",config_min_adaptive_interval:"最小自适应间隔 (ms):",config_max_adaptive_interval:"最大自适应间隔 (ms):",config_up_rate_delay:"升频延迟 (ms):",config_down_rate_delay:"降频延迟 (ms):",config_aggressive_down:"激进降频策略",config_gaming_mode:"游戏优化",config_adaptive_sampling:"自适应采样",config_load_custom:"加载配置",config_save_custom:"保存配置",log_title:"运行日志",log_refresh:"刷新",log_main:"主日志",log_init:"初始化日志",log_loading:"加载中...",log_empty:"日志为空",log_not_found:"未找到日志",log_size_warning:"警告: 日志文件较大",settings_title:"设置",settings_theme_follow:"深色模式跟随系统",settings_theme_follow_summary:"自动根据系统设置切换主题",settings_language:"语言设置:",settings_language_follow:"跟随系统",settings_language_zh:"中文",settings_language_en:"English",settings_language_desc1:"修改语言设置后实时生效",settings_language_desc2:"跟随系统将自动检测系统语言设置",settings_log_level:"主日志等级:",settings_log_level_debug:"Debug (详细)",settings_log_level_info:"Info (信息)",settings_log_level_warn:"Warn (警告)",settings_log_level_error:"Error (错误)",settings_log_level_desc1:"修改日志等级后实时生效",settings_log_level_desc2:"设置为Debug级别将启用详细日志记录",edit_config_title:"编辑GPU频率表",edit_config_freq:"频率 (MHz):",edit_config_freq_example:"例如: 350000 (KHz)",edit_config_freq_hint:"请输入KHz值，表格中显示为MHz",edit_config_volt:"电压 (uV):",edit_config_ddr:"内存档位:",edit_config_ddr_default:"999 (不调整)",edit_config_ddr_highest:"0 (最高)",edit_config_ddr_high:"1",edit_config_ddr_medium:"2",edit_config_ddr_low:"3",edit_config_save:"保存",edit_config_cancel:"取消",edit_config_delete:"删除",edit_game_title:"编辑游戏列表",edit_game_package:"应用包名:",edit_game_package_example:"例如: com.tencent.tmgp.sgame",edit_game_mode:"对应模式:",edit_game_save:"保存",edit_game_cancel:"取消",toast_webui_loaded:"WebUI加载完成",toast_theme_follow_disabled:"已关闭跟随系统主题，现在可以手动切换主题",toast_theme_follow_enabled:"已开启跟随系统主题",toast_theme_follow_keep:"已关闭跟随系统主题，将保持当前主题",toast_theme_switched_dark:"已切换到深色模式",toast_theme_switched_light:"已切换到浅色模式",toast_config_updated:'配置已更新，请点击"保存频率表"按钮保存到文件',toast_config_deleted:'配置已删除，请点击"保存频率表"按钮保存到文件',toast_config_saved:"配置已成功保存",toast_config_save_fail:"保存配置失败，请检查权限",toast_freq_table_saved:"频率表已成功保存",toast_freq_table_save_fail:"保存频率表失败，请检查权限",toast_config_empty:"没有配置可保存",toast_config_parse_error:"配置文件解析失败: {error}",toast_freq_invalid:"请输入有效的频率值",toast_index_invalid:"无效的配置索引",toast_game_added:'游戏已添加，请点击"保存列表"按钮保存到文件',toast_game_deleted:'游戏已删除，请点击"保存列表"按钮保存到文件',toast_game_exists:"该应用包名已存在于列表中",toast_game_invalid:"请输入有效的应用包名",toast_games_saved:"游戏列表已成功保存",toast_games_save_fail:"保存游戏列表失败，请检查权限",toast_games_empty:"没有游戏可保存",toast_games_parse_error:"游戏列表解析失败，请检查文件格式",toast_log_level_debug:"日志等级已设置为: debug，详细日志记录已启用",toast_log_level_set:"日志等级已设置为: {level}，已实时生效",toast_log_level_fail:"保存日志等级失败，请检查权限",toast_language_changed:"语言已切换为{language}",toast_language_follow_system:"语言已设置为跟随系统",copyright_text:"天玑GPU调速器 © 2025 酷安@瓦力喀 = Github@Seyud",config_games_not_found:"未找到游戏",config_games_list_not_found:"未找到游戏列表"},en:{title:"Mediatek Mali GPU Governor",loading:"Loading",header_title:"Mediatek Mali GPU Governor",nav_status:"Status",nav_config:"Config",nav_log:"Log",nav_settings:"Settings",status_title:"Module Status",status_running:"Running Status:",status_running_active:"Running",status_running_inactive:"Not Running",status_checking:"Checking...",status_current_mode:"Current Mode:",status_mode_powersave:"Powersave",status_mode_balance:"Balance",status_mode_performance:"Performance",status_mode_fast:"Fast",status_mode_unknown:"Unknown",status_module_version:"Module Version:",status_unknown:"Unknown",config_gpu_title:"GPU Frequency Table",config_freq:"Frequency (MHz)",config_volt:"Voltage (uV)",config_ddr:"Memory Level",config_edit:"Edit",config_loading:"Loading...",config_not_found:"No configuration found",config_add:"Add Config",config_save:"Save Config",config_save_freq_table:"Save Frequency Table",config_games_title:"Games List",config_games_add:"Add Game",config_games_save:"Save List",config_games_search_placeholder:"Search games...",config_custom_settings:"Custom Settings",config_global_settings:"Global Settings",config_global_mode:"Global Mode:",config_mode_powersave:"Powersave Mode",config_mode_balance:"Balance Mode",config_mode_performance:"Performance Mode",config_mode_fast:"Fast Mode",config_idle_threshold:"Idle Threshold (%):",config_powersave_mode:"Powersave Mode Settings",config_balance_mode:"Balance Mode Settings",config_performance_mode:"Performance Mode Settings",config_fast_mode:"Fast Mode Settings",config_margin:"Margin (%):",config_sampling_interval:"Sampling Interval (ms):",config_min_adaptive_interval:"Min Adaptive Interval (ms):",config_max_adaptive_interval:"Max Adaptive Interval (ms):",config_up_rate_delay:"Up Rate Delay (ms):",config_down_rate_delay:"Down Rate Delay (ms):",config_aggressive_down:"Aggressive Down Strategy",config_gaming_mode:"Gaming Mode",config_adaptive_sampling:"Adaptive Sampling",config_load_custom:"Load Config",config_save_custom:"Save Config",log_title:"Runtime Log",log_refresh:"Refresh",log_main:"Main Log",log_init:"Init Log",log_loading:"Loading...",log_empty:"Log is empty",log_not_found:"Log not found",log_size_warning:"Warning: Log file size exceeds limit, it will be rotated automatically.",settings_title:"Settings",settings_theme_follow:"Follow System Dark Mode",settings_theme_follow_summary:"Automatically switch theme based on system settings",settings_language:"Language:",settings_language_follow:"Follow System",settings_language_zh:"中文",settings_language_en:"English",settings_language_desc1:"Language changes take effect immediately",settings_language_desc2:"Follow System will detect system language settings",settings_log_level:"Main Log Level:",settings_log_level_debug:"Debug (Detailed)",settings_log_level_info:"Info",settings_log_level_warn:"Warn",settings_log_level_error:"Error",settings_log_level_desc1:"Log level changes take effect immediately",settings_log_level_desc2:"Debug level enables detailed logging",edit_config_title:"Edit GPU Frequency Table",edit_config_freq:"Frequency (MHz):",edit_config_freq_example:"e.g.: 350000 (KHz)",edit_config_freq_hint:"Please enter KHz value, displayed as MHz in table",edit_config_volt:"Voltage (uV):",edit_config_ddr:"Memory Level:",edit_config_ddr_default:"999 (No Change)",edit_config_ddr_highest:"0 (Highest)",edit_config_ddr_high:"1",edit_config_ddr_medium:"2",edit_config_ddr_low:"3",edit_config_save:"Save",edit_config_cancel:"Cancel",edit_config_delete:"Delete",edit_game_title:"Edit Games List",edit_game_package:"Package Name:",edit_game_package_example:"e.g.: com.tencent.tmgp.sgame",edit_game_mode:"Corresponding Mode:",edit_game_save:"Save",edit_game_cancel:"Cancel",toast_webui_loaded:"WebUI loaded successfully",toast_theme_follow_disabled:"System theme following disabled, you can now switch themes manually",toast_theme_follow_enabled:"System theme following enabled",toast_theme_follow_keep:"System theme following disabled, current theme will be kept",toast_theme_switched_dark:"Switched to dark mode",toast_theme_switched_light:"Switched to light mode",toast_config_updated:'Configuration updated, please click "Save Frequency Table" to save to file',toast_config_deleted:'Configuration deleted, please click "Save Frequency Table" to save to file',toast_config_saved:"Configuration saved successfully",toast_config_save_fail:"Failed to save configuration, please check permissions",toast_freq_table_saved:"Frequency table saved successfully",toast_freq_table_save_fail:"Failed to save frequency table, please check permissions",toast_config_empty:"No configuration to save",toast_config_parse_error:"Failed to parse configuration file: {error}",toast_freq_invalid:"Please enter a valid frequency value",toast_index_invalid:"Invalid configuration index",toast_game_added:'Game added, please click "Save List" button to save to file',toast_game_deleted:'Game deleted, please click "Save List" button to save to file',toast_game_exists:"This package name already exists in the list",toast_game_invalid:"Please enter a valid package name",toast_games_saved:"Games list saved successfully",toast_games_save_fail:"Failed to save games list, please check permissions",toast_games_empty:"No games to save",toast_games_parse_error:"Failed to parse games list, please check file format",toast_log_level_debug:"Log level set to: debug, detailed logging has been enabled",toast_log_level_set:"Log level set to: {level}, changes applied immediately",toast_log_level_fail:"Failed to save log level, please check permissions",toast_language_changed:"Language changed to {language}",toast_language_follow_system:"Language set to follow system",copyright_text:"Mediatek Mali GPU Governor © 2025 Coolapk@Walika = Github@Seyud",config_games_not_found:"No games found",config_games_list_not_found:"No games list found"}};function r(a,e={},t="zh"){let s=(f[t]||f.zh)[a]||a;for(const[i,o]of Object.entries(e))s=s.replace(`{${i}}`,String(o));return s}let ue=0;function he(a){return`${a}_callback_${Date.now()}_${ue++}`}function me(a,e){return typeof e>"u"&&(e={}),new Promise((t,n)=>{const s=he("exec");window[s]=(o,l,c)=>{t({errno:o,stdout:l,stderr:c}),i(s)};function i(o){delete window[o]}try{ksu.exec(a,JSON.stringify(e),s)}catch(o){n(o),i(s)}})}function fe(a){ksu.toast(a)}function m(a,e={}){return me(a,e)}function h(a){fe(a)}class pe{currentLanguage="zh";async loadGpuConfig(){const{errno:e,stdout:t}=await m(`cat ${_.CONFIG_PATH}`);if(e===0&&t.trim())try{const n=I(t);if(n.freq_table&&Array.isArray(n.freq_table)){const s=n.freq_table.map(i=>({freq:Number(i.freq),volt:Number(i.volt),ddr:Number(i.ddr_opp)}));return s.sort((i,o)=>i.freq-o.freq),{success:!0,data:s}}}catch(n){return h(r("toast_config_parse_error",{error:String(n)},this.currentLanguage)),{success:!1,error:"parse_error"}}return{success:!1,error:"config_not_found"}}async saveGpuConfig(e){if(!e||e.length===0)return h(r("toast_config_empty",{},this.currentLanguage)),{success:!1,error:"empty_config"};const n={freq_table:[...e].sort((l,c)=>l.freq-c.freq).map(l=>({freq:l.freq,volt:l.volt,ddr_opp:l.ddr}))},i=`# GPU 频率表
# freq 单位: kHz
# volt 单位: uV
# ddr_opp: DDR OPP 档位

`+k(n);return(await this.writeFileAtomically(_.CONFIG_PATH,i)).errno===0?(h(r("toast_freq_table_saved",{},this.currentLanguage)),{success:!0}):(h(r("toast_freq_table_save_fail",{},this.currentLanguage)),{success:!1,error:"save_failed"})}async loadCustomConfig(){const{errno:e,stdout:t}=await m(`cat ${_.CUSTOM_CONFIG_PATH}`);if(e===0&&t.trim())try{const n=I(t),s={};return n.global&&(s.global=n.global),["powersave","balance","performance","fast"].forEach(o=>{n[o]&&(s[o]=n[o])}),{success:!0,data:s}}catch(n){return h(r("toast_config_parse_error",{error:String(n)},this.currentLanguage)),{success:!1,error:"parse_error"}}return{success:!1,error:"config_not_found"}}async saveCustomConfig(e){const t=this.generateCustomConfigContent(e);return(await this.writeFileAtomically(_.CUSTOM_CONFIG_PATH,t)).errno===0?(h(r("toast_config_saved",{},this.currentLanguage)),{success:!0}):(h(r("toast_config_save_fail",{},this.currentLanguage)),{success:!1,error:"save_failed"})}generateCustomConfigContent(e){const t=`# GPU调速器配置文件

`,n={};return e.global&&(n.global=e.global),["powersave","balance","performance","fast"].forEach(i=>{e[i]&&(n[i]=e[i])}),t+k(n)}async writeFileAtomically(e,t){const n=`${e}.tmp`,i=`echo '${btoa(unescape(encodeURIComponent(t)))}' | base64 -d > '${n}' && mv '${n}' '${e}'`,o=await m(i);return o.errno!==0&&await m(`rm -f '${n}'`),o}setLanguage(e){this.currentLanguage=e}}class _e{gpuConfigs=[];currentLanguage="zh";gpuFreqTable;addConfigBtn;saveConfigBtn;onEditCallback=null;saveConfigToFile=null;constructor(){this.gpuFreqTable=document.getElementById("gpuFreqTable")?.querySelector("tbody"),this.addConfigBtn=document.getElementById("addConfigBtn"),this.saveConfigBtn=document.getElementById("saveConfigBtn")}init(){this.setupEventListeners()}setupEventListeners(){this.addConfigBtn&&this.addConfigBtn.addEventListener("click",()=>this.openEditModal()),this.saveConfigBtn&&this.saveConfigBtn.addEventListener("click",()=>{this.saveConfigToFile&&this.saveConfigToFile()})}loadConfigs(e){this.gpuConfigs=e||[],this.gpuConfigs.length>0?(this.gpuConfigs.sort((t,n)=>t.freq-n.freq),this.refreshTable()):this.showEmptyState()}refreshTable(){if(this.gpuFreqTable){if(this.gpuFreqTable.innerHTML="",this.gpuConfigs.length===0){this.showEmptyState();return}this.gpuConfigs=[...this.gpuConfigs].sort((e,t)=>e.freq-t.freq),this.gpuConfigs.forEach((e,t)=>{const n=this.createTableRow(e,t);this.gpuFreqTable?.appendChild(n)})}}createTableRow(e,t){const n=document.createElement("tr");n.dataset.index=String(t),n.dataset.freq=String(e.freq);const s=document.createElement("td");s.textContent=(e.freq/1e3).toFixed(0);const i=document.createElement("td");i.textContent=String(e.volt);const o=document.createElement("td");o.textContent=String(e.ddr);const l=document.createElement("td"),c=this.createEditButton(t);return l.appendChild(c),n.appendChild(s),n.appendChild(i),n.appendChild(o),n.appendChild(l),n}createEditButton(e){const t=document.createElement("button");return t.className="edit-btn",t.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>',t.title="编辑/删除",t.onclick=()=>(this.openEditModal(e),!1),t}showEmptyState(){this.gpuFreqTable&&(this.gpuFreqTable.innerHTML=`<tr><td colspan="4" class="loading-text">${r("config_not_found",{},this.currentLanguage)}</td></tr>`)}openEditModal(e=-1){if(this.onEditCallback){const t=e>=0?this.gpuConfigs[e]:null;this.onEditCallback(t,e)}}addConfig(e){this.gpuConfigs.push(e),this.refreshTable()}updateConfig(e,t){t>=0&&t<this.gpuConfigs.length?this.gpuConfigs[t]=e:this.gpuConfigs.push(e),this.refreshTable()}deleteConfig(e){return e>=0&&e<this.gpuConfigs.length?(this.gpuConfigs.splice(e,1),this.refreshTable(),!0):!1}getConfigs(){return[...this.gpuConfigs]}setEditCallback(e){this.onEditCallback=e}setSaveFileCallback(e){this.saveConfigToFile=e}isFrequencyDuplicate(e,t=-1){return this.gpuConfigs.some((n,s)=>n.freq===e&&s!==t)}getFrequencyRange(){if(this.gpuConfigs.length===0)return{min:0,max:0};const e=this.gpuConfigs.map(t=>t.freq);return{min:Math.min(...e),max:Math.max(...e)}}sortByFrequency(){this.gpuConfigs.sort((e,t)=>e.freq-t.freq),this.refreshTable()}validateConfig(e){const t=[];return(!e.freq||Number.isNaN(e.freq)||e.freq<=0)&&t.push("无效的频率值"),(!e.volt||Number.isNaN(e.volt)||e.volt<=0)&&t.push("无效的电压值"),(e.ddr===void 0||Number.isNaN(e.ddr))&&t.push("无效的DDR档位值"),{isValid:t.length===0,errors:t}}getStatistics(){if(this.gpuConfigs.length===0)return{count:0,avgFreq:0,avgVolt:0,freqRange:{min:0,max:0},voltRange:{min:0,max:0}};const e=this.gpuConfigs.map(n=>n.freq),t=this.gpuConfigs.map(n=>n.volt);return{count:this.gpuConfigs.length,avgFreq:e.reduce((n,s)=>n+s,0)/e.length,avgVolt:t.reduce((n,s)=>n+s,0)/t.length,freqRange:{min:Math.min(...e),max:Math.max(...e)},voltRange:{min:Math.min(...t),max:Math.max(...t)}}}setLanguage(e){this.currentLanguage=e,this.refreshTable()}clearConfigs(){this.gpuConfigs=[],this.refreshTable()}}class ve{voltageController;editingIndex=-1;currentLanguage="zh";onSaveCallback=null;onDeleteCallback=null;editConfigModal;closeModalBtn;freqInput;saveItemBtn;cancelEditBtn;deleteItemBtn;ddrContainer;selectedDdr;constructor(e){this.voltageController=e,this.editConfigModal=document.getElementById("editConfigModal"),this.closeModalBtn=document.querySelector(".close-modal"),this.freqInput=document.getElementById("freqInput"),this.saveItemBtn=document.getElementById("saveItemBtn"),this.cancelEditBtn=document.getElementById("cancelEditBtn"),this.deleteItemBtn=document.getElementById("deleteItemBtn"),this.ddrContainer=document.getElementById("ddrContainer"),this.selectedDdr=document.getElementById("selectedDdr")}init(){this.setupEventListeners(),this.setupDdrSelector()}setupEventListeners(){this.closeModalBtn&&this.closeModalBtn.addEventListener("click",()=>this.closeModal()),this.cancelEditBtn&&this.cancelEditBtn.addEventListener("click",()=>this.closeModal()),this.saveItemBtn&&this.saveItemBtn.addEventListener("click",()=>this.saveConfigItem()),this.deleteItemBtn&&this.deleteItemBtn.addEventListener("click",()=>this.deleteConfigItem()),window.addEventListener("click",e=>{e.target===this.editConfigModal&&this.closeModal()}),window.addEventListener("keydown",e=>{e.key==="Escape"&&this.editConfigModal&&this.editConfigModal.style.display==="block"&&this.closeModal()})}setupDdrSelector(){if(!this.ddrContainer)return;this.ddrContainer.addEventListener("click",()=>{this.ddrContainer?.classList.toggle("open"),this.ddrContainer?.classList.contains("open")?setTimeout(()=>{(this.ddrContainer?.querySelectorAll(".option")).forEach((n,s)=>{setTimeout(()=>{n.style.opacity="1",n.style.transform="translateY(0)"},s*50)})},10):((this.ddrContainer?.querySelectorAll(".option")).forEach(n=>{n.style.opacity="0",n.style.transform="translateY(-10px)"}),setTimeout(()=>{this.ddrContainer?.classList.remove("open")},150))});const e=document.querySelectorAll("#ddrOptions .option");e.forEach(t=>{t.addEventListener("click",n=>{n.stopPropagation(),e.forEach(i=>{i.classList.remove("selected")}),t.classList.add("selected"),this.selectedDdr&&(this.selectedDdr.textContent=t.textContent);const s=this.ddrContainer?.querySelectorAll(".option");s.forEach(i=>{i.style.opacity="0",i.style.transform="translateY(-10px)"}),setTimeout(()=>{this.ddrContainer?.classList.remove("open")},150),setTimeout(()=>{s.forEach(i=>{i.style.opacity="",i.style.transform=""})},300)})})}openModal(e=null,t=-1){this.editConfigModal&&(this.editingIndex=t,e?(this.freqInput&&(this.freqInput.value=String(e.freq)),this.voltageController&&this.voltageController.setVoltage(e.volt),this.setDdrValue(e.ddr),this.deleteItemBtn&&(this.deleteItemBtn.style.display="block")):(this.freqInput&&(this.freqInput.value=""),this.voltageController&&this.voltageController.reset(),this.setDdrValue(999),this.deleteItemBtn&&(this.deleteItemBtn.style.display="none")),this.editConfigModal.style.display="block")}closeModal(){this.editConfigModal&&(this.editConfigModal.style.display="none")}setDdrValue(e){this.selectedDdr&&document.querySelectorAll("#ddrOptions .option").forEach(n=>{parseInt(n.getAttribute("data-value")||"0",10)===e?(this.selectedDdr&&(this.selectedDdr.textContent=n.textContent),n.classList.add("selected")):n.classList.remove("selected")})}getDdrValue(){if(this.selectedDdr){const e=this.selectedDdr.textContent||"999";return parseInt(e.split(" ")[0],10)}return 999}saveConfigItem(){if(!this.freqInput)return;const e=parseInt(this.freqInput.value,10),t=this.voltageController?this.voltageController.getCurrentVoltage():0,n=this.getDdrValue();if(!e||Number.isNaN(e)){h(r("toast_freq_invalid",{},this.currentLanguage));return}const s={freq:e,volt:t,ddr:n};this.onSaveCallback&&this.onSaveCallback(s,this.editingIndex),this.closeModal(),h(r("toast_config_updated",{},this.currentLanguage))}deleteConfigItem(){this.editingIndex>=0?(this.onDeleteCallback&&this.onDeleteCallback(this.editingIndex),this.closeModal(),h(r("toast_config_deleted",{},this.currentLanguage))):h(r("toast_index_invalid",{},this.currentLanguage))}setSaveCallback(e){this.onSaveCallback=e}setDeleteCallback(e){this.onDeleteCallback=e}setLanguage(e){this.currentLanguage=e}}class ye{currentLanguage="zh";customConfig={};globalModeSelect;globalModeContainer;selectedGlobalMode;globalModeOptions;idleThresholdInput;powersaveInputs=null;balanceInputs=null;performanceInputs=null;fastInputs=null;constructor(){this.globalModeSelect=document.getElementById("globalMode"),this.globalModeContainer=document.getElementById("globalModeContainer"),this.selectedGlobalMode=document.getElementById("selectedGlobalMode"),this.globalModeOptions=document.getElementById("globalModeOptions"),this.idleThresholdInput=document.getElementById("idleThreshold"),this.powersaveInputs=this.getModeInputs("powersave"),this.balanceInputs=this.getModeInputs("balance"),this.performanceInputs=this.getModeInputs("performance"),this.fastInputs=this.getModeInputs("fast")}getModeInputs(e){return{margin:document.getElementById(`${e}Margin`),sampling_interval:document.getElementById(`${e}SamplingInterval`),min_adaptive_interval:document.getElementById(`${e}MinAdaptiveInterval`),max_adaptive_interval:document.getElementById(`${e}MaxAdaptiveInterval`),up_rate_delay:document.getElementById(`${e}UpRateDelay`),down_rate_delay:document.getElementById(`${e}DownRateDelay`),aggressive_down:document.getElementById(`${e}AggressiveDown`),gaming_mode:document.getElementById(`${e}GamingMode`),adaptive_sampling:document.getElementById(`${e}AdaptiveSampling`)}}init(){this.initGlobalModeSelect(),this.initModeSwitchEvents()}initGlobalModeSelect(){if(!this.selectedGlobalMode||!this.globalModeOptions)return;this.selectedGlobalMode.addEventListener("click",t=>{t.stopPropagation(),this.globalModeContainer?.classList.toggle("open")}),this.globalModeOptions.querySelectorAll(".option").forEach(t=>{t.addEventListener("click",n=>{n.stopPropagation();const s=t.getAttribute("data-value"),i=t.textContent,o=this.selectedGlobalMode?.querySelector("span");o&&(o.textContent=i||"",o.setAttribute("data-i18n",t.getAttribute("data-i18n")||"")),this.globalModeSelect&&s&&(this.globalModeSelect.value=s,this.globalModeSelect.dispatchEvent(new Event("change"))),this.globalModeContainer?.classList.remove("open")})}),document.addEventListener("click",t=>{this.globalModeContainer?.contains(t.target)||this.globalModeContainer?.classList.remove("open")})}initModeSwitchEvents(){const e=document.querySelectorAll(".mode-tabs-grid .settings-tab-btn"),t=document.querySelectorAll(".mode-config-section");this.globalModeSelect&&this.syncModeTabsWithGlobalMode(this.globalModeSelect.value),e.forEach(n=>{n.addEventListener("click",()=>{const s=n.getAttribute("data-mode");e.forEach(o=>{o.classList.remove("active")}),n.classList.add("active"),t.forEach(o=>{o.classList.remove("active")});const i=document.getElementById(`${s}-config`);i&&i.classList.add("active")})}),this.globalModeSelect&&this.globalModeSelect.addEventListener("change",()=>{const n=this.globalModeSelect?.value;n&&this.syncModeTabsWithGlobalMode(n)})}syncModeTabsWithGlobalMode(e){const t=document.querySelectorAll(".mode-tabs-grid .settings-tab-btn"),n=document.querySelectorAll(".mode-config-section");t.forEach(s=>{s.classList.remove("active"),s.getAttribute("data-mode")===e&&s.classList.add("active")}),n.forEach(s=>{s.classList.remove("active"),s.id===`${e}-config`&&s.classList.add("active")})}populateCustomConfigForm(e){this.customConfig=e||{},this.customConfig.global&&(this.globalModeSelect&&this.customConfig.global.mode&&(this.globalModeSelect.value=String(this.customConfig.global.mode)),this.selectedGlobalMode&&this.customConfig.global.mode&&this.updateGlobalModeDisplay(String(this.customConfig.global.mode)),this.idleThresholdInput&&this.customConfig.global.idle_threshold!==void 0&&(this.idleThresholdInput.value=String(this.customConfig.global.idle_threshold))),this.populateModeConfig(this.powersaveInputs,this.customConfig.powersave),this.populateModeConfig(this.balanceInputs,this.customConfig.balance),this.populateModeConfig(this.performanceInputs,this.customConfig.performance),this.populateModeConfig(this.fastInputs,this.customConfig.fast),this.customConfig.global?.mode&&this.syncModeTabsWithGlobalMode(String(this.customConfig.global.mode))}updateGlobalModeDisplay(e){let t="",n="";switch(e){case"powersave":t=r("config_powersave_mode",{},this.currentLanguage),n="config_powersave_mode";break;case"performance":t=r("config_performance_mode",{},this.currentLanguage),n="config_performance_mode";break;case"fast":t=r("config_fast_mode",{},this.currentLanguage),n="config_fast_mode";break;default:t=r("config_balance_mode",{},this.currentLanguage),n="config_balance_mode";break}if(this.selectedGlobalMode){const s=this.selectedGlobalMode.querySelector("span");s&&(s.textContent=t,s.setAttribute("data-i18n",n))}}populateModeConfig(e,t){!t||!e||Object.keys(e).forEach(n=>{const s=e[n];if(s&&t[n]!==void 0){const i=s;i.type==="checkbox"?i.checked=!!t[n]:i.value=String(t[n])}})}getCurrentConfig(){return{global:{mode:this.getGlobalMode(),idle_threshold:this.getIdleThreshold()},powersave:this.getModeConfig(this.powersaveInputs),balance:this.getModeConfig(this.balanceInputs),performance:this.getModeConfig(this.performanceInputs),fast:this.getModeConfig(this.fastInputs)}}getGlobalMode(){if(this.globalModeSelect?.value)return this.globalModeSelect.value;if(this.selectedGlobalMode){const e=this.selectedGlobalMode.querySelector("span");if(e){const t=e.textContent||"";return t.includes("省电")||t.includes("Power Save")?"powersave":t.includes("性能")||t.includes("Performance")?"performance":t.includes("极速")||t.includes("Fast")?"fast":"balance"}}return"balance"}getIdleThreshold(){return this.idleThresholdInput&&this.idleThresholdInput.value||5}getModeConfig(e){if(!e)return{};const t={};return Object.keys(e).forEach(n=>{const s=e[n];s&&(s.type==="checkbox"?t[n]=s.checked:t[n]=s.value?Number(s.value):0)}),t}setLanguage(e){this.currentLanguage=e,this.customConfig.global?.mode&&this.updateGlobalModeDisplay(String(this.customConfig.global.mode))}}class we{currentVoltValue=v.MAX_VOLT;isLongPress=!1;decreaseTimer=null;increaseTimer=null;voltageEventsInitialized=!1;voltSelect;selectedVolt;voltDecreaseBtn;voltIncreaseBtn;constructor(){this.voltSelect=document.getElementById("voltSelect"),this.selectedVolt=document.getElementById("selectedVolt"),this.voltDecreaseBtn=document.getElementById("voltDecreaseBtn"),this.voltIncreaseBtn=document.getElementById("voltIncreaseBtn")}init(){this.initVoltSelect(),this.setupVoltageEvents()}decreaseVolt(){const e=this.currentVoltValue-v.VOLT_STEP;return e>=v.MIN_VOLT?(this.currentVoltValue=e,this.updateVoltDisplay(),!0):!1}increaseVolt(){const e=this.currentVoltValue+v.VOLT_STEP;return e<=v.MAX_VOLT?(this.currentVoltValue=e,this.updateVoltDisplay(),!0):!1}updateVoltDisplay(){if(this.selectedVolt&&(this.selectedVolt.textContent=String(this.currentVoltValue)),this.voltSelect){const e=Array.from(this.voltSelect.options).find(t=>parseInt(t.value,10)===this.currentVoltValue);if(e)this.voltSelect.value=e.value;else{const t=document.createElement("option");t.value=String(this.currentVoltValue),t.textContent=String(this.currentVoltValue),this.voltSelect.appendChild(t),this.voltSelect.value=String(this.currentVoltValue)}this.voltDecreaseBtn&&(this.voltDecreaseBtn.disabled=this.currentVoltValue<=v.MIN_VOLT),this.voltIncreaseBtn&&(this.voltIncreaseBtn.disabled=this.currentVoltValue>=v.MAX_VOLT)}}initVoltSelect(){!this.voltSelect||!this.selectedVolt||(this.voltSelect.innerHTML="",de.forEach(e=>{const t=document.createElement("option");t.value=String(e),t.textContent=String(e),this.voltSelect?.appendChild(t)}),this.currentVoltValue=v.MAX_VOLT,this.selectedVolt.textContent=String(this.currentVoltValue),this.voltSelect.value=String(this.currentVoltValue),this.updateVoltDisplay())}setupVoltageEvents(){this.voltageEventsInitialized||(this.voltDecreaseBtn&&(this.voltDecreaseBtn.addEventListener("click",()=>{if(this.isLongPress){this.isLongPress=!1;return}this.decreaseVolt()}),this.voltDecreaseBtn.addEventListener("mousedown",()=>{this.isLongPress=!1,this.decreaseTimer=setTimeout(()=>{this.isLongPress=!0,this.decreaseVolt()&&this.decreaseTimer&&(this.decreaseTimer=setInterval(()=>{this.decreaseVolt()||this.decreaseTimer&&(clearInterval(this.decreaseTimer),this.decreaseTimer=null)},150))},500)})),this.voltIncreaseBtn&&(this.voltIncreaseBtn.addEventListener("click",()=>{if(this.isLongPress){this.isLongPress=!1;return}this.increaseVolt()}),this.voltIncreaseBtn.addEventListener("mousedown",()=>{this.isLongPress=!1,this.increaseTimer=setTimeout(()=>{this.isLongPress=!0,this.increaseVolt()&&this.increaseTimer&&(this.increaseTimer=setInterval(()=>{this.increaseVolt()||this.increaseTimer&&(clearInterval(this.increaseTimer),this.increaseTimer=null)},150))},500)})),document.addEventListener("mouseup",()=>this.clearTimers()),document.addEventListener("mouseleave",()=>this.clearTimers()),this.setupTouchEvents(),this.voltageEventsInitialized=!0)}setupTouchEvents(){this.voltDecreaseBtn&&this.voltDecreaseBtn.addEventListener("touchstart",e=>{e.preventDefault(),this.isLongPress=!1,this.decreaseVolt(),this.decreaseTimer=setTimeout(()=>{this.isLongPress=!0,this.decreaseTimer=setInterval(()=>{this.decreaseVolt()||this.decreaseTimer&&(clearInterval(this.decreaseTimer),this.decreaseTimer=null)},150)},500)},{passive:!1}),this.voltIncreaseBtn&&this.voltIncreaseBtn.addEventListener("touchstart",e=>{e.preventDefault(),this.isLongPress=!1,this.increaseVolt(),this.increaseTimer=setTimeout(()=>{this.isLongPress=!0,this.increaseTimer=setInterval(()=>{this.increaseVolt()||this.increaseTimer&&(clearInterval(this.increaseTimer),this.increaseTimer=null)},150)},500)},{passive:!1}),document.addEventListener("touchend",()=>this.clearTimers())}clearTimers(){this.decreaseTimer!==null&&(clearTimeout(this.decreaseTimer),clearInterval(this.decreaseTimer),this.decreaseTimer=null),this.increaseTimer!==null&&(clearTimeout(this.increaseTimer),clearInterval(this.increaseTimer),this.increaseTimer=null)}getCurrentVoltage(){return this.currentVoltValue}setVoltage(e){this.currentVoltValue=e,this.updateVoltDisplay()}reset(){this.currentVoltValue=v.MAX_VOLT,this.updateVoltDisplay()}}class Le{currentLanguage="zh";voltageController;configFileManager;modalManager;modeConfigManager;gpuConfigManager;loadCustomConfigBtn;saveCustomConfigBtn;constructor(){this.voltageController=new we,this.configFileManager=new pe,this.modalManager=new ve(this.voltageController),this.modeConfigManager=new ye,this.gpuConfigManager=new _e,this.loadCustomConfigBtn=document.getElementById("loadCustomConfigBtn"),this.saveCustomConfigBtn=document.getElementById("saveCustomConfigBtn")}init(){this.setupEventListeners(),this.setupModuleCallbacks(),this.initializeModules()}initializeModules(){this.voltageController.init(),this.modalManager.init(),this.modeConfigManager.init(),this.gpuConfigManager.init()}setupModuleCallbacks(){this.gpuConfigManager.setEditCallback((e,t)=>{this.modalManager.openModal(e,t)}),this.gpuConfigManager.setSaveFileCallback(()=>{this.saveGpuConfigToFile()}),this.modalManager.setSaveCallback((e,t)=>{this.gpuConfigManager.updateConfig(e,t)}),this.modalManager.setDeleteCallback(e=>{this.gpuConfigManager.deleteConfig(e)})}async loadInitialData(){await this.loadGpuConfig(),await this.loadCustomConfigFromFile()}async loadAllConfigData(){await this.loadInitialData()}setupEventListeners(){this.loadCustomConfigBtn&&this.loadCustomConfigBtn.addEventListener("click",()=>this.loadCustomConfigFromFile()),this.saveCustomConfigBtn&&this.saveCustomConfigBtn.addEventListener("click",()=>this.saveCustomConfigToFile())}async loadGpuConfig(){const e=await this.configFileManager.loadGpuConfig();e.success&&e.data?this.gpuConfigManager.loadConfigs(e.data):this.gpuConfigManager.loadConfigs([])}async saveGpuConfigToFile(){const e=this.gpuConfigManager.getConfigs();await this.configFileManager.saveGpuConfig(e)}async loadCustomConfigFromFile(){const e=await this.configFileManager.loadCustomConfig();e.success&&e.data&&this.modeConfigManager.populateCustomConfigForm(e.data)}async saveCustomConfigToFile(){const e=this.modeConfigManager.getCurrentConfig();await this.configFileManager.saveCustomConfig(e)}setLanguage(e){this.currentLanguage=e,this.configFileManager.setLanguage(e),this.modalManager.setLanguage(e),this.modeConfigManager.setLanguage(e),this.gpuConfigManager.setLanguage(e)}}function Ce(a){return new Promise((e,t)=>{if(!a)return e([]);if(typeof globalThis.ksu?.getPackagesInfo!="function")return t(new Error("ksu.getPackagesInfo is not available."));const n=Array.isArray(a)?a:[a];if(n.length===0)return e([]);try{const s=ksu.getPackagesInfo(JSON.stringify(n)),i=JSON.parse(s);!Array.isArray(a)&&i.length===1?e(i[0]):e(i)}catch(s){t(new Error(`Failed to get package info: ${s.message}`))}})}const U="/assets/icon-D9lcp6DU.png",w=new Map;function E(a){if(!a)return!1;const e=a.trim();return e.length>0&&e.toLowerCase()!=="null"}function B(a){const e=a.split("."),t=e[e.length-1];return t.replace(/app$/i,"").replace(/client$/i,"").replace(/mobile$/i,"").replace(/([A-Z])/g," $1").trim().split(" ").map(s=>s.charAt(0).toUpperCase()+s.slice(1).toLowerCase()).join(" ")||t.charAt(0).toUpperCase()+t.slice(1)}function be(a,e){const t=document.createElement("img");return t.className="game-icon-loaded",t.src=`data:image/png;base64,${e}`,t.alt=a,t}function Me(a,e,t){a.onload=()=>{t.style.opacity="0",t.style.transition="opacity 0.3s ease",setTimeout(()=>{e.innerHTML="",a.style.opacity="0",e.appendChild(a),requestAnimationFrame(()=>{a.style.transition="opacity 0.3s ease",a.style.opacity="1"})},300)},a.onerror=()=>{a.src=U,t.style.display="none",a.style.opacity="1"}}async function Se(){if(typeof window.wrapInputStream>"u")try{const t=await new Function("url","return import(url)")("https://mui.kernelsu.org/internal/assets/ext/wrapInputStream.mjs");window.wrapInputStream=t.wrapInputStream}catch{}}function Ee(a){const e=new Uint8Array(a);let t="";for(const n of e)t+=String.fromCharCode(n);return btoa(t)}async function Te(a){if(w.has(a))return w.get(a)??"";try{const e=globalThis;if(typeof e.ksu?.getPackagesInfo=="function")try{const n=await e.ksu.getPackagesInfo(a);if(E(n.appLabel))return w.set(a,n.appLabel),n.appLabel}catch{}try{const n=await Ce(a);if(E(n.appLabel))return w.set(a,n.appLabel),n.appLabel}catch{}if(typeof window.$packageManager<"u")try{const s=window.$packageManager.getApplicationInfo(a,0,0)?.getLabel?.();if(E(s))return w.set(a,s),s}catch{}const t=B(a);return w.set(a,t),t}catch{const t=B(a);return w.set(a,t),t}}async function Ie(a,e,t){try{if(typeof globalThis.ksu?.getPackagesInfo=="function"){const s=document.createElement("img");s.className="game-icon-loaded",s.alt=a,s.onload=()=>{t.style.display="none",s.style.opacity="1",e.innerHTML="",e.appendChild(s)},s.onerror=()=>{s.src=U,t.style.display="none",s.style.opacity="1"},s.src=`ksu://icon/${a}`;return}if(typeof window.$packageManager<"u")try{const s=window.$packageManager.getApplicationIcon(a,0,0);if(s){await Se();const i=window.wrapInputStream;if(i){const l=await(await i(s)).arrayBuffer(),c=Ee(l),g=be(a,c);Me(g,e,t);return}}}catch{}}catch{}}const M={fetchAppName:Te,getAppNameFromPackage:B,loadAppIcon:Ie};class ke{editGameModal;closeGameModalBtn;packageNameInput;gameModeSelect;saveGameBtn;cancelGameBtn;gameModeContainer;selectedGameMode;gameModeOptions;constructor(){this.editGameModal=document.getElementById("editGameModal"),this.closeGameModalBtn=document.querySelector(".close-game-modal"),this.packageNameInput=document.getElementById("packageNameInput"),this.gameModeSelect=document.getElementById("gameModeSelect"),this.saveGameBtn=document.getElementById("saveGameBtn"),this.cancelGameBtn=document.getElementById("cancelGameBtn"),this.gameModeContainer=document.getElementById("gameModeContainer"),this.selectedGameMode=document.getElementById("selectedGameMode"),this.gameModeOptions=document.getElementById("gameModeOptions")}init(e,t){this.closeGameModalBtn&&this.closeGameModalBtn.addEventListener("click",t),this.cancelGameBtn&&this.cancelGameBtn.addEventListener("click",t),this.saveGameBtn&&this.saveGameBtn.addEventListener("click",e),window.addEventListener("click",n=>{n.target===this.editGameModal&&t()}),window.addEventListener("keydown",n=>{n.key==="Escape"&&this.editGameModal&&this.editGameModal.style.display==="block"&&t()}),this.initGameModeSelect()}initGameModeSelect(){if(!this.gameModeContainer||!this.selectedGameMode||!this.gameModeOptions)return;this.selectedGameMode.addEventListener("click",t=>{t.stopPropagation(),this.gameModeContainer?.classList.toggle("open")});const e=this.gameModeOptions.querySelectorAll(".option");e.forEach(t=>{t.addEventListener("click",n=>{n.stopPropagation();const s=t.getAttribute("data-value"),i=t.textContent;this.selectedGameMode&&(this.selectedGameMode.textContent=i),this.gameModeSelect&&s&&(this.gameModeSelect.value=s,this.gameModeSelect.dispatchEvent(new Event("change"))),e.forEach(o=>{o.classList.remove("selected")}),t.classList.add("selected"),this.gameModeContainer?.classList.remove("open")})}),document.addEventListener("click",t=>{this.gameModeContainer?.contains(t.target)||this.gameModeContainer?.classList.remove("open")})}openForAdd(){this.packageNameInput&&(this.packageNameInput.value=""),this.gameModeSelect&&(this.gameModeSelect.value="balance"),this.updateGameModeSelectDisplay("balance"),this.editGameModal&&(this.editGameModal.style.display="block")}openForEdit(e,t){this.packageNameInput&&(this.packageNameInput.value=e),this.gameModeSelect&&(this.gameModeSelect.value=t),this.updateGameModeSelectDisplay(t),this.editGameModal&&(this.editGameModal.style.display="block")}close(){this.editGameModal&&(this.editGameModal.style.display="none")}getPackageName(){return this.packageNameInput?.value.trim()||""}getGameMode(){return this.gameModeSelect?.value||"balance"}updateGameModeSelectDisplay(e){if(!this.selectedGameMode||!this.gameModeOptions)return;const t=this.gameModeOptions.querySelector(`.option[data-value="${e}"]`);t&&(this.selectedGameMode.textContent=t.textContent,this.gameModeOptions.querySelectorAll(".option").forEach(s=>{s.classList.remove("selected")}),t.classList.add("selected"))}setLanguage(e){if(this.gameModeSelect){const t=this.gameModeSelect.options;for(let n=0;n<t.length;n++){const s=t[n],o=`status_mode_${s.value}`;f[e]?.[o]&&(s.textContent=f[e][o])}}if(this.gameModeOptions&&this.gameModeOptions.querySelectorAll(".option").forEach(n=>{const i=`status_mode_${n.getAttribute("data-value")}`;f[e]?.[i]&&(n.textContent=f[e][i])}),this.selectedGameMode&&this.gameModeSelect){const n=`status_mode_${this.gameModeSelect.value}`;f[e]?.[n]&&(this.selectedGameMode.textContent=f[e][n])}}}function Be(a){try{const e=I(a);return e.games&&Array.isArray(e.games)?e.games.map(t=>({package:t.package||"",mode:t.mode||"balance"})):[]}catch{return[]}}function Ge(a){const e=`# GPU调速器游戏列表配置文件

`,t={games:a.map(n=>({package:n.package,mode:n.mode||"balance"}))};return e+k(t)}const $={parseTomlGames:Be,serializeTomlGames:Ge};class Ae{currentLanguage;onEdit;onDelete;constructor(e,t,n){this.currentLanguage=e,this.onEdit=t,this.onDelete=n}setLanguage(e){this.currentLanguage=e}renderGamesList(e,t){if(e.innerHTML="",t.length===0){e.innerHTML=`<div class="loading-text">${r("config_games_not_found",{},this.currentLanguage)}</div>`;return}t.forEach((n,s)=>{const i=this.createGameCard(n,s);e.appendChild(i)})}createGameCard(e,t){const n=document.createElement("div");n.className="game-card",n.style.animationDelay=`${Math.min(t*.05,.5)}s`;const s=this.createGameHeader(e),i=this.createGameDetails(e,t);return n.appendChild(s),n.appendChild(i),n}createGameHeader(e){const t=document.createElement("div");t.className="game-header";const n=this.createIconContainer(e),s=this.createGameNameContainer(e);return t.appendChild(n),t.appendChild(s),t}createIconContainer(e){const t=document.createElement("div");t.className="game-icon-container";const s=(e.name||M.getAppNameFromPackage(e.package||"")).charAt(0).toUpperCase(),i=(e.package||"").split("").reduce((c,g)=>g.charCodeAt(0)+((c<<5)-c),0),o=Math.abs(i)%360,l=document.createElement("div");return l.className="game-icon-placeholder",l.textContent=s,l.style.background=`linear-gradient(135deg, hsl(${o}, 65%, 55%), hsl(${o+20}, 65%, 45%))`,t.appendChild(l),e.package&&M.loadAppIcon(e.package,t,l),t}createGameNameContainer(e){const t=document.createElement("div");t.className="game-name-container";const n=e.name||M.getAppNameFromPackage(e.package||""),s=document.createElement("h4");s.className="game-name",s.textContent=n,s.title=n;const i=document.createElement("span");return i.className="game-package",i.textContent=e.package||"",i.title=e.package||"",t.appendChild(s),t.appendChild(i),t}createGameDetails(e,t){const n=document.createElement("div");n.className="game-details";const s=this.getModeText(e.mode||"balance"),i=document.createElement("span");i.className=`game-mode-badge mode-${e.mode||"balance"}`,i.textContent=s,n.appendChild(i);const o=this.createActionButtons(t);return n.appendChild(o),n}createActionButtons(e){const t=document.createElement("div");t.className="game-actions";const n=document.createElement("button");n.className="game-edit-btn",n.innerHTML='<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>',n.title="编辑",n.onclick=i=>{i.stopPropagation(),this.onEdit(e)};const s=document.createElement("button");return s.className="game-delete-btn",s.innerHTML='<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"></path><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>',s.title="删除",s.onclick=i=>{i.stopPropagation(),this.onDelete(e)},t.appendChild(n),t.appendChild(s),t}getModeText(e){const t={zh:{powersave:"省电",balance:"均衡",performance:"性能",fast:"极速"},en:{powersave:"Powersave",balance:"Balance",performance:"Performance",fast:"Fast"}};return t[this.currentLanguage][e]||t[this.currentLanguage].balance}}class xe{gamesListData=[];currentLanguage="zh";gamesList;addGameBtn;saveGamesBtn;gamesSearchInput;editingIndex=-1;renderer;modal;constructor(){this.gamesList=document.getElementById("gamesList"),this.addGameBtn=document.getElementById("addGameBtn"),this.saveGamesBtn=document.getElementById("saveGamesBtn"),this.gamesSearchInput=document.getElementById("gamesSearchInput"),this.renderer=new Ae(this.currentLanguage,e=>this.editGameItem(e),e=>this.deleteGameItem(e)),this.modal=new ke}init(){this.setupEventListeners(),this.modal.init(()=>this.saveGameItem(),()=>this.closeGameModal()),this.gamesSearchInput&&(this.gamesSearchInput.placeholder=r("config_games_search_placeholder",{},this.currentLanguage))}setupEventListeners(){this.addGameBtn&&this.addGameBtn.addEventListener("click",()=>this.openGameModal()),this.saveGamesBtn&&this.saveGamesBtn.addEventListener("click",()=>this.saveGamesToFile()),this.gamesSearchInput&&this.gamesSearchInput.addEventListener("input",e=>{const t=e.target.value.toLowerCase();this.filterGamesList(t)})}filterGamesList(e){document.querySelectorAll(".game-card").forEach(n=>{const s=n.querySelector(".game-name")?.textContent?.toLowerCase()||"",i=n.querySelector(".game-package")?.textContent?.toLowerCase()||"";s.includes(e)||i.includes(e)?n.style.display="flex":n.style.display="none"})}async loadGamesList(){this.gamesList&&(this.gamesList.innerHTML=`<div class="loading-text">${r("status_loading",{},this.currentLanguage)}</div>`);const{errno:e,stdout:t}=await m(`cat ${_.GAMES_FILE}`);if(e===0&&t.trim()){const n=$.parseTomlGames(t.trim());n.length===0&&t.trim().length>0&&h(r("toast_games_parse_error",{},this.currentLanguage)),this.gamesListData=n,n.length>0?(this.refreshGamesList(),this.loadAppNamesAsync()):this.gamesList&&(this.gamesList.innerHTML=`<div class="loading-text">${r("config_games_not_found",{},this.currentLanguage)}</div>`)}else this.gamesList&&(this.gamesList.innerHTML=`<div class="loading-text">${r("config_games_list_not_found",{},this.currentLanguage)}</div>`)}async loadAppNamesAsync(){const e=this.gamesListData.filter(t=>t.package&&!t.name).map(async t=>{if(t.package){const n=await M.fetchAppName(t.package);t.name=n,"package"in t&&t.package&&this.updateGameCardName(t)}});await Promise.all(e)}updateGameCardName(e){if(!this.gamesList)return;this.gamesList.querySelectorAll(".game-card").forEach(n=>{if(n.querySelector(".game-package")?.textContent===e.package){const i=n.querySelector(".game-name");i&&e.name&&(i.textContent=e.name,i.setAttribute("title",e.name))}})}refreshGamesList(){this.gamesList&&this.renderer.renderGamesList(this.gamesList,this.gamesListData)}openGameModal(){this.modal.openForAdd(),this.editingIndex=-1}editGameItem(e){if(e<0||e>=this.gamesListData.length)return;const t=this.gamesListData[e];this.modal.openForEdit(t.package||"",t.mode||"balance"),this.editingIndex=e}closeGameModal(){this.modal.close(),this.editingIndex=-1}saveGameItem(){const e=this.modal.getPackageName(),t=this.modal.getGameMode();if(!e){h(r("toast_game_invalid",{},this.currentLanguage));return}if(this.editingIndex===-1){if(this.gamesListData.some(n=>n.package===e)){h(r("toast_game_exists",{},this.currentLanguage));return}this.gamesListData.push({package:e,mode:t})}else this.gamesListData[this.editingIndex].package=e,this.gamesListData[this.editingIndex].mode=t;this.closeGameModal(),this.refreshGamesList(),this.editingIndex===-1&&h(r("toast_game_added",{},this.currentLanguage))}deleteGameItem(e){e>=0&&e<this.gamesListData.length?(this.gamesListData.splice(e,1),this.refreshGamesList(),h(r("toast_game_deleted",{},this.currentLanguage))):h(r("toast_index_invalid",{},this.currentLanguage))}async saveGamesToFile(){if(this.gamesListData.length===0){h(r("toast_games_empty",{},this.currentLanguage));return}const e=$.serializeTomlGames(this.gamesListData),t=btoa(unescape(encodeURIComponent(e)));(await m(`echo '${t}' | base64 -d > ${_.GAMES_FILE}`)).errno===0?h(r("toast_games_saved",{},this.currentLanguage)):h(r("toast_games_save_fail",{},this.currentLanguage))}setLanguage(e){this.currentLanguage=e,this.gamesSearchInput&&(this.gamesSearchInput.placeholder=r("config_games_search_placeholder",{},this.currentLanguage)),this.renderer.setLanguage(e),this.modal.setLanguage(e),this.refreshGamesList()}}class Ve{currentLanguage="zh";logContent;refreshLogBtn;constructor(){this.logContent=document.getElementById("logContent"),this.refreshLogBtn=document.getElementById("refreshLogBtn")}init(){this.setupEventListeners(),this.initLogFileSelect()}setupEventListeners(){this.refreshLogBtn&&this.refreshLogBtn.addEventListener("click",()=>this.loadLog());const e=document.querySelectorAll(".log-tab-btn");e.forEach(t=>{t.addEventListener("click",()=>{t.classList.contains("active")||(e.forEach(n=>{n.classList.remove("active")}),t.classList.add("active"),this.logContent&&(this.logContent.style.opacity="0.5",this.logContent.textContent=r("log_loading",{},this.currentLanguage)),setTimeout(()=>{this.loadLog().then(()=>{this.logContent&&(this.logContent.style.opacity="1")})},100))})})}initLogFileSelect(){const e=document.querySelector(".log-tab-btn.active"),t=e?e.getAttribute("data-log"):"gpu_gov.log";document.querySelectorAll(".log-tab-btn").forEach(s=>{s.getAttribute("data-log")===t?s.classList.add("active"):s.classList.remove("active")})}async loadLog(){const e=document.querySelector(".log-tab-btn.active"),t=e?e.getAttribute("data-log"):"gpu_gov.log";this.logContent&&(this.logContent.textContent=r("log_loading",{},this.currentLanguage));const{errno:n,stdout:s}=await m(`cat ${_.LOG_PATH}/${t} 2>/dev/null || echo "日志文件不存在"`);if(s.trim()==="日志文件不存在"){this.logContent&&(this.logContent.textContent=r("log_not_found",{},this.currentLanguage));return}if(n===0){const o=s.trim().split(`
`).slice(-100).join(`
`);this.logContent&&(this.logContent.textContent=o||r("log_empty",{},this.currentLanguage)),this.logContent&&(this.logContent.scrollTop=this.logContent.scrollHeight)}else this.logContent&&(this.logContent.textContent=r("log_not_found",{},this.currentLanguage))}setLanguage(e){this.currentLanguage=e}}class qe{currentLanguage="zh";logLevelContainer;languageContainer;constructor(){this.logLevelContainer=document.getElementById("logLevelContainer"),this.languageContainer=document.getElementById("languageContainer")}init(){this.setupEventListeners(),this.loadLogLevel()}setupEventListeners(){if(this.logLevelContainer){const e=this.logLevelContainer.querySelectorAll(".settings-tab-btn");e.forEach(t=>{t.addEventListener("click",n=>{n.preventDefault(),e.forEach(s=>{s.classList.remove("active")}),t.classList.add("active"),this.saveLogLevel()})})}if(this.languageContainer){const e=this.languageContainer.querySelectorAll(".settings-tab-btn");e.forEach(t=>{t.addEventListener("click",async n=>{n.preventDefault(),e.forEach(l=>{l.classList.remove("active")}),t.classList.add("active");const s=t.getAttribute("data-value");localStorage.setItem("languageSetting",s);let i="zh";if(s==="system"){const{errno:l,stdout:c}=await m('getprop persist.sys.locale || getprop ro.product.locale || echo "zh-CN"');l===0&&c.trim()&&(i=c.trim().toLowerCase().startsWith("en")?"en":"zh"),localStorage.setItem("language",i),h(r("toast_language_follow_system",{},i))}else i=s,localStorage.setItem("language",s),h(r("toast_language_changed",{language:s==="zh"?"中文":"English"},i));this.currentLanguage=i;const o=new CustomEvent("languageChange",{detail:{language:i}});document.dispatchEvent(o)})})}}async loadLogLevel(){const{errno:e,stdout:t}=await m(`cat ${_.LOG_LEVEL_PATH} 2>/dev/null || echo "info"`);let n="info";if(e===0){const s=t.trim().toLowerCase();["debug","info","warn","error"].includes(s)&&(n=s)}this.logLevelContainer&&this.logLevelContainer.querySelectorAll(".settings-tab-btn").forEach(i=>{i.getAttribute("data-value")===n?i.classList.add("active"):i.classList.remove("active")})}async saveLogLevel(){if(!this.logLevelContainer)return;const e=this.logLevelContainer.querySelector(".settings-tab-btn.active");if(!e)return;const t=e.getAttribute("data-value"),{errno:n}=await m(`echo "${t}" > ${_.LOG_LEVEL_PATH}`);h(n===0?t==="debug"?r("toast_log_level_debug",{},this.currentLanguage):r("toast_log_level_set",{level:t||""},this.currentLanguage):r("toast_log_level_fail",{},this.currentLanguage))}setLanguage(e){this.currentLanguage=e}}class Pe{themeToggle;followSystemThemeToggle;followSystemThemeSuperSwitch;currentLanguage="zh";constructor(){this.themeToggle=document.getElementById("themeToggle"),this.followSystemThemeToggle=document.querySelector("#followSystemThemeToggle .miuix-switch-input"),this.followSystemThemeSuperSwitch=document.getElementById("followSystemThemeSuperSwitch")}init(){this.initTheme(),this.setupEventListeners()}initTheme(){const e=localStorage.getItem("theme"),t=window.matchMedia?.("(prefers-color-scheme: dark)").matches,n=localStorage.getItem("followSystemTheme"),s=n===null?!0:n==="true";this.followSystemThemeToggle&&(this.followSystemThemeToggle.checked=s),n===null&&localStorage.setItem("followSystemTheme","true");let i;if(s?i=t?"dark":"light":e?i=e:i=t?"dark":"light",document.documentElement.setAttribute("data-theme",i),localStorage.setItem("theme",i),window.matchMedia){const o=window.matchMedia("(prefers-color-scheme: dark)");o.addEventListener&&o.addEventListener("change",l=>{if(localStorage.getItem("followSystemTheme")==="true"){const c=l.matches?"dark":"light";document.documentElement.setAttribute("data-theme",c),localStorage.setItem("theme",c)}})}}setupEventListeners(){this.themeToggle&&this.themeToggle.addEventListener("click",()=>this.toggleTheme()),this.followSystemThemeSuperSwitch&&(this.followSystemThemeSuperSwitch.addEventListener("click",e=>this.handleFollowSystemToggleClick(e)),this.followSystemThemeSuperSwitch.addEventListener("keydown",e=>{(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),e.currentTarget.click())}),this.followSystemThemeSuperSwitch.setAttribute("tabindex","0"),this.followSystemThemeSuperSwitch.setAttribute("role","switch"),this.followSystemThemeSuperSwitch.setAttribute("aria-checked",this.followSystemThemeToggle?.checked?"true":"false")),this.followSystemThemeToggle&&this.followSystemThemeToggle.addEventListener("change",()=>this.handleFollowSystemChange())}toggleTheme(){this.themeToggle&&this.themeToggle.classList.add("switching"),localStorage.getItem("followSystemTheme")==="true"&&(localStorage.setItem("followSystemTheme","false"),this.followSystemThemeToggle&&(this.followSystemThemeToggle.checked=!1),h(r("toast_theme_follow_disabled",{},this.currentLanguage)));const t=document.documentElement.getAttribute("data-theme")==="light"?"dark":"light";document.documentElement.style.transition="background-color 0.3s ease, color 0.3s ease",document.documentElement.setAttribute("data-theme",t),localStorage.setItem("theme",t),setTimeout(()=>{this.themeToggle&&this.themeToggle.classList.remove("switching"),document.documentElement.style.transition=""},600),h(r(t==="dark"?"toast_theme_switched_dark":"toast_theme_switched_light",{},this.currentLanguage))}handleFollowSystemToggleClick(e){e.target!==this.followSystemThemeToggle&&(e.preventDefault(),navigator.vibrate&&navigator.vibrate(50),this.followSystemThemeToggle&&(this.followSystemThemeToggle.checked=!this.followSystemThemeToggle.checked,this.followSystemThemeToggle.dispatchEvent(new Event("change",{bubbles:!0}))))}handleFollowSystemChange(){const e=!!this.followSystemThemeToggle?.checked;if(localStorage.setItem("followSystemTheme",e.toString()),this.followSystemThemeSuperSwitch&&this.followSystemThemeSuperSwitch.setAttribute("aria-checked",e?"true":"false"),this.followSystemThemeSuperSwitch&&(this.followSystemThemeSuperSwitch.style.transform="scale(0.98)",setTimeout(()=>{this.followSystemThemeSuperSwitch&&(this.followSystemThemeSuperSwitch.style.transform="")},150)),e){const t=window.matchMedia?.("(prefers-color-scheme: dark)").matches?"dark":"light";document.documentElement.setAttribute("data-theme",t),localStorage.setItem("theme",t),h(r("toast_theme_follow_enabled",{},this.currentLanguage))}else h(r("toast_theme_follow_keep",{},this.currentLanguage))}setLanguage(e){this.currentLanguage=e}}class De{currentLanguage="zh";currentPage="page-status";statusPageLoaded=!1;configPageLoaded=!1;logPageLoaded=!1;settingsPageLoaded=!1;statusCache={mode:{value:"unknown",timestamp:0,ttl:2e3},running:{value:!1,timestamp:0,ttl:2e3},version:{value:"",timestamp:0,ttl:6e4}};isRefreshing=!1;app;loading;htmlRoot;moduleVersion;currentMode;runningStatus;pages;navItems;languageContainer;themeManager;configManager;gamesManager;logManager;settingsManager;constructor(){this.app=document.getElementById("app"),this.loading=document.getElementById("loading"),this.htmlRoot=document.getElementById("htmlRoot"),this.moduleVersion=document.getElementById("moduleVersion"),this.currentMode=document.getElementById("currentMode"),this.runningStatus=document.getElementById("runningStatus"),this.pages=document.querySelectorAll(".page"),this.navItems=document.querySelectorAll(".nav-item"),this.languageContainer=document.getElementById("languageContainer"),this.themeManager=new Pe,this.configManager=new Le,this.gamesManager=new xe,this.logManager=new Ve,this.settingsManager=new qe}async init(){this.loading&&(this.loading.style.display="none"),this.app&&(this.app.style.display="block"),this.themeManager.init(),this.configManager.init(),this.gamesManager.init(),this.logManager.init(),this.settingsManager.init(),await this.initLanguage(),this.setupLanguageEvents(),this.setupNavigationEvents(),this.loadData().catch(()=>{}),this.startStatusRefreshLoop(),h(r("toast_webui_loaded",{},this.currentLanguage))}async startStatusRefreshLoop(){const e=async()=>{this.statusPageLoaded&&this.currentPage==="page-status"&&await this.refreshStatusIfNeeded(),setTimeout(e,1e3)};e()}async refreshStatusIfNeeded(){if(this.isRefreshing)return;const e=Date.now(),t={mode:e-this.statusCache.mode.timestamp>this.statusCache.mode.ttl,running:e-this.statusCache.running.timestamp>this.statusCache.running.ttl,version:e-this.statusCache.version.timestamp>this.statusCache.version.ttl};if(t.mode||t.running||t.version){this.isRefreshing=!0;try{const n=[];t.mode&&n.push(this.loadCurrentMode()),t.running&&n.push(this.checkModuleStatus()),t.version&&n.push(this.loadModuleVersion()),await Promise.allSettled(n)}finally{this.isRefreshing=!1}}}setupNavigationEvents(){this.navItems.forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-page");t&&this.switchPage(t)})})}setupLanguageEvents(){document.addEventListener("languageChange",e=>{const t=e,{language:n}=t.detail;this.currentLanguage=n,this.themeManager.setLanguage(this.currentLanguage),this.configManager.setLanguage(this.currentLanguage),this.gamesManager.setLanguage(this.currentLanguage),this.logManager.setLanguage(this.currentLanguage),this.settingsManager.setLanguage(this.currentLanguage),this.applyTranslations(),this.loadModuleVersion(),this.loadCurrentMode(),this.checkModuleStatus()})}async initLanguage(){const e=localStorage.getItem("languageSetting"),t=localStorage.getItem("language");e===null&&localStorage.setItem("languageSetting","system"),e==="system"||e===null?(this.currentLanguage=await this.detectSystemLanguage(),localStorage.setItem("language",this.currentLanguage)):t&&(this.currentLanguage=t),this.themeManager.setLanguage(this.currentLanguage),this.configManager.setLanguage(this.currentLanguage),this.gamesManager.setLanguage(this.currentLanguage),this.logManager.setLanguage(this.currentLanguage),this.settingsManager.setLanguage(this.currentLanguage),this.applyTranslations(),this.updateSelectedLanguageText(e||"system"),this.setupLanguageEvents()}async detectSystemLanguage(){const e=navigator,t=navigator.language||e.userLanguage||"zh-CN",{errno:n,stdout:s}=await m('getprop persist.sys.locale || getprop ro.product.locale || echo "zh-CN"');return n===0&&s.trim()?s.trim().toLowerCase().startsWith("en")?"en":"zh":t.startsWith("en")?"en":"zh"}applyTranslations(){document.title=r("title",{},this.currentLanguage),this.htmlRoot&&this.htmlRoot.setAttribute("lang",this.currentLanguage==="en"?"en":"zh-CN"),this.loading&&(this.loading.textContent=r("loading",{},this.currentLanguage));const e=document.querySelector(".header-content h1");e&&(e.textContent=r("header_title",{},this.currentLanguage)),document.querySelectorAll(".nav-item").forEach(t=>{const n=t.getAttribute("data-page"),s=t.querySelector(".nav-text");s&&(n==="page-status"?s.textContent=r("nav_status",{},this.currentLanguage):n==="page-config"?s.textContent=r("nav_config",{},this.currentLanguage):n==="page-log"?s.textContent=r("nav_log",{},this.currentLanguage):n==="page-settings"&&(s.textContent=r("nav_settings",{},this.currentLanguage)))}),document.querySelectorAll("[data-i18n]").forEach(t=>{const n=t.getAttribute("data-i18n");n&&f[this.currentLanguage]&&f[this.currentLanguage][n]&&(t.textContent=r(n,{},this.currentLanguage))}),document.querySelectorAll("[data-i18n-placeholder]").forEach(t=>{const n=t.getAttribute("data-i18n-placeholder");n&&f[this.currentLanguage]&&f[this.currentLanguage][n]&&(t.placeholder=r(n,{},this.currentLanguage))})}updateSelectedLanguageText(e){if(!this.languageContainer)return;this.languageContainer.querySelectorAll(".settings-tab-btn").forEach(s=>{s.classList.remove("active")});const n=this.languageContainer.querySelector(`.settings-tab-btn[data-value="${e}"]`);if(n)n.classList.add("active");else{const s=this.languageContainer.querySelector('.settings-tab-btn[data-value="system"]');s&&s.classList.add("active")}}async loadData(){this.statusPageLoaded=!0,await Promise.all([this.checkModuleStatus(),this.loadModuleVersion(),this.loadCurrentMode()]).catch(()=>{}),this.switchPage("page-status")}switchPage(e){this.pages.forEach(n=>{n.classList.remove("active")});const t=document.getElementById(e);t&&t.classList.add("active"),this.navItems.forEach(n=>{n.getAttribute("data-page")===e?n.classList.add("active"):n.classList.remove("active")}),this.currentPage=e,this.lazyLoadPageData(e)}async lazyLoadPageData(e){switch(e){case"page-status":this.statusPageLoaded||(this.statusPageLoaded=!0,await Promise.all([this.checkModuleStatus(),this.loadModuleVersion(),this.loadCurrentMode()]).catch(()=>{}));break;case"page-config":this.configPageLoaded||(this.configPageLoaded=!0,await Promise.all([this.configManager.loadAllConfigData(),this.gamesManager.loadGamesList()]).catch(()=>{}));break;case"page-log":this.logPageLoaded||(this.logPageLoaded=!0,this.logManager.loadLog().catch(()=>{}));break;case"page-settings":this.settingsPageLoaded||(this.settingsPageLoaded=!0,this.settingsManager.loadLogLevel().catch(()=>{}));break}}async checkModuleStatus(){try{const{errno:e,stdout:t}=await m('pgrep -f gpugovernor || echo ""'),n=e===0&&t.trim();this.statusCache.running.value=!!n,this.statusCache.running.timestamp=Date.now();const s=this.runningStatus?.classList.contains("status-running");n!==s&&this.runningStatus&&(this.runningStatus.classList.add("status-changing"),this.runningStatus.removeAttribute("data-i18n"),setTimeout(()=>{n&&this.runningStatus?(this.runningStatus.textContent=r("status_running_active",{},this.currentLanguage),this.runningStatus.className="status-badge status-running"):this.runningStatus&&(this.runningStatus.textContent=r("status_running_inactive",{},this.currentLanguage),this.runningStatus.className="status-badge status-stopped"),setTimeout(()=>{this.runningStatus?.classList.remove("status-changing")},600)},100))}catch{}}async loadModuleVersion(){try{const{errno:e,stdout:t}=await m('grep -i "^version=" /data/adb/modules/Mediatek_Mali_GPU_Governor/module.prop | cut -d= -f2');if(e===0&&t.trim()){this.moduleVersion&&(this.moduleVersion.textContent=t.trim(),this.moduleVersion.removeAttribute("data-i18n"),this.statusCache.version.value=t.trim(),this.statusCache.version.timestamp=Date.now());return}const{errno:n,stdout:s}=await m('grep -i "^version=" /data/adb/ksu/modules/Mediatek_Mali_GPU_Governor/module.prop | cut -d= -f2');if(n===0&&s.trim()){this.moduleVersion&&(this.moduleVersion.textContent=s.trim(),this.moduleVersion.removeAttribute("data-i18n"),this.statusCache.version.value=s.trim(),this.statusCache.version.timestamp=Date.now());return}this.moduleVersion&&(this.moduleVersion.textContent=this.currentLanguage==="en"?"Unknown":"未知",this.moduleVersion.removeAttribute("data-i18n"),this.statusCache.version.value="unknown",this.statusCache.version.timestamp=Date.now())}catch{}}async loadCurrentMode(){try{const{errno:e,stdout:t}=await m(`cat ${_.CURRENT_MODE_PATH} 2>/dev/null || echo "unknown"`);let n="unknown";if(e===0&&(n=t.trim().toLowerCase()),["powersave","balance","performance","fast"].includes(n)||(n="unknown"),this.statusCache.mode.value=n,this.statusCache.mode.timestamp=Date.now(),this.currentMode){const i={powersave:r("status_mode_powersave",{},this.currentLanguage),balance:r("status_mode_balance",{},this.currentLanguage),performance:r("status_mode_performance",{},this.currentLanguage),fast:r("status_mode_fast",{},this.currentLanguage),unknown:r("status_mode_unknown",{},this.currentLanguage)};this.currentMode.textContent=i[n]||i.unknown,this.currentMode.className=`mode-badge ${n}`,this.currentMode.removeAttribute("data-i18n")}}catch{if(this.statusCache.mode.value!=="unknown"&&this.currentMode){const t=this.statusCache.mode.value,n={powersave:r("status_mode_powersave",{},this.currentLanguage),balance:r("status_mode_balance",{},this.currentLanguage),performance:r("status_mode_performance",{},this.currentLanguage),fast:r("status_mode_fast",{},this.currentLanguage),unknown:r("status_mode_unknown",{},this.currentLanguage)};this.currentMode.textContent=n[t]||n.unknown,this.currentMode.className=`mode-badge ${t}`}}}}document.addEventListener("DOMContentLoaded",async()=>{await new De().init()});
