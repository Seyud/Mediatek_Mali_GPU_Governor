(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();function getAugmentedNamespace(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function s(){var r=!1;try{r=this instanceof s}catch{}return r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(s){var r=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(t,s,r.get?r:{enumerable:!0,get:function(){return n[s]}})}),t}var toml={},parse={exports:{}},tomlParser={exports:{}},parser,hasRequiredParser;function requireParser(){if(hasRequiredParser)return parser;hasRequiredParser=1;const n=1114112;class e extends Error{constructor(i,a,l){super("[ParserError] "+i,a,l),this.name="ParserError",this.code="ParserError",Error.captureStackTrace&&Error.captureStackTrace(this,e)}}class t{constructor(i){this.parser=i,this.buf="",this.returned=null,this.result=null,this.resultTable=null,this.resultArr=null}}class s{constructor(){this.pos=0,this.col=0,this.line=0,this.obj={},this.ctx=this.obj,this.stack=[],this._buf="",this.char=null,this.ii=0,this.state=new t(this.parseStart)}parse(i){if(i.length===0||i.length==null)return;this._buf=String(i),this.ii=-1,this.char=-1;let a;for(;a===!1||this.nextChar();)a=this.runOne();this._buf=null}nextChar(){return this.char===10&&(++this.line,this.col=-1),++this.ii,this.char=this._buf.codePointAt(this.ii),++this.pos,++this.col,this.haveBuffer()}haveBuffer(){return this.ii<this._buf.length}runOne(){return this.state.parser.call(this,this.state.returned)}finish(){this.char=n;let i;do i=this.state.parser,this.runOne();while(this.state.parser!==i);return this.ctx=null,this.state=null,this._buf=null,this.obj}next(i){if(typeof i!="function")throw new e("Tried to set state to non-existent state: "+JSON.stringify(i));this.state.parser=i}goto(i){return this.next(i),this.runOne()}call(i,a){a&&this.next(a),this.stack.push(this.state),this.state=new t(i)}callNow(i,a){return this.call(i,a),this.runOne()}return(i){if(this.stack.length===0)throw this.error(new e("Stack underflow"));i===void 0&&(i=this.state.buf),this.state=this.stack.pop(),this.state.returned=i}returnNow(i){return this.return(i),this.runOne()}consume(){if(this.char===n)throw this.error(new e("Unexpected end-of-buffer"));this.state.buf+=this._buf[this.ii]}error(i){return i.line=this.line,i.col=this.col,i.pos=this.pos,i}parseStart(){throw new e("Must declare a parseStart method")}}return s.END=n,s.Error=e,parser=s,parser}var createDatetime,hasRequiredCreateDatetime;function requireCreateDatetime(){return hasRequiredCreateDatetime||(hasRequiredCreateDatetime=1,createDatetime=n=>{const e=new Date(n);if(isNaN(e))throw new TypeError("Invalid Datetime");return e}),createDatetime}var formatNum,hasRequiredFormatNum;function requireFormatNum(){return hasRequiredFormatNum||(hasRequiredFormatNum=1,formatNum=(n,e)=>{for(e=String(e);e.length<n;)e="0"+e;return e}),formatNum}var createDatetimeFloat,hasRequiredCreateDatetimeFloat;function requireCreateDatetimeFloat(){if(hasRequiredCreateDatetimeFloat)return createDatetimeFloat;hasRequiredCreateDatetimeFloat=1;const n=requireFormatNum();class e extends Date{constructor(s){super(s+"Z"),this.isFloating=!0}toISOString(){const s=`${this.getUTCFullYear()}-${n(2,this.getUTCMonth()+1)}-${n(2,this.getUTCDate())}`,r=`${n(2,this.getUTCHours())}:${n(2,this.getUTCMinutes())}:${n(2,this.getUTCSeconds())}.${n(3,this.getUTCMilliseconds())}`;return`${s}T${r}`}}return createDatetimeFloat=t=>{const s=new e(t);if(isNaN(s))throw new TypeError("Invalid Datetime");return s},createDatetimeFloat}var createDate,hasRequiredCreateDate;function requireCreateDate(){if(hasRequiredCreateDate)return createDate;hasRequiredCreateDate=1;const n=requireFormatNum(),e=globalThis.Date;class t extends e{constructor(r){super(r),this.isDate=!0}toISOString(){return`${this.getUTCFullYear()}-${n(2,this.getUTCMonth()+1)}-${n(2,this.getUTCDate())}`}}return createDate=s=>{const r=new t(s);if(isNaN(r))throw new TypeError("Invalid Datetime");return r},createDate}var createTime,hasRequiredCreateTime;function requireCreateTime(){if(hasRequiredCreateTime)return createTime;hasRequiredCreateTime=1;const n=requireFormatNum();class e extends Date{constructor(s){super(`0000-01-01T${s}Z`),this.isTime=!0}toISOString(){return`${n(2,this.getUTCHours())}:${n(2,this.getUTCMinutes())}:${n(2,this.getUTCSeconds())}.${n(3,this.getUTCMilliseconds())}`}}return createTime=t=>{const s=new e(t);if(isNaN(s))throw new TypeError("Invalid Datetime");return s},createTime}var hasRequiredTomlParser;function requireTomlParser(){if(hasRequiredTomlParser)return tomlParser.exports;hasRequiredTomlParser=1,tomlParser.exports=makeParserClass(requireParser()),tomlParser.exports.makeParserClass=makeParserClass;class TomlError extends Error{constructor(e){super(e),this.name="TomlError",Error.captureStackTrace&&Error.captureStackTrace(this,TomlError),this.fromTOML=!0,this.wrapped=null}}TomlError.wrap=n=>{const e=new TomlError(n.message);return e.code=n.code,e.wrapped=n,e},tomlParser.exports.TomlError=TomlError;const createDateTime=requireCreateDatetime(),createDateTimeFloat=requireCreateDatetimeFloat(),createDate=requireCreateDate(),createTime=requireCreateTime(),CTRL_I=9,CTRL_J=10,CTRL_M=13,CTRL_CHAR_BOUNDARY=31,CHAR_SP=32,CHAR_QUOT=34,CHAR_NUM=35,CHAR_APOS=39,CHAR_PLUS=43,CHAR_COMMA=44,CHAR_HYPHEN=45,CHAR_PERIOD=46,CHAR_0=48,CHAR_1=49,CHAR_7=55,CHAR_9=57,CHAR_COLON=58,CHAR_EQUALS=61,CHAR_A=65,CHAR_E=69,CHAR_F=70,CHAR_T=84,CHAR_U=85,CHAR_Z=90,CHAR_LOWBAR=95,CHAR_a=97,CHAR_b=98,CHAR_e=101,CHAR_f=102,CHAR_i=105,CHAR_l=108,CHAR_n=110,CHAR_o=111,CHAR_r=114,CHAR_s=115,CHAR_t=116,CHAR_u=117,CHAR_x=120,CHAR_z=122,CHAR_LCUB=123,CHAR_RCUB=125,CHAR_LSQB=91,CHAR_BSOL=92,CHAR_RSQB=93,CHAR_DEL=127,SURROGATE_FIRST=55296,SURROGATE_LAST=57343,escapes={[CHAR_b]:"\b",[CHAR_t]:"	",[CHAR_n]:`
`,[CHAR_f]:"\f",[CHAR_r]:"\r",[CHAR_QUOT]:'"',[CHAR_BSOL]:"\\"};function isDigit(n){return n>=CHAR_0&&n<=CHAR_9}function isHexit(n){return n>=CHAR_A&&n<=CHAR_F||n>=CHAR_a&&n<=CHAR_f||n>=CHAR_0&&n<=CHAR_9}function isBit(n){return n===CHAR_1||n===CHAR_0}function isOctit(n){return n>=CHAR_0&&n<=CHAR_7}function isAlphaNumQuoteHyphen(n){return n>=CHAR_A&&n<=CHAR_Z||n>=CHAR_a&&n<=CHAR_z||n>=CHAR_0&&n<=CHAR_9||n===CHAR_APOS||n===CHAR_QUOT||n===CHAR_LOWBAR||n===CHAR_HYPHEN}function isAlphaNumHyphen(n){return n>=CHAR_A&&n<=CHAR_Z||n>=CHAR_a&&n<=CHAR_z||n>=CHAR_0&&n<=CHAR_9||n===CHAR_LOWBAR||n===CHAR_HYPHEN}const _type=Symbol("type"),_declared=Symbol("declared"),hasOwnProperty=Object.prototype.hasOwnProperty,defineProperty=Object.defineProperty,descriptor={configurable:!0,enumerable:!0,writable:!0,value:void 0};function hasKey(n,e){return hasOwnProperty.call(n,e)?!0:(e==="__proto__"&&defineProperty(n,"__proto__",descriptor),!1)}const INLINE_TABLE=Symbol("inline-table");function InlineTable(){return Object.defineProperties({},{[_type]:{value:INLINE_TABLE}})}function isInlineTable(n){return n===null||typeof n!="object"?!1:n[_type]===INLINE_TABLE}const TABLE=Symbol("table");function Table(){return Object.defineProperties({},{[_type]:{value:TABLE},[_declared]:{value:!1,writable:!0}})}function isTable(n){return n===null||typeof n!="object"?!1:n[_type]===TABLE}const _contentType=Symbol("content-type"),INLINE_LIST=Symbol("inline-list");function InlineList(n){return Object.defineProperties([],{[_type]:{value:INLINE_LIST},[_contentType]:{value:n}})}function isInlineList(n){return n===null||typeof n!="object"?!1:n[_type]===INLINE_LIST}const LIST=Symbol("list");function List(){return Object.defineProperties([],{[_type]:{value:LIST}})}function isList(n){return n===null||typeof n!="object"?!1:n[_type]===LIST}let _custom;try{const utilInspect=eval("require('util').inspect");_custom=utilInspect.custom}catch(n){}const _inspect=_custom||"inspect";class BoxedBigInt{constructor(e){try{this.value=globalThis.BigInt.asIntN(64,e)}catch{this.value=null}Object.defineProperty(this,_type,{value:INTEGER})}isNaN(){return this.value===null}toString(){return String(this.value)}[_inspect](){return`[BigInt: ${this.toString()}]}`}valueOf(){return this.value}}const INTEGER=Symbol("integer");function Integer(n){let e=Number(n);return Object.is(e,-0)&&(e=0),globalThis.BigInt&&!Number.isSafeInteger(e)?new BoxedBigInt(n):Object.defineProperties(new Number(e),{isNaN:{value:function(){return isNaN(this)}},[_type]:{value:INTEGER},[_inspect]:{value:()=>`[Integer: ${n}]`}})}function isInteger(n){return n===null||typeof n!="object"?!1:n[_type]===INTEGER}const FLOAT=Symbol("float");function Float(n){return Object.defineProperties(new Number(n),{[_type]:{value:FLOAT},[_inspect]:{value:()=>`[Float: ${n}]`}})}function isFloat(n){return n===null||typeof n!="object"?!1:n[_type]===FLOAT}function tomlType(n){const e=typeof n;if(e==="object"){if(n===null)return"null";if(n instanceof Date)return"datetime";if(_type in n)switch(n[_type]){case INLINE_TABLE:return"inline-table";case INLINE_LIST:return"inline-list";case TABLE:return"table";case LIST:return"list";case FLOAT:return"float";case INTEGER:return"integer"}}return e}function makeParserClass(n){class e extends n{constructor(){super(),this.ctx=this.obj=Table()}atEndOfWord(){return this.char===CHAR_NUM||this.char===CTRL_I||this.char===CHAR_SP||this.atEndOfLine()}atEndOfLine(){return this.char===n.END||this.char===CTRL_J||this.char===CTRL_M}parseStart(){if(this.char===n.END)return null;if(this.char===CHAR_LSQB)return this.call(this.parseTableOrList);if(this.char===CHAR_NUM)return this.call(this.parseComment);if(this.char===CTRL_J||this.char===CHAR_SP||this.char===CTRL_I||this.char===CTRL_M)return null;if(isAlphaNumQuoteHyphen(this.char))return this.callNow(this.parseAssignStatement);throw this.error(new TomlError(`Unknown character "${this.char}"`))}parseWhitespaceToEOL(){if(this.char===CHAR_SP||this.char===CTRL_I||this.char===CTRL_M)return null;if(this.char===CHAR_NUM)return this.goto(this.parseComment);if(this.char===n.END||this.char===CTRL_J)return this.return();throw this.error(new TomlError("Unexpected character, expected only whitespace or comments till end of line"))}parseAssignStatement(){return this.callNow(this.parseAssign,this.recordAssignStatement)}recordAssignStatement(s){let r=this.ctx,i=s.key.pop();for(let a of s.key){if(hasKey(r,a)&&(!isTable(r[a])||r[a][_declared]))throw this.error(new TomlError("Can't redefine existing key"));r=r[a]=r[a]||Table()}if(hasKey(r,i))throw this.error(new TomlError("Can't redefine existing key"));return isInteger(s.value)||isFloat(s.value)?r[i]=s.value.valueOf():r[i]=s.value,this.goto(this.parseWhitespaceToEOL)}parseAssign(){return this.callNow(this.parseKeyword,this.recordAssignKeyword)}recordAssignKeyword(s){return this.state.resultTable?this.state.resultTable.push(s):this.state.resultTable=[s],this.goto(this.parseAssignKeywordPreDot)}parseAssignKeywordPreDot(){if(this.char===CHAR_PERIOD)return this.next(this.parseAssignKeywordPostDot);if(this.char!==CHAR_SP&&this.char!==CTRL_I)return this.goto(this.parseAssignEqual)}parseAssignKeywordPostDot(){if(this.char!==CHAR_SP&&this.char!==CTRL_I)return this.callNow(this.parseKeyword,this.recordAssignKeyword)}parseAssignEqual(){if(this.char===CHAR_EQUALS)return this.next(this.parseAssignPreValue);throw this.error(new TomlError('Invalid character, expected "="'))}parseAssignPreValue(){return this.char===CHAR_SP||this.char===CTRL_I?null:this.callNow(this.parseValue,this.recordAssignValue)}recordAssignValue(s){return this.returnNow({key:this.state.resultTable,value:s})}parseComment(){do if(this.char===n.END||this.char===CTRL_J)return this.return();while(this.nextChar())}parseTableOrList(){if(this.char===CHAR_LSQB)this.next(this.parseList);else return this.goto(this.parseTable)}parseTable(){return this.ctx=this.obj,this.goto(this.parseTableNext)}parseTableNext(){return this.char===CHAR_SP||this.char===CTRL_I?null:this.callNow(this.parseKeyword,this.parseTableMore)}parseTableMore(s){if(this.char===CHAR_SP||this.char===CTRL_I)return null;if(this.char===CHAR_RSQB){if(hasKey(this.ctx,s)&&(!isTable(this.ctx[s])||this.ctx[s][_declared]))throw this.error(new TomlError("Can't redefine existing key"));return this.ctx=this.ctx[s]=this.ctx[s]||Table(),this.ctx[_declared]=!0,this.next(this.parseWhitespaceToEOL)}else if(this.char===CHAR_PERIOD){if(!hasKey(this.ctx,s))this.ctx=this.ctx[s]=Table();else if(isTable(this.ctx[s]))this.ctx=this.ctx[s];else if(isList(this.ctx[s]))this.ctx=this.ctx[s][this.ctx[s].length-1];else throw this.error(new TomlError("Can't redefine existing key"));return this.next(this.parseTableNext)}else throw this.error(new TomlError("Unexpected character, expected whitespace, . or ]"))}parseList(){return this.ctx=this.obj,this.goto(this.parseListNext)}parseListNext(){return this.char===CHAR_SP||this.char===CTRL_I?null:this.callNow(this.parseKeyword,this.parseListMore)}parseListMore(s){if(this.char===CHAR_SP||this.char===CTRL_I)return null;if(this.char===CHAR_RSQB){if(hasKey(this.ctx,s)||(this.ctx[s]=List()),isInlineList(this.ctx[s]))throw this.error(new TomlError("Can't extend an inline array"));if(isList(this.ctx[s])){const r=Table();this.ctx[s].push(r),this.ctx=r}else throw this.error(new TomlError("Can't redefine an existing key"));return this.next(this.parseListEnd)}else if(this.char===CHAR_PERIOD){if(!hasKey(this.ctx,s))this.ctx=this.ctx[s]=Table();else{if(isInlineList(this.ctx[s]))throw this.error(new TomlError("Can't extend an inline array"));if(isInlineTable(this.ctx[s]))throw this.error(new TomlError("Can't extend an inline table"));if(isList(this.ctx[s]))this.ctx=this.ctx[s][this.ctx[s].length-1];else if(isTable(this.ctx[s]))this.ctx=this.ctx[s];else throw this.error(new TomlError("Can't redefine an existing key"))}return this.next(this.parseListNext)}else throw this.error(new TomlError("Unexpected character, expected whitespace, . or ]"))}parseListEnd(s){if(this.char===CHAR_RSQB)return this.next(this.parseWhitespaceToEOL);throw this.error(new TomlError("Unexpected character, expected whitespace, . or ]"))}parseValue(){if(this.char===n.END)throw this.error(new TomlError("Key without value"));if(this.char===CHAR_QUOT)return this.next(this.parseDoubleString);if(this.char===CHAR_APOS)return this.next(this.parseSingleString);if(this.char===CHAR_HYPHEN||this.char===CHAR_PLUS)return this.goto(this.parseNumberSign);if(this.char===CHAR_i)return this.next(this.parseInf);if(this.char===CHAR_n)return this.next(this.parseNan);if(isDigit(this.char))return this.goto(this.parseNumberOrDateTime);if(this.char===CHAR_t||this.char===CHAR_f)return this.goto(this.parseBoolean);if(this.char===CHAR_LSQB)return this.call(this.parseInlineList,this.recordValue);if(this.char===CHAR_LCUB)return this.call(this.parseInlineTable,this.recordValue);throw this.error(new TomlError("Unexpected character, expecting string, number, datetime, boolean, inline array or inline table"))}recordValue(s){return this.returnNow(s)}parseInf(){if(this.char===CHAR_n)return this.next(this.parseInf2);throw this.error(new TomlError('Unexpected character, expected "inf", "+inf" or "-inf"'))}parseInf2(){if(this.char===CHAR_f)return this.state.buf==="-"?this.return(-1/0):this.return(1/0);throw this.error(new TomlError('Unexpected character, expected "inf", "+inf" or "-inf"'))}parseNan(){if(this.char===CHAR_a)return this.next(this.parseNan2);throw this.error(new TomlError('Unexpected character, expected "nan"'))}parseNan2(){if(this.char===CHAR_n)return this.return(NaN);throw this.error(new TomlError('Unexpected character, expected "nan"'))}parseKeyword(){return this.char===CHAR_QUOT?this.next(this.parseBasicString):this.char===CHAR_APOS?this.next(this.parseLiteralString):this.goto(this.parseBareKey)}parseBareKey(){do{if(this.char===n.END)throw this.error(new TomlError("Key ended without value"));if(isAlphaNumHyphen(this.char))this.consume();else{if(this.state.buf.length===0)throw this.error(new TomlError("Empty bare keys are not allowed"));return this.returnNow()}}while(this.nextChar())}parseSingleString(){return this.char===CHAR_APOS?this.next(this.parseLiteralMultiStringMaybe):this.goto(this.parseLiteralString)}parseLiteralString(){do{if(this.char===CHAR_APOS)return this.return();if(this.atEndOfLine())throw this.error(new TomlError("Unterminated string"));if(this.char===CHAR_DEL||this.char<=CTRL_CHAR_BOUNDARY&&this.char!==CTRL_I)throw this.errorControlCharInString();this.consume()}while(this.nextChar())}parseLiteralMultiStringMaybe(){return this.char===CHAR_APOS?this.next(this.parseLiteralMultiString):this.returnNow()}parseLiteralMultiString(){return this.char===CTRL_M?null:this.char===CTRL_J?this.next(this.parseLiteralMultiStringContent):this.goto(this.parseLiteralMultiStringContent)}parseLiteralMultiStringContent(){do{if(this.char===CHAR_APOS)return this.next(this.parseLiteralMultiEnd);if(this.char===n.END)throw this.error(new TomlError("Unterminated multi-line string"));if(this.char===CHAR_DEL||this.char<=CTRL_CHAR_BOUNDARY&&this.char!==CTRL_I&&this.char!==CTRL_J&&this.char!==CTRL_M)throw this.errorControlCharInString();this.consume()}while(this.nextChar())}parseLiteralMultiEnd(){return this.char===CHAR_APOS?this.next(this.parseLiteralMultiEnd2):(this.state.buf+="'",this.goto(this.parseLiteralMultiStringContent))}parseLiteralMultiEnd2(){return this.char===CHAR_APOS?this.return():(this.state.buf+="''",this.goto(this.parseLiteralMultiStringContent))}parseDoubleString(){return this.char===CHAR_QUOT?this.next(this.parseMultiStringMaybe):this.goto(this.parseBasicString)}parseBasicString(){do{if(this.char===CHAR_BSOL)return this.call(this.parseEscape,this.recordEscapeReplacement);if(this.char===CHAR_QUOT)return this.return();if(this.atEndOfLine())throw this.error(new TomlError("Unterminated string"));if(this.char===CHAR_DEL||this.char<=CTRL_CHAR_BOUNDARY&&this.char!==CTRL_I)throw this.errorControlCharInString();this.consume()}while(this.nextChar())}recordEscapeReplacement(s){return this.state.buf+=s,this.goto(this.parseBasicString)}parseMultiStringMaybe(){return this.char===CHAR_QUOT?this.next(this.parseMultiString):this.returnNow()}parseMultiString(){return this.char===CTRL_M?null:this.char===CTRL_J?this.next(this.parseMultiStringContent):this.goto(this.parseMultiStringContent)}parseMultiStringContent(){do{if(this.char===CHAR_BSOL)return this.call(this.parseMultiEscape,this.recordMultiEscapeReplacement);if(this.char===CHAR_QUOT)return this.next(this.parseMultiEnd);if(this.char===n.END)throw this.error(new TomlError("Unterminated multi-line string"));if(this.char===CHAR_DEL||this.char<=CTRL_CHAR_BOUNDARY&&this.char!==CTRL_I&&this.char!==CTRL_J&&this.char!==CTRL_M)throw this.errorControlCharInString();this.consume()}while(this.nextChar())}errorControlCharInString(){let s="\\u00";return this.char<16&&(s+="0"),s+=this.char.toString(16),this.error(new TomlError(`Control characters (codes < 0x1f and 0x7f) are not allowed in strings, use ${s} instead`))}recordMultiEscapeReplacement(s){return this.state.buf+=s,this.goto(this.parseMultiStringContent)}parseMultiEnd(){return this.char===CHAR_QUOT?this.next(this.parseMultiEnd2):(this.state.buf+='"',this.goto(this.parseMultiStringContent))}parseMultiEnd2(){return this.char===CHAR_QUOT?this.return():(this.state.buf+='""',this.goto(this.parseMultiStringContent))}parseMultiEscape(){return this.char===CTRL_M||this.char===CTRL_J?this.next(this.parseMultiTrim):this.char===CHAR_SP||this.char===CTRL_I?this.next(this.parsePreMultiTrim):this.goto(this.parseEscape)}parsePreMultiTrim(){if(this.char===CHAR_SP||this.char===CTRL_I)return null;if(this.char===CTRL_M||this.char===CTRL_J)return this.next(this.parseMultiTrim);throw this.error(new TomlError("Can't escape whitespace"))}parseMultiTrim(){return this.char===CTRL_J||this.char===CHAR_SP||this.char===CTRL_I||this.char===CTRL_M?null:this.returnNow()}parseEscape(){if(this.char in escapes)return this.return(escapes[this.char]);if(this.char===CHAR_u)return this.call(this.parseSmallUnicode,this.parseUnicodeReturn);if(this.char===CHAR_U)return this.call(this.parseLargeUnicode,this.parseUnicodeReturn);throw this.error(new TomlError("Unknown escape character: "+this.char))}parseUnicodeReturn(s){try{const r=parseInt(s,16);if(r>=SURROGATE_FIRST&&r<=SURROGATE_LAST)throw this.error(new TomlError("Invalid unicode, character in range 0xD800 - 0xDFFF is reserved"));return this.returnNow(String.fromCodePoint(r))}catch(r){throw this.error(TomlError.wrap(r))}}parseSmallUnicode(){if(isHexit(this.char)){if(this.consume(),this.state.buf.length>=4)return this.return()}else throw this.error(new TomlError("Invalid character in unicode sequence, expected hex"))}parseLargeUnicode(){if(isHexit(this.char)){if(this.consume(),this.state.buf.length>=8)return this.return()}else throw this.error(new TomlError("Invalid character in unicode sequence, expected hex"))}parseNumberSign(){return this.consume(),this.next(this.parseMaybeSignedInfOrNan)}parseMaybeSignedInfOrNan(){return this.char===CHAR_i?this.next(this.parseInf):this.char===CHAR_n?this.next(this.parseNan):this.callNow(this.parseNoUnder,this.parseNumberIntegerStart)}parseNumberIntegerStart(){return this.char===CHAR_0?(this.consume(),this.next(this.parseNumberIntegerExponentOrDecimal)):this.goto(this.parseNumberInteger)}parseNumberIntegerExponentOrDecimal(){return this.char===CHAR_PERIOD?(this.consume(),this.call(this.parseNoUnder,this.parseNumberFloat)):this.char===CHAR_E||this.char===CHAR_e?(this.consume(),this.next(this.parseNumberExponentSign)):this.returnNow(Integer(this.state.buf))}parseNumberInteger(){if(isDigit(this.char))this.consume();else{if(this.char===CHAR_LOWBAR)return this.call(this.parseNoUnder);if(this.char===CHAR_E||this.char===CHAR_e)return this.consume(),this.next(this.parseNumberExponentSign);if(this.char===CHAR_PERIOD)return this.consume(),this.call(this.parseNoUnder,this.parseNumberFloat);{const s=Integer(this.state.buf);if(s.isNaN())throw this.error(new TomlError("Invalid number"));return this.returnNow(s)}}}parseNoUnder(){if(this.char===CHAR_LOWBAR||this.char===CHAR_PERIOD||this.char===CHAR_E||this.char===CHAR_e)throw this.error(new TomlError("Unexpected character, expected digit"));if(this.atEndOfWord())throw this.error(new TomlError("Incomplete number"));return this.returnNow()}parseNoUnderHexOctBinLiteral(){if(this.char===CHAR_LOWBAR||this.char===CHAR_PERIOD)throw this.error(new TomlError("Unexpected character, expected digit"));if(this.atEndOfWord())throw this.error(new TomlError("Incomplete number"));return this.returnNow()}parseNumberFloat(){if(this.char===CHAR_LOWBAR)return this.call(this.parseNoUnder,this.parseNumberFloat);if(isDigit(this.char))this.consume();else return this.char===CHAR_E||this.char===CHAR_e?(this.consume(),this.next(this.parseNumberExponentSign)):this.returnNow(Float(this.state.buf))}parseNumberExponentSign(){if(isDigit(this.char))return this.goto(this.parseNumberExponent);if(this.char===CHAR_HYPHEN||this.char===CHAR_PLUS)this.consume(),this.call(this.parseNoUnder,this.parseNumberExponent);else throw this.error(new TomlError("Unexpected character, expected -, + or digit"))}parseNumberExponent(){if(isDigit(this.char))this.consume();else return this.char===CHAR_LOWBAR?this.call(this.parseNoUnder):this.returnNow(Float(this.state.buf))}parseNumberOrDateTime(){return this.char===CHAR_0?(this.consume(),this.next(this.parseNumberBaseOrDateTime)):this.goto(this.parseNumberOrDateTimeOnly)}parseNumberOrDateTimeOnly(){if(this.char===CHAR_LOWBAR)return this.call(this.parseNoUnder,this.parseNumberInteger);if(isDigit(this.char))this.consume(),this.state.buf.length>4&&this.next(this.parseNumberInteger);else return this.char===CHAR_E||this.char===CHAR_e?(this.consume(),this.next(this.parseNumberExponentSign)):this.char===CHAR_PERIOD?(this.consume(),this.call(this.parseNoUnder,this.parseNumberFloat)):this.char===CHAR_HYPHEN?this.goto(this.parseDateTime):this.char===CHAR_COLON?this.goto(this.parseOnlyTimeHour):this.returnNow(Integer(this.state.buf))}parseDateTimeOnly(){if(this.state.buf.length<4){if(isDigit(this.char))return this.consume();if(this.char===CHAR_COLON)return this.goto(this.parseOnlyTimeHour);throw this.error(new TomlError("Expected digit while parsing year part of a date"))}else{if(this.char===CHAR_HYPHEN)return this.goto(this.parseDateTime);throw this.error(new TomlError("Expected hyphen (-) while parsing year part of date"))}}parseNumberBaseOrDateTime(){return this.char===CHAR_b?(this.consume(),this.call(this.parseNoUnderHexOctBinLiteral,this.parseIntegerBin)):this.char===CHAR_o?(this.consume(),this.call(this.parseNoUnderHexOctBinLiteral,this.parseIntegerOct)):this.char===CHAR_x?(this.consume(),this.call(this.parseNoUnderHexOctBinLiteral,this.parseIntegerHex)):this.char===CHAR_PERIOD?this.goto(this.parseNumberInteger):isDigit(this.char)?this.goto(this.parseDateTimeOnly):this.returnNow(Integer(this.state.buf))}parseIntegerHex(){if(isHexit(this.char))this.consume();else{if(this.char===CHAR_LOWBAR)return this.call(this.parseNoUnderHexOctBinLiteral);{const s=Integer(this.state.buf);if(s.isNaN())throw this.error(new TomlError("Invalid number"));return this.returnNow(s)}}}parseIntegerOct(){if(isOctit(this.char))this.consume();else{if(this.char===CHAR_LOWBAR)return this.call(this.parseNoUnderHexOctBinLiteral);{const s=Integer(this.state.buf);if(s.isNaN())throw this.error(new TomlError("Invalid number"));return this.returnNow(s)}}}parseIntegerBin(){if(isBit(this.char))this.consume();else{if(this.char===CHAR_LOWBAR)return this.call(this.parseNoUnderHexOctBinLiteral);{const s=Integer(this.state.buf);if(s.isNaN())throw this.error(new TomlError("Invalid number"));return this.returnNow(s)}}}parseDateTime(){if(this.state.buf.length<4)throw this.error(new TomlError("Years less than 1000 must be zero padded to four characters"));return this.state.result=this.state.buf,this.state.buf="",this.next(this.parseDateMonth)}parseDateMonth(){if(this.char===CHAR_HYPHEN){if(this.state.buf.length<2)throw this.error(new TomlError("Months less than 10 must be zero padded to two characters"));return this.state.result+="-"+this.state.buf,this.state.buf="",this.next(this.parseDateDay)}else if(isDigit(this.char))this.consume();else throw this.error(new TomlError("Incomplete datetime"))}parseDateDay(){if(this.char===CHAR_T||this.char===CHAR_SP){if(this.state.buf.length<2)throw this.error(new TomlError("Days less than 10 must be zero padded to two characters"));return this.state.result+="-"+this.state.buf,this.state.buf="",this.next(this.parseStartTimeHour)}else{if(this.atEndOfWord())return this.returnNow(createDate(this.state.result+"-"+this.state.buf));if(isDigit(this.char))this.consume();else throw this.error(new TomlError("Incomplete datetime"))}}parseStartTimeHour(){return this.atEndOfWord()?this.returnNow(createDate(this.state.result)):this.goto(this.parseTimeHour)}parseTimeHour(){if(this.char===CHAR_COLON){if(this.state.buf.length<2)throw this.error(new TomlError("Hours less than 10 must be zero padded to two characters"));return this.state.result+="T"+this.state.buf,this.state.buf="",this.next(this.parseTimeMin)}else if(isDigit(this.char))this.consume();else throw this.error(new TomlError("Incomplete datetime"))}parseTimeMin(){if(this.state.buf.length<2&&isDigit(this.char))this.consume();else{if(this.state.buf.length===2&&this.char===CHAR_COLON)return this.state.result+=":"+this.state.buf,this.state.buf="",this.next(this.parseTimeSec);throw this.error(new TomlError("Incomplete datetime"))}}parseTimeSec(){if(isDigit(this.char)){if(this.consume(),this.state.buf.length===2)return this.state.result+=":"+this.state.buf,this.state.buf="",this.next(this.parseTimeZoneOrFraction)}else throw this.error(new TomlError("Incomplete datetime"))}parseOnlyTimeHour(){if(this.char===CHAR_COLON){if(this.state.buf.length<2)throw this.error(new TomlError("Hours less than 10 must be zero padded to two characters"));return this.state.result=this.state.buf,this.state.buf="",this.next(this.parseOnlyTimeMin)}else throw this.error(new TomlError("Incomplete time"))}parseOnlyTimeMin(){if(this.state.buf.length<2&&isDigit(this.char))this.consume();else{if(this.state.buf.length===2&&this.char===CHAR_COLON)return this.state.result+=":"+this.state.buf,this.state.buf="",this.next(this.parseOnlyTimeSec);throw this.error(new TomlError("Incomplete time"))}}parseOnlyTimeSec(){if(isDigit(this.char)){if(this.consume(),this.state.buf.length===2)return this.next(this.parseOnlyTimeFractionMaybe)}else throw this.error(new TomlError("Incomplete time"))}parseOnlyTimeFractionMaybe(){if(this.state.result+=":"+this.state.buf,this.char===CHAR_PERIOD)this.state.buf="",this.next(this.parseOnlyTimeFraction);else return this.return(createTime(this.state.result))}parseOnlyTimeFraction(){if(isDigit(this.char))this.consume();else if(this.atEndOfWord()){if(this.state.buf.length===0)throw this.error(new TomlError("Expected digit in milliseconds"));return this.returnNow(createTime(this.state.result+"."+this.state.buf))}else throw this.error(new TomlError("Unexpected character in datetime, expected period (.), minus (-), plus (+) or Z"))}parseTimeZoneOrFraction(){if(this.char===CHAR_PERIOD)this.consume(),this.next(this.parseDateTimeFraction);else if(this.char===CHAR_HYPHEN||this.char===CHAR_PLUS)this.consume(),this.next(this.parseTimeZoneHour);else{if(this.char===CHAR_Z)return this.consume(),this.return(createDateTime(this.state.result+this.state.buf));if(this.atEndOfWord())return this.returnNow(createDateTimeFloat(this.state.result+this.state.buf));throw this.error(new TomlError("Unexpected character in datetime, expected period (.), minus (-), plus (+) or Z"))}}parseDateTimeFraction(){if(isDigit(this.char))this.consume();else{if(this.state.buf.length===1)throw this.error(new TomlError("Expected digit in milliseconds"));if(this.char===CHAR_HYPHEN||this.char===CHAR_PLUS)this.consume(),this.next(this.parseTimeZoneHour);else{if(this.char===CHAR_Z)return this.consume(),this.return(createDateTime(this.state.result+this.state.buf));if(this.atEndOfWord())return this.returnNow(createDateTimeFloat(this.state.result+this.state.buf));throw this.error(new TomlError("Unexpected character in datetime, expected period (.), minus (-), plus (+) or Z"))}}}parseTimeZoneHour(){if(isDigit(this.char)){if(this.consume(),/\d\d$/.test(this.state.buf))return this.next(this.parseTimeZoneSep)}else throw this.error(new TomlError("Unexpected character in datetime, expected digit"))}parseTimeZoneSep(){if(this.char===CHAR_COLON)this.consume(),this.next(this.parseTimeZoneMin);else throw this.error(new TomlError("Unexpected character in datetime, expected colon"))}parseTimeZoneMin(){if(isDigit(this.char)){if(this.consume(),/\d\d$/.test(this.state.buf))return this.return(createDateTime(this.state.result+this.state.buf))}else throw this.error(new TomlError("Unexpected character in datetime, expected digit"))}parseBoolean(){if(this.char===CHAR_t)return this.consume(),this.next(this.parseTrue_r);if(this.char===CHAR_f)return this.consume(),this.next(this.parseFalse_a)}parseTrue_r(){if(this.char===CHAR_r)return this.consume(),this.next(this.parseTrue_u);throw this.error(new TomlError("Invalid boolean, expected true or false"))}parseTrue_u(){if(this.char===CHAR_u)return this.consume(),this.next(this.parseTrue_e);throw this.error(new TomlError("Invalid boolean, expected true or false"))}parseTrue_e(){if(this.char===CHAR_e)return this.return(!0);throw this.error(new TomlError("Invalid boolean, expected true or false"))}parseFalse_a(){if(this.char===CHAR_a)return this.consume(),this.next(this.parseFalse_l);throw this.error(new TomlError("Invalid boolean, expected true or false"))}parseFalse_l(){if(this.char===CHAR_l)return this.consume(),this.next(this.parseFalse_s);throw this.error(new TomlError("Invalid boolean, expected true or false"))}parseFalse_s(){if(this.char===CHAR_s)return this.consume(),this.next(this.parseFalse_e);throw this.error(new TomlError("Invalid boolean, expected true or false"))}parseFalse_e(){if(this.char===CHAR_e)return this.return(!1);throw this.error(new TomlError("Invalid boolean, expected true or false"))}parseInlineList(){if(this.char===CHAR_SP||this.char===CTRL_I||this.char===CTRL_M||this.char===CTRL_J)return null;if(this.char===n.END)throw this.error(new TomlError("Unterminated inline array"));return this.char===CHAR_NUM?this.call(this.parseComment):this.char===CHAR_RSQB?this.return(this.state.resultArr||InlineList()):this.callNow(this.parseValue,this.recordInlineListValue)}recordInlineListValue(s){if(this.state.resultArr){const r=this.state.resultArr[_contentType],i=tomlType(s);if(r!==i)throw this.error(new TomlError(`Inline lists must be a single type, not a mix of ${r} and ${i}`))}else this.state.resultArr=InlineList(tomlType(s));return isFloat(s)||isInteger(s)?this.state.resultArr.push(s.valueOf()):this.state.resultArr.push(s),this.goto(this.parseInlineListNext)}parseInlineListNext(){if(this.char===CHAR_SP||this.char===CTRL_I||this.char===CTRL_M||this.char===CTRL_J)return null;if(this.char===CHAR_NUM)return this.call(this.parseComment);if(this.char===CHAR_COMMA)return this.next(this.parseInlineList);if(this.char===CHAR_RSQB)return this.goto(this.parseInlineList);throw this.error(new TomlError("Invalid character, expected whitespace, comma (,) or close bracket (])"))}parseInlineTable(){if(this.char===CHAR_SP||this.char===CTRL_I)return null;if(this.char===n.END||this.char===CHAR_NUM||this.char===CTRL_J||this.char===CTRL_M)throw this.error(new TomlError("Unterminated inline array"));return this.char===CHAR_RCUB?this.return(this.state.resultTable||InlineTable()):(this.state.resultTable||(this.state.resultTable=InlineTable()),this.callNow(this.parseAssign,this.recordInlineTableValue))}recordInlineTableValue(s){let r=this.state.resultTable,i=s.key.pop();for(let a of s.key){if(hasKey(r,a)&&(!isTable(r[a])||r[a][_declared]))throw this.error(new TomlError("Can't redefine existing key"));r=r[a]=r[a]||Table()}if(hasKey(r,i))throw this.error(new TomlError("Can't redefine existing key"));return isInteger(s.value)||isFloat(s.value)?r[i]=s.value.valueOf():r[i]=s.value,this.goto(this.parseInlineTableNext)}parseInlineTableNext(){if(this.char===CHAR_SP||this.char===CTRL_I)return null;if(this.char===n.END||this.char===CHAR_NUM||this.char===CTRL_J||this.char===CTRL_M)throw this.error(new TomlError("Unterminated inline array"));if(this.char===CHAR_COMMA)return this.next(this.parseInlineTable);if(this.char===CHAR_RCUB)return this.goto(this.parseInlineTable);throw this.error(new TomlError("Invalid character, expected whitespace, comma (,) or close bracket (])"))}}return e}return tomlParser.exports}var parsePrettyError,hasRequiredParsePrettyError;function requireParsePrettyError(){if(hasRequiredParsePrettyError)return parsePrettyError;hasRequiredParsePrettyError=1,parsePrettyError=n;function n(e,t){if(e.pos==null||e.line==null)return e;let s=e.message;if(s+=` at row ${e.line+1}, col ${e.col+1}, pos ${e.pos}:
`,t&&t.split){const r=t.split(/\n/),i=String(Math.min(r.length,e.line+3)).length;let a=" ";for(;a.length<i;)a+=" ";for(let l=Math.max(0,e.line-1);l<Math.min(r.length,e.line+2);++l){let o=String(l+1);if(o.length<i&&(o=" "+o),e.line===l){s+=o+"> "+r[l]+`
`,s+=a+"  ";for(let h=0;h<e.col;++h)s+=" ";s+=`^
`}else s+=o+": "+r[l]+`
`}}return e.message=s+`
`,e}return parsePrettyError}var parseString_1,hasRequiredParseString;function requireParseString(){if(hasRequiredParseString)return parseString_1;hasRequiredParseString=1,parseString_1=t;const n=requireTomlParser(),e=requireParsePrettyError();function t(s){globalThis.Buffer&&globalThis.Buffer.isBuffer(s)&&(s=s.toString("utf8"));const r=new n;try{return r.parse(s),r.finish()}catch(i){throw e(i,s)}}return parseString_1}var parseAsync_1,hasRequiredParseAsync;function requireParseAsync(){if(hasRequiredParseAsync)return parseAsync_1;hasRequiredParseAsync=1,parseAsync_1=t;const n=requireTomlParser(),e=requireParsePrettyError();function t(s,r){r||(r={});const i=0,a=r.blocksize||40960,l=new n;return new Promise((h,u)=>{setImmediate(o,i,a,h,u)});function o(h,u,A,f){if(h>=s.length)try{return A(l.finish())}catch(R){return f(e(R,s))}try{l.parse(s.slice(h,h+u)),setImmediate(o,h+u,u,A,f)}catch(R){f(e(R,s))}}}return parseAsync_1}const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(__viteBrowserExternal$1);var parseStream_1,hasRequiredParseStream;function requireParseStream(){if(hasRequiredParseStream)return parseStream_1;hasRequiredParseStream=1,parseStream_1=t;const n=require$$0,e=requireTomlParser();function t(i){return i?s(i):r()}function s(i){const a=new e;return i.setEncoding("utf8"),new Promise((l,o)=>{let h,u=!1,A=!1;function f(){if(u=!0,!h)try{l(a.finish())}catch(V){o(V)}}function R(V){A=!0,o(V)}i.once("end",f),i.once("error",R),H();function H(){h=!0;let V;for(;(V=i.read())!==null;)try{a.parse(V)}catch(fe){return R(fe)}if(h=!1,u)return f();A||i.once("readable",H)}})}function r(){const i=new e;return new n.Transform({objectMode:!0,transform(a,l,o){try{i.parse(a.toString(l))}catch(h){this.emit("error",h)}o()},flush(a){try{this.push(i.finish())}catch(l){this.emit("error",l)}a()}})}return parseStream_1}var hasRequiredParse;function requireParse(){return hasRequiredParse||(hasRequiredParse=1,parse.exports=requireParseString(),parse.exports.async=requireParseAsync(),parse.exports.stream=requireParseStream(),parse.exports.prettyError=requireParsePrettyError()),parse.exports}var stringify={exports:{}},hasRequiredStringify;function requireStringify(){if(hasRequiredStringify)return stringify.exports;hasRequiredStringify=1,stringify.exports=n,stringify.exports.value=fe;function n(c){if(c===null)throw e("null");if(c===void 0)throw e("undefined");if(typeof c!="object")throw e(typeof c);if(typeof c.toJSON=="function"&&(c=c.toJSON()),c==null)return null;const g=o(c);if(g!=="table")throw e(g);return a("","",c)}function e(c){return new Error("Can only stringify objects, not "+c)}function t(){return new Error("Array values can't have mixed types")}function s(c){return Object.keys(c).filter(g=>l(c[g]))}function r(c){return Object.keys(c).filter(g=>!l(c[g]))}function i(c){let g=Array.isArray(c)?[]:Object.prototype.hasOwnProperty.call(c,"__proto__")?{["__proto__"]:void 0}:{};for(let p of Object.keys(c))c[p]&&typeof c[p].toJSON=="function"&&!("toISOString"in c[p])?g[p]=c[p].toJSON():g[p]=c[p];return g}function a(c,g,p){p=i(p);var O,Y;O=s(p),Y=r(p);var ee=[],Ye=g||"";O.forEach(et=>{var ct=o(p[et]);ct!=="undefined"&&ct!=="null"&&ee.push(Ye+h(et)+" = "+V(p[et],!0))}),ee.length>0&&ee.push("");var it=c&&O.length>0?g+"  ":"";return Y.forEach(et=>{ee.push(dt(c,it,et,p[et]))}),ee.join(`
`)}function l(c){switch(o(c)){case"undefined":case"null":case"integer":case"nan":case"float":case"boolean":case"string":case"datetime":return!0;case"array":return c.length===0||o(c[0])!=="table";case"table":return Object.keys(c).length===0;default:return!1}}function o(c){return c===void 0?"undefined":c===null?"null":typeof c=="bigint"||Number.isInteger(c)&&!Object.is(c,-0)?"integer":typeof c=="number"?"float":typeof c=="boolean"?"boolean":typeof c=="string"?"string":"toISOString"in c?isNaN(c)?"undefined":"datetime":Array.isArray(c)?"array":"table"}function h(c){var g=String(c);return/^[-A-Za-z0-9_]+$/.test(g)?g:u(g)}function u(c){return'"'+R(c).replace(/"/g,'\\"')+'"'}function A(c){return"'"+c+"'"}function f(c,g){for(;g.length<c;)g="0"+g;return g}function R(c){return c.replace(/\\/g,"\\\\").replace(/[\b]/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/([\u0000-\u001f\u007f])/,g=>"\\u"+f(4,g.codePointAt(0).toString(16)))}function H(c){let g=c.split(/\n/).map(p=>R(p).replace(/"(?="")/g,'\\"')).join(`
`);return g.slice(-1)==='"'&&(g+=`\\
`),`"""
`+g+'"""'}function V(c,g){let p=o(c);return p==="string"&&(g&&/\n/.test(c)?p="string-multiline":!/[\b\t\n\f\r']/.test(c)&&/"/.test(c)&&(p="string-literal")),fe(c,p)}function fe(c,g){switch(g||(g=o(c)),g){case"string-multiline":return H(c);case"string":return u(c);case"string-literal":return A(c);case"integer":return tt(c);case"float":return rt(c);case"boolean":return nt(c);case"datetime":return st(c);case"array":return ut(c.filter(p=>o(p)!=="null"&&o(p)!=="undefined"&&o(p)!=="nan"));case"table":return gt(c);default:throw e(g)}}function tt(c){return String(c).replace(/\B(?=(\d{3})+(?!\d))/g,"_")}function rt(c){if(c===1/0)return"inf";if(c===-1/0)return"-inf";if(Object.is(c,NaN))return"nan";if(Object.is(c,-0))return"-0.0";var g=String(c).split("."),p=g[0],O=g[1]||0;return tt(p)+"."+O}function nt(c){return String(c)}function st(c){return c.toISOString()}function Ve(c){return c==="float"||c==="integer"}function ht(c){var g=o(c[0]);return c.every(p=>o(p)===g)?g:c.every(p=>Ve(o(p)))?"float":"mixed"}function lt(c){const g=ht(c);if(g==="mixed")throw t();return g}function ut(c){c=i(c);const g=lt(c);var p="[",O=c.map(Y=>fe(Y,g));return O.join(", ").length>60||/\n/.test(O)?p+=`
  `+O.join(`,
  `)+`
`:p+=" "+O.join(", ")+(O.length>0?" ":""),p+"]"}function gt(c){c=i(c);var g=[];return Object.keys(c).forEach(p=>{g.push(h(p)+" = "+V(c[p],!1))}),"{ "+g.join(", ")+(g.length>0?" ":"")+"}"}function dt(c,g,p,O){var Y=o(O);if(Y==="array")return pt(c,g,p,O);if(Y==="table")return ft(c,g,p,O);throw e(Y)}function pt(c,g,p,O){O=i(O),lt(O);var Y=o(O[0]);if(Y!=="table")throw e(Y);var ee=c+h(p),Ye="";return O.forEach(it=>{Ye.length>0&&(Ye+=`
`),Ye+=g+"[["+ee+`]]
`,Ye+=a(ee+".",g,it)}),Ye}function ft(c,g,p,O){var Y=c+h(p),ee="";return s(O).length>0&&(ee+=g+"["+Y+`]
`),ee+a(Y+".",g,O)}return stringify.exports}var hasRequiredToml;function requireToml(){return hasRequiredToml||(hasRequiredToml=1,toml.parse=requireParse(),toml.stringify=requireStringify()),toml}var tomlExports=requireToml();const PATHS={LOG_PATH:"/data/adb/gpu_governor/log",CONFIG_PATH:"/data/adb/gpu_governor/config/gpu_freq_table.toml",CURRENT_MODE_PATH:"/data/adb/gpu_governor/config/current_mode",GAMES_FILE:"/data/adb/gpu_governor/game/games.toml",LOG_LEVEL_PATH:"/data/adb/gpu_governor/log/log_level",CUSTOM_CONFIG_PATH:"/data/adb/gpu_governor/config/config.toml"},VOLT_LIST=[65e3,64375,63750,63125,62500,61875,61250,60625,6e4,59375,58750,58125,57500,56875,56250,55625,55e3,54375,53750,53125,52500,51875,51250,50625,5e4,49375,48750,48125,47500,46875,46250,45625,45e3,44375,43750,43125,42500,41875],VOLT_SETTINGS={VOLT_STEP:625,MAX_VOLT:65e3,MIN_VOLT:41875},translations={zh:{title:"天玑GPU调速器",loading:"加载中",header_title:"天玑GPU调速器",nav_status:"状态",nav_config:"配置",nav_log:"日志",nav_settings:"设置",status_title:"模块状态",status_running:"运行状态:",status_running_active:"运行中",status_running_inactive:"未运行",status_checking:"检查中...",status_current_mode:"当前模式:",status_mode_powersave:"省电",status_mode_balance:"均衡",status_mode_performance:"性能",status_mode_fast:"极速",status_mode_unknown:"未知",status_module_version:"模块版本:",status_unknown:"未知",config_gpu_title:"GPU频率表",config_freq:"频率 (MHz)",config_volt:"电压 (uV)",config_ddr:"内存档位",config_edit:"编辑",config_loading:"加载中...",config_not_found:"未找到配置",config_add:"添加配置",config_save:"保存配置",config_save_freq_table:"保存频率表",config_games_title:"游戏列表",config_games_add:"添加游戏",config_games_save:"保存列表",config_games_search_placeholder:"搜索游戏...",config_custom_settings:"自定义设置",config_global_settings:"全局设置",config_global_mode:"全局模式:",config_mode_powersave:"省电模式",config_mode_balance:"均衡模式",config_mode_performance:"性能模式",config_mode_fast:"极速模式",config_idle_threshold:"空闲阈值 (%):",config_powersave_mode:"省电模式设置",config_balance_mode:"均衡模式设置",config_performance_mode:"性能模式设置",config_fast_mode:"极速模式设置",config_margin:"余量 (%):",config_sampling_interval:"采样间隔 (ms):",config_min_adaptive_interval:"最小自适应间隔 (ms):",config_max_adaptive_interval:"最大自适应间隔 (ms):",config_up_rate_delay:"升频延迟 (ms):",config_down_rate_delay:"降频延迟 (ms):",config_aggressive_down:"激进降频策略",config_gaming_mode:"游戏优化",config_adaptive_sampling:"自适应采样",config_load_custom:"加载配置",config_save_custom:"保存配置",log_title:"运行日志",log_refresh:"刷新",log_main:"主日志",log_init:"初始化日志",log_loading:"加载中...",log_empty:"日志为空",log_not_found:"未找到日志",log_size_warning:"警告: 日志文件较大",settings_title:"设置",settings_theme_follow:"深色模式跟随系统",settings_theme_follow_summary:"自动根据系统设置切换主题",settings_language:"语言设置:",settings_language_follow:"跟随系统",settings_language_zh:"中文",settings_language_en:"English",settings_language_desc1:"修改语言设置后实时生效",settings_language_desc2:"跟随系统将自动检测系统语言设置",settings_log_level:"主日志等级:",settings_log_level_debug:"Debug (详细)",settings_log_level_info:"Info (信息)",settings_log_level_warn:"Warn (警告)",settings_log_level_error:"Error (错误)",settings_log_level_desc1:"修改日志等级后实时生效",settings_log_level_desc2:"设置为Debug级别将启用详细日志记录",edit_config_title:"编辑GPU频率表",edit_config_freq:"频率 (MHz):",edit_config_freq_example:"例如: 350000 (KHz)",edit_config_freq_hint:"请输入KHz值，表格中显示为MHz",edit_config_volt:"电压 (uV):",edit_config_ddr:"内存档位:",edit_config_ddr_default:"999 (不调整)",edit_config_ddr_highest:"0 (最高)",edit_config_ddr_high:"1",edit_config_ddr_medium:"2",edit_config_ddr_low:"3",edit_config_save:"保存",edit_config_cancel:"取消",edit_config_delete:"删除",edit_game_title:"编辑游戏列表",edit_game_package:"应用包名:",edit_game_package_example:"例如: com.tencent.tmgp.sgame",edit_game_mode:"对应模式:",edit_game_save:"保存",edit_game_cancel:"取消",toast_webui_loaded:"WebUI加载完成",toast_theme_follow_disabled:"已关闭跟随系统主题，现在可以手动切换主题",toast_theme_follow_enabled:"已开启跟随系统主题",toast_theme_follow_keep:"已关闭跟随系统主题，将保持当前主题",toast_theme_switched_dark:"已切换到深色模式",toast_theme_switched_light:"已切换到浅色模式",toast_config_updated:'配置已更新，请点击"保存频率表"按钮保存到文件',toast_config_deleted:'配置已删除，请点击"保存频率表"按钮保存到文件',toast_config_saved:"配置已成功保存",toast_config_save_fail:"保存配置失败，请检查权限",toast_freq_table_saved:"频率表已成功保存",toast_freq_table_save_fail:"保存频率表失败，请检查权限",toast_config_empty:"没有配置可保存",toast_config_parse_error:"配置文件解析失败: {error}",toast_freq_invalid:"请输入有效的频率值",toast_index_invalid:"无效的配置索引",toast_game_added:'游戏已添加，请点击"保存列表"按钮保存到文件',toast_game_deleted:'游戏已删除，请点击"保存列表"按钮保存到文件',toast_game_exists:"该应用包名已存在于列表中",toast_game_invalid:"请输入有效的应用包名",toast_games_saved:"游戏列表已成功保存",toast_games_save_fail:"保存游戏列表失败，请检查权限",toast_games_empty:"没有游戏可保存",toast_games_parse_error:"游戏列表解析失败，请检查文件格式",toast_log_level_debug:"日志等级已设置为: debug，详细日志记录已启用",toast_log_level_set:"日志等级已设置为: {level}，已实时生效",toast_log_level_fail:"保存日志等级失败，请检查权限",toast_language_changed:"语言已切换为{language}",toast_language_follow_system:"语言已设置为跟随系统",copyright_text:"天玑GPU调速器 © 2025 酷安@瓦力喀 = Github@Seyud",config_games_not_found:"未找到游戏",config_games_list_not_found:"未找到游戏列表",settings_docs:"帮助文档:",settings_docs_loading:"正在加载文档列表...",settings_docs_empty:"未找到文档",docs_modal_title:"文档",docs_load_fail:"加载文档失败"},en:{title:"Mediatek Mali GPU Governor",loading:"Loading",header_title:"Mediatek Mali GPU Governor",nav_status:"Status",nav_config:"Config",nav_log:"Log",nav_settings:"Settings",status_title:"Module Status",status_running:"Running Status:",status_running_active:"Running",status_running_inactive:"Not Running",status_checking:"Checking...",status_current_mode:"Current Mode:",status_mode_powersave:"Powersave",status_mode_balance:"Balance",status_mode_performance:"Performance",status_mode_fast:"Fast",status_mode_unknown:"Unknown",status_module_version:"Module Version:",status_unknown:"Unknown",config_gpu_title:"GPU Frequency Table",config_freq:"Frequency (MHz)",config_volt:"Voltage (uV)",config_ddr:"Memory Level",config_edit:"Edit",config_loading:"Loading...",config_not_found:"No configuration found",config_add:"Add Config",config_save:"Save Config",config_save_freq_table:"Save Frequency Table",config_games_title:"Games List",config_games_add:"Add Game",config_games_save:"Save List",config_games_search_placeholder:"Search games...",config_custom_settings:"Custom Settings",config_global_settings:"Global Settings",config_global_mode:"Global Mode:",config_mode_powersave:"Powersave Mode",config_mode_balance:"Balance Mode",config_mode_performance:"Performance Mode",config_mode_fast:"Fast Mode",config_idle_threshold:"Idle Threshold (%):",config_powersave_mode:"Powersave Mode Settings",config_balance_mode:"Balance Mode Settings",config_performance_mode:"Performance Mode Settings",config_fast_mode:"Fast Mode Settings",config_margin:"Margin (%):",config_sampling_interval:"Sampling Interval (ms):",config_min_adaptive_interval:"Min Adaptive Interval (ms):",config_max_adaptive_interval:"Max Adaptive Interval (ms):",config_up_rate_delay:"Up Rate Delay (ms):",config_down_rate_delay:"Down Rate Delay (ms):",config_aggressive_down:"Aggressive Down Strategy",config_gaming_mode:"Gaming Mode",config_adaptive_sampling:"Adaptive Sampling",config_load_custom:"Load Config",config_save_custom:"Save Config",log_title:"Runtime Log",log_refresh:"Refresh",log_main:"Main Log",log_init:"Init Log",log_loading:"Loading...",log_empty:"Log is empty",log_not_found:"Log not found",log_size_warning:"Warning: Log file size exceeds limit, it will be rotated automatically.",settings_title:"Settings",settings_theme_follow:"Follow System Dark Mode",settings_theme_follow_summary:"Automatically switch theme based on system settings",settings_language:"Language:",settings_language_follow:"Follow System",settings_language_zh:"中文",settings_language_en:"English",settings_language_desc1:"Language changes take effect immediately",settings_language_desc2:"Follow System will detect system language settings",settings_log_level:"Main Log Level:",settings_log_level_debug:"Debug",settings_log_level_info:"Info",settings_log_level_warn:"Warn",settings_log_level_error:"Error",settings_log_level_desc1:"Log level changes take effect immediately",settings_log_level_desc2:"Debug level enables detailed logging",edit_config_title:"Edit GPU Frequency Table",edit_config_freq:"Frequency (MHz):",edit_config_freq_example:"e.g.: 350000 (KHz)",edit_config_freq_hint:"Please enter KHz value, displayed as MHz in table",edit_config_volt:"Voltage (uV):",edit_config_ddr:"Memory Level:",edit_config_ddr_default:"999 (No Change)",edit_config_ddr_highest:"0 (Highest)",edit_config_ddr_high:"1",edit_config_ddr_medium:"2",edit_config_ddr_low:"3",edit_config_save:"Save",edit_config_cancel:"Cancel",edit_config_delete:"Delete",edit_game_title:"Edit Games List",edit_game_package:"Package Name:",edit_game_package_example:"e.g.: com.tencent.tmgp.sgame",edit_game_mode:"Corresponding Mode:",edit_game_save:"Save",edit_game_cancel:"Cancel",toast_webui_loaded:"WebUI loaded successfully",toast_theme_follow_disabled:"System theme following disabled, you can now switch themes manually",toast_theme_follow_enabled:"System theme following enabled",toast_theme_follow_keep:"System theme following disabled, current theme will be kept",toast_theme_switched_dark:"Switched to dark mode",toast_theme_switched_light:"Switched to light mode",toast_config_updated:'Configuration updated, please click "Save Frequency Table" to save to file',toast_config_deleted:'Configuration deleted, please click "Save Frequency Table" to save to file',toast_config_saved:"Configuration saved successfully",toast_config_save_fail:"Failed to save configuration, please check permissions",toast_freq_table_saved:"Frequency table saved successfully",toast_freq_table_save_fail:"Failed to save frequency table, please check permissions",toast_config_empty:"No configuration to save",toast_config_parse_error:"Failed to parse configuration file: {error}",toast_freq_invalid:"Please enter a valid frequency value",toast_index_invalid:"Invalid configuration index",toast_game_added:'Game added, please click "Save List" button to save to file',toast_game_deleted:'Game deleted, please click "Save List" button to save to file',toast_game_exists:"This package name already exists in the list",toast_game_invalid:"Please enter a valid package name",toast_games_saved:"Games list saved successfully",toast_games_save_fail:"Failed to save games list, please check permissions",toast_games_empty:"No games to save",toast_games_parse_error:"Failed to parse games list, please check file format",toast_log_level_debug:"Log level set to: debug, detailed logging has been enabled",toast_log_level_set:"Log level set to: {level}, changes applied immediately",toast_log_level_fail:"Failed to save log level, please check permissions",toast_language_changed:"Language changed to {language}",toast_language_follow_system:"Language set to follow system",copyright_text:"Mediatek Mali GPU Governor © 2025 Github@Seyud",config_games_not_found:"No games found",config_games_list_not_found:"No games list found",settings_docs:"Help Documents:",settings_docs_loading:"Loading documents list...",settings_docs_empty:"No documents found",docs_modal_title:"Document",docs_load_fail:"Failed to load document"}};function getTranslation(n,e={},t="zh"){let r=(translations[t]||translations.zh)[n]||n;for(const[i,a]of Object.entries(e))r=r.replace(`{${i}}`,String(a));return r}let callbackCounter=0;function getUniqueCallbackName(n){return`${n}_callback_${Date.now()}_${callbackCounter++}`}function exec$1(n,e){return typeof e>"u"&&(e={}),new Promise((t,s)=>{const r=getUniqueCallbackName("exec");window[r]=(a,l,o)=>{t({errno:a,stdout:l,stderr:o}),i(r)};function i(a){delete window[a]}try{ksu.exec(n,JSON.stringify(e),r)}catch(a){s(a),i(r)}})}function toast$1(n){ksu.toast(n)}function exec(n,e={}){return exec$1(n,e)}function toast(n){toast$1(n)}class ConfigFileManager{currentLanguage="zh";async loadGpuConfig(){const{errno:e,stdout:t}=await exec(`cat ${PATHS.CONFIG_PATH}`);if(e===0&&t.trim())try{const s=tomlExports.parse(t);if(s.freq_table&&Array.isArray(s.freq_table)){const r=s.freq_table.map(i=>({freq:Number(i.freq),volt:Number(i.volt),ddr:Number(i.ddr_opp)}));return r.sort((i,a)=>i.freq-a.freq),{success:!0,data:r}}}catch(s){return toast(getTranslation("toast_config_parse_error",{error:String(s)},this.currentLanguage)),{success:!1,error:"parse_error"}}return{success:!1,error:"config_not_found"}}async saveGpuConfig(e){if(!e||e.length===0)return toast(getTranslation("toast_config_empty",{},this.currentLanguage)),{success:!1,error:"empty_config"};const s={freq_table:[...e].sort((l,o)=>l.freq-o.freq).map(l=>({freq:l.freq,volt:l.volt,ddr_opp:l.ddr}))},i=`# GPU 频率表
# freq 单位: kHz
# volt 单位: uV
# ddr_opp: DDR OPP 档位

`+tomlExports.stringify(s);return(await this.writeFileAtomically(PATHS.CONFIG_PATH,i)).errno===0?(toast(getTranslation("toast_freq_table_saved",{},this.currentLanguage)),{success:!0}):(toast(getTranslation("toast_freq_table_save_fail",{},this.currentLanguage)),{success:!1,error:"save_failed"})}async loadCustomConfig(){const{errno:e,stdout:t}=await exec(`cat ${PATHS.CUSTOM_CONFIG_PATH}`);if(e===0&&t.trim())try{const s=tomlExports.parse(t),r={};return s.global&&(r.global=s.global),["powersave","balance","performance","fast"].forEach(a=>{s[a]&&(r[a]=s[a])}),{success:!0,data:r}}catch(s){return toast(getTranslation("toast_config_parse_error",{error:String(s)},this.currentLanguage)),{success:!1,error:"parse_error"}}return{success:!1,error:"config_not_found"}}async saveCustomConfig(e){const t=this.generateCustomConfigContent(e);return(await this.writeFileAtomically(PATHS.CUSTOM_CONFIG_PATH,t)).errno===0?(toast(getTranslation("toast_config_saved",{},this.currentLanguage)),{success:!0}):(toast(getTranslation("toast_config_save_fail",{},this.currentLanguage)),{success:!1,error:"save_failed"})}generateCustomConfigContent(e){const t=`# GPU调速器配置文件

`,s={};return e.global&&(s.global=e.global),["powersave","balance","performance","fast"].forEach(i=>{e[i]&&(s[i]=e[i])}),t+tomlExports.stringify(s)}async writeFileAtomically(e,t){const s=`${e}.tmp`,i=`echo '${btoa(unescape(encodeURIComponent(t)))}' | base64 -d > '${s}' && mv '${s}' '${e}'`,a=await exec(i);return a.errno!==0&&await exec(`rm -f '${s}'`),a}setLanguage(e){this.currentLanguage=e}}class GpuConfigManager{gpuConfigs=[];currentLanguage="zh";gpuFreqTable;addConfigBtn;saveConfigBtn;onEditCallback=null;saveConfigToFile=null;constructor(){this.gpuFreqTable=document.getElementById("gpuFreqTable")?.querySelector("tbody"),this.addConfigBtn=document.getElementById("addConfigBtn"),this.saveConfigBtn=document.getElementById("saveConfigBtn")}init(){this.setupEventListeners()}setupEventListeners(){this.addConfigBtn&&this.addConfigBtn.addEventListener("click",()=>this.openEditModal()),this.saveConfigBtn&&this.saveConfigBtn.addEventListener("click",()=>{this.saveConfigToFile&&this.saveConfigToFile()})}loadConfigs(e){this.gpuConfigs=e||[],this.gpuConfigs.length>0?(this.gpuConfigs.sort((t,s)=>t.freq-s.freq),this.refreshTable()):this.showEmptyState()}refreshTable(){if(this.gpuFreqTable){if(this.gpuFreqTable.innerHTML="",this.gpuConfigs.length===0){this.showEmptyState();return}this.gpuConfigs=[...this.gpuConfigs].sort((e,t)=>e.freq-t.freq),this.gpuConfigs.forEach((e,t)=>{const s=this.createTableRow(e,t);this.gpuFreqTable?.appendChild(s)})}}createTableRow(e,t){const s=document.createElement("tr");s.dataset.index=String(t),s.dataset.freq=String(e.freq);const r=document.createElement("td");r.textContent=(e.freq/1e3).toFixed(0);const i=document.createElement("td");i.textContent=String(e.volt);const a=document.createElement("td");a.textContent=String(e.ddr);const l=document.createElement("td"),o=this.createEditButton(t);return l.appendChild(o),s.appendChild(r),s.appendChild(i),s.appendChild(a),s.appendChild(l),s}createEditButton(e){const t=document.createElement("button");return t.className="edit-btn",t.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>',t.title="编辑/删除",t.onclick=()=>(this.openEditModal(e),!1),t}showEmptyState(){this.gpuFreqTable&&(this.gpuFreqTable.innerHTML=`<tr><td colspan="4" class="loading-text">${getTranslation("config_not_found",{},this.currentLanguage)}</td></tr>`)}openEditModal(e=-1){if(this.onEditCallback){const t=e>=0?this.gpuConfigs[e]:null;this.onEditCallback(t,e)}}addConfig(e){this.gpuConfigs.push(e),this.refreshTable()}updateConfig(e,t){t>=0&&t<this.gpuConfigs.length?this.gpuConfigs[t]=e:this.gpuConfigs.push(e),this.refreshTable()}deleteConfig(e){return e>=0&&e<this.gpuConfigs.length?(this.gpuConfigs.splice(e,1),this.refreshTable(),!0):!1}getConfigs(){return[...this.gpuConfigs]}setEditCallback(e){this.onEditCallback=e}setSaveFileCallback(e){this.saveConfigToFile=e}isFrequencyDuplicate(e,t=-1){return this.gpuConfigs.some((s,r)=>s.freq===e&&r!==t)}getFrequencyRange(){if(this.gpuConfigs.length===0)return{min:0,max:0};const e=this.gpuConfigs.map(t=>t.freq);return{min:Math.min(...e),max:Math.max(...e)}}sortByFrequency(){this.gpuConfigs.sort((e,t)=>e.freq-t.freq),this.refreshTable()}validateConfig(e){const t=[];return(!e.freq||Number.isNaN(e.freq)||e.freq<=0)&&t.push("无效的频率值"),(!e.volt||Number.isNaN(e.volt)||e.volt<=0)&&t.push("无效的电压值"),(e.ddr===void 0||Number.isNaN(e.ddr))&&t.push("无效的DDR档位值"),{isValid:t.length===0,errors:t}}getStatistics(){if(this.gpuConfigs.length===0)return{count:0,avgFreq:0,avgVolt:0,freqRange:{min:0,max:0},voltRange:{min:0,max:0}};const e=this.gpuConfigs.map(s=>s.freq),t=this.gpuConfigs.map(s=>s.volt);return{count:this.gpuConfigs.length,avgFreq:e.reduce((s,r)=>s+r,0)/e.length,avgVolt:t.reduce((s,r)=>s+r,0)/t.length,freqRange:{min:Math.min(...e),max:Math.max(...e)},voltRange:{min:Math.min(...t),max:Math.max(...t)}}}setLanguage(e){this.currentLanguage=e,this.refreshTable()}clearConfigs(){this.gpuConfigs=[],this.refreshTable()}}class ModalManager{voltageController;editingIndex=-1;currentLanguage="zh";onSaveCallback=null;onDeleteCallback=null;editConfigModal;closeModalBtn;freqInput;saveItemBtn;cancelEditBtn;deleteItemBtn;ddrContainer;selectedDdr;constructor(e){this.voltageController=e,this.editConfigModal=document.getElementById("editConfigModal"),this.closeModalBtn=document.querySelector(".close-modal"),this.freqInput=document.getElementById("freqInput"),this.saveItemBtn=document.getElementById("saveItemBtn"),this.cancelEditBtn=document.getElementById("cancelEditBtn"),this.deleteItemBtn=document.getElementById("deleteItemBtn"),this.ddrContainer=document.getElementById("ddrContainer"),this.selectedDdr=document.getElementById("selectedDdr")}init(){this.setupEventListeners(),this.setupDdrSelector()}setupEventListeners(){this.closeModalBtn&&this.closeModalBtn.addEventListener("click",()=>this.closeModal()),this.cancelEditBtn&&this.cancelEditBtn.addEventListener("click",()=>this.closeModal()),this.saveItemBtn&&this.saveItemBtn.addEventListener("click",()=>this.saveConfigItem()),this.deleteItemBtn&&this.deleteItemBtn.addEventListener("click",()=>this.deleteConfigItem()),window.addEventListener("click",e=>{e.target===this.editConfigModal&&this.closeModal()}),window.addEventListener("keydown",e=>{e.key==="Escape"&&this.editConfigModal&&this.editConfigModal.style.display==="block"&&this.closeModal()})}setupDdrSelector(){if(!this.ddrContainer)return;this.ddrContainer.addEventListener("click",()=>{this.ddrContainer?.classList.toggle("open"),this.ddrContainer?.classList.contains("open")?setTimeout(()=>{(this.ddrContainer?.querySelectorAll(".option")).forEach((s,r)=>{setTimeout(()=>{s.style.opacity="1",s.style.transform="translateY(0)"},r*50)})},10):((this.ddrContainer?.querySelectorAll(".option")).forEach(s=>{s.style.opacity="0",s.style.transform="translateY(-10px)"}),setTimeout(()=>{this.ddrContainer?.classList.remove("open")},150))});const e=document.querySelectorAll("#ddrOptions .option");e.forEach(t=>{t.addEventListener("click",s=>{s.stopPropagation(),e.forEach(i=>{i.classList.remove("selected")}),t.classList.add("selected"),this.selectedDdr&&(this.selectedDdr.textContent=t.textContent);const r=this.ddrContainer?.querySelectorAll(".option");r.forEach(i=>{i.style.opacity="0",i.style.transform="translateY(-10px)"}),setTimeout(()=>{this.ddrContainer?.classList.remove("open")},150),setTimeout(()=>{r.forEach(i=>{i.style.opacity="",i.style.transform=""})},300)})})}openModal(e=null,t=-1){this.editConfigModal&&(this.editingIndex=t,e?(this.freqInput&&(this.freqInput.value=String(e.freq)),this.voltageController&&this.voltageController.setVoltage(e.volt),this.setDdrValue(e.ddr),this.deleteItemBtn&&(this.deleteItemBtn.style.display="block")):(this.freqInput&&(this.freqInput.value=""),this.voltageController&&this.voltageController.reset(),this.setDdrValue(999),this.deleteItemBtn&&(this.deleteItemBtn.style.display="none")),this.editConfigModal.style.display="block")}closeModal(){this.editConfigModal&&(this.editConfigModal.style.display="none")}setDdrValue(e){this.selectedDdr&&document.querySelectorAll("#ddrOptions .option").forEach(s=>{parseInt(s.getAttribute("data-value")||"0",10)===e?(this.selectedDdr&&(this.selectedDdr.textContent=s.textContent),s.classList.add("selected")):s.classList.remove("selected")})}getDdrValue(){if(this.selectedDdr){const e=this.selectedDdr.textContent||"999";return parseInt(e.split(" ")[0],10)}return 999}saveConfigItem(){if(!this.freqInput)return;const e=parseInt(this.freqInput.value,10),t=this.voltageController?this.voltageController.getCurrentVoltage():0,s=this.getDdrValue();if(!e||Number.isNaN(e)){toast(getTranslation("toast_freq_invalid",{},this.currentLanguage));return}const r={freq:e,volt:t,ddr:s};this.onSaveCallback&&this.onSaveCallback(r,this.editingIndex),this.closeModal(),toast(getTranslation("toast_config_updated",{},this.currentLanguage))}deleteConfigItem(){this.editingIndex>=0?(this.onDeleteCallback&&this.onDeleteCallback(this.editingIndex),this.closeModal(),toast(getTranslation("toast_config_deleted",{},this.currentLanguage))):toast(getTranslation("toast_index_invalid",{},this.currentLanguage))}setSaveCallback(e){this.onSaveCallback=e}setDeleteCallback(e){this.onDeleteCallback=e}setLanguage(e){this.currentLanguage=e}}class ModeConfigManager{currentLanguage="zh";customConfig={};globalModeSelect;globalModeContainer;selectedGlobalMode;globalModeOptions;idleThresholdInput;powersaveInputs=null;balanceInputs=null;performanceInputs=null;fastInputs=null;constructor(){this.globalModeSelect=document.getElementById("globalMode"),this.globalModeContainer=document.getElementById("globalModeContainer"),this.selectedGlobalMode=document.getElementById("selectedGlobalMode"),this.globalModeOptions=document.getElementById("globalModeOptions"),this.idleThresholdInput=document.getElementById("idleThreshold"),this.powersaveInputs=this.getModeInputs("powersave"),this.balanceInputs=this.getModeInputs("balance"),this.performanceInputs=this.getModeInputs("performance"),this.fastInputs=this.getModeInputs("fast")}getModeInputs(e){return{margin:document.getElementById(`${e}Margin`),sampling_interval:document.getElementById(`${e}SamplingInterval`),min_adaptive_interval:document.getElementById(`${e}MinAdaptiveInterval`),max_adaptive_interval:document.getElementById(`${e}MaxAdaptiveInterval`),up_rate_delay:document.getElementById(`${e}UpRateDelay`),down_rate_delay:document.getElementById(`${e}DownRateDelay`),aggressive_down:document.getElementById(`${e}AggressiveDown`),gaming_mode:document.getElementById(`${e}GamingMode`),adaptive_sampling:document.getElementById(`${e}AdaptiveSampling`)}}init(){this.initGlobalModeSelect(),this.initModeSwitchEvents()}initGlobalModeSelect(){if(!this.selectedGlobalMode||!this.globalModeOptions)return;this.selectedGlobalMode.addEventListener("click",t=>{t.stopPropagation(),this.globalModeContainer?.classList.toggle("open")}),this.globalModeOptions.querySelectorAll(".option").forEach(t=>{t.addEventListener("click",s=>{s.stopPropagation();const r=t.getAttribute("data-value"),i=t.textContent,a=this.selectedGlobalMode?.querySelector("span");a&&(a.textContent=i||"",a.setAttribute("data-i18n",t.getAttribute("data-i18n")||"")),this.globalModeSelect&&r&&(this.globalModeSelect.value=r,this.globalModeSelect.dispatchEvent(new Event("change"))),this.globalModeContainer?.classList.remove("open")})}),document.addEventListener("click",t=>{this.globalModeContainer?.contains(t.target)||this.globalModeContainer?.classList.remove("open")})}initModeSwitchEvents(){const e=document.querySelectorAll(".mode-tabs-grid .settings-tab-btn"),t=document.querySelectorAll(".mode-config-section");this.globalModeSelect&&this.syncModeTabsWithGlobalMode(this.globalModeSelect.value),e.forEach(s=>{s.addEventListener("click",()=>{const r=s.getAttribute("data-mode");e.forEach(a=>{a.classList.remove("active")}),s.classList.add("active"),t.forEach(a=>{a.classList.remove("active")});const i=document.getElementById(`${r}-config`);i&&i.classList.add("active")})}),this.globalModeSelect&&this.globalModeSelect.addEventListener("change",()=>{const s=this.globalModeSelect?.value;s&&this.syncModeTabsWithGlobalMode(s)})}syncModeTabsWithGlobalMode(e){const t=document.querySelectorAll(".mode-tabs-grid .settings-tab-btn"),s=document.querySelectorAll(".mode-config-section");t.forEach(r=>{r.classList.remove("active"),r.getAttribute("data-mode")===e&&r.classList.add("active")}),s.forEach(r=>{r.classList.remove("active"),r.id===`${e}-config`&&r.classList.add("active")})}populateCustomConfigForm(e){this.customConfig=e||{},this.customConfig.global&&(this.globalModeSelect&&this.customConfig.global.mode&&(this.globalModeSelect.value=String(this.customConfig.global.mode)),this.selectedGlobalMode&&this.customConfig.global.mode&&this.updateGlobalModeDisplay(String(this.customConfig.global.mode)),this.idleThresholdInput&&this.customConfig.global.idle_threshold!==void 0&&(this.idleThresholdInput.value=String(this.customConfig.global.idle_threshold))),this.populateModeConfig(this.powersaveInputs,this.customConfig.powersave),this.populateModeConfig(this.balanceInputs,this.customConfig.balance),this.populateModeConfig(this.performanceInputs,this.customConfig.performance),this.populateModeConfig(this.fastInputs,this.customConfig.fast),this.customConfig.global?.mode&&this.syncModeTabsWithGlobalMode(String(this.customConfig.global.mode))}updateGlobalModeDisplay(e){let t="",s="";switch(e){case"powersave":t=getTranslation("config_powersave_mode",{},this.currentLanguage),s="config_powersave_mode";break;case"performance":t=getTranslation("config_performance_mode",{},this.currentLanguage),s="config_performance_mode";break;case"fast":t=getTranslation("config_fast_mode",{},this.currentLanguage),s="config_fast_mode";break;default:t=getTranslation("config_balance_mode",{},this.currentLanguage),s="config_balance_mode";break}if(this.selectedGlobalMode){const r=this.selectedGlobalMode.querySelector("span");r&&(r.textContent=t,r.setAttribute("data-i18n",s))}}populateModeConfig(e,t){!t||!e||Object.keys(e).forEach(s=>{const r=e[s];if(r&&t[s]!==void 0){const i=r;i.type==="checkbox"?i.checked=!!t[s]:i.value=String(t[s])}})}getCurrentConfig(){return{global:{mode:this.getGlobalMode(),idle_threshold:this.getIdleThreshold()},powersave:this.getModeConfig(this.powersaveInputs),balance:this.getModeConfig(this.balanceInputs),performance:this.getModeConfig(this.performanceInputs),fast:this.getModeConfig(this.fastInputs)}}getGlobalMode(){if(this.globalModeSelect?.value)return this.globalModeSelect.value;if(this.selectedGlobalMode){const e=this.selectedGlobalMode.querySelector("span");if(e){const t=e.textContent||"";return t.includes("省电")||t.includes("Power Save")?"powersave":t.includes("性能")||t.includes("Performance")?"performance":t.includes("极速")||t.includes("Fast")?"fast":"balance"}}return"balance"}getIdleThreshold(){return this.idleThresholdInput&&Number(this.idleThresholdInput.value)||5}getModeConfig(e){if(!e)return{};const t={};return Object.keys(e).forEach(s=>{const r=e[s];r&&(r.type==="checkbox"?t[s]=r.checked:t[s]=r.value?Number(r.value):0)}),t}setLanguage(e){this.currentLanguage=e,this.customConfig.global?.mode&&this.updateGlobalModeDisplay(String(this.customConfig.global.mode))}}class VoltageController{currentVoltValue=VOLT_SETTINGS.MAX_VOLT;isLongPress=!1;decreaseTimer=null;increaseTimer=null;voltageEventsInitialized=!1;voltSelect;selectedVolt;voltDecreaseBtn;voltIncreaseBtn;constructor(){this.voltSelect=document.getElementById("voltSelect"),this.selectedVolt=document.getElementById("selectedVolt"),this.voltDecreaseBtn=document.getElementById("voltDecreaseBtn"),this.voltIncreaseBtn=document.getElementById("voltIncreaseBtn")}init(){this.initVoltSelect(),this.setupVoltageEvents()}decreaseVolt(){const e=this.currentVoltValue-VOLT_SETTINGS.VOLT_STEP;return e>=VOLT_SETTINGS.MIN_VOLT?(this.currentVoltValue=e,this.updateVoltDisplay(),!0):!1}increaseVolt(){const e=this.currentVoltValue+VOLT_SETTINGS.VOLT_STEP;return e<=VOLT_SETTINGS.MAX_VOLT?(this.currentVoltValue=e,this.updateVoltDisplay(),!0):!1}updateVoltDisplay(){if(this.selectedVolt&&(this.selectedVolt.textContent=String(this.currentVoltValue)),this.voltSelect){const e=Array.from(this.voltSelect.options).find(t=>parseInt(t.value,10)===this.currentVoltValue);if(e)this.voltSelect.value=e.value;else{const t=document.createElement("option");t.value=String(this.currentVoltValue),t.textContent=String(this.currentVoltValue),this.voltSelect.appendChild(t),this.voltSelect.value=String(this.currentVoltValue)}this.voltDecreaseBtn&&(this.voltDecreaseBtn.disabled=this.currentVoltValue<=VOLT_SETTINGS.MIN_VOLT),this.voltIncreaseBtn&&(this.voltIncreaseBtn.disabled=this.currentVoltValue>=VOLT_SETTINGS.MAX_VOLT)}}initVoltSelect(){!this.voltSelect||!this.selectedVolt||(this.voltSelect.innerHTML="",VOLT_LIST.forEach(e=>{const t=document.createElement("option");t.value=String(e),t.textContent=String(e),this.voltSelect?.appendChild(t)}),this.currentVoltValue=VOLT_SETTINGS.MAX_VOLT,this.selectedVolt.textContent=String(this.currentVoltValue),this.voltSelect.value=String(this.currentVoltValue),this.updateVoltDisplay())}setupVoltageEvents(){this.voltageEventsInitialized||(this.voltDecreaseBtn&&(this.voltDecreaseBtn.addEventListener("click",()=>{if(this.isLongPress){this.isLongPress=!1;return}this.decreaseVolt()}),this.voltDecreaseBtn.addEventListener("mousedown",()=>{this.isLongPress=!1,this.decreaseTimer=setTimeout(()=>{this.isLongPress=!0,this.decreaseVolt()&&this.decreaseTimer&&(this.decreaseTimer=setInterval(()=>{this.decreaseVolt()||this.decreaseTimer&&(clearInterval(this.decreaseTimer),this.decreaseTimer=null)},150))},500)})),this.voltIncreaseBtn&&(this.voltIncreaseBtn.addEventListener("click",()=>{if(this.isLongPress){this.isLongPress=!1;return}this.increaseVolt()}),this.voltIncreaseBtn.addEventListener("mousedown",()=>{this.isLongPress=!1,this.increaseTimer=setTimeout(()=>{this.isLongPress=!0,this.increaseVolt()&&this.increaseTimer&&(this.increaseTimer=setInterval(()=>{this.increaseVolt()||this.increaseTimer&&(clearInterval(this.increaseTimer),this.increaseTimer=null)},150))},500)})),document.addEventListener("mouseup",()=>this.clearTimers()),document.addEventListener("mouseleave",()=>this.clearTimers()),this.setupTouchEvents(),this.voltageEventsInitialized=!0)}setupTouchEvents(){this.voltDecreaseBtn&&this.voltDecreaseBtn.addEventListener("touchstart",e=>{e.preventDefault(),this.isLongPress=!1,this.decreaseVolt(),this.decreaseTimer=setTimeout(()=>{this.isLongPress=!0,this.decreaseTimer=setInterval(()=>{this.decreaseVolt()||this.decreaseTimer&&(clearInterval(this.decreaseTimer),this.decreaseTimer=null)},150)},500)},{passive:!1}),this.voltIncreaseBtn&&this.voltIncreaseBtn.addEventListener("touchstart",e=>{e.preventDefault(),this.isLongPress=!1,this.increaseVolt(),this.increaseTimer=setTimeout(()=>{this.isLongPress=!0,this.increaseTimer=setInterval(()=>{this.increaseVolt()||this.increaseTimer&&(clearInterval(this.increaseTimer),this.increaseTimer=null)},150)},500)},{passive:!1}),document.addEventListener("touchend",()=>this.clearTimers())}clearTimers(){this.decreaseTimer!==null&&(clearTimeout(this.decreaseTimer),clearInterval(this.decreaseTimer),this.decreaseTimer=null),this.increaseTimer!==null&&(clearTimeout(this.increaseTimer),clearInterval(this.increaseTimer),this.increaseTimer=null)}getCurrentVoltage(){return this.currentVoltValue}setVoltage(e){this.currentVoltValue=e,this.updateVoltDisplay()}reset(){this.currentVoltValue=VOLT_SETTINGS.MAX_VOLT,this.updateVoltDisplay()}}class ConfigManager{currentLanguage="zh";voltageController;configFileManager;modalManager;modeConfigManager;gpuConfigManager;loadCustomConfigBtn;saveCustomConfigBtn;constructor(){this.voltageController=new VoltageController,this.configFileManager=new ConfigFileManager,this.modalManager=new ModalManager(this.voltageController),this.modeConfigManager=new ModeConfigManager,this.gpuConfigManager=new GpuConfigManager,this.loadCustomConfigBtn=document.getElementById("loadCustomConfigBtn"),this.saveCustomConfigBtn=document.getElementById("saveCustomConfigBtn")}init(){this.setupEventListeners(),this.setupModuleCallbacks(),this.initializeModules()}initializeModules(){this.voltageController.init(),this.modalManager.init(),this.modeConfigManager.init(),this.gpuConfigManager.init()}setupModuleCallbacks(){this.gpuConfigManager.setEditCallback((e,t)=>{this.modalManager.openModal(e,t)}),this.gpuConfigManager.setSaveFileCallback(()=>{this.saveGpuConfigToFile()}),this.modalManager.setSaveCallback((e,t)=>{this.gpuConfigManager.updateConfig(e,t)}),this.modalManager.setDeleteCallback(e=>{this.gpuConfigManager.deleteConfig(e)})}async loadInitialData(){await this.loadGpuConfig(),await this.loadCustomConfigFromFile()}async loadAllConfigData(){await this.loadInitialData()}setupEventListeners(){this.loadCustomConfigBtn&&this.loadCustomConfigBtn.addEventListener("click",()=>this.loadCustomConfigFromFile()),this.saveCustomConfigBtn&&this.saveCustomConfigBtn.addEventListener("click",()=>this.saveCustomConfigToFile())}async loadGpuConfig(){const e=await this.configFileManager.loadGpuConfig();e.success&&e.data?this.gpuConfigManager.loadConfigs(e.data):this.gpuConfigManager.loadConfigs([])}async saveGpuConfigToFile(){const e=this.gpuConfigManager.getConfigs();await this.configFileManager.saveGpuConfig(e)}async loadCustomConfigFromFile(){const e=await this.configFileManager.loadCustomConfig();e.success&&e.data&&this.modeConfigManager.populateCustomConfigForm(e.data)}async saveCustomConfigToFile(){const e=this.modeConfigManager.getCurrentConfig();await this.configFileManager.saveCustomConfig(e)}setLanguage(e){this.currentLanguage=e,this.configFileManager.setLanguage(e),this.modalManager.setLanguage(e),this.modeConfigManager.setLanguage(e),this.gpuConfigManager.setLanguage(e)}}function L(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var T=L();function Z(n){T=n}var C={exec:()=>null};function k(n,e=""){let t=typeof n=="string"?n:n.source,s={replace:(r,i)=>{let a=typeof i=="string"?i:i.source;return a=a.replace(m.caret,"$1"),t=t.replace(r,a),s},getRegex:()=>new RegExp(t,e)};return s}var me=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),m={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] +\S/,listReplaceTask:/^\[[ xX]\] +/,listTaskCheckbox:/\[[ xX]\]/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:n=>new RegExp(`^( {0,3}${n})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}#`),htmlBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}<(?:[a-z].*>|!--)`,"i")},xe=/^(?:[ \t]*(?:\n|$))+/,be=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Re=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,I=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Te=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,N=/(?:[*+-]|\d{1,9}[.)])/,re=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,se=k(re).replace(/bull/g,N).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),Oe=k(re).replace(/bull/g,N).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),Q=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,we=/^[^\n]+/,F=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,ye=k(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",F).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Pe=k(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,N).getRegex(),v="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",j=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Se=k("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",j).replace("tag",v).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),ie=k(Q).replace("hr",I).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",v).getRegex(),$e=k(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",ie).getRegex(),U={blockquote:$e,code:be,def:ye,fences:Re,heading:Te,hr:I,html:Se,lheading:se,list:Pe,newline:xe,paragraph:ie,table:C,text:we},te=k("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",I).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",v).getRegex(),_e={...U,lheading:Oe,table:te,paragraph:k(Q).replace("hr",I).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",te).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",v).getRegex()},Le={...U,html:k(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",j).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:C,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:k(Q).replace("hr",I).replace("heading",` *#{1,6} *[^
]`).replace("lheading",se).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Me=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,ze=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,oe=/^( {2,}|\\)\n(?!\s*$)/,Ae=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,D=/[\p{P}\p{S}]/u,K=/[\s\p{P}\p{S}]/u,ae=/[^\s\p{P}\p{S}]/u,Ce=k(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,K).getRegex(),le=/(?!~)[\p{P}\p{S}]/u,Ie=/(?!~)[\s\p{P}\p{S}]/u,Ee=/(?:[^\s\p{P}\p{S}]|~)/u,Be=k(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",me?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),ue=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,qe=k(ue,"u").replace(/punct/g,D).getRegex(),ve=k(ue,"u").replace(/punct/g,le).getRegex(),pe="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",De=k(pe,"gu").replace(/notPunctSpace/g,ae).replace(/punctSpace/g,K).replace(/punct/g,D).getRegex(),He=k(pe,"gu").replace(/notPunctSpace/g,Ee).replace(/punctSpace/g,Ie).replace(/punct/g,le).getRegex(),Ze=k("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,ae).replace(/punctSpace/g,K).replace(/punct/g,D).getRegex(),Ge=k(/\\(punct)/,"gu").replace(/punct/g,D).getRegex(),Ne=k(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Qe=k(j).replace("(?:-->|$)","-->").getRegex(),Fe=k("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Qe).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),q=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,je=k(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",q).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),ce=k(/^!?\[(label)\]\[(ref)\]/).replace("label",q).replace("ref",F).getRegex(),he=k(/^!?\[(ref)\](?:\[\])?/).replace("ref",F).getRegex(),Ue=k("reflink|nolink(?!\\()","g").replace("reflink",ce).replace("nolink",he).getRegex(),ne=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,W={_backpedal:C,anyPunctuation:Ge,autolink:Ne,blockSkip:Be,br:oe,code:ze,del:C,emStrongLDelim:qe,emStrongRDelimAst:De,emStrongRDelimUnd:Ze,escape:Me,link:je,nolink:he,punctuation:Ce,reflink:ce,reflinkSearch:Ue,tag:Fe,text:Ae,url:C},Ke={...W,link:k(/^!?\[(label)\]\((.*?)\)/).replace("label",q).getRegex(),reflink:k(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",q).getRegex()},G={...W,emStrongRDelimAst:He,emStrongLDelim:ve,url:k(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",ne).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:k(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",ne).getRegex()},We={...G,br:k(oe).replace("{2,}","*").getRegex(),text:k(G.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},E={normal:U,gfm:_e,pedantic:Le},M={normal:W,gfm:G,breaks:We,pedantic:Ke},Xe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ke=n=>Xe[n];function w(n,e){if(e){if(m.escapeTest.test(n))return n.replace(m.escapeReplace,ke)}else if(m.escapeTestNoEncode.test(n))return n.replace(m.escapeReplaceNoEncode,ke);return n}function X(n){try{n=encodeURI(n).replace(m.percentDecode,"%")}catch{return null}return n}function J(n,e){let t=n.replace(m.findPipe,(i,a,l)=>{let o=!1,h=a;for(;--h>=0&&l[h]==="\\";)o=!o;return o?"|":" |"}),s=t.split(m.splitPipe),r=0;if(s[0].trim()||s.shift(),s.length>0&&!s.at(-1)?.trim()&&s.pop(),e)if(s.length>e)s.splice(e);else for(;s.length<e;)s.push("");for(;r<s.length;r++)s[r]=s[r].trim().replace(m.slashPipe,"|");return s}function z(n,e,t){let s=n.length;if(s===0)return"";let r=0;for(;r<s&&n.charAt(s-r-1)===e;)r++;return n.slice(0,s-r)}function de(n,e){if(n.indexOf(e[1])===-1)return-1;let t=0;for(let s=0;s<n.length;s++)if(n[s]==="\\")s++;else if(n[s]===e[0])t++;else if(n[s]===e[1]&&(t--,t<0))return s;return t>0?-2:-1}function ge(n,e,t,s,r){let i=e.href,a=e.title||null,l=n[1].replace(r.other.outputLinkReplace,"$1");s.state.inLink=!0;let o={type:n[0].charAt(0)==="!"?"image":"link",raw:t,href:i,title:a,text:l,tokens:s.inlineTokens(l)};return s.state.inLink=!1,o}function Je(n,e,t){let s=n.match(t.other.indentCodeCompensation);if(s===null)return e;let r=s[1];return e.split(`
`).map(i=>{let a=i.match(t.other.beginningSpace);if(a===null)return i;let[l]=a;return l.length>=r.length?i.slice(r.length):i}).join(`
`)}var y=class{options;rules;lexer;constructor(n){this.options=n||T}space(n){let e=this.rules.block.newline.exec(n);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(n){let e=this.rules.block.code.exec(n);if(e){let t=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?t:z(t,`
`)}}}fences(n){let e=this.rules.block.fences.exec(n);if(e){let t=e[0],s=Je(t,e[3]||"",this.rules);return{type:"code",raw:t,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:s}}}heading(n){let e=this.rules.block.heading.exec(n);if(e){let t=e[2].trim();if(this.rules.other.endingHash.test(t)){let s=z(t,"#");(this.options.pedantic||!s||this.rules.other.endingSpaceChar.test(s))&&(t=s.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:t,tokens:this.lexer.inline(t)}}}hr(n){let e=this.rules.block.hr.exec(n);if(e)return{type:"hr",raw:z(e[0],`
`)}}blockquote(n){let e=this.rules.block.blockquote.exec(n);if(e){let t=z(e[0],`
`).split(`
`),s="",r="",i=[];for(;t.length>0;){let a=!1,l=[],o;for(o=0;o<t.length;o++)if(this.rules.other.blockquoteStart.test(t[o]))l.push(t[o]),a=!0;else if(!a)l.push(t[o]);else break;t=t.slice(o);let h=l.join(`
`),u=h.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");s=s?`${s}
${h}`:h,r=r?`${r}
${u}`:u;let A=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(u,i,!0),this.lexer.state.top=A,t.length===0)break;let f=i.at(-1);if(f?.type==="code")break;if(f?.type==="blockquote"){let R=f,H=R.raw+`
`+t.join(`
`),V=this.blockquote(H);i[i.length-1]=V,s=s.substring(0,s.length-R.raw.length)+V.raw,r=r.substring(0,r.length-R.text.length)+V.text;break}else if(f?.type==="list"){let R=f,H=R.raw+`
`+t.join(`
`),V=this.list(H);i[i.length-1]=V,s=s.substring(0,s.length-f.raw.length)+V.raw,r=r.substring(0,r.length-R.raw.length)+V.raw,t=H.substring(i.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:s,tokens:i,text:r}}}list(n){let e=this.rules.block.list.exec(n);if(e){let t=e[1].trim(),s=t.length>1,r={type:"list",raw:"",ordered:s,start:s?+t.slice(0,-1):"",loose:!1,items:[]};t=s?`\\d{1,9}\\${t.slice(-1)}`:`\\${t}`,this.options.pedantic&&(t=s?t:"[*+-]");let i=this.rules.other.listItemRegex(t),a=!1;for(;n;){let o=!1,h="",u="";if(!(e=i.exec(n))||this.rules.block.hr.test(n))break;h=e[0],n=n.substring(h.length);let A=e[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,V=>" ".repeat(3*V.length)),f=n.split(`
`,1)[0],R=!A.trim(),H=0;if(this.options.pedantic?(H=2,u=A.trimStart()):R?H=e[1].length+1:(H=e[2].search(this.rules.other.nonSpaceChar),H=H>4?1:H,u=A.slice(H),H+=e[1].length),R&&this.rules.other.blankLine.test(f)&&(h+=f+`
`,n=n.substring(f.length+1),o=!0),!o){let V=this.rules.other.nextBulletRegex(H),fe=this.rules.other.hrRegex(H),tt=this.rules.other.fencesBeginRegex(H),rt=this.rules.other.headingBeginRegex(H),nt=this.rules.other.htmlBeginRegex(H);for(;n;){let st=n.split(`
`,1)[0],Ve;if(f=st,this.options.pedantic?(f=f.replace(this.rules.other.listReplaceNesting,"  "),Ve=f):Ve=f.replace(this.rules.other.tabCharGlobal,"    "),tt.test(f)||rt.test(f)||nt.test(f)||V.test(f)||fe.test(f))break;if(Ve.search(this.rules.other.nonSpaceChar)>=H||!f.trim())u+=`
`+Ve.slice(H);else{if(R||A.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||tt.test(A)||rt.test(A)||fe.test(A))break;u+=`
`+f}!R&&!f.trim()&&(R=!0),h+=st+`
`,n=n.substring(st.length+1),A=Ve.slice(H)}}r.loose||(a?r.loose=!0:this.rules.other.doubleBlankLine.test(h)&&(a=!0)),r.items.push({type:"list_item",raw:h,task:!!this.options.gfm&&this.rules.other.listIsTask.test(u),loose:!1,text:u,tokens:[]}),r.raw+=h}let l=r.items.at(-1);if(l)l.raw=l.raw.trimEnd(),l.text=l.text.trimEnd();else return;r.raw=r.raw.trimEnd();for(let o of r.items){if(this.lexer.state.top=!1,o.tokens=this.lexer.blockTokens(o.text,[]),o.task){if(o.text=o.text.replace(this.rules.other.listReplaceTask,""),o.tokens[0]?.type==="text"||o.tokens[0]?.type==="paragraph"){o.tokens[0].raw=o.tokens[0].raw.replace(this.rules.other.listReplaceTask,""),o.tokens[0].text=o.tokens[0].text.replace(this.rules.other.listReplaceTask,"");for(let u=this.lexer.inlineQueue.length-1;u>=0;u--)if(this.rules.other.listIsTask.test(this.lexer.inlineQueue[u].src)){this.lexer.inlineQueue[u].src=this.lexer.inlineQueue[u].src.replace(this.rules.other.listReplaceTask,"");break}}let h=this.rules.other.listTaskCheckbox.exec(o.raw);if(h){let u={type:"checkbox",raw:h[0]+" ",checked:h[0]!=="[ ]"};o.checked=u.checked,r.loose?o.tokens[0]&&["paragraph","text"].includes(o.tokens[0].type)&&"tokens"in o.tokens[0]&&o.tokens[0].tokens?(o.tokens[0].raw=u.raw+o.tokens[0].raw,o.tokens[0].text=u.raw+o.tokens[0].text,o.tokens[0].tokens.unshift(u)):o.tokens.unshift({type:"paragraph",raw:u.raw,text:u.raw,tokens:[u]}):o.tokens.unshift(u)}}if(!r.loose){let h=o.tokens.filter(A=>A.type==="space"),u=h.length>0&&h.some(A=>this.rules.other.anyLine.test(A.raw));r.loose=u}}if(r.loose)for(let o of r.items){o.loose=!0;for(let h of o.tokens)h.type==="text"&&(h.type="paragraph")}return r}}html(n){let e=this.rules.block.html.exec(n);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(n){let e=this.rules.block.def.exec(n);if(e){let t=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),s=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",r=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:t,raw:e[0],href:s,title:r}}}table(n){let e=this.rules.block.table.exec(n);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let t=J(e[1]),s=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),r=e[3]?.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],i={type:"table",raw:e[0],header:[],align:[],rows:[]};if(t.length===s.length){for(let a of s)this.rules.other.tableAlignRight.test(a)?i.align.push("right"):this.rules.other.tableAlignCenter.test(a)?i.align.push("center"):this.rules.other.tableAlignLeft.test(a)?i.align.push("left"):i.align.push(null);for(let a=0;a<t.length;a++)i.header.push({text:t[a],tokens:this.lexer.inline(t[a]),header:!0,align:i.align[a]});for(let a of r)i.rows.push(J(a,i.header.length).map((l,o)=>({text:l,tokens:this.lexer.inline(l),header:!1,align:i.align[o]})));return i}}lheading(n){let e=this.rules.block.lheading.exec(n);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(n){let e=this.rules.block.paragraph.exec(n);if(e){let t=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:t,tokens:this.lexer.inline(t)}}}text(n){let e=this.rules.block.text.exec(n);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(n){let e=this.rules.inline.escape.exec(n);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(n){let e=this.rules.inline.tag.exec(n);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(n){let e=this.rules.inline.link.exec(n);if(e){let t=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(t)){if(!this.rules.other.endAngleBracket.test(t))return;let i=z(t.slice(0,-1),"\\");if((t.length-i.length)%2===0)return}else{let i=de(e[2],"()");if(i===-2)return;if(i>-1){let a=(e[0].indexOf("!")===0?5:4)+e[1].length+i;e[2]=e[2].substring(0,i),e[0]=e[0].substring(0,a).trim(),e[3]=""}}let s=e[2],r="";if(this.options.pedantic){let i=this.rules.other.pedanticHrefTitle.exec(s);i&&(s=i[1],r=i[3])}else r=e[3]?e[3].slice(1,-1):"";return s=s.trim(),this.rules.other.startAngleBracket.test(s)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(t)?s=s.slice(1):s=s.slice(1,-1)),ge(e,{href:s&&s.replace(this.rules.inline.anyPunctuation,"$1"),title:r&&r.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(n,e){let t;if((t=this.rules.inline.reflink.exec(n))||(t=this.rules.inline.nolink.exec(n))){let s=(t[2]||t[1]).replace(this.rules.other.multipleSpaceGlobal," "),r=e[s.toLowerCase()];if(!r){let i=t[0].charAt(0);return{type:"text",raw:i,text:i}}return ge(t,r,t[0],this.lexer,this.rules)}}emStrong(n,e,t=""){let s=this.rules.inline.emStrongLDelim.exec(n);if(!(!s||s[3]&&t.match(this.rules.other.unicodeAlphaNumeric))&&(!(s[1]||s[2])||!t||this.rules.inline.punctuation.exec(t))){let r=[...s[0]].length-1,i,a,l=r,o=0,h=s[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(h.lastIndex=0,e=e.slice(-1*n.length+r);(s=h.exec(e))!=null;){if(i=s[1]||s[2]||s[3]||s[4]||s[5]||s[6],!i)continue;if(a=[...i].length,s[3]||s[4]){l+=a;continue}else if((s[5]||s[6])&&r%3&&!((r+a)%3)){o+=a;continue}if(l-=a,l>0)continue;a=Math.min(a,a+l+o);let u=[...s[0]][0].length,A=n.slice(0,r+s.index+u+a);if(Math.min(r,a)%2){let R=A.slice(1,-1);return{type:"em",raw:A,text:R,tokens:this.lexer.inlineTokens(R)}}let f=A.slice(2,-2);return{type:"strong",raw:A,text:f,tokens:this.lexer.inlineTokens(f)}}}}codespan(n){let e=this.rules.inline.code.exec(n);if(e){let t=e[2].replace(this.rules.other.newLineCharGlobal," "),s=this.rules.other.nonSpaceChar.test(t),r=this.rules.other.startingSpaceChar.test(t)&&this.rules.other.endingSpaceChar.test(t);return s&&r&&(t=t.substring(1,t.length-1)),{type:"codespan",raw:e[0],text:t}}}br(n){let e=this.rules.inline.br.exec(n);if(e)return{type:"br",raw:e[0]}}del(n){let e=this.rules.inline.del.exec(n);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(n){let e=this.rules.inline.autolink.exec(n);if(e){let t,s;return e[2]==="@"?(t=e[1],s="mailto:"+t):(t=e[1],s=t),{type:"link",raw:e[0],text:t,href:s,tokens:[{type:"text",raw:t,text:t}]}}}url(n){let e;if(e=this.rules.inline.url.exec(n)){let t,s;if(e[2]==="@")t=e[0],s="mailto:"+t;else{let r;do r=e[0],e[0]=this.rules.inline._backpedal.exec(e[0])?.[0]??"";while(r!==e[0]);t=e[0],e[1]==="www."?s="http://"+e[0]:s=e[0]}return{type:"link",raw:e[0],text:t,href:s,tokens:[{type:"text",raw:t,text:t}]}}}inlineText(n){let e=this.rules.inline.text.exec(n);if(e){let t=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:t}}}},x=class at{tokens;options;state;inlineQueue;tokenizer;constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||T,this.options.tokenizer=this.options.tokenizer||new y,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let t={other:m,block:E.normal,inline:M.normal};this.options.pedantic?(t.block=E.pedantic,t.inline=M.pedantic):this.options.gfm&&(t.block=E.gfm,this.options.breaks?t.inline=M.breaks:t.inline=M.gfm),this.tokenizer.rules=t}static get rules(){return{block:E,inline:M}}static lex(e,t){return new at(t).lex(e)}static lexInline(e,t){return new at(t).inlineTokens(e)}lex(e){e=e.replace(m.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){let s=this.inlineQueue[t];this.inlineTokens(s.src,s.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],s=!1){for(this.options.pedantic&&(e=e.replace(m.tabCharGlobal,"    ").replace(m.spaceLine,""));e;){let r;if(this.options.extensions?.block?.some(a=>(r=a.call({lexer:this},e,t))?(e=e.substring(r.raw.length),t.push(r),!0):!1))continue;if(r=this.tokenizer.space(e)){e=e.substring(r.raw.length);let a=t.at(-1);r.raw.length===1&&a!==void 0?a.raw+=`
`:t.push(r);continue}if(r=this.tokenizer.code(e)){e=e.substring(r.raw.length);let a=t.at(-1);a?.type==="paragraph"||a?.type==="text"?(a.raw+=(a.raw.endsWith(`
`)?"":`
`)+r.raw,a.text+=`
`+r.text,this.inlineQueue.at(-1).src=a.text):t.push(r);continue}if(r=this.tokenizer.fences(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.heading(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.hr(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.blockquote(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.list(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.html(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.def(e)){e=e.substring(r.raw.length);let a=t.at(-1);a?.type==="paragraph"||a?.type==="text"?(a.raw+=(a.raw.endsWith(`
`)?"":`
`)+r.raw,a.text+=`
`+r.raw,this.inlineQueue.at(-1).src=a.text):this.tokens.links[r.tag]||(this.tokens.links[r.tag]={href:r.href,title:r.title},t.push(r));continue}if(r=this.tokenizer.table(e)){e=e.substring(r.raw.length),t.push(r);continue}if(r=this.tokenizer.lheading(e)){e=e.substring(r.raw.length),t.push(r);continue}let i=e;if(this.options.extensions?.startBlock){let a=1/0,l=e.slice(1),o;this.options.extensions.startBlock.forEach(h=>{o=h.call({lexer:this},l),typeof o=="number"&&o>=0&&(a=Math.min(a,o))}),a<1/0&&a>=0&&(i=e.substring(0,a+1))}if(this.state.top&&(r=this.tokenizer.paragraph(i))){let a=t.at(-1);s&&a?.type==="paragraph"?(a.raw+=(a.raw.endsWith(`
`)?"":`
`)+r.raw,a.text+=`
`+r.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=a.text):t.push(r),s=i.length!==e.length,e=e.substring(r.raw.length);continue}if(r=this.tokenizer.text(e)){e=e.substring(r.raw.length);let a=t.at(-1);a?.type==="text"?(a.raw+=(a.raw.endsWith(`
`)?"":`
`)+r.raw,a.text+=`
`+r.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=a.text):t.push(r);continue}if(e){let a="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(a);break}else throw new Error(a)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let s=e,r=null;if(this.tokens.links){let o=Object.keys(this.tokens.links);if(o.length>0)for(;(r=this.tokenizer.rules.inline.reflinkSearch.exec(s))!=null;)o.includes(r[0].slice(r[0].lastIndexOf("[")+1,-1))&&(s=s.slice(0,r.index)+"["+"a".repeat(r[0].length-2)+"]"+s.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(r=this.tokenizer.rules.inline.anyPunctuation.exec(s))!=null;)s=s.slice(0,r.index)+"++"+s.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let i;for(;(r=this.tokenizer.rules.inline.blockSkip.exec(s))!=null;)i=r[2]?r[2].length:0,s=s.slice(0,r.index+i)+"["+"a".repeat(r[0].length-i-2)+"]"+s.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);s=this.options.hooks?.emStrongMask?.call({lexer:this},s)??s;let a=!1,l="";for(;e;){a||(l=""),a=!1;let o;if(this.options.extensions?.inline?.some(u=>(o=u.call({lexer:this},e,t))?(e=e.substring(o.raw.length),t.push(o),!0):!1))continue;if(o=this.tokenizer.escape(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.tag(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.link(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(o.raw.length);let u=t.at(-1);o.type==="text"&&u?.type==="text"?(u.raw+=o.raw,u.text+=o.text):t.push(o);continue}if(o=this.tokenizer.emStrong(e,s,l)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.codespan(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.br(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.del(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.autolink(e)){e=e.substring(o.raw.length),t.push(o);continue}if(!this.state.inLink&&(o=this.tokenizer.url(e))){e=e.substring(o.raw.length),t.push(o);continue}let h=e;if(this.options.extensions?.startInline){let u=1/0,A=e.slice(1),f;this.options.extensions.startInline.forEach(R=>{f=R.call({lexer:this},A),typeof f=="number"&&f>=0&&(u=Math.min(u,f))}),u<1/0&&u>=0&&(h=e.substring(0,u+1))}if(o=this.tokenizer.inlineText(h)){e=e.substring(o.raw.length),o.raw.slice(-1)!=="_"&&(l=o.raw.slice(-1)),a=!0;let u=t.at(-1);u?.type==="text"?(u.raw+=o.raw,u.text+=o.text):t.push(o);continue}if(e){let u="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(u);break}else throw new Error(u)}}return t}},P=class{options;parser;constructor(n){this.options=n||T}space(n){return""}code({text:n,lang:e,escaped:t}){let s=(e||"").match(m.notSpaceStart)?.[0],r=n.replace(m.endingNewline,"")+`
`;return s?'<pre><code class="language-'+w(s)+'">'+(t?r:w(r,!0))+`</code></pre>
`:"<pre><code>"+(t?r:w(r,!0))+`</code></pre>
`}blockquote({tokens:n}){return`<blockquote>
${this.parser.parse(n)}</blockquote>
`}html({text:n}){return n}def(n){return""}heading({tokens:n,depth:e}){return`<h${e}>${this.parser.parseInline(n)}</h${e}>
`}hr(n){return`<hr>
`}list(n){let e=n.ordered,t=n.start,s="";for(let a=0;a<n.items.length;a++){let l=n.items[a];s+=this.listitem(l)}let r=e?"ol":"ul",i=e&&t!==1?' start="'+t+'"':"";return"<"+r+i+`>
`+s+"</"+r+`>
`}listitem(n){return`<li>${this.parser.parse(n.tokens)}</li>
`}checkbox({checked:n}){return"<input "+(n?'checked="" ':"")+'disabled="" type="checkbox"> '}paragraph({tokens:n}){return`<p>${this.parser.parseInline(n)}</p>
`}table(n){let e="",t="";for(let r=0;r<n.header.length;r++)t+=this.tablecell(n.header[r]);e+=this.tablerow({text:t});let s="";for(let r=0;r<n.rows.length;r++){let i=n.rows[r];t="";for(let a=0;a<i.length;a++)t+=this.tablecell(i[a]);s+=this.tablerow({text:t})}return s&&(s=`<tbody>${s}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+s+`</table>
`}tablerow({text:n}){return`<tr>
${n}</tr>
`}tablecell(n){let e=this.parser.parseInline(n.tokens),t=n.header?"th":"td";return(n.align?`<${t} align="${n.align}">`:`<${t}>`)+e+`</${t}>
`}strong({tokens:n}){return`<strong>${this.parser.parseInline(n)}</strong>`}em({tokens:n}){return`<em>${this.parser.parseInline(n)}</em>`}codespan({text:n}){return`<code>${w(n,!0)}</code>`}br(n){return"<br>"}del({tokens:n}){return`<del>${this.parser.parseInline(n)}</del>`}link({href:n,title:e,tokens:t}){let s=this.parser.parseInline(t),r=X(n);if(r===null)return s;n=r;let i='<a href="'+n+'"';return e&&(i+=' title="'+w(e)+'"'),i+=">"+s+"</a>",i}image({href:n,title:e,text:t,tokens:s}){s&&(t=this.parser.parseInline(s,this.parser.textRenderer));let r=X(n);if(r===null)return w(t);n=r;let i=`<img src="${n}" alt="${t}"`;return e&&(i+=` title="${w(e)}"`),i+=">",i}text(n){return"tokens"in n&&n.tokens?this.parser.parseInline(n.tokens):"escaped"in n&&n.escaped?n.text:w(n.text)}},$=class{strong({text:n}){return n}em({text:n}){return n}codespan({text:n}){return n}del({text:n}){return n}html({text:n}){return n}text({text:n}){return n}link({text:n}){return""+n}image({text:n}){return""+n}br(){return""}checkbox({raw:n}){return n}},b=class ot{options;renderer;textRenderer;constructor(e){this.options=e||T,this.options.renderer=this.options.renderer||new P,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new $}static parse(e,t){return new ot(t).parse(e)}static parseInline(e,t){return new ot(t).parseInline(e)}parse(e){let t="";for(let s=0;s<e.length;s++){let r=e[s];if(this.options.extensions?.renderers?.[r.type]){let a=r,l=this.options.extensions.renderers[a.type].call({parser:this},a);if(l!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(a.type)){t+=l||"";continue}}let i=r;switch(i.type){case"space":{t+=this.renderer.space(i);break}case"hr":{t+=this.renderer.hr(i);break}case"heading":{t+=this.renderer.heading(i);break}case"code":{t+=this.renderer.code(i);break}case"table":{t+=this.renderer.table(i);break}case"blockquote":{t+=this.renderer.blockquote(i);break}case"list":{t+=this.renderer.list(i);break}case"checkbox":{t+=this.renderer.checkbox(i);break}case"html":{t+=this.renderer.html(i);break}case"def":{t+=this.renderer.def(i);break}case"paragraph":{t+=this.renderer.paragraph(i);break}case"text":{t+=this.renderer.text(i);break}default:{let a='Token with "'+i.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return t}parseInline(e,t=this.renderer){let s="";for(let r=0;r<e.length;r++){let i=e[r];if(this.options.extensions?.renderers?.[i.type]){let l=this.options.extensions.renderers[i.type].call({parser:this},i);if(l!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(i.type)){s+=l||"";continue}}let a=i;switch(a.type){case"escape":{s+=t.text(a);break}case"html":{s+=t.html(a);break}case"link":{s+=t.link(a);break}case"image":{s+=t.image(a);break}case"checkbox":{s+=t.checkbox(a);break}case"strong":{s+=t.strong(a);break}case"em":{s+=t.em(a);break}case"codespan":{s+=t.codespan(a);break}case"br":{s+=t.br(a);break}case"del":{s+=t.del(a);break}case"text":{s+=t.text(a);break}default:{let l='Token with "'+a.type+'" type was not found.';if(this.options.silent)return console.error(l),"";throw new Error(l)}}}return s}},S=class{options;block;constructor(n){this.options=n||T}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens","emStrongMask"]);static passThroughHooksRespectAsync=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(n){return n}postprocess(n){return n}processAllTokens(n){return n}emStrongMask(n){return n}provideLexer(){return this.block?x.lex:x.lexInline}provideParser(){return this.block?b.parse:b.parseInline}},B=class{defaults=L();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=b;Renderer=P;TextRenderer=$;Lexer=x;Tokenizer=y;Hooks=S;constructor(...n){this.use(...n)}walkTokens(n,e){let t=[];for(let s of n)switch(t=t.concat(e.call(this,s)),s.type){case"table":{let r=s;for(let i of r.header)t=t.concat(this.walkTokens(i.tokens,e));for(let i of r.rows)for(let a of i)t=t.concat(this.walkTokens(a.tokens,e));break}case"list":{let r=s;t=t.concat(this.walkTokens(r.items,e));break}default:{let r=s;this.defaults.extensions?.childTokens?.[r.type]?this.defaults.extensions.childTokens[r.type].forEach(i=>{let a=r[i].flat(1/0);t=t.concat(this.walkTokens(a,e))}):r.tokens&&(t=t.concat(this.walkTokens(r.tokens,e)))}}return t}use(...n){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return n.forEach(t=>{let s={...t};if(s.async=this.defaults.async||s.async||!1,t.extensions&&(t.extensions.forEach(r=>{if(!r.name)throw new Error("extension name required");if("renderer"in r){let i=e.renderers[r.name];i?e.renderers[r.name]=function(...a){let l=r.renderer.apply(this,a);return l===!1&&(l=i.apply(this,a)),l}:e.renderers[r.name]=r.renderer}if("tokenizer"in r){if(!r.level||r.level!=="block"&&r.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let i=e[r.level];i?i.unshift(r.tokenizer):e[r.level]=[r.tokenizer],r.start&&(r.level==="block"?e.startBlock?e.startBlock.push(r.start):e.startBlock=[r.start]:r.level==="inline"&&(e.startInline?e.startInline.push(r.start):e.startInline=[r.start]))}"childTokens"in r&&r.childTokens&&(e.childTokens[r.name]=r.childTokens)}),s.extensions=e),t.renderer){let r=this.defaults.renderer||new P(this.defaults);for(let i in t.renderer){if(!(i in r))throw new Error(`renderer '${i}' does not exist`);if(["options","parser"].includes(i))continue;let a=i,l=t.renderer[a],o=r[a];r[a]=(...h)=>{let u=l.apply(r,h);return u===!1&&(u=o.apply(r,h)),u||""}}s.renderer=r}if(t.tokenizer){let r=this.defaults.tokenizer||new y(this.defaults);for(let i in t.tokenizer){if(!(i in r))throw new Error(`tokenizer '${i}' does not exist`);if(["options","rules","lexer"].includes(i))continue;let a=i,l=t.tokenizer[a],o=r[a];r[a]=(...h)=>{let u=l.apply(r,h);return u===!1&&(u=o.apply(r,h)),u}}s.tokenizer=r}if(t.hooks){let r=this.defaults.hooks||new S;for(let i in t.hooks){if(!(i in r))throw new Error(`hook '${i}' does not exist`);if(["options","block"].includes(i))continue;let a=i,l=t.hooks[a],o=r[a];S.passThroughHooks.has(i)?r[a]=h=>{if(this.defaults.async&&S.passThroughHooksRespectAsync.has(i))return(async()=>{let A=await l.call(r,h);return o.call(r,A)})();let u=l.call(r,h);return o.call(r,u)}:r[a]=(...h)=>{if(this.defaults.async)return(async()=>{let A=await l.apply(r,h);return A===!1&&(A=await o.apply(r,h)),A})();let u=l.apply(r,h);return u===!1&&(u=o.apply(r,h)),u}}s.hooks=r}if(t.walkTokens){let r=this.defaults.walkTokens,i=t.walkTokens;s.walkTokens=function(a){let l=[];return l.push(i.call(this,a)),r&&(l=l.concat(r.call(this,a))),l}}this.defaults={...this.defaults,...s}}),this}setOptions(n){return this.defaults={...this.defaults,...n},this}lexer(n,e){return x.lex(n,e??this.defaults)}parser(n,e){return b.parse(n,e??this.defaults)}parseMarkdown(n){return(e,t)=>{let s={...t},r={...this.defaults,...s},i=this.onError(!!r.silent,!!r.async);if(this.defaults.async===!0&&s.async===!1)return i(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return i(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return i(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));if(r.hooks&&(r.hooks.options=r,r.hooks.block=n),r.async)return(async()=>{let a=r.hooks?await r.hooks.preprocess(e):e,l=await(r.hooks?await r.hooks.provideLexer():n?x.lex:x.lexInline)(a,r),o=r.hooks?await r.hooks.processAllTokens(l):l;r.walkTokens&&await Promise.all(this.walkTokens(o,r.walkTokens));let h=await(r.hooks?await r.hooks.provideParser():n?b.parse:b.parseInline)(o,r);return r.hooks?await r.hooks.postprocess(h):h})().catch(i);try{r.hooks&&(e=r.hooks.preprocess(e));let a=(r.hooks?r.hooks.provideLexer():n?x.lex:x.lexInline)(e,r);r.hooks&&(a=r.hooks.processAllTokens(a)),r.walkTokens&&this.walkTokens(a,r.walkTokens);let l=(r.hooks?r.hooks.provideParser():n?b.parse:b.parseInline)(a,r);return r.hooks&&(l=r.hooks.postprocess(l)),l}catch(a){return i(a)}}}onError(n,e){return t=>{if(t.message+=`
Please report this to https://github.com/markedjs/marked.`,n){let s="<p>An error occurred:</p><pre>"+w(t.message+"",!0)+"</pre>";return e?Promise.resolve(s):s}if(e)return Promise.reject(t);throw t}}},_=new B;function d(n,e){return _.parse(n,e)}d.options=d.setOptions=function(n){return _.setOptions(n),d.defaults=_.defaults,Z(d.defaults),d};d.getDefaults=L;d.defaults=T;d.use=function(...n){return _.use(...n),d.defaults=_.defaults,Z(d.defaults),d};d.walkTokens=function(n,e){return _.walkTokens(n,e)};d.parseInline=_.parseInline;d.Parser=b;d.parser=b.parse;d.Renderer=P;d.TextRenderer=$;d.Lexer=x;d.lexer=x.lex;d.Tokenizer=y;d.Hooks=S;d.parse=d;d.options;d.setOptions;d.use;d.walkTokens;d.parseInline;b.parse;x.lex;class DocsManager{docsListContainer;docsModal;docsContent;docsTitle;closeModalBtn;currentLanguage="zh";constructor(){this.docsListContainer=document.getElementById("docsList"),this.docsModal=document.getElementById("docsModal"),this.docsContent=document.getElementById("docsContent"),this.docsTitle=document.getElementById("docsTitle"),this.closeModalBtn=document.querySelector(".close-docs-modal")}init(){this.setupEventListeners(),this.loadDocsList()}setupEventListeners(){this.closeModalBtn&&this.closeModalBtn.addEventListener("click",()=>this.closeModal()),window.addEventListener("click",e=>{e.target===this.docsModal&&this.closeModal()}),window.addEventListener("keydown",e=>{e.key==="Escape"&&this.docsModal&&this.docsModal.style.display==="block"&&this.closeModal()})}async loadDocsList(){if(!this.docsListContainer)return;const e="/data/adb/modules/Mediatek_Mali_GPU_Governor/docs",{errno:t,stdout:s}=await exec(`ls "${e}"/*.md`);if(this.docsListContainer.innerHTML="",t===0&&s.trim())s.trim().split(`
`).forEach(i=>{const a=i.trim().split("/").pop();if(!a)return;const l=a.replace(".md","").replace(/_/g," "),o=document.createElement("button");o.className="settings-tab-btn",o.style.width="100%",o.style.padding="10px 15px",o.style.boxSizing="border-box";const h=document.createElement("span");h.className="tab-icon",h.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2Z"></path></svg>';const u=document.createElement("span");u.className="tab-text",u.textContent=l,o.appendChild(h),o.appendChild(u),o.onclick=()=>this.openDoc(i.trim(),l),this.docsListContainer?.appendChild(o)});else{const r=document.createElement("span");r.className="loading-text",r.setAttribute("data-i18n","settings_docs_empty"),r.textContent=getTranslation("settings_docs_empty",{},this.currentLanguage),this.docsListContainer.appendChild(r)}}async openDoc(e,t){if(!this.docsModal||!this.docsContent)return;const{errno:s,stdout:r}=await exec(`cat "${e}"`);s===0?(this.docsContent.innerHTML=await d.parse(r),this.docsTitle&&(this.docsTitle.textContent=t),this.docsModal.style.display="block"):toast(getTranslation("docs_load_fail",{},this.currentLanguage))}closeModal(){this.docsModal&&(this.docsModal.style.display="none")}setLanguage(e){if(this.currentLanguage=e,this.docsListContainer?.querySelector("[data-i18n='settings_docs_empty']")){const t=this.docsListContainer.querySelector("[data-i18n='settings_docs_empty']");t&&(t.textContent=getTranslation("settings_docs_empty",{},this.currentLanguage))}this.docsTitle?.getAttribute("data-i18n")&&(this.docsTitle.textContent=getTranslation("docs_modal_title",{},this.currentLanguage))}}function getPackagesInfo(n){return new Promise((e,t)=>{if(!n)return e([]);if(typeof globalThis.ksu?.getPackagesInfo!="function")return t(new Error("ksu.getPackagesInfo is not available."));const s=Array.isArray(n)?n:[n];if(s.length===0)return e([]);try{const r=ksu.getPackagesInfo(JSON.stringify(s)),i=JSON.parse(r);!Array.isArray(n)&&i.length===1?e(i[0]):e(i)}catch(r){t(new Error(`Failed to get package info: ${r.message}`))}})}const appNameCache=new Map;function isValidAppName(n){if(!n)return!1;const e=n.trim();return e.length>0&&e.toLowerCase()!=="null"}function getAppNameFromPackage(n){const e=n.split("."),t=e[e.length-1];return t.replace(/app$/i,"").replace(/client$/i,"").replace(/mobile$/i,"").replace(/([A-Z])/g," $1").trim().split(" ").map(r=>r.charAt(0).toUpperCase()+r.slice(1).toLowerCase()).join(" ")||t.charAt(0).toUpperCase()+t.slice(1)}function createIconImage(n,e){const t=document.createElement("img");return t.className="game-icon-loaded",t.src=`data:image/png;base64,${e}`,t.alt=n,t}function applyIconTransition(n,e,t){n.onload=()=>{t.style.opacity="0",t.style.transition="opacity 0.3s ease",setTimeout(()=>{e.innerHTML="",n.style.opacity="0",e.appendChild(n),requestAnimationFrame(()=>{n.style.transition="opacity 0.3s ease",n.style.opacity="1"})},300)}}async function loadWrapInputStream(){if(typeof window.wrapInputStream>"u")try{const t=await new Function("url","return import(url)")("https://mui.kernelsu.org/internal/assets/ext/wrapInputStream.mjs");window.wrapInputStream=t.wrapInputStream}catch{}}function arrayBufferToBase64(n){const e=new Uint8Array(n);let t="";for(const s of e)t+=String.fromCharCode(s);return btoa(t)}async function fetchAppName(n){if(appNameCache.has(n))return appNameCache.get(n)??"";try{const e=globalThis;if(typeof e.ksu?.getPackagesInfo=="function")try{const s=await e.ksu.getPackagesInfo(n);if(isValidAppName(s.appLabel))return appNameCache.set(n,s.appLabel),s.appLabel}catch{}try{const s=await getPackagesInfo(n);if(isValidAppName(s.appLabel))return appNameCache.set(n,s.appLabel),s.appLabel}catch{}if(typeof window.$packageManager<"u")try{const r=window.$packageManager.getApplicationInfo(n,0,0)?.getLabel?.();if(isValidAppName(r))return appNameCache.set(n,r),r}catch{}const t=getAppNameFromPackage(n);return appNameCache.set(n,t),t}catch{const t=getAppNameFromPackage(n);return appNameCache.set(n,t),t}}async function loadAppIcon(n,e,t){try{if(typeof globalThis.ksu?.getPackagesInfo=="function"){const r=document.createElement("img");r.className="game-icon-loaded",r.alt=n,r.onload=()=>{t.style.display="none",r.style.opacity="1",e.innerHTML="",e.appendChild(r)},r.src=`ksu://icon/${n}`;return}if(typeof window.$packageManager<"u")try{const r=window.$packageManager.getApplicationIcon(n,0,0);if(r){await loadWrapInputStream();const i=window.wrapInputStream;if(i){const l=await(await i(r)).arrayBuffer(),o=arrayBufferToBase64(l),h=createIconImage(n,o);applyIconTransition(h,e,t);return}}}catch{}}catch{}}const AppInfoService={fetchAppName,getAppNameFromPackage,loadAppIcon};class GameModal{editGameModal;closeGameModalBtn;packageNameInput;gameModeSelect;saveGameBtn;cancelGameBtn;gameModeContainer;selectedGameMode;gameModeOptions;constructor(){this.editGameModal=document.getElementById("editGameModal"),this.closeGameModalBtn=document.querySelector(".close-game-modal"),this.packageNameInput=document.getElementById("packageNameInput"),this.gameModeSelect=document.getElementById("gameModeSelect"),this.saveGameBtn=document.getElementById("saveGameBtn"),this.cancelGameBtn=document.getElementById("cancelGameBtn"),this.gameModeContainer=document.getElementById("gameModeContainer"),this.selectedGameMode=document.getElementById("selectedGameMode"),this.gameModeOptions=document.getElementById("gameModeOptions")}init(e,t){this.closeGameModalBtn&&this.closeGameModalBtn.addEventListener("click",t),this.cancelGameBtn&&this.cancelGameBtn.addEventListener("click",t),this.saveGameBtn&&this.saveGameBtn.addEventListener("click",e),window.addEventListener("click",s=>{s.target===this.editGameModal&&t()}),window.addEventListener("keydown",s=>{s.key==="Escape"&&this.editGameModal&&this.editGameModal.style.display==="block"&&t()}),this.initGameModeSelect()}initGameModeSelect(){if(!this.gameModeContainer||!this.selectedGameMode||!this.gameModeOptions)return;this.selectedGameMode.addEventListener("click",t=>{t.stopPropagation(),this.gameModeContainer?.classList.toggle("open")});const e=this.gameModeOptions.querySelectorAll(".option");e.forEach(t=>{t.addEventListener("click",s=>{s.stopPropagation();const r=t.getAttribute("data-value"),i=t.textContent;this.selectedGameMode&&(this.selectedGameMode.textContent=i),this.gameModeSelect&&r&&(this.gameModeSelect.value=r,this.gameModeSelect.dispatchEvent(new Event("change"))),e.forEach(a=>{a.classList.remove("selected")}),t.classList.add("selected"),this.gameModeContainer?.classList.remove("open")})}),document.addEventListener("click",t=>{this.gameModeContainer?.contains(t.target)||this.gameModeContainer?.classList.remove("open")})}openForAdd(){this.packageNameInput&&(this.packageNameInput.value=""),this.gameModeSelect&&(this.gameModeSelect.value="balance"),this.updateGameModeSelectDisplay("balance"),this.editGameModal&&(this.editGameModal.style.display="block")}openForEdit(e,t){this.packageNameInput&&(this.packageNameInput.value=e),this.gameModeSelect&&(this.gameModeSelect.value=t),this.updateGameModeSelectDisplay(t),this.editGameModal&&(this.editGameModal.style.display="block")}close(){this.editGameModal&&(this.editGameModal.style.display="none")}getPackageName(){return this.packageNameInput?.value.trim()||""}getGameMode(){return this.gameModeSelect?.value||"balance"}updateGameModeSelectDisplay(e){if(!this.selectedGameMode||!this.gameModeOptions)return;const t=this.gameModeOptions.querySelector(`.option[data-value="${e}"]`);t&&(this.selectedGameMode.textContent=t.textContent,this.gameModeOptions.querySelectorAll(".option").forEach(r=>{r.classList.remove("selected")}),t.classList.add("selected"))}setLanguage(e){if(this.gameModeSelect){const t=this.gameModeSelect.options;for(let s=0;s<t.length;s++){const r=t[s],a=`status_mode_${r.value}`;translations[e]?.[a]&&(r.textContent=translations[e][a])}}if(this.gameModeOptions&&this.gameModeOptions.querySelectorAll(".option").forEach(s=>{const i=`status_mode_${s.getAttribute("data-value")}`;translations[e]?.[i]&&(s.textContent=translations[e][i])}),this.selectedGameMode&&this.gameModeSelect){const s=`status_mode_${this.gameModeSelect.value}`;translations[e]?.[s]&&(this.selectedGameMode.textContent=translations[e][s])}}}function parseTomlGames(n){try{const e=tomlExports.parse(n);return e.games&&Array.isArray(e.games)?e.games.map(t=>({package:t.package||"",mode:t.mode||"balance"})):[]}catch{return[]}}function serializeTomlGames(n){const e=`# GPU调速器游戏列表配置文件

`,t={games:n.map(s=>({package:s.package,mode:s.mode||"balance"}))};return e+tomlExports.stringify(t)}const GameParser={parseTomlGames,serializeTomlGames};class GameRenderer{currentLanguage;onEdit;onDelete;constructor(e,t,s){this.currentLanguage=e,this.onEdit=t,this.onDelete=s}setLanguage(e){this.currentLanguage=e}renderGamesList(e,t){if(e.innerHTML="",t.length===0){e.innerHTML=`<div class="loading-text">${getTranslation("config_games_not_found",{},this.currentLanguage)}</div>`;return}t.forEach((s,r)=>{const i=this.createGameCard(s,r);e.appendChild(i)})}createGameCard(e,t){const s=document.createElement("div");s.className="game-card",s.style.animationDelay=`${Math.min(t*.05,.5)}s`;const r=this.createGameHeader(e),i=this.createGameDetails(e,t);return s.appendChild(r),s.appendChild(i),s}createGameHeader(e){const t=document.createElement("div");t.className="game-header";const s=this.createIconContainer(e),r=this.createGameNameContainer(e);return t.appendChild(s),t.appendChild(r),t}createIconContainer(e){const t=document.createElement("div");t.className="game-icon-container";const r=(e.name||AppInfoService.getAppNameFromPackage(e.package||"")).charAt(0).toUpperCase(),i=(e.package||"").split("").reduce((o,h)=>h.charCodeAt(0)+((o<<5)-o),0),a=Math.abs(i)%360,l=document.createElement("div");return l.className="game-icon-placeholder",l.textContent=r,l.style.background=`linear-gradient(135deg, hsl(${a}, 65%, 55%), hsl(${a+20}, 65%, 45%))`,t.appendChild(l),e.package&&AppInfoService.loadAppIcon(e.package,t,l),t}createGameNameContainer(e){const t=document.createElement("div");t.className="game-name-container";const s=e.name||AppInfoService.getAppNameFromPackage(e.package||""),r=document.createElement("h4");r.className="game-name",r.textContent=s,r.title=s;const i=document.createElement("span");return i.className="game-package",i.textContent=e.package||"",i.title=e.package||"",t.appendChild(r),t.appendChild(i),t}createGameDetails(e,t){const s=document.createElement("div");s.className="game-details";const r=this.getModeText(e.mode||"balance"),i=document.createElement("span");i.className=`game-mode-badge mode-${e.mode||"balance"}`,i.textContent=r,s.appendChild(i);const a=this.createActionButtons(t);return s.appendChild(a),s}createActionButtons(e){const t=document.createElement("div");t.className="game-actions";const s=document.createElement("button");s.className="game-edit-btn",s.innerHTML='<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>',s.title="编辑",s.onclick=i=>{i.stopPropagation(),this.onEdit(e)};const r=document.createElement("button");return r.className="game-delete-btn",r.innerHTML='<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"></path><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>',r.title="删除",r.onclick=i=>{i.stopPropagation(),this.onDelete(e)},t.appendChild(s),t.appendChild(r),t}getModeText(e){const t={zh:{powersave:"省电",balance:"均衡",performance:"性能",fast:"极速"},en:{powersave:"Powersave",balance:"Balance",performance:"Performance",fast:"Fast"}};return t[this.currentLanguage][e]||t[this.currentLanguage].balance}}class GamesManager{gamesListData=[];currentLanguage="zh";gamesList;addGameBtn;saveGamesBtn;gamesSearchInput;editingIndex=-1;renderer;modal;constructor(){this.gamesList=document.getElementById("gamesList"),this.addGameBtn=document.getElementById("addGameBtn"),this.saveGamesBtn=document.getElementById("saveGamesBtn"),this.gamesSearchInput=document.getElementById("gamesSearchInput"),this.renderer=new GameRenderer(this.currentLanguage,e=>this.editGameItem(e),e=>this.deleteGameItem(e)),this.modal=new GameModal}init(){this.setupEventListeners(),this.modal.init(()=>this.saveGameItem(),()=>this.closeGameModal()),this.gamesSearchInput&&(this.gamesSearchInput.placeholder=getTranslation("config_games_search_placeholder",{},this.currentLanguage))}setupEventListeners(){this.addGameBtn&&this.addGameBtn.addEventListener("click",()=>this.openGameModal()),this.saveGamesBtn&&this.saveGamesBtn.addEventListener("click",()=>this.saveGamesToFile()),this.gamesSearchInput&&this.gamesSearchInput.addEventListener("input",e=>{const t=e.target.value.toLowerCase();this.filterGamesList(t)})}filterGamesList(e){document.querySelectorAll(".game-card").forEach(s=>{const r=s.querySelector(".game-name")?.textContent?.toLowerCase()||"",i=s.querySelector(".game-package")?.textContent?.toLowerCase()||"";r.includes(e)||i.includes(e)?s.style.display="flex":s.style.display="none"})}async loadGamesList(){this.gamesList&&(this.gamesList.innerHTML=`<div class="loading-text">${getTranslation("status_loading",{},this.currentLanguage)}</div>`);const{errno:e,stdout:t}=await exec(`cat ${PATHS.GAMES_FILE}`);if(e===0&&t.trim()){const s=GameParser.parseTomlGames(t.trim());s.length===0&&t.trim().length>0&&toast(getTranslation("toast_games_parse_error",{},this.currentLanguage)),this.gamesListData=s,s.length>0?(this.refreshGamesList(),this.loadAppNamesAsync()):this.gamesList&&(this.gamesList.innerHTML=`<div class="loading-text">${getTranslation("config_games_not_found",{},this.currentLanguage)}</div>`)}else this.gamesList&&(this.gamesList.innerHTML=`<div class="loading-text">${getTranslation("config_games_list_not_found",{},this.currentLanguage)}</div>`)}async loadAppNamesAsync(){const e=this.gamesListData.filter(t=>t.package&&!t.name).map(async t=>{if(t.package){const s=await AppInfoService.fetchAppName(t.package);t.name=s,"package"in t&&t.package&&this.updateGameCardName(t)}});await Promise.all(e)}updateGameCardName(e){if(!this.gamesList)return;this.gamesList.querySelectorAll(".game-card").forEach(s=>{if(s.querySelector(".game-package")?.textContent===e.package){const i=s.querySelector(".game-name");i&&e.name&&(i.textContent=e.name,i.setAttribute("title",e.name))}})}refreshGamesList(){this.gamesList&&this.renderer.renderGamesList(this.gamesList,this.gamesListData)}openGameModal(){this.modal.openForAdd(),this.editingIndex=-1}editGameItem(e){if(e<0||e>=this.gamesListData.length)return;const t=this.gamesListData[e];this.modal.openForEdit(t.package||"",t.mode||"balance"),this.editingIndex=e}closeGameModal(){this.modal.close(),this.editingIndex=-1}saveGameItem(){const e=this.modal.getPackageName(),t=this.modal.getGameMode();if(!e){toast(getTranslation("toast_game_invalid",{},this.currentLanguage));return}if(this.editingIndex===-1){if(this.gamesListData.some(s=>s.package===e)){toast(getTranslation("toast_game_exists",{},this.currentLanguage));return}this.gamesListData.push({package:e,mode:t})}else this.gamesListData[this.editingIndex].package=e,this.gamesListData[this.editingIndex].mode=t;this.closeGameModal(),this.refreshGamesList(),this.editingIndex===-1&&toast(getTranslation("toast_game_added",{},this.currentLanguage))}deleteGameItem(e){e>=0&&e<this.gamesListData.length?(this.gamesListData.splice(e,1),this.refreshGamesList(),toast(getTranslation("toast_game_deleted",{},this.currentLanguage))):toast(getTranslation("toast_index_invalid",{},this.currentLanguage))}async saveGamesToFile(){if(this.gamesListData.length===0){toast(getTranslation("toast_games_empty",{},this.currentLanguage));return}const e=GameParser.serializeTomlGames(this.gamesListData),t=btoa(unescape(encodeURIComponent(e)));(await exec(`echo '${t}' | base64 -d > ${PATHS.GAMES_FILE}`)).errno===0?toast(getTranslation("toast_games_saved",{},this.currentLanguage)):toast(getTranslation("toast_games_save_fail",{},this.currentLanguage))}setLanguage(e){this.currentLanguage=e,this.gamesSearchInput&&(this.gamesSearchInput.placeholder=getTranslation("config_games_search_placeholder",{},this.currentLanguage)),this.renderer.setLanguage(e),this.modal.setLanguage(e),this.refreshGamesList()}}class LogManager{currentLanguage="zh";logContent;refreshLogBtn;logLevelContainer;constructor(){this.logContent=document.getElementById("logContent"),this.refreshLogBtn=document.getElementById("refreshLogBtn"),this.logLevelContainer=document.getElementById("logLevelContainer")}init(){this.setupEventListeners(),this.initLogFileSelect(),this.loadLogLevel()}setupEventListeners(){this.refreshLogBtn&&this.refreshLogBtn.addEventListener("click",()=>this.loadLog());const e=document.querySelectorAll(".log-tab-btn");if(e.forEach(t=>{t.addEventListener("click",()=>{t.classList.contains("active")||(e.forEach(s=>{s.classList.remove("active")}),t.classList.add("active"),this.logContent&&(this.logContent.style.opacity="0.5",this.logContent.textContent=getTranslation("log_loading",{},this.currentLanguage)),setTimeout(()=>{this.loadLog().then(()=>{this.logContent&&(this.logContent.style.opacity="1")})},100))})}),this.logLevelContainer){const t=this.logLevelContainer.querySelectorAll(".settings-tab-btn");t.forEach(s=>{s.addEventListener("click",r=>{r.preventDefault(),t.forEach(i=>{i.classList.remove("active")}),s.classList.add("active"),this.saveLogLevel()})})}}initLogFileSelect(){const e=document.querySelector(".log-tab-btn.active"),t=e?e.getAttribute("data-log"):"gpu_gov.log";document.querySelectorAll(".log-tab-btn").forEach(r=>{r.getAttribute("data-log")===t?r.classList.add("active"):r.classList.remove("active")})}async loadLog(){const e=document.querySelector(".log-tab-btn.active"),t=e?e.getAttribute("data-log"):"gpu_gov.log";this.logContent&&(this.logContent.textContent=getTranslation("log_loading",{},this.currentLanguage));const{errno:s,stdout:r}=await exec(`cat ${PATHS.LOG_PATH}/${t} 2>/dev/null || echo "日志文件不存在"`);if(r.trim()==="日志文件不存在"){this.logContent&&(this.logContent.textContent=getTranslation("log_not_found",{},this.currentLanguage));return}if(s===0){const a=r.trim().split(`
`).slice(-100).join(`
`);this.logContent&&(this.logContent.textContent=a||getTranslation("log_empty",{},this.currentLanguage)),this.logContent&&(this.logContent.scrollTop=this.logContent.scrollHeight)}else this.logContent&&(this.logContent.textContent=getTranslation("log_not_found",{},this.currentLanguage))}async loadLogLevel(){const{errno:e,stdout:t}=await exec(`cat ${PATHS.LOG_LEVEL_PATH} 2>/dev/null || echo "info"`);let s="info";if(e===0){const r=t.trim().toLowerCase();["debug","info","warn","error"].includes(r)&&(s=r)}this.logLevelContainer&&this.logLevelContainer.querySelectorAll(".settings-tab-btn").forEach(i=>{i.getAttribute("data-value")===s?i.classList.add("active"):i.classList.remove("active")})}async saveLogLevel(){if(!this.logLevelContainer)return;const e=this.logLevelContainer.querySelector(".settings-tab-btn.active");if(!e)return;const t=e.getAttribute("data-value"),{errno:s}=await exec(`echo "${t}" > ${PATHS.LOG_LEVEL_PATH}`);toast(s===0?t==="debug"?getTranslation("toast_log_level_debug",{},this.currentLanguage):getTranslation("toast_log_level_set",{level:t||""},this.currentLanguage):getTranslation("toast_log_level_fail",{},this.currentLanguage))}setLanguage(e){this.currentLanguage=e}}class SettingsManager{currentLanguage="zh";languageContainer;constructor(){this.languageContainer=document.getElementById("languageContainer")}init(){this.setupEventListeners()}setupEventListeners(){if(this.languageContainer){const e=this.languageContainer.querySelectorAll(".settings-tab-btn");e.forEach(t=>{t.addEventListener("click",async s=>{s.preventDefault(),e.forEach(l=>{l.classList.remove("active")}),t.classList.add("active");const r=t.getAttribute("data-value");localStorage.setItem("languageSetting",r);let i="zh";if(r==="system"){const{errno:l,stdout:o}=await exec('getprop persist.sys.locale || getprop ro.product.locale || echo "zh-CN"');l===0&&o.trim()&&(i=o.trim().toLowerCase().startsWith("en")?"en":"zh"),localStorage.setItem("language",i),toast(getTranslation("toast_language_follow_system",{},i))}else i=r,localStorage.setItem("language",r),toast(getTranslation("toast_language_changed",{language:r==="zh"?"中文":"English"},i));this.currentLanguage=i;const a=new CustomEvent("languageChange",{detail:{language:i}});document.dispatchEvent(a)})})}}setLanguage(e){this.currentLanguage=e}}class ThemeManager{themeToggle;followSystemThemeToggle;followSystemThemeSuperSwitch;currentLanguage="zh";constructor(){this.themeToggle=document.getElementById("themeToggle"),this.followSystemThemeToggle=document.querySelector("#followSystemThemeToggle .miuix-switch-input"),this.followSystemThemeSuperSwitch=document.getElementById("followSystemThemeSuperSwitch")}init(){this.initTheme(),this.setupEventListeners()}initTheme(){const e=localStorage.getItem("theme"),t=window.matchMedia?.("(prefers-color-scheme: dark)").matches,s=localStorage.getItem("followSystemTheme"),r=s===null?!0:s==="true";this.followSystemThemeToggle&&(this.followSystemThemeToggle.checked=r),s===null&&localStorage.setItem("followSystemTheme","true");let i;if(r?i=t?"dark":"light":e?i=e:i=t?"dark":"light",document.documentElement.setAttribute("data-theme",i),localStorage.setItem("theme",i),window.matchMedia){const a=window.matchMedia("(prefers-color-scheme: dark)");a.addEventListener&&a.addEventListener("change",l=>{if(localStorage.getItem("followSystemTheme")==="true"){const o=l.matches?"dark":"light";document.documentElement.setAttribute("data-theme",o),localStorage.setItem("theme",o)}})}}setupEventListeners(){this.themeToggle&&this.themeToggle.addEventListener("click",()=>this.toggleTheme()),this.followSystemThemeSuperSwitch&&(this.followSystemThemeSuperSwitch.addEventListener("click",e=>this.handleFollowSystemToggleClick(e)),this.followSystemThemeSuperSwitch.addEventListener("keydown",e=>{(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),e.currentTarget.click())}),this.followSystemThemeSuperSwitch.setAttribute("tabindex","0"),this.followSystemThemeSuperSwitch.setAttribute("role","switch"),this.followSystemThemeSuperSwitch.setAttribute("aria-checked",this.followSystemThemeToggle?.checked?"true":"false")),this.followSystemThemeToggle&&this.followSystemThemeToggle.addEventListener("change",()=>this.handleFollowSystemChange())}toggleTheme(){this.themeToggle&&this.themeToggle.classList.add("switching"),localStorage.getItem("followSystemTheme")==="true"&&(localStorage.setItem("followSystemTheme","false"),this.followSystemThemeToggle&&(this.followSystemThemeToggle.checked=!1),toast(getTranslation("toast_theme_follow_disabled",{},this.currentLanguage)));const t=document.documentElement.getAttribute("data-theme")==="light"?"dark":"light";document.documentElement.style.transition="background-color 0.3s ease, color 0.3s ease",document.documentElement.setAttribute("data-theme",t),localStorage.setItem("theme",t),setTimeout(()=>{this.themeToggle&&this.themeToggle.classList.remove("switching"),document.documentElement.style.transition=""},600),toast(getTranslation(t==="dark"?"toast_theme_switched_dark":"toast_theme_switched_light",{},this.currentLanguage))}handleFollowSystemToggleClick(e){e.target!==this.followSystemThemeToggle&&(e.preventDefault(),navigator.vibrate&&navigator.vibrate(50),this.followSystemThemeToggle&&(this.followSystemThemeToggle.checked=!this.followSystemThemeToggle.checked,this.followSystemThemeToggle.dispatchEvent(new Event("change",{bubbles:!0}))))}handleFollowSystemChange(){const e=!!this.followSystemThemeToggle?.checked;if(localStorage.setItem("followSystemTheme",e.toString()),this.followSystemThemeSuperSwitch&&this.followSystemThemeSuperSwitch.setAttribute("aria-checked",e?"true":"false"),this.followSystemThemeSuperSwitch&&(this.followSystemThemeSuperSwitch.style.transform="scale(0.98)",setTimeout(()=>{this.followSystemThemeSuperSwitch&&(this.followSystemThemeSuperSwitch.style.transform="")},150)),e){const t=window.matchMedia?.("(prefers-color-scheme: dark)").matches?"dark":"light";document.documentElement.setAttribute("data-theme",t),localStorage.setItem("theme",t),toast(getTranslation("toast_theme_follow_enabled",{},this.currentLanguage))}else toast(getTranslation("toast_theme_follow_keep",{},this.currentLanguage))}setLanguage(e){this.currentLanguage=e}}class MainApp{currentLanguage="zh";currentPage="page-status";statusPageLoaded=!1;configPageLoaded=!1;logPageLoaded=!1;settingsPageLoaded=!1;statusCache={mode:{value:"unknown",timestamp:0,ttl:2e3},running:{value:!1,timestamp:0,ttl:2e3},version:{value:"",timestamp:0,ttl:6e4}};isRefreshing=!1;app;loading;htmlRoot;moduleVersion;currentMode;runningStatus;pages;navItems;languageContainer;themeManager;configManager;gamesManager;logManager;settingsManager;docsManager;constructor(){this.app=document.getElementById("app"),this.loading=document.getElementById("loading"),this.htmlRoot=document.getElementById("htmlRoot"),this.moduleVersion=document.getElementById("moduleVersion"),this.currentMode=document.getElementById("currentMode"),this.runningStatus=document.getElementById("runningStatus"),this.pages=document.querySelectorAll(".page"),this.navItems=document.querySelectorAll(".nav-item"),this.languageContainer=document.getElementById("languageContainer"),this.themeManager=new ThemeManager,this.configManager=new ConfigManager,this.gamesManager=new GamesManager,this.logManager=new LogManager,this.settingsManager=new SettingsManager,this.docsManager=new DocsManager}async init(){this.loading&&(this.loading.style.display="none"),this.app&&(this.app.style.display="block"),this.themeManager.init(),this.configManager.init(),this.gamesManager.init(),this.logManager.init(),this.settingsManager.init(),this.docsManager.init(),await this.initLanguage(),this.setupLanguageEvents(),this.setupNavigationEvents(),this.loadData().catch(()=>{}),this.startStatusRefreshLoop(),toast(getTranslation("toast_webui_loaded",{},this.currentLanguage))}async startStatusRefreshLoop(){const e=async()=>{this.statusPageLoaded&&this.currentPage==="page-status"&&await this.refreshStatusIfNeeded(),setTimeout(e,1e3)};e()}async refreshStatusIfNeeded(){if(this.isRefreshing)return;const e=Date.now(),t={mode:e-this.statusCache.mode.timestamp>this.statusCache.mode.ttl,running:e-this.statusCache.running.timestamp>this.statusCache.running.ttl,version:e-this.statusCache.version.timestamp>this.statusCache.version.ttl};if(t.mode||t.running||t.version){this.isRefreshing=!0;try{const s=[];t.mode&&s.push(this.loadCurrentMode()),t.running&&s.push(this.checkModuleStatus()),t.version&&s.push(this.loadModuleVersion()),await Promise.allSettled(s)}finally{this.isRefreshing=!1}}}setupNavigationEvents(){this.navItems.forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-page");t&&this.switchPage(t)})})}setupLanguageEvents(){document.addEventListener("languageChange",e=>{const t=e,{language:s}=t.detail;this.currentLanguage=s,this.themeManager.setLanguage(this.currentLanguage),this.configManager.setLanguage(this.currentLanguage),this.gamesManager.setLanguage(this.currentLanguage),this.logManager.setLanguage(this.currentLanguage),this.settingsManager.setLanguage(this.currentLanguage),this.docsManager.setLanguage(this.currentLanguage),this.applyTranslations(),this.loadModuleVersion(),this.loadCurrentMode(),this.checkModuleStatus()})}async initLanguage(){const e=localStorage.getItem("languageSetting"),t=localStorage.getItem("language");e===null&&localStorage.setItem("languageSetting","system"),e==="system"||e===null?(this.currentLanguage=await this.detectSystemLanguage(),localStorage.setItem("language",this.currentLanguage)):t&&(this.currentLanguage=t),this.themeManager.setLanguage(this.currentLanguage),this.configManager.setLanguage(this.currentLanguage),this.gamesManager.setLanguage(this.currentLanguage),this.logManager.setLanguage(this.currentLanguage),this.settingsManager.setLanguage(this.currentLanguage),this.docsManager.setLanguage(this.currentLanguage),this.applyTranslations(),this.updateSelectedLanguageText(e||"system"),this.setupLanguageEvents()}async detectSystemLanguage(){const e=navigator,t=navigator.language||e.userLanguage||"zh-CN",{errno:s,stdout:r}=await exec('getprop persist.sys.locale || getprop ro.product.locale || echo "zh-CN"');return s===0&&r.trim()?r.trim().toLowerCase().startsWith("en")?"en":"zh":t.startsWith("en")?"en":"zh"}applyTranslations(){document.title=getTranslation("title",{},this.currentLanguage),this.htmlRoot&&this.htmlRoot.setAttribute("lang",this.currentLanguage==="en"?"en":"zh-CN"),this.loading&&(this.loading.textContent=getTranslation("loading",{},this.currentLanguage));const e=document.querySelector(".header-content h1");e&&(e.textContent=getTranslation("header_title",{},this.currentLanguage)),document.querySelectorAll(".nav-item").forEach(t=>{const s=t.getAttribute("data-page"),r=t.querySelector(".nav-text");r&&(s==="page-status"?r.textContent=getTranslation("nav_status",{},this.currentLanguage):s==="page-config"?r.textContent=getTranslation("nav_config",{},this.currentLanguage):s==="page-log"?r.textContent=getTranslation("nav_log",{},this.currentLanguage):s==="page-settings"&&(r.textContent=getTranslation("nav_settings",{},this.currentLanguage)))}),document.querySelectorAll("[data-i18n]").forEach(t=>{const s=t.getAttribute("data-i18n");s&&translations[this.currentLanguage]&&translations[this.currentLanguage][s]&&(t.textContent=getTranslation(s,{},this.currentLanguage))}),document.querySelectorAll("[data-i18n-placeholder]").forEach(t=>{const s=t.getAttribute("data-i18n-placeholder");s&&translations[this.currentLanguage]&&translations[this.currentLanguage][s]&&(t.placeholder=getTranslation(s,{},this.currentLanguage))})}updateSelectedLanguageText(e){if(!this.languageContainer)return;this.languageContainer.querySelectorAll(".settings-tab-btn").forEach(r=>{r.classList.remove("active")});const s=this.languageContainer.querySelector(`.settings-tab-btn[data-value="${e}"]`);if(s)s.classList.add("active");else{const r=this.languageContainer.querySelector('.settings-tab-btn[data-value="system"]');r&&r.classList.add("active")}}async loadData(){this.statusPageLoaded=!0,await Promise.all([this.checkModuleStatus(),this.loadModuleVersion(),this.loadCurrentMode()]).catch(()=>{}),this.switchPage("page-status")}switchPage(e){this.pages.forEach(s=>{s.classList.remove("active")});const t=document.getElementById(e);t&&t.classList.add("active"),this.navItems.forEach(s=>{s.getAttribute("data-page")===e?s.classList.add("active"):s.classList.remove("active")}),this.currentPage=e,this.lazyLoadPageData(e)}async lazyLoadPageData(e){switch(e){case"page-status":this.statusPageLoaded||(this.statusPageLoaded=!0,await Promise.all([this.checkModuleStatus(),this.loadModuleVersion(),this.loadCurrentMode()]).catch(()=>{}));break;case"page-config":this.configPageLoaded||(this.configPageLoaded=!0,await Promise.all([this.configManager.loadAllConfigData(),this.gamesManager.loadGamesList()]).catch(()=>{}));break;case"page-log":this.logPageLoaded||(this.logPageLoaded=!0,this.logManager.loadLog().catch(()=>{}));break;case"page-settings":this.settingsPageLoaded||(this.settingsPageLoaded=!0,this.settingsManager.loadLogLevel().catch(()=>{}));break}}async checkModuleStatus(){try{const{errno:e,stdout:t}=await exec('pgrep -f gpugovernor || echo ""'),s=e===0&&t.trim();this.statusCache.running.value=!!s,this.statusCache.running.timestamp=Date.now();const r=this.runningStatus?.classList.contains("status-running");s!==r&&this.runningStatus&&(this.runningStatus.classList.add("status-changing"),this.runningStatus.removeAttribute("data-i18n"),setTimeout(()=>{s&&this.runningStatus?(this.runningStatus.textContent=getTranslation("status_running_active",{},this.currentLanguage),this.runningStatus.className="status-badge status-running"):this.runningStatus&&(this.runningStatus.textContent=getTranslation("status_running_inactive",{},this.currentLanguage),this.runningStatus.className="status-badge status-stopped"),setTimeout(()=>{this.runningStatus?.classList.remove("status-changing")},600)},100))}catch{}}async loadModuleVersion(){try{const{errno:e,stdout:t}=await exec('grep -i "^version=" /data/adb/modules/Mediatek_Mali_GPU_Governor/module.prop | cut -d= -f2');if(e===0&&t.trim()){this.moduleVersion&&(this.moduleVersion.textContent=t.trim(),this.moduleVersion.removeAttribute("data-i18n"),this.statusCache.version.value=t.trim(),this.statusCache.version.timestamp=Date.now());return}const{errno:s,stdout:r}=await exec('grep -i "^version=" /data/adb/ksu/modules/Mediatek_Mali_GPU_Governor/module.prop | cut -d= -f2');if(s===0&&r.trim()){this.moduleVersion&&(this.moduleVersion.textContent=r.trim(),this.moduleVersion.removeAttribute("data-i18n"),this.statusCache.version.value=r.trim(),this.statusCache.version.timestamp=Date.now());return}this.moduleVersion&&(this.moduleVersion.textContent=this.currentLanguage==="en"?"Unknown":"未知",this.moduleVersion.removeAttribute("data-i18n"),this.statusCache.version.value="unknown",this.statusCache.version.timestamp=Date.now())}catch{}}async loadCurrentMode(){try{const{errno:e,stdout:t}=await exec(`cat ${PATHS.CURRENT_MODE_PATH} 2>/dev/null || echo "unknown"`);let s="unknown";if(e===0&&(s=t.trim().toLowerCase()),["powersave","balance","performance","fast"].includes(s)||(s="unknown"),this.statusCache.mode.value=s,this.statusCache.mode.timestamp=Date.now(),this.currentMode){const i={powersave:getTranslation("status_mode_powersave",{},this.currentLanguage),balance:getTranslation("status_mode_balance",{},this.currentLanguage),performance:getTranslation("status_mode_performance",{},this.currentLanguage),fast:getTranslation("status_mode_fast",{},this.currentLanguage),unknown:getTranslation("status_mode_unknown",{},this.currentLanguage)};this.currentMode.textContent=i[s]||i.unknown,this.currentMode.className=`mode-badge ${s}`,this.currentMode.removeAttribute("data-i18n")}}catch{if(this.statusCache.mode.value!=="unknown"&&this.currentMode){const t=this.statusCache.mode.value,s={powersave:getTranslation("status_mode_powersave",{},this.currentLanguage),balance:getTranslation("status_mode_balance",{},this.currentLanguage),performance:getTranslation("status_mode_performance",{},this.currentLanguage),fast:getTranslation("status_mode_fast",{},this.currentLanguage),unknown:getTranslation("status_mode_unknown",{},this.currentLanguage)};this.currentMode.textContent=s[t]||s.unknown,this.currentMode.className=`mode-badge ${t}`}}}}async function loadComponent(n,e){const t=await fetch(n);if(t.ok){const s=await t.text(),r=document.getElementById(e);r&&(r.innerHTML=s)}}document.addEventListener("DOMContentLoaded",async()=>{await new MainApp().init()});
