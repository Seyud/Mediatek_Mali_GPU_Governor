(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();function U(s,e){let t=s.slice(0,e).split(/\r\n|\n|\r/g);return[t.length,t.pop().length+1]}function W(s,e,t){let a=s.split(/\r\n|\n|\r/g),n="",i=(Math.log10(e+1)|0)+1;for(let o=e-1;o<=e+1;o++){let l=a[o-1];l&&(n+=o.toString().padEnd(i," "),n+=":  ",n+=l,n+=`
`,o===e&&(n+=" ".repeat(i+t+2),n+=`^
`))}return n}class u extends Error{line;column;codeblock;constructor(e,t){const[a,n]=U(t.toml,t.ptr),i=W(t.toml,a,n);super(`Invalid TOML document: ${e}

${i}`,t),this.line=a,this.column=n,this.codeblock=i}}function j(s,e){let t=0;for(;s[e-++t]==="\\";);return--t&&t%2}function M(s,e=0,t=s.length){let a=s.indexOf(`
`,e);return s[a-1]==="\r"&&a--,a<=t?a:-1}function I(s,e){for(let t=e;t<s.length;t++){let a=s[t];if(a===`
`)return t;if(a==="\r"&&s[t+1]===`
`)return t+1;if(a<" "&&a!=="	"||a==="")throw new u("control characters are not allowed in comments",{toml:s,ptr:e})}return s.length}function y(s,e,t,a){let n;for(;(n=s[e])===" "||n==="	"||!t&&(n===`
`||n==="\r"&&s[e+1]===`
`);)e++;return a||n!=="#"?e:y(s,I(s,e),t)}function P(s,e,t,a,n=!1){if(!a)return e=M(s,e),e<0?s.length:e;for(let i=e;i<s.length;i++){let o=s[i];if(o==="#")i=M(s,i);else{if(o===t)return i+1;if(o===a||n&&(o===`
`||o==="\r"&&s[i+1]===`
`))return i}}throw new u("cannot find end of structure",{toml:s,ptr:e})}function O(s,e){let t=s[e],a=t===s[e+1]&&s[e+1]===s[e+2]?s.slice(e,e+3):t;e+=a.length-1;do e=s.indexOf(a,++e);while(e>-1&&t!=="'"&&j(s,e));return e>-1&&(e+=a.length,a.length>1&&(s[e]===t&&e++,s[e]===t&&e++)),e}let K=/^(\d{4}-\d{2}-\d{2})?[T ]?(?:(\d{2}):\d{2}:\d{2}(?:\.\d+)?)?(Z|[-+]\d{2}:\d{2})?$/i;class C extends Date{#t=!1;#a=!1;#e=null;constructor(e){let t=!0,a=!0,n="Z";if(typeof e=="string"){let i=e.match(K);i?(i[1]||(t=!1,e=`0000-01-01T${e}`),a=!!i[2],a&&e[10]===" "&&(e=e.replace(" ","T")),i[2]&&+i[2]>23?e="":(n=i[3]||null,e=e.toUpperCase(),!n&&a&&(e+="Z"))):e=""}super(e),isNaN(this.getTime())||(this.#t=t,this.#a=a,this.#e=n)}isDateTime(){return this.#t&&this.#a}isLocal(){return!this.#t||!this.#a||!this.#e}isDate(){return this.#t&&!this.#a}isTime(){return this.#a&&!this.#t}isValid(){return this.#t||this.#a}toISOString(){let e=super.toISOString();if(this.isDate())return e.slice(0,10);if(this.isTime())return e.slice(11,23);if(this.#e===null)return e.slice(0,-1);if(this.#e==="Z")return e;let t=+this.#e.slice(1,3)*60+ +this.#e.slice(4,6);return t=this.#e[0]==="-"?t:-t,new Date(this.getTime()-t*6e4).toISOString().slice(0,-1)+this.#e}static wrapAsOffsetDateTime(e,t="Z"){let a=new C(e);return a.#e=t,a}static wrapAsLocalDateTime(e){let t=new C(e);return t.#e=null,t}static wrapAsLocalDate(e){let t=new C(e);return t.#a=!1,t.#e=null,t}static wrapAsLocalTime(e){let t=new C(e);return t.#t=!1,t.#e=null,t}}let X=/^((0x[0-9a-fA-F](_?[0-9a-fA-F])*)|(([+-]|0[ob])?\d(_?\d)*))$/,Z=/^[+-]?\d(_?\d)*(\.\d(_?\d)*)?([eE][+-]?\d(_?\d)*)?$/,J=/^[+-]?0[0-9_]/,Y=/^[0-9a-f]{4,8}$/i,q={b:"\b",t:"	",n:`
`,f:"\f",r:"\r",'"':'"',"\\":"\\"};function $(s,e=0,t=s.length){let a=s[e]==="'",n=s[e++]===s[e]&&s[e]===s[e+1];n&&(t-=2,s[e+=2]==="\r"&&e++,s[e]===`
`&&e++);let i=0,o,l="",r=e;for(;e<t-1;){let g=s[e++];if(g===`
`||g==="\r"&&s[e]===`
`){if(!n)throw new u("newlines are not allowed in strings",{toml:s,ptr:e-1})}else if(g<" "&&g!=="	"||g==="")throw new u("control characters are not allowed in strings",{toml:s,ptr:e-1});if(o){if(o=!1,g==="u"||g==="U"){let d=s.slice(e,e+=g==="u"?4:8);if(!Y.test(d))throw new u("invalid unicode escape",{toml:s,ptr:i});try{l+=String.fromCodePoint(parseInt(d,16))}catch{throw new u("invalid unicode escape",{toml:s,ptr:i})}}else if(n&&(g===`
`||g===" "||g==="	"||g==="\r")){if(e=y(s,e-1,!0),s[e]!==`
`&&s[e]!=="\r")throw new u("invalid escape: only line-ending whitespace may be escaped",{toml:s,ptr:i});e=y(s,e)}else if(g in q)l+=q[g];else throw new u("unrecognized escape sequence",{toml:s,ptr:i});r=e}else!a&&g==="\\"&&(i=e-1,o=!0,l+=s.slice(r,i))}return l+s.slice(r,t-1)}function Q(s,e,t,a){if(s==="true")return!0;if(s==="false")return!1;if(s==="-inf")return-1/0;if(s==="inf"||s==="+inf")return 1/0;if(s==="nan"||s==="+nan"||s==="-nan")return NaN;if(s==="-0")return a?0n:0;let n=X.test(s);if(n||Z.test(s)){if(J.test(s))throw new u("leading zeroes are not allowed",{toml:e,ptr:t});s=s.replace(/_/g,"");let o=+s;if(isNaN(o))throw new u("invalid number",{toml:e,ptr:t});if(n){if((n=!Number.isSafeInteger(o))&&!a)throw new u("integer value cannot be represented losslessly",{toml:e,ptr:t});(n||a===!0)&&(o=BigInt(s))}return o}const i=new C(s);if(!i.isValid())throw new u("invalid value",{toml:e,ptr:t});return i}function ee(s,e,t,a){let n=s.slice(e,t),i=n.indexOf("#");i>-1&&(I(s,i),n=n.slice(0,i));let o=n.trimEnd();if(!a){let l=n.indexOf(`
`,o.length);if(l>-1)throw new u("newlines are not allowed in inline tables",{toml:s,ptr:e+l})}return[o,i]}function k(s,e,t,a,n){if(a===0)throw new u("document contains excessively nested structures. aborting.",{toml:s,ptr:e});let i=s[e];if(i==="["||i==="{"){let[r,g]=i==="["?ne(s,e,a,n):ae(s,e,a,n),d=t?P(s,g,",",t):g;if(g-d&&t==="}"){let p=M(s,g,d);if(p>-1)throw new u("newlines are not allowed in inline tables",{toml:s,ptr:p})}return[r,d]}let o;if(i==='"'||i==="'"){o=O(s,e);let r=$(s,e,o);if(t){if(o=y(s,o,t!=="]"),s[o]&&s[o]!==","&&s[o]!==t&&s[o]!==`
`&&s[o]!=="\r")throw new u("unexpected character encountered",{toml:s,ptr:o});o+=+(s[o]===",")}return[r,o]}o=P(s,e,",",t);let l=ee(s,e,o-+(s[o-1]===","),t==="]");if(!l[0])throw new u("incomplete key-value declaration: no value specified",{toml:s,ptr:e});return t&&l[1]>-1&&(o=y(s,e+l[1]),o+=+(s[o]===",")),[Q(l[0],s,e,n),o]}let te=/^[a-zA-Z0-9-_]+[ \t]*$/;function S(s,e,t="="){let a=e-1,n=[],i=s.indexOf(t,e);if(i<0)throw new u("incomplete key-value: cannot find end of key",{toml:s,ptr:e});do{let o=s[e=++a];if(o!==" "&&o!=="	")if(o==='"'||o==="'"){if(o===s[e+1]&&o===s[e+2])throw new u("multiline strings are not allowed in keys",{toml:s,ptr:e});let l=O(s,e);if(l<0)throw new u("unfinished string encountered",{toml:s,ptr:e});a=s.indexOf(".",l);let r=s.slice(l,a<0||a>i?i:a),g=M(r);if(g>-1)throw new u("newlines are not allowed in keys",{toml:s,ptr:e+a+g});if(r.trimStart())throw new u("found extra tokens after the string part",{toml:s,ptr:l});if(i<l&&(i=s.indexOf(t,l),i<0))throw new u("incomplete key-value: cannot find end of key",{toml:s,ptr:e});n.push($(s,e,l))}else{a=s.indexOf(".",e);let l=s.slice(e,a<0||a>i?i:a);if(!te.test(l))throw new u("only letter, numbers, dashes and underscores are allowed in keys",{toml:s,ptr:e});n.push(l.trimEnd())}}while(a+1&&a<i);return[n,y(s,i+1,!0,!0)]}function ae(s,e,t,a){let n={},i=new Set,o,l=0;for(e++;(o=s[e++])!=="}"&&o;){let r={toml:s,ptr:e-1};if(o===`
`)throw new u("newlines are not allowed in inline tables",r);if(o==="#")throw new u("inline tables cannot contain comments",r);if(o===",")throw new u("expected key-value, found comma",r);if(o!==" "&&o!=="	"){let g,d=n,p=!1,[V,H]=S(s,e-1);for(let b=0;b<V.length;b++){if(b&&(d=p?d[g]:d[g]={}),g=V[b],(p=Object.hasOwn(d,g))&&(typeof d[g]!="object"||i.has(d[g])))throw new u("trying to redefine an already defined value",{toml:s,ptr:e});!p&&g==="__proto__"&&Object.defineProperty(d,g,{enumerable:!0,configurable:!0,writable:!0})}if(p)throw new u("trying to redefine an already defined value",{toml:s,ptr:e});let[A,R]=k(s,H,"}",t-1,a);i.add(A),d[g]=A,e=R,l=s[e-1]===","?e-1:0}}if(l)throw new u("trailing commas are not allowed in inline tables",{toml:s,ptr:l});if(!o)throw new u("unfinished table encountered",{toml:s,ptr:e});return[n,e]}function ne(s,e,t,a){let n=[],i;for(e++;(i=s[e++])!=="]"&&i;){if(i===",")throw new u("expected value, found comma",{toml:s,ptr:e-1});if(i==="#")e=I(s,e);else if(i!==" "&&i!=="	"&&i!==`
`&&i!=="\r"){let o=k(s,e-1,"]",t-1,a);n.push(o[0]),e=o[1]}}if(!i)throw new u("unfinished array encountered",{toml:s,ptr:e});return[n,e]}function D(s,e,t,a){let n=e,i=t,o,l=!1,r;for(let g=0;g<s.length;g++){if(g){if(n=l?n[o]:n[o]={},i=(r=i[o]).c,a===0&&(r.t===1||r.t===2))return null;if(r.t===2){let d=n.length-1;n=n[d],i=i[d].c}}if(o=s[g],(l=Object.hasOwn(n,o))&&i[o]?.t===0&&i[o]?.d)return null;l||(o==="__proto__"&&(Object.defineProperty(n,o,{enumerable:!0,configurable:!0,writable:!0}),Object.defineProperty(i,o,{enumerable:!0,configurable:!0,writable:!0})),i[o]={t:g<s.length-1&&a===2?3:a,d:!1,i:0,c:{}})}if(r=i[o],r.t!==a&&!(a===1&&r.t===3)||(a===2&&(r.d||(r.d=!0,n[o]=[]),n[o].push(n={}),r.c[r.i++]=r={t:1,d:!1,i:0,c:{}}),r.d))return null;if(r.d=!0,a===1)n=l?n[o]:n[o]={};else if(a===0&&l)return null;return[o,n,r.c]}function E(s,{maxDepth:e=1e3,integersAsBigInt:t}={}){let a={},n={},i=a,o=n;for(let l=y(s,0);l<s.length;){if(s[l]==="["){let r=s[++l]==="[",g=S(s,l+=+r,"]");if(r){if(s[g[1]-1]!=="]")throw new u("expected end of table declaration",{toml:s,ptr:g[1]-1});g[1]++}let d=D(g[0],a,n,r?2:1);if(!d)throw new u("trying to redefine an already defined table or value",{toml:s,ptr:l});o=d[2],i=d[1],l=g[1]}else{let r=S(s,l),g=D(r[0],i,o,0);if(!g)throw new u("trying to redefine an already defined table or value",{toml:s,ptr:l});let d=k(s,r[1],void 0,e,t);g[1][g[0]]=d[0],l=d[1]}if(l=y(s,l,!0),s[l]&&s[l]!==`
`&&s[l]!=="\r")throw new u("each key-value declaration must be followed by an end-of-line",{toml:s,ptr:l});l=y(s,l)}return a}let z=/^[a-z0-9-_]+$/i;function L(s){let e=typeof s;if(e==="object"){if(Array.isArray(s))return"array";if(s instanceof Date)return"date"}return e}function se(s){for(let e=0;e<s.length;e++)if(L(s[e])!=="object")return!1;return s.length!=0}function B(s){return JSON.stringify(s).replace(/\x7f/g,"\\u007f")}function G(s,e,t,a){if(t===0)throw new Error("Could not stringify the object: maximum object depth exceeded");if(e==="number")return isNaN(s)?"nan":s===1/0?"inf":s===-1/0?"-inf":a&&Number.isInteger(s)?s.toFixed(1):s.toString();if(e==="bigint"||e==="boolean")return s.toString();if(e==="string")return B(s);if(e==="date"){if(isNaN(s.getTime()))throw new TypeError("cannot serialize invalid date");return s.toISOString()}if(e==="object")return ie(s,t,a);if(e==="array")return oe(s,t,a)}function ie(s,e,t){let a=Object.keys(s);if(a.length===0)return"{}";let n="{ ";for(let i=0;i<a.length;i++){let o=a[i];i&&(n+=", "),n+=z.test(o)?o:B(o),n+=" = ",n+=G(s[o],L(s[o]),e-1,t)}return n+" }"}function oe(s,e,t){if(s.length===0)return"[]";let a="[ ";for(let n=0;n<s.length;n++){if(n&&(a+=", "),s[n]===null||s[n]===void 0)throw new TypeError("arrays cannot contain null or undefined values");a+=G(s[n],L(s[n]),e-1,t)}return a+" ]"}function le(s,e,t,a){if(t===0)throw new Error("Could not stringify the object: maximum object depth exceeded");let n="";for(let i=0;i<s.length;i++)n+=`[[${e}]]
`,n+=x(s[i],e,t,a),n+=`

`;return n}function x(s,e,t,a){if(t===0)throw new Error("Could not stringify the object: maximum object depth exceeded");let n="",i="",o=Object.keys(s);for(let l=0;l<o.length;l++){let r=o[l];if(s[r]!==null&&s[r]!==void 0){let g=L(s[r]);if(g==="symbol"||g==="function")throw new TypeError(`cannot serialize values of type '${g}'`);let d=z.test(r)?r:B(r);if(g==="array"&&se(s[r]))i+=le(s[r],e?`${e}.${d}`:d,t-1,a);else if(g==="object"){let p=e?`${e}.${d}`:d;i+=`[${p}]
`,i+=x(s[r],p,t-1,a),i+=`

`}else n+=d,n+=" = ",n+=G(s[r],g,t,a),n+=`
`}}return`${n}
${i}`.trim()}function T(s,{maxDepth:e=1e3,numbersAsFloat:t=!1}={}){if(L(s)!=="object")throw new TypeError("stringify can only be called with an object");return x(s,"",e,t)}const v={LOG_PATH:"/data/adb/gpu_governor/log",CONFIG_PATH:"/data/adb/gpu_governor/config/gpu_freq_table.toml",CURRENT_MODE_PATH:"/data/adb/gpu_governor/config/current_mode",GAMES_FILE:"/data/adb/gpu_governor/game/games.toml",LOG_LEVEL_PATH:"/data/adb/gpu_governor/log/log_level",CUSTOM_CONFIG_PATH:"/data/adb/gpu_governor/config/config.toml"},re=[65e3,64375,63750,63125,62500,61875,61250,60625,6e4,59375,58750,58125,57500,56875,56250,55625,55e3,54375,53750,53125,52500,51875,51250,50625,5e4,49375,48750,48125,47500,46875,46250,45625,45e3,44375,43750,43125,42500,41875],w={VOLT_STEP:625,MAX_VOLT:65e3,MIN_VOLT:41875},_={zh:{title:"天玑GPU调速器",loading:"加载中",header_title:"天玑GPU调速器",nav_status:"状态",nav_config:"配置",nav_log:"日志",nav_settings:"设置",status_title:"模块状态",status_running:"运行状态:",status_running_active:"运行中",status_running_inactive:"未运行",status_checking:"检查中...",status_current_mode:"当前模式:",status_mode_powersave:"省电",status_mode_balance:"均衡",status_mode_performance:"性能",status_mode_fast:"极速",status_mode_unknown:"未知",status_module_version:"模块版本:",status_unknown:"未知",config_gpu_title:"GPU频率表",config_freq:"频率 (MHz)",config_volt:"电压 (uV)",config_ddr:"内存档位",config_edit:"编辑",config_loading:"加载中...",config_not_found:"未找到配置",config_add:"添加配置",config_save:"保存配置",config_save_freq_table:"保存频率表",config_games_title:"游戏列表",config_games_add:"添加游戏",config_games_save:"保存列表",config_games_search_placeholder:"搜索游戏...",config_custom_settings:"自定义设置",config_global_settings:"全局设置",config_global_mode:"全局模式:",config_mode_powersave:"省电模式",config_mode_balance:"均衡模式",config_mode_performance:"性能模式",config_mode_fast:"极速模式",config_idle_threshold:"空闲阈值 (%):",config_powersave_mode:"省电模式设置",config_balance_mode:"均衡模式设置",config_performance_mode:"性能模式设置",config_fast_mode:"极速模式设置",config_margin:"余量 (%):",config_sampling_interval:"采样间隔 (ms):",config_min_adaptive_interval:"最小自适应间隔 (ms):",config_max_adaptive_interval:"最大自适应间隔 (ms):",config_up_rate_delay:"升频延迟 (ms):",config_down_rate_delay:"降频延迟 (ms):",config_aggressive_down:"激进降频策略",config_gaming_mode:"游戏优化",config_adaptive_sampling:"自适应采样",config_load_custom:"加载配置",config_save_custom:"保存配置",log_title:"运行日志",log_refresh:"刷新",log_main:"主日志",log_init:"初始化日志",log_loading:"加载中...",log_empty:"日志为空",log_not_found:"未找到日志",log_size_warning:"警告: 日志文件较大",settings_title:"设置",settings_theme_follow:"深色模式跟随系统",settings_theme_follow_summary:"自动根据系统设置切换主题",settings_language:"语言设置:",settings_language_follow:"跟随系统",settings_language_zh:"中文",settings_language_en:"English",settings_language_desc1:"修改语言设置后实时生效",settings_language_desc2:"跟随系统将自动检测系统语言设置",settings_log_level:"主日志等级:",settings_log_level_debug:"Debug (详细)",settings_log_level_info:"Info (信息)",settings_log_level_warn:"Warn (警告)",settings_log_level_error:"Error (错误)",settings_log_level_desc1:"修改日志等级后实时生效",settings_log_level_desc2:"设置为Debug级别将启用详细日志记录",edit_config_title:"编辑GPU频率表",edit_config_freq:"频率 (MHz):",edit_config_freq_example:"例如: 350000 (KHz)",edit_config_freq_hint:"请输入KHz值，表格中显示为MHz",edit_config_volt:"电压 (uV):",edit_config_ddr:"内存档位:",edit_config_ddr_default:"999 (不调整)",edit_config_ddr_highest:"0 (最高)",edit_config_ddr_high:"1",edit_config_ddr_medium:"2",edit_config_ddr_low:"3",edit_config_save:"保存",edit_config_cancel:"取消",edit_config_delete:"删除",edit_game_title:"编辑游戏列表",edit_game_package:"应用包名:",edit_game_package_example:"例如: com.tencent.tmgp.sgame",edit_game_mode:"对应模式:",edit_game_save:"保存",edit_game_cancel:"取消",toast_webui_loaded:"WebUI加载完成",toast_theme_follow_disabled:"已关闭跟随系统主题，现在可以手动切换主题",toast_theme_follow_enabled:"已开启跟随系统主题",toast_theme_follow_keep:"已关闭跟随系统主题，将保持当前主题",toast_theme_switched_dark:"已切换到深色模式",toast_theme_switched_light:"已切换到浅色模式",toast_config_updated:'配置已更新，请点击"保存频率表"按钮保存到文件',toast_config_deleted:'配置已删除，请点击"保存频率表"按钮保存到文件',toast_config_saved:"配置已成功保存",toast_config_save_fail:"保存配置失败，请检查权限",toast_freq_table_saved:"频率表已成功保存",toast_freq_table_save_fail:"保存频率表失败，请检查权限",toast_config_empty:"没有配置可保存",toast_config_parse_error:"配置文件解析失败: {error}",toast_freq_invalid:"请输入有效的频率值",toast_index_invalid:"无效的配置索引",toast_game_added:'游戏已添加，请点击"保存列表"按钮保存到文件',toast_game_deleted:'游戏已删除，请点击"保存列表"按钮保存到文件',toast_game_exists:"该应用包名已存在于列表中",toast_game_invalid:"请输入有效的应用包名",toast_games_saved:"游戏列表已成功保存",toast_games_save_fail:"保存游戏列表失败，请检查权限",toast_games_empty:"没有游戏可保存",toast_games_parse_error:"游戏列表解析失败，请检查文件格式",toast_log_level_debug:"日志等级已设置为: debug，详细日志记录已启用",toast_log_level_set:"日志等级已设置为: {level}，已实时生效",toast_log_level_fail:"保存日志等级失败，请检查权限",toast_language_changed:"语言已切换为{language}",toast_language_follow_system:"语言已设置为跟随系统",copyright_text:"天玑GPU调速器 © 2025 酷安@瓦力喀 = Github@Seyud",config_games_not_found:"未找到游戏",config_games_list_not_found:"未找到游戏列表"},en:{title:"Mediatek Mali GPU Governor",loading:"Loading",header_title:"Mediatek Mali GPU Governor",nav_status:"Status",nav_config:"Config",nav_log:"Log",nav_settings:"Settings",status_title:"Module Status",status_running:"Running Status:",status_running_active:"Running",status_running_inactive:"Not Running",status_checking:"Checking...",status_current_mode:"Current Mode:",status_mode_powersave:"Powersave",status_mode_balance:"Balance",status_mode_performance:"Performance",status_mode_fast:"Fast",status_mode_unknown:"Unknown",status_module_version:"Module Version:",status_unknown:"Unknown",config_gpu_title:"GPU Frequency Table",config_freq:"Frequency (MHz)",config_volt:"Voltage (uV)",config_ddr:"Memory Level",config_edit:"Edit",config_loading:"Loading...",config_not_found:"No configuration found",config_add:"Add Config",config_save:"Save Config",config_save_freq_table:"Save Frequency Table",config_games_title:"Games List",config_games_add:"Add Game",config_games_save:"Save List",config_games_search_placeholder:"Search games...",config_custom_settings:"Custom Settings",config_global_settings:"Global Settings",config_global_mode:"Global Mode:",config_mode_powersave:"Powersave Mode",config_mode_balance:"Balance Mode",config_mode_performance:"Performance Mode",config_mode_fast:"Fast Mode",config_idle_threshold:"Idle Threshold (%):",config_powersave_mode:"Powersave Mode Settings",config_balance_mode:"Balance Mode Settings",config_performance_mode:"Performance Mode Settings",config_fast_mode:"Fast Mode Settings",config_margin:"Margin (%):",config_sampling_interval:"Sampling Interval (ms):",config_min_adaptive_interval:"Min Adaptive Interval (ms):",config_max_adaptive_interval:"Max Adaptive Interval (ms):",config_up_rate_delay:"Up Rate Delay (ms):",config_down_rate_delay:"Down Rate Delay (ms):",config_aggressive_down:"Aggressive Down Strategy",config_gaming_mode:"Gaming Mode",config_adaptive_sampling:"Adaptive Sampling",config_load_custom:"Load Config",config_save_custom:"Save Config",log_title:"Runtime Log",log_refresh:"Refresh",log_main:"Main Log",log_init:"Init Log",log_loading:"Loading...",log_empty:"Log is empty",log_not_found:"Log not found",log_size_warning:"Warning: Log file size exceeds limit, it will be rotated automatically.",settings_title:"Settings",settings_theme_follow:"Follow System Dark Mode",settings_theme_follow_summary:"Automatically switch theme based on system settings",settings_language:"Language:",settings_language_follow:"Follow System",settings_language_zh:"中文",settings_language_en:"English",settings_language_desc1:"Language changes take effect immediately",settings_language_desc2:"Follow System will detect system language settings",settings_log_level:"Main Log Level:",settings_log_level_debug:"Debug (Detailed)",settings_log_level_info:"Info",settings_log_level_warn:"Warn",settings_log_level_error:"Error",settings_log_level_desc1:"Log level changes take effect immediately",settings_log_level_desc2:"Debug level enables detailed logging",edit_config_title:"Edit GPU Frequency Table",edit_config_freq:"Frequency (MHz):",edit_config_freq_example:"e.g.: 350000 (KHz)",edit_config_freq_hint:"Please enter KHz value, displayed as MHz in table",edit_config_volt:"Voltage (uV):",edit_config_ddr:"Memory Level:",edit_config_ddr_default:"999 (No Change)",edit_config_ddr_highest:"0 (Highest)",edit_config_ddr_high:"1",edit_config_ddr_medium:"2",edit_config_ddr_low:"3",edit_config_save:"Save",edit_config_cancel:"Cancel",edit_config_delete:"Delete",edit_game_title:"Edit Games List",edit_game_package:"Package Name:",edit_game_package_example:"e.g.: com.tencent.tmgp.sgame",edit_game_mode:"Corresponding Mode:",edit_game_save:"Save",edit_game_cancel:"Cancel",toast_webui_loaded:"WebUI loaded successfully",toast_theme_follow_disabled:"System theme following disabled, you can now switch themes manually",toast_theme_follow_enabled:"System theme following enabled",toast_theme_follow_keep:"System theme following disabled, current theme will be kept",toast_theme_switched_dark:"Switched to dark mode",toast_theme_switched_light:"Switched to light mode",toast_config_updated:'Configuration updated, please click "Save Frequency Table" to save to file',toast_config_deleted:'Configuration deleted, please click "Save Frequency Table" to save to file',toast_config_saved:"Configuration saved successfully",toast_config_save_fail:"Failed to save configuration, please check permissions",toast_freq_table_saved:"Frequency table saved successfully",toast_freq_table_save_fail:"Failed to save frequency table, please check permissions",toast_config_empty:"No configuration to save",toast_config_parse_error:"Failed to parse configuration file: {error}",toast_freq_invalid:"Please enter a valid frequency value",toast_index_invalid:"Invalid configuration index",toast_game_added:'Game added, please click "Save List" button to save to file',toast_game_deleted:'Game deleted, please click "Save List" button to save to file',toast_game_exists:"This package name already exists in the list",toast_game_invalid:"Please enter a valid package name",toast_games_saved:"Games list saved successfully",toast_games_save_fail:"Failed to save games list, please check permissions",toast_games_empty:"No games to save",toast_games_parse_error:"Failed to parse games list, please check file format",toast_log_level_debug:"Log level set to: debug, detailed logging has been enabled",toast_log_level_set:"Log level set to: {level}, changes applied immediately",toast_log_level_fail:"Failed to save log level, please check permissions",toast_language_changed:"Language changed to {language}",toast_language_follow_system:"Language set to follow system",copyright_text:"Mediatek Mali GPU Governor © 2025 Coolapk@Walika = Github@Seyud",config_games_not_found:"No games found",config_games_list_not_found:"No games list found"}};function c(s,e={},t="zh"){let n=(_[t]||_.zh)[s]||s;for(const[i,o]of Object.entries(e))n=n.replace(`{${i}}`,String(o));return n}let ce=0;function ge(s){return`${s}_callback_${Date.now()}_${ce++}`}function de(s,e){return typeof e>"u"&&(e={}),new Promise((t,a)=>{const n=ge("exec");window[n]=(o,l,r)=>{t({errno:o,stdout:l,stderr:r}),i(n)};function i(o){delete window[o]}try{ksu.exec(s,JSON.stringify(e),n)}catch(o){a(o),i(n)}})}function ue(s){ksu.toast(s)}function f(s,e={}){return de(s,e)}function h(s){ue(s)}class he{currentLanguage="zh";async loadGpuConfig(){const{errno:e,stdout:t}=await f(`cat ${v.CONFIG_PATH}`);if(e===0&&t.trim())try{const a=E(t);if(a.freq_table&&Array.isArray(a.freq_table)){const n=a.freq_table.map(i=>({freq:Number(i.freq),volt:Number(i.volt),ddr:Number(i.ddr_opp)}));return n.sort((i,o)=>i.freq-o.freq),{success:!0,data:n}}}catch(a){return h(c("toast_config_parse_error",{error:String(a)},this.currentLanguage)),{success:!1,error:"parse_error"}}return{success:!1,error:"config_not_found"}}async saveGpuConfig(e){if(!e||e.length===0)return h(c("toast_config_empty",{},this.currentLanguage)),{success:!1,error:"empty_config"};const a={freq_table:[...e].sort((l,r)=>l.freq-r.freq).map(l=>({freq:l.freq,volt:l.volt,ddr_opp:l.ddr}))},i=`# GPU 频率表
# freq 单位: kHz
# volt 单位: uV
# ddr_opp: DDR OPP 档位

`+T(a);return(await this.writeFileAtomically(v.CONFIG_PATH,i)).errno===0?(h(c("toast_freq_table_saved",{},this.currentLanguage)),{success:!0}):(h(c("toast_freq_table_save_fail",{},this.currentLanguage)),{success:!1,error:"save_failed"})}async loadCustomConfig(){const{errno:e,stdout:t}=await f(`cat ${v.CUSTOM_CONFIG_PATH}`);if(e===0&&t.trim())try{const a=E(t),n={};return a.global&&(n.global=a.global),["powersave","balance","performance","fast"].forEach(o=>{a[o]&&(n[o]=a[o])}),{success:!0,data:n}}catch(a){return h(c("toast_config_parse_error",{error:String(a)},this.currentLanguage)),{success:!1,error:"parse_error"}}return{success:!1,error:"config_not_found"}}async saveCustomConfig(e){const t=this.generateCustomConfigContent(e);return(await this.writeFileAtomically(v.CUSTOM_CONFIG_PATH,t)).errno===0?(h(c("toast_config_saved",{},this.currentLanguage)),{success:!0}):(h(c("toast_config_save_fail",{},this.currentLanguage)),{success:!1,error:"save_failed"})}generateCustomConfigContent(e){const t=`# GPU调速器配置文件

`,a={};return e.global&&(a.global=e.global),["powersave","balance","performance","fast"].forEach(i=>{e[i]&&(a[i]=e[i])}),t+T(a)}async writeFileAtomically(e,t){const a=`${e}.tmp`,i=`echo '${btoa(unescape(encodeURIComponent(t)))}' | base64 -d > '${a}' && mv '${a}' '${e}'`,o=await f(i);return o.errno!==0&&await f(`rm -f '${a}'`),o}setLanguage(e){this.currentLanguage=e}}class me{gpuConfigs=[];currentLanguage="zh";gpuFreqTable;addConfigBtn;saveConfigBtn;onEditCallback=null;saveConfigToFile=null;constructor(){this.gpuFreqTable=document.getElementById("gpuFreqTable")?.querySelector("tbody"),this.addConfigBtn=document.getElementById("addConfigBtn"),this.saveConfigBtn=document.getElementById("saveConfigBtn")}init(){this.setupEventListeners()}setupEventListeners(){this.addConfigBtn&&this.addConfigBtn.addEventListener("click",()=>this.openEditModal()),this.saveConfigBtn&&this.saveConfigBtn.addEventListener("click",()=>{this.saveConfigToFile&&this.saveConfigToFile()})}loadConfigs(e){this.gpuConfigs=e||[],this.gpuConfigs.length>0?(this.gpuConfigs.sort((t,a)=>t.freq-a.freq),this.refreshTable()):this.showEmptyState()}refreshTable(){if(this.gpuFreqTable){if(this.gpuFreqTable.innerHTML="",this.gpuConfigs.length===0){this.showEmptyState();return}this.gpuConfigs=[...this.gpuConfigs].sort((e,t)=>e.freq-t.freq),this.gpuConfigs.forEach((e,t)=>{const a=this.createTableRow(e,t);this.gpuFreqTable?.appendChild(a)})}}createTableRow(e,t){const a=document.createElement("tr");a.dataset.index=String(t),a.dataset.freq=String(e.freq);const n=document.createElement("td");n.textContent=(e.freq/1e3).toFixed(0);const i=document.createElement("td");i.textContent=String(e.volt);const o=document.createElement("td");o.textContent=String(e.ddr);const l=document.createElement("td"),r=this.createEditButton(t);return l.appendChild(r),a.appendChild(n),a.appendChild(i),a.appendChild(o),a.appendChild(l),a}createEditButton(e){const t=document.createElement("button");return t.className="edit-btn",t.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>',t.title="编辑/删除",t.onclick=()=>(this.openEditModal(e),!1),t}showEmptyState(){this.gpuFreqTable&&(this.gpuFreqTable.innerHTML=`<tr><td colspan="4" class="loading-text">${c("config_not_found",{},this.currentLanguage)}</td></tr>`)}openEditModal(e=-1){if(this.onEditCallback){const t=e>=0?this.gpuConfigs[e]:null;this.onEditCallback(t,e)}}addConfig(e){this.gpuConfigs.push(e),this.refreshTable()}updateConfig(e,t){t>=0&&t<this.gpuConfigs.length?this.gpuConfigs[t]=e:this.gpuConfigs.push(e),this.refreshTable()}deleteConfig(e){return e>=0&&e<this.gpuConfigs.length?(this.gpuConfigs.splice(e,1),this.refreshTable(),!0):!1}getConfigs(){return[...this.gpuConfigs]}setEditCallback(e){this.onEditCallback=e}setSaveFileCallback(e){this.saveConfigToFile=e}isFrequencyDuplicate(e,t=-1){return this.gpuConfigs.some((a,n)=>a.freq===e&&n!==t)}getFrequencyRange(){if(this.gpuConfigs.length===0)return{min:0,max:0};const e=this.gpuConfigs.map(t=>t.freq);return{min:Math.min(...e),max:Math.max(...e)}}sortByFrequency(){this.gpuConfigs.sort((e,t)=>e.freq-t.freq),this.refreshTable()}validateConfig(e){const t=[];return(!e.freq||Number.isNaN(e.freq)||e.freq<=0)&&t.push("无效的频率值"),(!e.volt||Number.isNaN(e.volt)||e.volt<=0)&&t.push("无效的电压值"),(e.ddr===void 0||Number.isNaN(e.ddr))&&t.push("无效的DDR档位值"),{isValid:t.length===0,errors:t}}getStatistics(){if(this.gpuConfigs.length===0)return{count:0,avgFreq:0,avgVolt:0,freqRange:{min:0,max:0},voltRange:{min:0,max:0}};const e=this.gpuConfigs.map(a=>a.freq),t=this.gpuConfigs.map(a=>a.volt);return{count:this.gpuConfigs.length,avgFreq:e.reduce((a,n)=>a+n,0)/e.length,avgVolt:t.reduce((a,n)=>a+n,0)/t.length,freqRange:{min:Math.min(...e),max:Math.max(...e)},voltRange:{min:Math.min(...t),max:Math.max(...t)}}}setLanguage(e){this.currentLanguage=e,this.refreshTable()}clearConfigs(){this.gpuConfigs=[],this.refreshTable()}}class fe{voltageController;editingIndex=-1;currentLanguage="zh";onSaveCallback=null;onDeleteCallback=null;editConfigModal;closeModalBtn;freqInput;saveItemBtn;cancelEditBtn;deleteItemBtn;ddrContainer;selectedDdr;constructor(e){this.voltageController=e,this.editConfigModal=document.getElementById("editConfigModal"),this.closeModalBtn=document.querySelector(".close-modal"),this.freqInput=document.getElementById("freqInput"),this.saveItemBtn=document.getElementById("saveItemBtn"),this.cancelEditBtn=document.getElementById("cancelEditBtn"),this.deleteItemBtn=document.getElementById("deleteItemBtn"),this.ddrContainer=document.getElementById("ddrContainer"),this.selectedDdr=document.getElementById("selectedDdr")}init(){this.setupEventListeners(),this.setupDdrSelector()}setupEventListeners(){this.closeModalBtn&&this.closeModalBtn.addEventListener("click",()=>this.closeModal()),this.cancelEditBtn&&this.cancelEditBtn.addEventListener("click",()=>this.closeModal()),this.saveItemBtn&&this.saveItemBtn.addEventListener("click",()=>this.saveConfigItem()),this.deleteItemBtn&&this.deleteItemBtn.addEventListener("click",()=>this.deleteConfigItem()),window.addEventListener("click",e=>{e.target===this.editConfigModal&&this.closeModal()}),window.addEventListener("keydown",e=>{e.key==="Escape"&&this.editConfigModal&&this.editConfigModal.style.display==="block"&&this.closeModal()})}setupDdrSelector(){if(!this.ddrContainer)return;this.ddrContainer.addEventListener("click",()=>{this.ddrContainer?.classList.toggle("open"),this.ddrContainer?.classList.contains("open")?setTimeout(()=>{(this.ddrContainer?.querySelectorAll(".option")).forEach((a,n)=>{setTimeout(()=>{a.style.opacity="1",a.style.transform="translateY(0)"},n*50)})},10):((this.ddrContainer?.querySelectorAll(".option")).forEach(a=>{a.style.opacity="0",a.style.transform="translateY(-10px)"}),setTimeout(()=>{this.ddrContainer?.classList.remove("open")},150))});const e=document.querySelectorAll("#ddrOptions .option");e.forEach(t=>{t.addEventListener("click",a=>{a.stopPropagation(),e.forEach(i=>{i.classList.remove("selected")}),t.classList.add("selected"),this.selectedDdr&&(this.selectedDdr.textContent=t.textContent);const n=this.ddrContainer?.querySelectorAll(".option");n.forEach(i=>{i.style.opacity="0",i.style.transform="translateY(-10px)"}),setTimeout(()=>{this.ddrContainer?.classList.remove("open")},150),setTimeout(()=>{n.forEach(i=>{i.style.opacity="",i.style.transform=""})},300)})})}openModal(e=null,t=-1){this.editConfigModal&&(this.editingIndex=t,e?(this.freqInput&&(this.freqInput.value=String(e.freq)),this.voltageController&&this.voltageController.setVoltage(e.volt),this.setDdrValue(e.ddr),this.deleteItemBtn&&(this.deleteItemBtn.style.display="block")):(this.freqInput&&(this.freqInput.value=""),this.voltageController&&this.voltageController.reset(),this.setDdrValue(999),this.deleteItemBtn&&(this.deleteItemBtn.style.display="none")),this.editConfigModal.style.display="block")}closeModal(){this.editConfigModal&&(this.editConfigModal.style.display="none")}setDdrValue(e){this.selectedDdr&&document.querySelectorAll("#ddrOptions .option").forEach(a=>{parseInt(a.getAttribute("data-value")||"0",10)===e?(this.selectedDdr&&(this.selectedDdr.textContent=a.textContent),a.classList.add("selected")):a.classList.remove("selected")})}getDdrValue(){if(this.selectedDdr){const e=this.selectedDdr.textContent||"999";return parseInt(e.split(" ")[0],10)}return 999}saveConfigItem(){if(!this.freqInput)return;const e=parseInt(this.freqInput.value,10),t=this.voltageController?this.voltageController.getCurrentVoltage():0,a=this.getDdrValue();if(!e||Number.isNaN(e)){h(c("toast_freq_invalid",{},this.currentLanguage));return}const n={freq:e,volt:t,ddr:a};this.onSaveCallback&&this.onSaveCallback(n,this.editingIndex),this.closeModal(),h(c("toast_config_updated",{},this.currentLanguage))}deleteConfigItem(){this.editingIndex>=0?(this.onDeleteCallback&&this.onDeleteCallback(this.editingIndex),this.closeModal(),h(c("toast_config_deleted",{},this.currentLanguage))):h(c("toast_index_invalid",{},this.currentLanguage))}setSaveCallback(e){this.onSaveCallback=e}setDeleteCallback(e){this.onDeleteCallback=e}setLanguage(e){this.currentLanguage=e}}class pe{currentLanguage="zh";customConfig={};globalModeSelect;globalModeContainer;selectedGlobalMode;globalModeOptions;idleThresholdInput;powersaveInputs=null;balanceInputs=null;performanceInputs=null;fastInputs=null;constructor(){this.globalModeSelect=document.getElementById("globalMode"),this.globalModeContainer=document.getElementById("globalModeContainer"),this.selectedGlobalMode=document.getElementById("selectedGlobalMode"),this.globalModeOptions=document.getElementById("globalModeOptions"),this.idleThresholdInput=document.getElementById("idleThreshold"),this.powersaveInputs=this.getModeInputs("powersave"),this.balanceInputs=this.getModeInputs("balance"),this.performanceInputs=this.getModeInputs("performance"),this.fastInputs=this.getModeInputs("fast")}getModeInputs(e){return{margin:document.getElementById(`${e}Margin`),sampling_interval:document.getElementById(`${e}SamplingInterval`),min_adaptive_interval:document.getElementById(`${e}MinAdaptiveInterval`),max_adaptive_interval:document.getElementById(`${e}MaxAdaptiveInterval`),up_rate_delay:document.getElementById(`${e}UpRateDelay`),down_rate_delay:document.getElementById(`${e}DownRateDelay`),aggressive_down:document.getElementById(`${e}AggressiveDown`),gaming_mode:document.getElementById(`${e}GamingMode`),adaptive_sampling:document.getElementById(`${e}AdaptiveSampling`)}}init(){this.initGlobalModeSelect(),this.initModeSwitchEvents()}initGlobalModeSelect(){if(!this.selectedGlobalMode||!this.globalModeOptions)return;this.selectedGlobalMode.addEventListener("click",t=>{t.stopPropagation(),this.globalModeContainer?.classList.toggle("open")}),this.globalModeOptions.querySelectorAll(".option").forEach(t=>{t.addEventListener("click",a=>{a.stopPropagation();const n=t.getAttribute("data-value"),i=t.textContent,o=this.selectedGlobalMode?.querySelector("span");o&&(o.textContent=i||"",o.setAttribute("data-i18n",t.getAttribute("data-i18n")||"")),this.globalModeSelect&&n&&(this.globalModeSelect.value=n,this.globalModeSelect.dispatchEvent(new Event("change"))),this.globalModeContainer?.classList.remove("open")})}),document.addEventListener("click",t=>{this.globalModeContainer?.contains(t.target)||this.globalModeContainer?.classList.remove("open")})}initModeSwitchEvents(){const e=document.querySelectorAll(".mode-tabs-grid .settings-tab-btn"),t=document.querySelectorAll(".mode-config-section");this.globalModeSelect&&this.syncModeTabsWithGlobalMode(this.globalModeSelect.value),e.forEach(a=>{a.addEventListener("click",()=>{const n=a.getAttribute("data-mode");e.forEach(o=>{o.classList.remove("active")}),a.classList.add("active"),t.forEach(o=>{o.classList.remove("active")});const i=document.getElementById(`${n}-config`);i&&i.classList.add("active")})}),this.globalModeSelect&&this.globalModeSelect.addEventListener("change",()=>{const a=this.globalModeSelect?.value;a&&this.syncModeTabsWithGlobalMode(a)})}syncModeTabsWithGlobalMode(e){const t=document.querySelectorAll(".mode-tabs-grid .settings-tab-btn"),a=document.querySelectorAll(".mode-config-section");t.forEach(n=>{n.classList.remove("active"),n.getAttribute("data-mode")===e&&n.classList.add("active")}),a.forEach(n=>{n.classList.remove("active"),n.id===`${e}-config`&&n.classList.add("active")})}populateCustomConfigForm(e){this.customConfig=e||{},this.customConfig.global&&(this.globalModeSelect&&this.customConfig.global.mode&&(this.globalModeSelect.value=String(this.customConfig.global.mode)),this.selectedGlobalMode&&this.customConfig.global.mode&&this.updateGlobalModeDisplay(String(this.customConfig.global.mode)),this.idleThresholdInput&&this.customConfig.global.idle_threshold!==void 0&&(this.idleThresholdInput.value=String(this.customConfig.global.idle_threshold))),this.populateModeConfig(this.powersaveInputs,this.customConfig.powersave),this.populateModeConfig(this.balanceInputs,this.customConfig.balance),this.populateModeConfig(this.performanceInputs,this.customConfig.performance),this.populateModeConfig(this.fastInputs,this.customConfig.fast),this.customConfig.global?.mode&&this.syncModeTabsWithGlobalMode(String(this.customConfig.global.mode))}updateGlobalModeDisplay(e){let t="",a="";switch(e){case"powersave":t=c("config_powersave_mode",{},this.currentLanguage),a="config_powersave_mode";break;case"performance":t=c("config_performance_mode",{},this.currentLanguage),a="config_performance_mode";break;case"fast":t=c("config_fast_mode",{},this.currentLanguage),a="config_fast_mode";break;default:t=c("config_balance_mode",{},this.currentLanguage),a="config_balance_mode";break}if(this.selectedGlobalMode){const n=this.selectedGlobalMode.querySelector("span");n&&(n.textContent=t,n.setAttribute("data-i18n",a))}}populateModeConfig(e,t){!t||!e||Object.keys(e).forEach(a=>{const n=e[a];if(n&&t[a]!==void 0){const i=n;i.type==="checkbox"?i.checked=!!t[a]:i.value=String(t[a])}})}getCurrentConfig(){return{global:{mode:this.getGlobalMode(),idle_threshold:this.getIdleThreshold()},powersave:this.getModeConfig(this.powersaveInputs),balance:this.getModeConfig(this.balanceInputs),performance:this.getModeConfig(this.performanceInputs),fast:this.getModeConfig(this.fastInputs)}}getGlobalMode(){if(this.globalModeSelect?.value)return this.globalModeSelect.value;if(this.selectedGlobalMode){const e=this.selectedGlobalMode.querySelector("span");if(e){const t=e.textContent||"";return t.includes("省电")||t.includes("Power Save")?"powersave":t.includes("性能")||t.includes("Performance")?"performance":t.includes("极速")||t.includes("Fast")?"fast":"balance"}}return"balance"}getIdleThreshold(){return this.idleThresholdInput&&this.idleThresholdInput.value||5}getModeConfig(e){if(!e)return{};const t={};return Object.keys(e).forEach(a=>{const n=e[a];n&&(n.type==="checkbox"?t[a]=n.checked:t[a]=n.value?Number(n.value):0)}),t}setLanguage(e){this.currentLanguage=e,this.customConfig.global?.mode&&this.updateGlobalModeDisplay(String(this.customConfig.global.mode))}}class _e{currentVoltValue=w.MAX_VOLT;isLongPress=!1;decreaseTimer=null;increaseTimer=null;voltageEventsInitialized=!1;voltSelect;selectedVolt;voltDecreaseBtn;voltIncreaseBtn;constructor(){this.voltSelect=document.getElementById("voltSelect"),this.selectedVolt=document.getElementById("selectedVolt"),this.voltDecreaseBtn=document.getElementById("voltDecreaseBtn"),this.voltIncreaseBtn=document.getElementById("voltIncreaseBtn")}init(){this.initVoltSelect(),this.setupVoltageEvents()}decreaseVolt(){const e=this.currentVoltValue-w.VOLT_STEP;return e>=w.MIN_VOLT?(this.currentVoltValue=e,this.updateVoltDisplay(),!0):!1}increaseVolt(){const e=this.currentVoltValue+w.VOLT_STEP;return e<=w.MAX_VOLT?(this.currentVoltValue=e,this.updateVoltDisplay(),!0):!1}updateVoltDisplay(){if(this.selectedVolt&&(this.selectedVolt.textContent=String(this.currentVoltValue)),this.voltSelect){const e=Array.from(this.voltSelect.options).find(t=>parseInt(t.value,10)===this.currentVoltValue);if(e)this.voltSelect.value=e.value;else{const t=document.createElement("option");t.value=String(this.currentVoltValue),t.textContent=String(this.currentVoltValue),this.voltSelect.appendChild(t),this.voltSelect.value=String(this.currentVoltValue)}this.voltDecreaseBtn&&(this.voltDecreaseBtn.disabled=this.currentVoltValue<=w.MIN_VOLT),this.voltIncreaseBtn&&(this.voltIncreaseBtn.disabled=this.currentVoltValue>=w.MAX_VOLT)}}initVoltSelect(){!this.voltSelect||!this.selectedVolt||(this.voltSelect.innerHTML="",re.forEach(e=>{const t=document.createElement("option");t.value=String(e),t.textContent=String(e),this.voltSelect?.appendChild(t)}),this.currentVoltValue=w.MAX_VOLT,this.selectedVolt.textContent=String(this.currentVoltValue),this.voltSelect.value=String(this.currentVoltValue),this.updateVoltDisplay())}setupVoltageEvents(){this.voltageEventsInitialized||(this.voltDecreaseBtn&&(this.voltDecreaseBtn.addEventListener("click",()=>{if(this.isLongPress){this.isLongPress=!1;return}this.decreaseVolt()}),this.voltDecreaseBtn.addEventListener("mousedown",()=>{this.isLongPress=!1,this.decreaseTimer=setTimeout(()=>{this.isLongPress=!0,this.decreaseVolt()&&this.decreaseTimer&&(this.decreaseTimer=setInterval(()=>{this.decreaseVolt()||this.decreaseTimer&&(clearInterval(this.decreaseTimer),this.decreaseTimer=null)},150))},500)})),this.voltIncreaseBtn&&(this.voltIncreaseBtn.addEventListener("click",()=>{if(this.isLongPress){this.isLongPress=!1;return}this.increaseVolt()}),this.voltIncreaseBtn.addEventListener("mousedown",()=>{this.isLongPress=!1,this.increaseTimer=setTimeout(()=>{this.isLongPress=!0,this.increaseVolt()&&this.increaseTimer&&(this.increaseTimer=setInterval(()=>{this.increaseVolt()||this.increaseTimer&&(clearInterval(this.increaseTimer),this.increaseTimer=null)},150))},500)})),document.addEventListener("mouseup",()=>this.clearTimers()),document.addEventListener("mouseleave",()=>this.clearTimers()),this.setupTouchEvents(),this.voltageEventsInitialized=!0)}setupTouchEvents(){this.voltDecreaseBtn&&this.voltDecreaseBtn.addEventListener("touchstart",e=>{e.preventDefault(),this.isLongPress=!1,this.decreaseVolt(),this.decreaseTimer=setTimeout(()=>{this.isLongPress=!0,this.decreaseTimer=setInterval(()=>{this.decreaseVolt()||this.decreaseTimer&&(clearInterval(this.decreaseTimer),this.decreaseTimer=null)},150)},500)},{passive:!1}),this.voltIncreaseBtn&&this.voltIncreaseBtn.addEventListener("touchstart",e=>{e.preventDefault(),this.isLongPress=!1,this.increaseVolt(),this.increaseTimer=setTimeout(()=>{this.isLongPress=!0,this.increaseTimer=setInterval(()=>{this.increaseVolt()||this.increaseTimer&&(clearInterval(this.increaseTimer),this.increaseTimer=null)},150)},500)},{passive:!1}),document.addEventListener("touchend",()=>this.clearTimers())}clearTimers(){this.decreaseTimer!==null&&(clearTimeout(this.decreaseTimer),clearInterval(this.decreaseTimer),this.decreaseTimer=null),this.increaseTimer!==null&&(clearTimeout(this.increaseTimer),clearInterval(this.increaseTimer),this.increaseTimer=null)}getCurrentVoltage(){return this.currentVoltValue}setVoltage(e){this.currentVoltValue=e,this.updateVoltDisplay()}reset(){this.currentVoltValue=w.MAX_VOLT,this.updateVoltDisplay()}}class ve{currentLanguage="zh";voltageController;configFileManager;modalManager;modeConfigManager;gpuConfigManager;loadCustomConfigBtn;saveCustomConfigBtn;constructor(){this.voltageController=new _e,this.configFileManager=new he,this.modalManager=new fe(this.voltageController),this.modeConfigManager=new pe,this.gpuConfigManager=new me,this.loadCustomConfigBtn=document.getElementById("loadCustomConfigBtn"),this.saveCustomConfigBtn=document.getElementById("saveCustomConfigBtn")}init(){this.setupEventListeners(),this.setupModuleCallbacks(),this.initializeModules()}initializeModules(){this.voltageController.init(),this.modalManager.init(),this.modeConfigManager.init(),this.gpuConfigManager.init()}setupModuleCallbacks(){this.gpuConfigManager.setEditCallback((e,t)=>{this.modalManager.openModal(e,t)}),this.gpuConfigManager.setSaveFileCallback(()=>{this.saveGpuConfigToFile()}),this.modalManager.setSaveCallback((e,t)=>{this.gpuConfigManager.updateConfig(e,t)}),this.modalManager.setDeleteCallback(e=>{this.gpuConfigManager.deleteConfig(e)})}async loadInitialData(){await this.loadGpuConfig(),await this.loadCustomConfigFromFile()}async loadAllConfigData(){await this.loadInitialData()}setupEventListeners(){this.loadCustomConfigBtn&&this.loadCustomConfigBtn.addEventListener("click",()=>this.loadCustomConfigFromFile()),this.saveCustomConfigBtn&&this.saveCustomConfigBtn.addEventListener("click",()=>this.saveCustomConfigToFile())}async loadGpuConfig(){const e=await this.configFileManager.loadGpuConfig();e.success&&e.data?this.gpuConfigManager.loadConfigs(e.data):this.gpuConfigManager.loadConfigs([])}async saveGpuConfigToFile(){const e=this.gpuConfigManager.getConfigs();await this.configFileManager.saveGpuConfig(e)}async loadCustomConfigFromFile(){const e=await this.configFileManager.loadCustomConfig();e.success&&e.data&&this.modeConfigManager.populateCustomConfigForm(e.data)}async saveCustomConfigToFile(){const e=this.modeConfigManager.getCurrentConfig();await this.configFileManager.saveCustomConfig(e)}setLanguage(e){this.currentLanguage=e,this.configFileManager.setLanguage(e),this.modalManager.setLanguage(e),this.modeConfigManager.setLanguage(e),this.gpuConfigManager.setLanguage(e)}}function we(s){return new Promise((e,t)=>{if(!s)return e([]);if(typeof globalThis.ksu?.getPackagesInfo!="function")return t(new Error("ksu.getPackagesInfo is not available."));const a=Array.isArray(s)?s:[s];if(a.length===0)return e([]);try{const n=ksu.getPackagesInfo(JSON.stringify(a)),i=JSON.parse(n);!Array.isArray(s)&&i.length===1?e(i[0]):e(i)}catch(n){t(new Error(`Failed to get package info: ${n.message}`))}})}const N="/assets/icon-D9lcp6DU.png";class m{static appNameCache=new Map;static isValidAppName(e){if(!e)return!1;const t=e.trim();return t.length>0&&t.toLowerCase()!=="null"}static async fetchAppName(e){if(m.appNameCache.has(e))return m.appNameCache.get(e)??"";try{if(typeof globalThis.ksu?.getPackagesInfo=="function")try{const l=await globalThis.ksu.getPackagesInfo(e);if(m.isValidAppName(l.appLabel))return m.appNameCache.set(e,l.appLabel),l.appLabel}catch{}try{const l=await we(e);if(m.isValidAppName(l.appLabel))return m.appNameCache.set(e,l.appLabel),l.appLabel}catch{}if(typeof window.$packageManager<"u")try{const r=window.$packageManager.getApplicationInfo(e,0,0)?.getLabel?.();if(m.isValidAppName(r))return m.appNameCache.set(e,r),r}catch{}const{errno:t,stdout:a}=await f(`pm dump ${e} 2>/dev/null | grep "label=" | head -1 | sed 's/.*label=//' | cut -d' ' -f1`);if(t===0&&m.isValidAppName(a)){const l=a.trim();return m.appNameCache.set(e,l),l}const{errno:n,stdout:i}=await f(`pm path ${e} 2>/dev/null | head -1 | cut -d':' -f2`);if(n===0&&i.trim()){const l=i.trim(),{errno:r,stdout:g}=await f(`aapt dump badging "${l}" 2>/dev/null | grep "application-label:" | head -1 | sed "s/.*application-label:'\\([^']*\\)'.*/\\1/"`);if(r===0&&m.isValidAppName(g)){const d=g.trim();return m.appNameCache.set(e,d),d}}const o=m.getAppNameFromPackage(e);return m.appNameCache.set(e,o),o}catch{const a=m.getAppNameFromPackage(e);return m.appNameCache.set(e,a),a}}static getAppNameFromPackage(e){const t=e.split("."),a=t[t.length-1];return a.replace(/app$/i,"").replace(/client$/i,"").replace(/mobile$/i,"").replace(/([A-Z])/g," $1").trim().split(" ").map(i=>i.charAt(0).toUpperCase()+i.slice(1).toLowerCase()).join(" ")||a.charAt(0).toUpperCase()+a.slice(1)}static async loadAppIcon(e,t,a){try{if(typeof globalThis.ksu?.getPackagesInfo=="function"){const i=document.createElement("img");i.className="game-icon-loaded",i.alt=e,i.onload=()=>{a.style.display="none",i.style.opacity="1",t.innerHTML="",t.appendChild(i)},i.onerror=()=>{i.src=N,a.style.display="none",i.style.opacity="1"},i.src="ksu://icon/"+e;return}if(typeof window.$packageManager<"u")try{const i=window.$packageManager.getApplicationIcon(e,0,0);if(i){await m.loadWrapInputStream();const o=window.wrapInputStream;if(o){const r=await(await o(i)).arrayBuffer(),g=m.arrayBufferToBase64(r),d=m.createIconImage(e,g);m.applyIconTransition(d,t,a);return}}}catch{}const n=await m.extractIconFromApk(e);if(n){const i=m.createIconImage(e,n);m.applyIconTransition(i,t,a)}}catch{}}static async extractIconFromApk(e){const{errno:t,stdout:a}=await f(`pm path ${e} 2>/dev/null | head -1 | cut -d':' -f2`);if(t!==0||!a.trim())return null;const n=a.trim(),{errno:i,stdout:o}=await f(`aapt dump badging "${n}" 2>/dev/null | grep "application-icon-" | tail -1 | sed "s/.*'\\([^']*\\)'.*/\\1/"`);if(i!==0||!o.trim())return null;const l=o.trim(),r=`/data/local/tmp/icon_${Date.now()}_${Math.random().toString(36).substring(7)}.png`,{errno:g}=await f(`unzip -p "${n}" "${l}" > "${r}" 2>/dev/null`);if(g!==0)return await f(`rm -f "${r}" 2>/dev/null`),null;const{errno:d,stdout:p}=await f(`base64 "${r}" 2>/dev/null`);return await f(`rm -f "${r}" 2>/dev/null`),d===0&&p.trim()?p.trim():null}static createIconImage(e,t){const a=document.createElement("img");return a.className="game-icon-loaded",a.src=`data:image/png;base64,${t}`,a.alt=e,a}static applyIconTransition(e,t,a){e.onload=()=>{a.style.opacity="0",a.style.transition="opacity 0.3s ease",setTimeout(()=>{t.innerHTML="",e.style.opacity="0",t.appendChild(e),requestAnimationFrame(()=>{e.style.transition="opacity 0.3s ease",e.style.opacity="1"})},300)},e.onerror=()=>{e.src=N,a.style.display="none",e.style.opacity="1"}}static async loadWrapInputStream(){if(typeof window.wrapInputStream>"u")try{const a=await new Function("url","return import(url)")("https://mui.kernelsu.org/internal/assets/ext/wrapInputStream.mjs");window.wrapInputStream=a.wrapInputStream}catch{}}static arrayBufferToBase64(e){const t=new Uint8Array(e);let a="";for(const n of t)a+=String.fromCharCode(n);return btoa(a)}}class ye{editGameModal;closeGameModalBtn;packageNameInput;gameModeSelect;saveGameBtn;cancelGameBtn;gameModeContainer;selectedGameMode;gameModeOptions;currentLanguage;constructor(e){this.currentLanguage=e,this.editGameModal=document.getElementById("editGameModal"),this.closeGameModalBtn=document.querySelector(".close-game-modal"),this.packageNameInput=document.getElementById("packageNameInput"),this.gameModeSelect=document.getElementById("gameModeSelect"),this.saveGameBtn=document.getElementById("saveGameBtn"),this.cancelGameBtn=document.getElementById("cancelGameBtn"),this.gameModeContainer=document.getElementById("gameModeContainer"),this.selectedGameMode=document.getElementById("selectedGameMode"),this.gameModeOptions=document.getElementById("gameModeOptions")}init(e,t){this.closeGameModalBtn&&this.closeGameModalBtn.addEventListener("click",t),this.cancelGameBtn&&this.cancelGameBtn.addEventListener("click",t),this.saveGameBtn&&this.saveGameBtn.addEventListener("click",e),window.addEventListener("click",a=>{a.target===this.editGameModal&&t()}),window.addEventListener("keydown",a=>{a.key==="Escape"&&this.editGameModal&&this.editGameModal.style.display==="block"&&t()}),this.initGameModeSelect()}initGameModeSelect(){if(!this.gameModeContainer||!this.selectedGameMode||!this.gameModeOptions)return;this.selectedGameMode.addEventListener("click",t=>{t.stopPropagation(),this.gameModeContainer?.classList.toggle("open")});const e=this.gameModeOptions.querySelectorAll(".option");e.forEach(t=>{t.addEventListener("click",a=>{a.stopPropagation();const n=t.getAttribute("data-value"),i=t.textContent;this.selectedGameMode&&(this.selectedGameMode.textContent=i),this.gameModeSelect&&n&&(this.gameModeSelect.value=n,this.gameModeSelect.dispatchEvent(new Event("change"))),e.forEach(o=>{o.classList.remove("selected")}),t.classList.add("selected"),this.gameModeContainer?.classList.remove("open")})}),document.addEventListener("click",t=>{this.gameModeContainer?.contains(t.target)||this.gameModeContainer?.classList.remove("open")})}openForAdd(){this.packageNameInput&&(this.packageNameInput.value=""),this.gameModeSelect&&(this.gameModeSelect.value="balance"),this.updateGameModeSelectDisplay("balance"),this.editGameModal&&(this.editGameModal.style.display="block")}openForEdit(e,t){this.packageNameInput&&(this.packageNameInput.value=e),this.gameModeSelect&&(this.gameModeSelect.value=t),this.updateGameModeSelectDisplay(t),this.editGameModal&&(this.editGameModal.style.display="block")}close(){this.editGameModal&&(this.editGameModal.style.display="none")}getPackageName(){return this.packageNameInput?.value.trim()||""}getGameMode(){return this.gameModeSelect?.value||"balance"}updateGameModeSelectDisplay(e){if(!this.selectedGameMode||!this.gameModeOptions)return;const t=this.gameModeOptions.querySelector(`.option[data-value="${e}"]`);t&&(this.selectedGameMode.textContent=t.textContent,this.gameModeOptions.querySelectorAll(".option").forEach(n=>{n.classList.remove("selected")}),t.classList.add("selected"))}setLanguage(e){if(this.currentLanguage=e,this.gameModeSelect){const t=this.gameModeSelect.options;for(let a=0;a<t.length;a++){const n=t[a],o=`status_mode_${n.value}`;_[e]?.[o]&&(n.textContent=_[e][o])}}if(this.gameModeOptions&&this.gameModeOptions.querySelectorAll(".option").forEach(a=>{const i=`status_mode_${a.getAttribute("data-value")}`;_[e]?.[i]&&(a.textContent=_[e][i])}),this.selectedGameMode&&this.gameModeSelect){const a=`status_mode_${this.gameModeSelect.value}`;_[e]?.[a]&&(this.selectedGameMode.textContent=_[e][a])}}}class F{static parseTomlGames(e){try{const t=E(e);return t.games&&Array.isArray(t.games)?t.games.map(a=>({package:a.package||"",mode:a.mode||"balance"})):[]}catch{return[]}}static serializeTomlGames(e){const t=`# GPU调速器游戏列表配置文件

`,a={games:e.map(n=>({package:n.package,mode:n.mode||"balance"}))};return t+T(a)}}class Ce{currentLanguage;onEdit;onDelete;constructor(e,t,a){this.currentLanguage=e,this.onEdit=t,this.onDelete=a}setLanguage(e){this.currentLanguage=e}renderGamesList(e,t){if(e.innerHTML="",t.length===0){e.innerHTML=`<div class="loading-text">${c("config_games_not_found",{},this.currentLanguage)}</div>`;return}t.forEach((a,n)=>{const i=this.createGameCard(a,n);e.appendChild(i)})}createGameCard(e,t){const a=document.createElement("div");a.className="game-card",a.style.animationDelay=`${Math.min(t*.05,.5)}s`;const n=this.createGameHeader(e),i=this.createGameDetails(e,t);return a.appendChild(n),a.appendChild(i),a}createGameHeader(e){const t=document.createElement("div");t.className="game-header";const a=this.createIconContainer(e),n=this.createGameNameContainer(e);return t.appendChild(a),t.appendChild(n),t}createIconContainer(e){const t=document.createElement("div");t.className="game-icon-container";const n=(e.name||m.getAppNameFromPackage(e.package||"")).charAt(0).toUpperCase(),i=(e.package||"").split("").reduce((r,g)=>g.charCodeAt(0)+((r<<5)-r),0),o=Math.abs(i)%360,l=document.createElement("div");return l.className="game-icon-placeholder",l.textContent=n,l.style.background=`linear-gradient(135deg, hsl(${o}, 65%, 55%), hsl(${o+20}, 65%, 45%))`,t.appendChild(l),e.package&&m.loadAppIcon(e.package,t,l),t}createGameNameContainer(e){const t=document.createElement("div");t.className="game-name-container";const a=e.name||m.getAppNameFromPackage(e.package||""),n=document.createElement("h4");n.className="game-name",n.textContent=a,n.title=a;const i=document.createElement("span");return i.className="game-package",i.textContent=e.package||"",i.title=e.package||"",t.appendChild(n),t.appendChild(i),t}createGameDetails(e,t){const a=document.createElement("div");a.className="game-details";const n=this.getModeText(e.mode||"balance"),i=document.createElement("span");i.className=`game-mode-badge mode-${e.mode||"balance"}`,i.textContent=n,a.appendChild(i);const o=this.createActionButtons(t);return a.appendChild(o),a}createActionButtons(e){const t=document.createElement("div");t.className="game-actions";const a=document.createElement("button");a.className="game-edit-btn",a.innerHTML='<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>',a.title="编辑",a.onclick=i=>{i.stopPropagation(),this.onEdit(e)};const n=document.createElement("button");return n.className="game-delete-btn",n.innerHTML='<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"></path><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>',n.title="删除",n.onclick=i=>{i.stopPropagation(),this.onDelete(e)},t.appendChild(a),t.appendChild(n),t}getModeText(e){const t={zh:{powersave:"省电",balance:"均衡",performance:"性能",fast:"极速"},en:{powersave:"Powersave",balance:"Balance",performance:"Performance",fast:"Fast"}};return t[this.currentLanguage][e]||t[this.currentLanguage].balance}}class Le{gamesListData=[];currentLanguage="zh";gamesList;addGameBtn;saveGamesBtn;gamesSearchInput;editingIndex=-1;renderer;modal;constructor(){this.gamesList=document.getElementById("gamesList"),this.addGameBtn=document.getElementById("addGameBtn"),this.saveGamesBtn=document.getElementById("saveGamesBtn"),this.gamesSearchInput=document.getElementById("gamesSearchInput"),this.renderer=new Ce(this.currentLanguage,e=>this.editGameItem(e),e=>this.deleteGameItem(e)),this.modal=new ye(this.currentLanguage)}init(){this.setupEventListeners(),this.modal.init(()=>this.saveGameItem(),()=>this.closeGameModal()),this.gamesSearchInput&&(this.gamesSearchInput.placeholder=c("config_games_search_placeholder",{},this.currentLanguage))}setupEventListeners(){this.addGameBtn&&this.addGameBtn.addEventListener("click",()=>this.openGameModal()),this.saveGamesBtn&&this.saveGamesBtn.addEventListener("click",()=>this.saveGamesToFile()),this.gamesSearchInput&&this.gamesSearchInput.addEventListener("input",e=>{const t=e.target.value.toLowerCase();this.filterGamesList(t)})}filterGamesList(e){document.querySelectorAll(".game-card").forEach(a=>{const n=a.querySelector(".game-name")?.textContent?.toLowerCase()||"",i=a.querySelector(".game-package")?.textContent?.toLowerCase()||"";n.includes(e)||i.includes(e)?a.style.display="flex":a.style.display="none"})}async loadGamesList(){this.gamesList&&(this.gamesList.innerHTML=`<div class="loading-text">${c("status_loading",{},this.currentLanguage)}</div>`);const{errno:e,stdout:t}=await f(`cat ${v.GAMES_FILE}`);if(e===0&&t.trim()){const a=F.parseTomlGames(t.trim());a.length===0&&t.trim().length>0&&h(c("toast_games_parse_error",{},this.currentLanguage)),this.gamesListData=a,a.length>0?(this.refreshGamesList(),this.loadAppNamesAsync()):this.gamesList&&(this.gamesList.innerHTML=`<div class="loading-text">${c("config_games_not_found",{},this.currentLanguage)}</div>`)}else this.gamesList&&(this.gamesList.innerHTML=`<div class="loading-text">${c("config_games_list_not_found",{},this.currentLanguage)}</div>`)}async loadAppNamesAsync(){const e=this.gamesListData.filter(t=>t.package&&!t.name).map(async t=>{if(t.package){const a=await m.fetchAppName(t.package);t.name=a,"package"in t&&t.package&&this.updateGameCardName(t)}});await Promise.all(e)}updateGameCardName(e){if(!this.gamesList)return;this.gamesList.querySelectorAll(".game-card").forEach(a=>{if(a.querySelector(".game-package")?.textContent===e.package){const i=a.querySelector(".game-name");i&&e.name&&(i.textContent=e.name,i.setAttribute("title",e.name))}})}async loadAppNames(){const e=this.gamesListData.filter(t=>t.package&&!t.name).map(async t=>{t.package&&(t.name=await m.fetchAppName(t.package))});await Promise.all(e)}refreshGamesList(){this.gamesList&&this.renderer.renderGamesList(this.gamesList,this.gamesListData)}openGameModal(){this.modal.openForAdd(),this.editingIndex=-1}editGameItem(e){if(e<0||e>=this.gamesListData.length)return;const t=this.gamesListData[e];this.modal.openForEdit(t.package||"",t.mode||"balance"),this.editingIndex=e}closeGameModal(){this.modal.close(),this.editingIndex=-1}saveGameItem(){const e=this.modal.getPackageName(),t=this.modal.getGameMode();if(!e){h(c("toast_game_invalid",{},this.currentLanguage));return}if(this.editingIndex===-1){if(this.gamesListData.some(a=>a.package===e)){h(c("toast_game_exists",{},this.currentLanguage));return}this.gamesListData.push({package:e,mode:t})}else this.gamesListData[this.editingIndex].package=e,this.gamesListData[this.editingIndex].mode=t;this.closeGameModal(),this.refreshGamesList(),this.editingIndex===-1&&h(c("toast_game_added",{},this.currentLanguage))}deleteGameItem(e){e>=0&&e<this.gamesListData.length?(this.gamesListData.splice(e,1),this.refreshGamesList(),h(c("toast_game_deleted",{},this.currentLanguage))):h(c("toast_index_invalid",{},this.currentLanguage))}async saveGamesToFile(){if(this.gamesListData.length===0){h(c("toast_games_empty",{},this.currentLanguage));return}const e=F.serializeTomlGames(this.gamesListData),t=btoa(unescape(encodeURIComponent(e)));(await f(`echo '${t}' | base64 -d > ${v.GAMES_FILE}`)).errno===0?h(c("toast_games_saved",{},this.currentLanguage)):h(c("toast_games_save_fail",{},this.currentLanguage))}setLanguage(e){this.currentLanguage=e,this.gamesSearchInput&&(this.gamesSearchInput.placeholder=c("config_games_search_placeholder",{},this.currentLanguage)),this.renderer.setLanguage(e),this.modal.setLanguage(e),this.refreshGamesList()}}class be{currentLanguage="zh";logContent;refreshLogBtn;constructor(){this.logContent=document.getElementById("logContent"),this.refreshLogBtn=document.getElementById("refreshLogBtn")}init(){this.setupEventListeners(),this.initLogFileSelect()}setupEventListeners(){this.refreshLogBtn&&this.refreshLogBtn.addEventListener("click",()=>this.loadLog());const e=document.querySelectorAll(".log-tab-btn");e.forEach(t=>{t.addEventListener("click",()=>{t.classList.contains("active")||(e.forEach(a=>{a.classList.remove("active")}),t.classList.add("active"),this.logContent&&(this.logContent.style.opacity="0.5",this.logContent.textContent=c("log_loading",{},this.currentLanguage)),setTimeout(()=>{this.loadLog().then(()=>{this.logContent&&(this.logContent.style.opacity="1")})},100))})})}initLogFileSelect(){const e=document.querySelector(".log-tab-btn.active"),t=e?e.getAttribute("data-log"):"gpu_gov.log";document.querySelectorAll(".log-tab-btn").forEach(n=>{n.getAttribute("data-log")===t?n.classList.add("active"):n.classList.remove("active")})}async loadLog(){const e=document.querySelector(".log-tab-btn.active"),t=e?e.getAttribute("data-log"):"gpu_gov.log";this.logContent&&(this.logContent.textContent=c("log_loading",{},this.currentLanguage));const{errno:a,stdout:n}=await f(`cat ${v.LOG_PATH}/${t} 2>/dev/null || echo "日志文件不存在"`);if(n.trim()==="日志文件不存在"){this.logContent&&(this.logContent.textContent=c("log_not_found",{},this.currentLanguage));return}if(a===0){const o=n.trim().split(`
`).slice(-100).join(`
`);this.logContent&&(this.logContent.textContent=o||c("log_empty",{},this.currentLanguage)),this.logContent&&(this.logContent.scrollTop=this.logContent.scrollHeight)}else this.logContent&&(this.logContent.textContent=c("log_not_found",{},this.currentLanguage))}setLanguage(e){this.currentLanguage=e}}class Me{currentLanguage="zh";logLevelContainer;languageContainer;constructor(){this.logLevelContainer=document.getElementById("logLevelContainer"),this.languageContainer=document.getElementById("languageContainer")}init(){this.setupEventListeners(),this.loadLogLevel()}setupEventListeners(){if(this.logLevelContainer){const e=this.logLevelContainer.querySelectorAll(".settings-tab-btn");e.forEach(t=>{t.addEventListener("click",a=>{a.preventDefault(),e.forEach(n=>{n.classList.remove("active")}),t.classList.add("active"),this.saveLogLevel()})})}if(this.languageContainer){const e=this.languageContainer.querySelectorAll(".settings-tab-btn");e.forEach(t=>{t.addEventListener("click",async a=>{a.preventDefault(),e.forEach(l=>{l.classList.remove("active")}),t.classList.add("active");const n=t.getAttribute("data-value");localStorage.setItem("languageSetting",n);let i="zh";if(n==="system"){const{errno:l,stdout:r}=await f('getprop persist.sys.locale || getprop ro.product.locale || echo "zh-CN"');l===0&&r.trim()&&(i=r.trim().toLowerCase().startsWith("en")?"en":"zh"),localStorage.setItem("language",i),h(c("toast_language_follow_system",{},i))}else i=n,localStorage.setItem("language",n),h(c("toast_language_changed",{language:n==="zh"?"中文":"English"},i));this.currentLanguage=i;const o=new CustomEvent("languageChange",{detail:{language:i}});document.dispatchEvent(o)})})}}async loadLogLevel(){const{errno:e,stdout:t}=await f(`cat ${v.LOG_LEVEL_PATH} 2>/dev/null || echo "info"`);let a="info";if(e===0){const n=t.trim().toLowerCase();["debug","info","warn","error"].includes(n)&&(a=n)}this.logLevelContainer&&this.logLevelContainer.querySelectorAll(".settings-tab-btn").forEach(i=>{i.getAttribute("data-value")===a?i.classList.add("active"):i.classList.remove("active")})}async saveLogLevel(){if(!this.logLevelContainer)return;const e=this.logLevelContainer.querySelector(".settings-tab-btn.active");if(!e)return;const t=e.getAttribute("data-value"),{errno:a}=await f(`echo "${t}" > ${v.LOG_LEVEL_PATH}`);h(a===0?t==="debug"?c("toast_log_level_debug",{},this.currentLanguage):c("toast_log_level_set",{level:t||""},this.currentLanguage):c("toast_log_level_fail",{},this.currentLanguage))}setLanguage(e){this.currentLanguage=e}}class Se{themeToggle;followSystemThemeToggle;followSystemThemeSuperSwitch;currentLanguage="zh";constructor(){this.themeToggle=document.getElementById("themeToggle"),this.followSystemThemeToggle=document.querySelector("#followSystemThemeToggle .miuix-switch-input"),this.followSystemThemeSuperSwitch=document.getElementById("followSystemThemeSuperSwitch")}init(){this.initTheme(),this.setupEventListeners()}initTheme(){const e=localStorage.getItem("theme"),t=window.matchMedia?.("(prefers-color-scheme: dark)").matches,a=localStorage.getItem("followSystemTheme"),n=a===null?!0:a==="true";this.followSystemThemeToggle&&(this.followSystemThemeToggle.checked=n),a===null&&localStorage.setItem("followSystemTheme","true");let i;if(n?i=t?"dark":"light":e?i=e:i=t?"dark":"light",document.documentElement.setAttribute("data-theme",i),localStorage.setItem("theme",i),window.matchMedia){const o=window.matchMedia("(prefers-color-scheme: dark)");o.addEventListener&&o.addEventListener("change",l=>{if(localStorage.getItem("followSystemTheme")==="true"){const r=l.matches?"dark":"light";document.documentElement.setAttribute("data-theme",r),localStorage.setItem("theme",r)}})}}setupEventListeners(){this.themeToggle&&this.themeToggle.addEventListener("click",()=>this.toggleTheme()),this.followSystemThemeSuperSwitch&&(this.followSystemThemeSuperSwitch.addEventListener("click",e=>this.handleFollowSystemToggleClick(e)),this.followSystemThemeSuperSwitch.addEventListener("keydown",e=>{(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),e.currentTarget.click())}),this.followSystemThemeSuperSwitch.setAttribute("tabindex","0"),this.followSystemThemeSuperSwitch.setAttribute("role","switch"),this.followSystemThemeSuperSwitch.setAttribute("aria-checked",this.followSystemThemeToggle?.checked?"true":"false")),this.followSystemThemeToggle&&this.followSystemThemeToggle.addEventListener("change",()=>this.handleFollowSystemChange())}toggleTheme(){this.themeToggle&&this.themeToggle.classList.add("switching"),localStorage.getItem("followSystemTheme")==="true"&&(localStorage.setItem("followSystemTheme","false"),this.followSystemThemeToggle&&(this.followSystemThemeToggle.checked=!1),h(c("toast_theme_follow_disabled",{},this.currentLanguage)));const t=document.documentElement.getAttribute("data-theme")==="light"?"dark":"light";document.documentElement.style.transition="background-color 0.3s ease, color 0.3s ease",document.documentElement.setAttribute("data-theme",t),localStorage.setItem("theme",t),setTimeout(()=>{this.themeToggle&&this.themeToggle.classList.remove("switching"),document.documentElement.style.transition=""},600),h(c(t==="dark"?"toast_theme_switched_dark":"toast_theme_switched_light",{},this.currentLanguage))}handleFollowSystemToggleClick(e){e.target!==this.followSystemThemeToggle&&(e.preventDefault(),navigator.vibrate&&navigator.vibrate(50),this.followSystemThemeToggle&&(this.followSystemThemeToggle.checked=!this.followSystemThemeToggle.checked,this.followSystemThemeToggle.dispatchEvent(new Event("change",{bubbles:!0}))))}handleFollowSystemChange(){const e=!!this.followSystemThemeToggle?.checked;if(localStorage.setItem("followSystemTheme",e.toString()),this.followSystemThemeSuperSwitch&&this.followSystemThemeSuperSwitch.setAttribute("aria-checked",e?"true":"false"),this.followSystemThemeSuperSwitch&&(this.followSystemThemeSuperSwitch.style.transform="scale(0.98)",setTimeout(()=>{this.followSystemThemeSuperSwitch&&(this.followSystemThemeSuperSwitch.style.transform="")},150)),e){const t=window.matchMedia?.("(prefers-color-scheme: dark)").matches?"dark":"light";document.documentElement.setAttribute("data-theme",t),localStorage.setItem("theme",t),h(c("toast_theme_follow_enabled",{},this.currentLanguage))}else h(c("toast_theme_follow_keep",{},this.currentLanguage))}setLanguage(e){this.currentLanguage=e}}class Ee{currentLanguage="zh";currentPage="page-status";statusPageLoaded=!1;configPageLoaded=!1;logPageLoaded=!1;settingsPageLoaded=!1;statusCache={mode:{value:"unknown",timestamp:0,ttl:2e3},running:{value:!1,timestamp:0,ttl:2e3},version:{value:"",timestamp:0,ttl:6e4}};isRefreshing=!1;app;loading;htmlRoot;moduleVersion;currentMode;runningStatus;pages;navItems;languageContainer;themeManager;configManager;gamesManager;logManager;settingsManager;constructor(){this.app=document.getElementById("app"),this.loading=document.getElementById("loading"),this.htmlRoot=document.getElementById("htmlRoot"),this.moduleVersion=document.getElementById("moduleVersion"),this.currentMode=document.getElementById("currentMode"),this.runningStatus=document.getElementById("runningStatus"),this.pages=document.querySelectorAll(".page"),this.navItems=document.querySelectorAll(".nav-item"),this.languageContainer=document.getElementById("languageContainer"),this.themeManager=new Se,this.configManager=new ve,this.gamesManager=new Le,this.logManager=new be,this.settingsManager=new Me}async init(){this.loading&&(this.loading.style.display="none"),this.app&&(this.app.style.display="block"),this.themeManager.init(),this.configManager.init(),this.gamesManager.init(),this.logManager.init(),this.settingsManager.init(),await this.initLanguage(),this.setupLanguageEvents(),this.setupNavigationEvents(),this.loadData().catch(()=>{}),this.startStatusRefreshLoop(),h(c("toast_webui_loaded",{},this.currentLanguage))}async startStatusRefreshLoop(){const e=async()=>{this.statusPageLoaded&&this.currentPage==="page-status"&&await this.refreshStatusIfNeeded(),setTimeout(e,1e3)};e()}async refreshStatusIfNeeded(){if(this.isRefreshing)return;const e=Date.now(),t={mode:e-this.statusCache.mode.timestamp>this.statusCache.mode.ttl,running:e-this.statusCache.running.timestamp>this.statusCache.running.ttl,version:e-this.statusCache.version.timestamp>this.statusCache.version.ttl};if(t.mode||t.running||t.version){this.isRefreshing=!0;try{const a=[];t.mode&&a.push(this.loadCurrentMode()),t.running&&a.push(this.checkModuleStatus()),t.version&&a.push(this.loadModuleVersion()),await Promise.allSettled(a)}finally{this.isRefreshing=!1}}}setupNavigationEvents(){this.navItems.forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-page");t&&this.switchPage(t)})})}setupLanguageEvents(){document.addEventListener("languageChange",e=>{const t=e,{language:a}=t.detail;this.currentLanguage=a,this.themeManager.setLanguage(this.currentLanguage),this.configManager.setLanguage(this.currentLanguage),this.gamesManager.setLanguage(this.currentLanguage),this.logManager.setLanguage(this.currentLanguage),this.settingsManager.setLanguage(this.currentLanguage),this.applyTranslations(),this.loadModuleVersion(),this.loadCurrentMode(),this.checkModuleStatus()})}async initLanguage(){const e=localStorage.getItem("languageSetting"),t=localStorage.getItem("language");e===null&&localStorage.setItem("languageSetting","system"),e==="system"||e===null?(this.currentLanguage=await this.detectSystemLanguage(),localStorage.setItem("language",this.currentLanguage)):t&&(this.currentLanguage=t),this.themeManager.setLanguage(this.currentLanguage),this.configManager.setLanguage(this.currentLanguage),this.gamesManager.setLanguage(this.currentLanguage),this.logManager.setLanguage(this.currentLanguage),this.settingsManager.setLanguage(this.currentLanguage),this.applyTranslations(),this.updateSelectedLanguageText(e||"system"),this.setupLanguageEvents()}async detectSystemLanguage(){const e=navigator,t=navigator.language||e.userLanguage||"zh-CN",{errno:a,stdout:n}=await f('getprop persist.sys.locale || getprop ro.product.locale || echo "zh-CN"');return a===0&&n.trim()?n.trim().toLowerCase().startsWith("en")?"en":"zh":t.startsWith("en")?"en":"zh"}applyTranslations(){document.title=c("title",{},this.currentLanguage),this.htmlRoot&&this.htmlRoot.setAttribute("lang",this.currentLanguage==="en"?"en":"zh-CN"),this.loading&&(this.loading.textContent=c("loading",{},this.currentLanguage));const e=document.querySelector(".header-content h1");e&&(e.textContent=c("header_title",{},this.currentLanguage)),document.querySelectorAll(".nav-item").forEach(t=>{const a=t.getAttribute("data-page"),n=t.querySelector(".nav-text");n&&(a==="page-status"?n.textContent=c("nav_status",{},this.currentLanguage):a==="page-config"?n.textContent=c("nav_config",{},this.currentLanguage):a==="page-log"?n.textContent=c("nav_log",{},this.currentLanguage):a==="page-settings"&&(n.textContent=c("nav_settings",{},this.currentLanguage)))}),document.querySelectorAll("[data-i18n]").forEach(t=>{const a=t.getAttribute("data-i18n");a&&_[this.currentLanguage]&&_[this.currentLanguage][a]&&(t.textContent=c(a,{},this.currentLanguage))}),document.querySelectorAll("[data-i18n-placeholder]").forEach(t=>{const a=t.getAttribute("data-i18n-placeholder");a&&_[this.currentLanguage]&&_[this.currentLanguage][a]&&(t.placeholder=c(a,{},this.currentLanguage))})}updateSelectedLanguageText(e){if(!this.languageContainer)return;this.languageContainer.querySelectorAll(".settings-tab-btn").forEach(n=>{n.classList.remove("active")});const a=this.languageContainer.querySelector(`.settings-tab-btn[data-value="${e}"]`);if(a)a.classList.add("active");else{const n=this.languageContainer.querySelector('.settings-tab-btn[data-value="system"]');n&&n.classList.add("active")}}async loadData(){this.statusPageLoaded=!0,await Promise.all([this.checkModuleStatus(),this.loadModuleVersion(),this.loadCurrentMode()]).catch(()=>{}),this.switchPage("page-status")}switchPage(e){this.pages.forEach(a=>{a.classList.remove("active")});const t=document.getElementById(e);t&&t.classList.add("active"),this.navItems.forEach(a=>{a.getAttribute("data-page")===e?a.classList.add("active"):a.classList.remove("active")}),this.currentPage=e,this.lazyLoadPageData(e)}async lazyLoadPageData(e){switch(e){case"page-status":this.statusPageLoaded||(this.statusPageLoaded=!0,await Promise.all([this.checkModuleStatus(),this.loadModuleVersion(),this.loadCurrentMode()]).catch(()=>{}));break;case"page-config":this.configPageLoaded||(this.configPageLoaded=!0,await Promise.all([this.configManager.loadAllConfigData(),this.gamesManager.loadGamesList()]).catch(()=>{}));break;case"page-log":this.logPageLoaded||(this.logPageLoaded=!0,this.logManager.loadLog().catch(()=>{}));break;case"page-settings":this.settingsPageLoaded||(this.settingsPageLoaded=!0,this.settingsManager.loadLogLevel().catch(()=>{}));break}}async checkModuleStatus(){try{const{errno:e,stdout:t}=await f('pgrep -f gpugovernor || echo ""'),a=e===0&&t.trim();this.statusCache.running.value=!!a,this.statusCache.running.timestamp=Date.now();const n=this.runningStatus?.classList.contains("status-running");a!==n&&this.runningStatus&&(this.runningStatus.classList.add("status-changing"),this.runningStatus.removeAttribute("data-i18n"),setTimeout(()=>{a&&this.runningStatus?(this.runningStatus.textContent=c("status_running_active",{},this.currentLanguage),this.runningStatus.className="status-badge status-running"):this.runningStatus&&(this.runningStatus.textContent=c("status_running_inactive",{},this.currentLanguage),this.runningStatus.className="status-badge status-stopped"),setTimeout(()=>{this.runningStatus?.classList.remove("status-changing")},600)},100))}catch{}}async loadModuleVersion(){try{const{errno:e,stdout:t}=await f('grep -i "^version=" /data/adb/modules/Mediatek_Mali_GPU_Governor/module.prop | cut -d= -f2');if(e===0&&t.trim()){this.moduleVersion&&(this.moduleVersion.textContent=t.trim(),this.moduleVersion.removeAttribute("data-i18n"),this.statusCache.version.value=t.trim(),this.statusCache.version.timestamp=Date.now());return}const{errno:a,stdout:n}=await f('grep -i "^version=" /data/adb/ksu/modules/Mediatek_Mali_GPU_Governor/module.prop | cut -d= -f2');if(a===0&&n.trim()){this.moduleVersion&&(this.moduleVersion.textContent=n.trim(),this.moduleVersion.removeAttribute("data-i18n"),this.statusCache.version.value=n.trim(),this.statusCache.version.timestamp=Date.now());return}this.moduleVersion&&(this.moduleVersion.textContent=this.currentLanguage==="en"?"Unknown":"未知",this.moduleVersion.removeAttribute("data-i18n"),this.statusCache.version.value="unknown",this.statusCache.version.timestamp=Date.now())}catch{}}async loadCurrentMode(){try{const{errno:e,stdout:t}=await f(`cat ${v.CURRENT_MODE_PATH} 2>/dev/null || echo "unknown"`);let a="unknown";if(e===0&&(a=t.trim().toLowerCase()),["powersave","balance","performance","fast"].includes(a)||(a="unknown"),this.statusCache.mode.value=a,this.statusCache.mode.timestamp=Date.now(),this.currentMode){const i={powersave:c("status_mode_powersave",{},this.currentLanguage),balance:c("status_mode_balance",{},this.currentLanguage),performance:c("status_mode_performance",{},this.currentLanguage),fast:c("status_mode_fast",{},this.currentLanguage),unknown:c("status_mode_unknown",{},this.currentLanguage)};this.currentMode.textContent=i[a]||i.unknown,this.currentMode.className=`mode-badge ${a}`,this.currentMode.removeAttribute("data-i18n")}}catch{if(this.statusCache.mode.value!=="unknown"&&this.currentMode){const t=this.statusCache.mode.value,a={powersave:c("status_mode_powersave",{},this.currentLanguage),balance:c("status_mode_balance",{},this.currentLanguage),performance:c("status_mode_performance",{},this.currentLanguage),fast:c("status_mode_fast",{},this.currentLanguage),unknown:c("status_mode_unknown",{},this.currentLanguage)};this.currentMode.textContent=a[t]||a.unknown,this.currentMode.className=`mode-badge ${t}`}}}}document.addEventListener("DOMContentLoaded",async()=>{await new Ee().init()});
